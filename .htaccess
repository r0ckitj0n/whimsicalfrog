# No rewrites; host-safe routing via ErrorDocument
# Disable MultiViews so hashed Vite asset filenames (e.g., app.js-<hash>.js) are served exactly
Options -MultiViews
DirectoryIndex index.php
ErrorDocument 404 /router.php
ErrorDocument 403 /router.php

<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteBase /
  # Serve existing files or directories directly
  RewriteCond %{REQUEST_FILENAME} -f [OR]
  RewriteCond %{REQUEST_FILENAME} -d
  RewriteRule ^ - [L]
  # Route all other requests to index.php (clean URLs like /shop)
  RewriteRule ^ index.php [L]
  
</IfModule>

# --- Security: deny access to sensitive files ---
<IfModule mod_authz_core.c>
  <FilesMatch "^(\.env|composer\.(json|lock)|phpunit\.xml(\.dist)?|.*\.sql)$">
    Require all denied
  </FilesMatch>
  # Explicitly protect filesystem secret key
  <Files "secret.key">
    Require all denied
  </Files>
</IfModule>

# Legacy Apache (2.2) fallback
<IfModule !mod_authz_core.c>
  <FilesMatch "^(\.env|composer\.(json|lock)|phpunit\.xml(\.dist)?|.*\.sql)$">
    Order allow,deny
    Deny from all
  </FilesMatch>
  <Files "secret.key">
    Order allow,deny
    Deny from all
  </Files>
</IfModule>
