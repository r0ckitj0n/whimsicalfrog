<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSS Conflict Test - Shop Page Viewport Width</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status {
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            font-weight: bold;
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .css-rule {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            margin: 5px 0;
            font-family: monospace;
            font-size: 12px;
        }
        .applied { border-left: 4px solid #28a745; }
        .overridden { border-left: 4px solid #dc3545; }
        .conflict { border-left: 4px solid #ffc107; }
        iframe {
            width: 100%;
            height: 400px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üîç CSS Conflict Analysis - Shop Page Viewport Width</h1>
        <p><strong>Analyzing CSS rule conflicts that prevent full viewport width utilization.</strong></p>

        <!-- Test Results -->
        <div class="test-section">
            <h2>üìä CSS Rule Analysis</h2>
            <div id="testResults">
                <div class="status info">
                    <strong>ANALYZING:</strong> Checking which CSS rules are being applied to #shopPage...
                </div>
            </div>
            
            <div id="cssAnalysis" style="margin-top: 15px;">
                <!-- CSS analysis will be populated by JavaScript -->
            </div>
        </div>

        <!-- Shop Page Preview -->
        <div class="test-section">
            <h2>üñ•Ô∏è Shop Page Preview</h2>
            <iframe id="shopFrame" src="http://localhost:8000/?page=shop"></iframe>
        </div>
    </div>

    <script>
        function analyzeCSSConflicts() {
            const iframe = document.getElementById('shopFrame');
            const resultsDiv = document.getElementById('testResults');
            const analysisDiv = document.getElementById('cssAnalysis');
            
            iframe.onload = function() {
                try {
                    const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                    const iframeWindow = iframe.contentWindow;
                    
                    const shopPage = iframeDoc.querySelector('#shopPage');
                    const productsGrid = iframeDoc.querySelector('#productsGrid');
                    
                    if (!shopPage) {
                        resultsDiv.innerHTML = `
                            <div class="status error">
                                <strong>ERROR:</strong> #shopPage element not found in iframe
                            </div>
                        `;
                        return;
                    }
                    
                    // Get computed styles
                    const shopStyles = iframeWindow.getComputedStyle(shopPage);
                    const viewportWidth = iframeWindow.innerWidth;
                    const shopWidth = shopPage.offsetWidth;
                    
                    // Analyze key CSS properties
                    const cssProperties = {
                        'width': shopStyles.width,
                        'max-width': shopStyles.maxWidth,
                        'position': shopStyles.position,
                        'left': shopStyles.left,
                        'margin-left': shopStyles.marginLeft,
                        'margin-right': shopStyles.marginRight,
                        'padding': shopStyles.padding,
                        'box-sizing': shopStyles.boxSizing
                    };
                    
                    // Check if viewport breakout is working
                    const isFullWidth = shopWidth >= viewportWidth * 0.95;
                    const hasBreakoutPosition = shopStyles.position === 'relative' && shopStyles.left === '50%';
                    const hasBreakoutMargins = shopStyles.marginLeft.includes('vw') || shopStyles.marginLeft.includes('-');
                    
                    // Display results
                    resultsDiv.innerHTML = `
                        <div class="status ${isFullWidth ? 'success' : 'error'}">
                            <strong>${isFullWidth ? 'SUCCESS' : 'ISSUE DETECTED'}:</strong> 
                            ${isFullWidth ? 
                                'Viewport width breakout is working!' : 
                                'CSS conflicts preventing full viewport width utilization.'
                            }
                        </div>
                    `;
                    
                    // Display CSS analysis
                    let analysisHTML = '<h3>CSS Property Analysis:</h3>';
                    
                    // Check each property
                    Object.entries(cssProperties).forEach(([prop, value]) => {
                        let status = 'applied';
                        let explanation = '';
                        
                        if (prop === 'width' && value !== '100vw' && !isFullWidth) {
                            status = 'conflict';
                            explanation = 'Should be 100vw for full viewport width';
                        } else if (prop === 'position' && value !== 'relative' && !isFullWidth) {
                            status = 'conflict';
                            explanation = 'Should be relative for breakout technique';
                        } else if (prop === 'left' && value !== '50%' && !isFullWidth) {
                            status = 'conflict';
                            explanation = 'Should be 50% for breakout technique';
                        } else if (prop === 'margin-left' && !value.includes('vw') && !isFullWidth) {
                            status = 'conflict';
                            explanation = 'Should be -50vw for breakout technique';
                        }
                        
                        analysisHTML += `
                            <div class="css-rule ${status}">
                                <strong>${prop}:</strong> ${value}
                                ${explanation ? `<br><small style="color: #666;">${explanation}</small>` : ''}
                            </div>
                        `;
                    });
                    
                    // Add summary
                    analysisHTML += `
                        <h3>Summary:</h3>
                        <div class="css-rule ${isFullWidth ? 'applied' : 'conflict'}">
                            <strong>Viewport Width Utilization:</strong> ${Math.round((shopWidth / viewportWidth) * 100)}%<br>
                            <small>Expected: ‚â•95% for full width utilization</small>
                        </div>
                        <div class="css-rule ${hasBreakoutPosition ? 'applied' : 'conflict'}">
                            <strong>Breakout Position:</strong> ${hasBreakoutPosition ? 'Correctly applied' : 'Not applied'}<br>
                            <small>position: relative; left: 50%</small>
                        </div>
                        <div class="css-rule ${hasBreakoutMargins ? 'applied' : 'conflict'}">
                            <strong>Breakout Margins:</strong> ${hasBreakoutMargins ? 'Correctly applied' : 'Not applied'}<br>
                            <small>margin-left: -50vw; margin-right: -50vw</small>
                        </div>
                    `;
                    
                    analysisDiv.innerHTML = analysisHTML;
                    
                } catch (error) {
                    resultsDiv.innerHTML = `
                        <div class="status error">
                            <strong>ERROR:</strong> Could not access iframe content. ${error.message}
                        </div>
                    `;
                }
            };
        }
        
        // Run analysis when page loads
        analyzeCSSConflicts();
        
        // Re-run analysis every 3 seconds to catch dynamic changes
        setInterval(analyzeCSSConflicts, 3000);
    </script>
</body>
</html>
