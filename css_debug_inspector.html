<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSS Debug Inspector</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .debug-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .status {
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
            font-weight: bold;
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        
        .css-rule {
            font-family: monospace;
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            margin: 5px 0;
            border-left: 4px solid #007bff;
            white-space: pre-wrap;
        }
        .css-rule.overridden {
            border-left-color: #dc3545;
            background: #fff5f5;
            text-decoration: line-through;
            opacity: 0.7;
        }
        .css-rule.active {
            border-left-color: #28a745;
            background: #f8fff9;
        }
        
        iframe {
            width: 100%;
            height: 500px;
            border: 2px solid #ddd;
            border-radius: 4px;
        }
        
        .debug-controls {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
        }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <h1>üîç CSS Debug Inspector - Live Shop Page</h1>
    
    <div class="debug-container">
        <h2>Computed Style Analysis</h2>
        <div id="computed-styles">
            <div class="info">Loading shop page and analyzing computed styles...</div>
        </div>
        
        <div class="debug-controls">
            <button onclick="analyzeComputedStyles()">üî¨ Analyze Computed Styles</button>
            <button onclick="checkCSSRules()">üìã Check CSS Rules</button>
            <button onclick="findConstraints()">üö´ Find Constraints</button>
            <button onclick="measureElements()">üìè Measure Elements</button>
        </div>
    </div>

    <div class="debug-container">
        <h2>Live Shop Page</h2>
        <iframe id="shopFrame" src="http://localhost:8000/?page=shop"></iframe>
    </div>

    <script>
        let iframe, iframeDoc, iframeWindow;
        
        function initializeDebugger() {
            iframe = document.getElementById('shopFrame');
            
            iframe.onload = function() {
                try {
                    iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                    iframeWindow = iframe.contentWindow;
                    analyzeComputedStyles();
                } catch (error) {
                    document.getElementById('computed-styles').innerHTML = `
                        <div class="error">‚ùå Cannot access iframe content: ${error.message}</div>
                    `;
                }
            };
        }
        
        function analyzeComputedStyles() {
            const resultsDiv = document.getElementById('computed-styles');
            
            if (!iframeDoc || !iframeWindow) {
                resultsDiv.innerHTML = '<div class="error">‚ùå Shop page not loaded</div>';
                return;
            }
            
            // Get elements
            const mainElement = iframeDoc.getElementById('mainContent');
            const shopPage = iframeDoc.getElementById('shopPage');
            const productsGrid = iframeDoc.getElementById('productsGrid');
            
            if (!mainElement || !shopPage || !productsGrid) {
                resultsDiv.innerHTML = `
                    <div class="error">
                        ‚ùå Missing elements: 
                        Main: ${mainElement ? '‚úÖ' : '‚ùå'}, 
                        Shop: ${shopPage ? '‚úÖ' : '‚ùå'}, 
                        Grid: ${productsGrid ? '‚úÖ' : '‚ùå'}
                    </div>
                `;
                return;
            }
            
            // Get computed styles
            const mainStyles = iframeWindow.getComputedStyle(mainElement);
            const shopStyles = iframeWindow.getComputedStyle(shopPage);
            const gridStyles = iframeWindow.getComputedStyle(productsGrid);
            
            // Get measurements
            const viewportWidth = iframeWindow.innerWidth;
            const mainWidth = mainElement.offsetWidth;
            const shopWidth = shopPage.offsetWidth;
            const gridWidth = productsGrid.offsetWidth;
            
            // Analyze key properties
            const gridMaxWidth = gridStyles.maxWidth;
            const gridWidth_css = gridStyles.width;
            const gridDisplay = gridStyles.display;
            const gridTemplateColumns = gridStyles.gridTemplateColumns;
            const gridJustifyContent = gridStyles.justifyContent;
            const gridPadding = gridStyles.padding;
            const gridMargin = gridStyles.margin;
            const gridBoxSizing = gridStyles.boxSizing;
            
            // Check parent constraints
            const mainMaxWidth = mainStyles.maxWidth;
            const mainWidth_css = mainStyles.width;
            const mainPadding = mainStyles.padding;
            const mainMargin = mainStyles.margin;
            
            // Calculate utilization
            const gridUtil = (gridWidth / viewportWidth * 100).toFixed(1);
            const isFullWidth = gridUtil >= 85;
            
            // Check if our fix is applied
            const hasMaxWidthNone = gridMaxWidth === 'none';
            const hasWidthConstraint = gridMaxWidth !== 'none' && !gridMaxWidth.includes('100%');
            
            let statusHTML = '';
            if (isFullWidth && hasMaxWidthNone) {
                statusHTML = '<div class="success">üéâ SUCCESS: CSS fix is applied and working!</div>';
            } else if (hasMaxWidthNone && !isFullWidth) {
                statusHTML = '<div class="warning">‚ö†Ô∏è CSS fix applied but other constraints exist</div>';
            } else if (!hasMaxWidthNone) {
                statusHTML = '<div class="error">‚ùå CSS fix NOT applied - max-width constraint still exists</div>';
            } else {
                statusHTML = '<div class="error">‚ùå Unknown issue preventing full width</div>';
            }
            
            resultsDiv.innerHTML = statusHTML + `
                <h3>üéØ Grid Element Analysis</h3>
                <div class="css-rule ${hasMaxWidthNone ? 'active' : 'overridden'}">
                    max-width: ${gridMaxWidth} ${hasMaxWidthNone ? '‚úÖ FIXED' : '‚ùå CONSTRAINT'}
                </div>
                <div class="css-rule">width: ${gridWidth_css}</div>
                <div class="css-rule">display: ${gridDisplay}</div>
                <div class="css-rule">grid-template-columns: ${gridTemplateColumns}</div>
                <div class="css-rule">justify-content: ${gridJustifyContent}</div>
                <div class="css-rule">padding: ${gridPadding}</div>
                <div class="css-rule">margin: ${gridMargin}</div>
                <div class="css-rule">box-sizing: ${gridBoxSizing}</div>
                
                <h3>üì¶ Container Analysis</h3>
                <div class="css-rule">Main max-width: ${mainMaxWidth}</div>
                <div class="css-rule">Main width: ${mainWidth_css}</div>
                <div class="css-rule">Main padding: ${mainPadding}</div>
                <div class="css-rule">Main margin: ${mainMargin}</div>
                
                <h3>üìä Measurements</h3>
                <div class="css-rule">Viewport: ${viewportWidth}px</div>
                <div class="css-rule">Main: ${mainWidth}px (${(mainWidth/viewportWidth*100).toFixed(1)}%)</div>
                <div class="css-rule">Shop: ${shopWidth}px (${(shopWidth/viewportWidth*100).toFixed(1)}%)</div>
                <div class="css-rule ${isFullWidth ? 'active' : 'overridden'}">
                    Grid: ${gridWidth}px (${gridUtil}%) ${isFullWidth ? '‚úÖ GOOD' : '‚ùå CONSTRAINED'}
                </div>
            `;
        }
        
        function checkCSSRules() {
            if (!iframeDoc || !iframeWindow) return;
            
            const productsGrid = iframeDoc.getElementById('productsGrid');
            if (!productsGrid) return;
            
            // Get all stylesheets
            const stylesheets = Array.from(iframeDoc.styleSheets);
            const matchingRules = [];
            
            stylesheets.forEach((stylesheet, index) => {
                try {
                    const rules = Array.from(stylesheet.cssRules || stylesheet.rules || []);
                    rules.forEach(rule => {
                        if (rule.selectorText && rule.selectorText.includes('productsGrid')) {
                            matchingRules.push({
                                selector: rule.selectorText,
                                cssText: rule.cssText,
                                stylesheet: stylesheet.href || `<style> block ${index}`,
                                maxWidth: rule.style.maxWidth
                            });
                        }
                    });
                } catch (e) {
                    // Cross-origin or other access issues
                }
            });
            
            const resultsDiv = document.getElementById('computed-styles');
            let rulesHTML = '<h3>üîç Matching CSS Rules</h3>';
            
            if (matchingRules.length === 0) {
                rulesHTML += '<div class="warning">‚ö†Ô∏è No CSS rules found for #productsGrid</div>';
            } else {
                matchingRules.forEach(rule => {
                    rulesHTML += `
                        <div class="css-rule">
                            <strong>Selector:</strong> ${rule.selector}<br>
                            <strong>Source:</strong> ${rule.stylesheet}<br>
                            <strong>Max-Width:</strong> ${rule.maxWidth || 'not set'}<br>
                            <strong>Full Rule:</strong><br>
                            ${rule.cssText}
                        </div>
                    `;
                });
            }
            
            resultsDiv.innerHTML = rulesHTML;
        }
        
        function findConstraints() {
            if (!iframeDoc || !iframeWindow) return;
            
            const productsGrid = iframeDoc.getElementById('productsGrid');
            if (!productsGrid) return;
            
            const constraints = [];
            let element = productsGrid;
            
            // Walk up the DOM tree checking for constraints
            while (element && element !== iframeDoc.body) {
                const styles = iframeWindow.getComputedStyle(element);
                const maxWidth = styles.maxWidth;
                const width = styles.width;
                const elementWidth = element.offsetWidth;
                const viewportWidth = iframeWindow.innerWidth;
                
                if (maxWidth !== 'none' && !maxWidth.includes('100%')) {
                    constraints.push({
                        element: element.tagName + (element.id ? '#' + element.id : '') + (element.className ? '.' + element.className.split(' ').join('.') : ''),
                        property: 'max-width',
                        value: maxWidth,
                        actualWidth: elementWidth,
                        utilization: (elementWidth / viewportWidth * 100).toFixed(1) + '%'
                    });
                }
                
                if (elementWidth < viewportWidth * 0.9) {
                    constraints.push({
                        element: element.tagName + (element.id ? '#' + element.id : '') + (element.className ? '.' + element.className.split(' ').join('.') : ''),
                        property: 'actual width',
                        value: elementWidth + 'px',
                        actualWidth: elementWidth,
                        utilization: (elementWidth / viewportWidth * 100).toFixed(1) + '%'
                    });
                }
                
                element = element.parentElement;
            }
            
            const resultsDiv = document.getElementById('computed-styles');
            let constraintsHTML = '<h3>üö´ Found Constraints</h3>';
            
            if (constraints.length === 0) {
                constraintsHTML += '<div class="success">‚úÖ No obvious constraints found</div>';
            } else {
                constraints.forEach(constraint => {
                    constraintsHTML += `
                        <div class="css-rule overridden">
                            <strong>Element:</strong> ${constraint.element}<br>
                            <strong>Constraint:</strong> ${constraint.property}: ${constraint.value}<br>
                            <strong>Actual Width:</strong> ${constraint.actualWidth}px<br>
                            <strong>Viewport Utilization:</strong> ${constraint.utilization}
                        </div>
                    `;
                });
            }
            
            resultsDiv.innerHTML = constraintsHTML;
        }
        
        function measureElements() {
            analyzeComputedStyles();
        }
        
        // Initialize when page loads
        window.onload = initializeDebugger;
        
        // Auto-refresh every 10 seconds
        setInterval(() => {
            if (iframeDoc && iframeWindow) {
                analyzeComputedStyles();
            }
        }, 10000);
    </script>
</body>
</html>
