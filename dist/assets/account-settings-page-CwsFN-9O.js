(function(){function i(){const t=document.getElementById("account-settings-data");if(!t)return{};try{return JSON.parse(t.textContent||"{}")}catch(e){return console.error("[AccountSettings] Failed to parse page data",e),{}}}async function u(t){try{await fetch("/set_session.php",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"same-origin",body:JSON.stringify(t)})}catch(e){console.warn("[AccountSettings] Failed to update PHP session",e)}}function m(){const t=document.getElementById("accountSettingsForm"),e=document.getElementById("accountErrorMessage"),a=document.getElementById("accountSuccessMessage");if(!t)return;const{userId:l}=i();t.addEventListener("submit",async g=>{g.preventDefault(),e?.classList.add("hidden"),a?.classList.add("hidden");const f={userId:l||"",email:document.getElementById("email")?.value||"",firstName:document.getElementById("firstName")?.value||"",lastName:document.getElementById("lastName")?.value||"",currentPassword:document.getElementById("currentPassword")?.value||"",newPassword:document.getElementById("newPassword")?.value||""};try{const n=await fetch("/functions/process_account_update.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(f)}),s=await n.json();if(!n.ok)throw new Error(s.error||"Failed to update account");a&&a.classList.remove("hidden");const r=document.getElementById("currentPassword"),c=document.getElementById("newPassword");if(r&&(r.value=""),c&&(c.value=""),s.userData){const d={...JSON.parse(sessionStorage.getItem("user")||"{}"),email:s.userData.email,firstName:s.userData.firstName,lastName:s.userData.lastName};try{sessionStorage.setItem("user",JSON.stringify(d))}catch{}await u(d),setTimeout(()=>window.location.reload(),2e3)}}catch(n){e&&(e.textContent=n?.message||String(n),e.classList.remove("hidden"))}})}function o(){m()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",o,{once:!0}):o()})();
