const i={config:{customers:[],currentCustomerId:null,modalMode:null},init(){const t=document.querySelector(".admin-content-container");t&&(this.loadData(),this.bindEventListeners(t),(this.config.modalMode==="view"||this.config.modalMode==="edit")&&this.updateCustomerNavigationButtons())},loadData(){const t=document.getElementById("customer-page-data");if(t)try{const e=JSON.parse(t.textContent);this.config.customers=e.customers||[],this.config.currentCustomerId=e.currentCustomerId||null,this.config.modalMode=e.modalMode||null}catch(e){console.error("Failed to parse customer page data:",e)}},bindEventListeners(t){t.addEventListener("click",e=>{const o=e.target.closest("[data-action]");if(!o)return;switch(o.dataset.action){case"confirm-delete":this.confirmDelete(o.dataset.customerId,o.dataset.customerName);break;case"close-delete-modal":this.closeDeleteModal();break;case"navigate-customer":this.navigateToCustomer(o.dataset.direction);break;case"submit-customer-form":const s=new FormData(o.closest("form"));fetch("/api/update_customer.php",{method:"POST",body:s,headers:{"X-Requested-With":"XMLHttpRequest"}}).then(a=>a.json()).then(a=>{a.success&&(window.location.href=`/admin/customers?message=${encodeURIComponent(a.message)}&type=success`)});break}}),document.addEventListener("keydown",e=>{(this.config.modalMode==="view"||this.config.modalMode==="edit")&&!["INPUT","TEXTAREA","SELECT"].includes(e.target.tagName)&&(e.key==="ArrowLeft"||e.key==="ArrowUp"?(e.preventDefault(),this.navigateToCustomer("prev")):e.key==="ArrowRight"||e.key==="ArrowDown"?(e.preventDefault(),this.navigateToCustomer("next")):e.key==="Escape"&&(e.preventDefault(),window.location.href="/admin/customers"))})},confirmDelete(t,e){const o=document.getElementById("deleteConfirmModal"),n=document.getElementById("modal-message"),s=document.getElementById("delete_customer_id");o&&n&&s&&(n.textContent=`Are you sure you want to delete ${e}? This action cannot be undone.`,s.value=t,o.style.display="flex")},closeDeleteModal(){const t=document.getElementById("deleteConfirmModal");t&&(t.style.display="none")},navigateToCustomer(t){const e=this.config.customers.map(s=>s.id),o=e.indexOf(this.config.currentCustomerId);if(o===-1)return;let n=t==="next"?o+1:o-1;if(n>=0&&n<e.length){const s=e[n],a=new URL(window.location.href);a.searchParams.set(this.config.modalMode,s),window.location.href=a.toString()}},updateCustomerNavigationButtons(){const t=this.config.customers.map(s=>s.id),e=t.indexOf(this.config.currentCustomerId),o=document.getElementById("prevCustomerBtn"),n=document.getElementById("nextCustomerBtn");o&&(o.disabled=e<=0),n&&(n.disabled=e>=t.length-1)}};document.addEventListener("DOMContentLoaded",()=>{i.init()});
