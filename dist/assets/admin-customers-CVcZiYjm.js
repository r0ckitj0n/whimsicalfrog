const h={config:{customers:[],currentCustomerId:null,modalMode:null},init(){const t=document.querySelector(".admin-content-container");t&&(this.loadData(),this.bindEventListeners(t),(this.config.modalMode==="view"||this.config.modalMode==="edit")&&this.updateCustomerNavigationButtons(),this.highlightRowFromUrl())},loadData(){const t=document.getElementById("customer-page-data");if(t)try{const o=JSON.parse(t.textContent);this.config.customers=o.customers||[],this.config.currentCustomerId=o.currentCustomerId||null,this.config.modalMode=o.modalMode||null}catch(o){console.error("Failed to parse customer page data:",o)}},bindEventListeners(t){t.addEventListener("click",o=>{const e=o.target.closest("[data-action]");if(!e)return;switch(e.dataset.action){case"confirm-delete":this.confirmDelete(e.dataset.customerId,e.dataset.customerName);break;case"close-delete-modal":this.closeDeleteModal();break;case"navigate-customer":this.navigateToCustomer(e.dataset.direction);break;case"submit-customer-form":{const n=e.closest("form");n&&n.submit()}break}}),document.addEventListener("keydown",o=>{(this.config.modalMode==="view"||this.config.modalMode==="edit")&&!["INPUT","TEXTAREA","SELECT"].includes(o.target.tagName)&&(o.key==="ArrowLeft"||o.key==="ArrowUp"?(o.preventDefault(),this.navigateToCustomer("prev")):o.key==="ArrowRight"||o.key==="ArrowDown"?(o.preventDefault(),this.navigateToCustomer("next")):o.key==="Escape"&&(o.preventDefault(),window.location.href="/admin/customers"))})},confirmDelete(t,o){const e=document.getElementById("deleteConfirmModal"),s=document.getElementById("modal-message"),n=document.getElementById("delete_customer_id");e&&s&&n&&(s.textContent=`Are you sure you want to delete ${o}? This action cannot be undone.`,n.value=t,e.classList.add("show"))},closeDeleteModal(){const t=document.getElementById("deleteConfirmModal");t&&t.classList.remove("show")},navigateToCustomer(t){const e=(this.config.customers||[]).map(a=>a.id),s=e.indexOf(this.config.currentCustomerId);if(s===-1||e.length===0)return;let n=t==="next"?s+1:s-1;n<0&&(n=e.length-1),n>=e.length&&(n=0);const r=e[n],i=new URL(window.location.href),c=this.config.modalMode==="edit"?"edit":"view";i.searchParams.set("page","admin"),i.searchParams.set("section","customers"),i.searchParams.set(c,r),window.location.href=i.toString()},updateCustomerNavigationButtons(){const t=this.config.customers||[],e=t.map(u=>u.id).indexOf(this.config.currentCustomerId),s=document.getElementById("prevCustomerBtn"),n=document.getElementById("nextCustomerBtn");if(!s||!n||t.length===0||e===-1)return;s.style.display="block",n.style.display="block";const r=`${e+1} of ${t.length}`,i=e>0?e-1:t.length-1,c=e<t.length-1?e+1:0,a=t[i]||{},d=t[c]||{},m=`${a.firstName||""} ${a.lastName||""}`.trim()||"Unknown",l=`${d.firstName||""} ${d.lastName||""}`.trim()||"Unknown";s.title=`Previous: ${m} (${r})`,n.title=`Next: ${l} (${r})`},highlightRowFromUrl(){try{const t=new URL(window.location.href),o=t.searchParams.get("highlight");if(!o)return;const e=document.querySelector(`tr[data-customer-id='${CSS.escape(o)}']`);if(!e)return;e.classList.add("highlighted-row"),e.scrollIntoView({behavior:"smooth",block:"center"}),t.searchParams.delete("highlight"),window.history.replaceState({},"",t.toString()),setTimeout(()=>e.classList.remove("highlighted-row"),3e3)}catch{}}};document.addEventListener("DOMContentLoaded",()=>{h.init()});
