(function(){const a=t=>document.getElementById(t),o=t=>Array.from(document.querySelectorAll(t));function i(t,e){o(".tab-content").forEach(s=>s.classList.remove("active")),o(".tab").forEach(s=>s.classList.remove("active"));const r=a(t);r&&r.classList.add("active"),e&&e.classList.add("active")}function h(){fetch("",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"action=status"}).then(t=>t.json()).then(t=>{const e=a("status");e&&(t.success?e.innerHTML=`
            <div class="status-grid">
              <div class="status-item"><strong>${t.data.version}</strong>MySQL Version</div>
              <div class="status-item"><strong>${t.data.tables}</strong>Tables</div>
              <div class="status-item"><strong>${t.data.size}</strong>Database Size</div>
              <div class="status-item"><strong>${t.data.host}</strong>Host</div>
              <div class="status-item"><strong>${t.data.database}</strong>Database</div>
            </div>`:e.innerHTML=`<div class="error">Error: ${t.error}</div>`)}).catch(t=>{const e=a("status");e&&(e.innerHTML=`<div class="error">Connection failed: ${t.message}</div>`)})}function l(){const t=a("sqlQuery"),e=a("queryResults");if(!t||!e)return;const r=t.value.trim();if(!r){alert("Please enter a SQL query");return}e.innerHTML='<div class="loading">Executing query...</div>',fetch("",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`action=query&sql=${encodeURIComponent(r)}`}).then(s=>s.json()).then(s=>{if(s.success)if(s.type==="select"&&s.data.length>0){let n=`<div class="success">Query executed successfully. ${s.rows} rows returned.</div>`;n+="<table><thead><tr>",Object.keys(s.data[0]).forEach(c=>n+=`<th>${c}</th>`),n+="</tr></thead><tbody>",s.data.forEach(c=>{n+="<tr>",Object.values(c).forEach(u=>n+=`<td>${u!==null?u:"<em>NULL</em>"}</td>`),n+="</tr>"}),n+="</tbody></table>",e.innerHTML=n}else s.type==="update"?e.innerHTML=`<div class="success">Query executed successfully. ${s.affected} rows affected.</div>`:e.innerHTML='<div class="success">Query executed successfully. No results returned.</div>';else e.innerHTML=`<div class="error">Error: ${s.error}</div>`}).catch(s=>{e.innerHTML=`<div class="error">Request failed: ${s.message}</div>`})}function b(){const t=a("sqlQuery"),e=a("queryResults");t&&(t.value=""),e&&(e.innerHTML="")}function f(){const t=a("tablesResults");t&&(t.innerHTML='<div class="loading">Loading tables...</div>',fetch("",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"action=tables"}).then(e=>e.json()).then(e=>{if(e.success){let r="<table><thead><tr><th>Table Name</th><th>Row Count</th><th>Actions</th></tr></thead><tbody>";e.data.forEach(s=>{r+=`<tr>
              <td><strong>${s.name}</strong></td>
              <td>${s.rows}</td>
              <td>
                <button data-action="quickQuery" data-params='{"sql":"SELECT * FROM \`${s.name}\` LIMIT 10"}'>Preview</button>
                <button data-action="quickQuery" data-params='{"sql":"DESCRIBE \`${s.name}\`"}'>Structure</button>
              </td>
            </tr>`}),r+="</tbody></table>",t.innerHTML=r}else t.innerHTML=`<div class="error">Error: ${e.error}</div>`}))}function y(){const t=a("tableName"),e=a("structureResults");if(!t||!e)return;const r=t.value.trim();if(!r){alert("Please enter a table name");return}e.innerHTML='<div class="loading">Loading table structure...</div>',fetch("",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`action=describe&table=${encodeURIComponent(r)}`}).then(s=>s.json()).then(s=>{if(s.success){let n="<table><thead><tr><th>Field</th><th>Type</th><th>Null</th><th>Key</th><th>Default</th><th>Extra</th></tr></thead><tbody>";s.data.forEach(c=>{n+=`<tr>
              <td><strong>${c.Field}</strong></td>
              <td>${c.Type}</td>
              <td>${c.Null}</td>
              <td>${c.Key}</td>
              <td>${c.Default||"<em>NULL</em>"}</td>
              <td>${c.Extra}</td>
            </tr>`}),n+="</tbody></table>",e.innerHTML=n}else e.innerHTML=`<div class="error">Error: ${s.error}</div>`})}function v(t){const e=a("sqlQuery");if(!e)return;e.value=t,i("query");const r=document.querySelector(".tabs .tab");r&&r.classList.add("active"),l()}function m(t){const e=t.target.closest("[data-action]");if(!e)return;const r=e.getAttribute("data-action"),s=(()=>{try{const n=e.getAttribute("data-params");return n?JSON.parse(n):{}}catch{return{}}})();switch(r){case"showTab":i(s.tabName,e);break;case"executeQuery":l();break;case"clearQuery":b();break;case"loadTables":f();break;case"describeTable":y();break;case"quickQuery":s.sql&&v(s.sql);break}}function d(){document.addEventListener("click",m),h()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",d,{once:!0}):d()})();
