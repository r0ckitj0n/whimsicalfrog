(function(){let s={};const c=o=>document.getElementById(o);function m(o){Object.keys(o||{}).forEach(e=>{const n=document.querySelector(`[name="${e}"]`);n&&(n.type==="checkbox"?n.checked=!!o[e]:n.value=o[e])})}function u(){const o=c("roomConfigForm");o&&o.reset(),m({show_delay:50,hide_delay:150,max_width:450,min_width:280,max_quantity:999,min_quantity:1,debounce_time:50,popup_animation:"fade",modal_animation:"scale"})}async function l(){const o=c("roomSelect"),e=c("configFormContainer"),n=o?o.value:"";if(!n){e&&(e.style.display="none");return}try{const t=await(await fetch(`../api/room_config.php?action=get&room=${encodeURIComponent(n)}`)).json();if(t.success){s=t.config||{},m(s),e&&(e.style.display="block");const a=c("roomNumber");a&&(a.value=n)}else i("Error loading room configuration: "+(t.message||"Unknown error"),"error")}catch(r){console.error("Error loading room config:",r),i("Failed to load room configuration","error")}}function i(o,e){const n=c("messageContainer");if(!n)return;const r=e==="success"?"alert-success":"alert-error";n.innerHTML=`
      <div class="${r}">
        ${o}
      </div>`,setTimeout(()=>{n.innerHTML=""},5e3)}async function d(o){o.preventDefault();const e=o.currentTarget;if(!(e instanceof HTMLFormElement))return;const n=new FormData(e),r={};for(const[t,a]of n.entries())r[t]=a;e.querySelectorAll('input[type="checkbox"]').forEach(t=>{r[t.name]=t.checked});try{const a=await(await fetch("../api/room_config.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"save",room:r.room_number,config:r})})).json();a.success?(i("Room configuration saved successfully!","success"),s=r):i("Error saving configuration: "+(a.message||"Unknown error"),"error")}catch(t){console.error("Error saving room config:",t),i("Failed to save room configuration","error")}}function g(o){const e=o.target.closest("[data-action]");if(!e)return;e.getAttribute("data-action")==="resetForm"&&(o.preventDefault(),u())}function y(o){o.target.closest("#roomSelect")&&l()}function f(){const o=c("roomConfigForm");o&&o.addEventListener("submit",d),document.addEventListener("click",g),document.addEventListener("change",y);const e=c("roomSelect");if(e&&e.value)l();else{const n=c("configFormContainer");n&&(n.style.display="none")}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",f,{once:!0}):f()})();
