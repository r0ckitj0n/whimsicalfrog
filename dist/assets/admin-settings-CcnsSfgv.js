let u=[],m=[],k=new Set,O=new Set;async function D(){try{const t=await(await fetch("/api/content_tone_options.php?action=get_active&admin_token=whimsical_admin_2024")).json();t.success&&Array.isArray(t.options)&&t.options.length>0?(u=t.options.map(o=>({id:o.value,name:o.label,description:o.description})),k=new Set(u.map(o=>o.id)),U()):await Se()}catch(n){console.error("Error loading content tone options:",n.message),H()}}async function Se(){try{(await(await fetch("/api/content_tone_options.php?action=initialize_defaults&admin_token=whimsical_admin_2024",{method:"POST"})).json()).success?await D():H()}catch(n){console.error("Error initializing default content tone options:",n.message),H()}}function H(){u=[{id:"professional",name:"Professional",description:"Formal, business-focused tone"},{id:"friendly",name:"Friendly",description:"Warm and approachable"},{id:"casual",name:"Casual",description:"Relaxed and informal"},{id:"energetic",name:"Energetic",description:"Enthusiastic and dynamic"},{id:"sophisticated",name:"Sophisticated",description:"Elegant and refined"},{id:"playful",name:"Playful",description:"Fun and lighthearted"},{id:"authoritative",name:"Authoritative",description:"Expert and confident"},{id:"conversational",name:"Conversational",description:"Natural and engaging"},{id:"inspiring",name:"Inspiring",description:"Motivational and uplifting"},{id:"trustworthy",name:"Trustworthy",description:"Reliable and credible"},{id:"innovative",name:"Innovative",description:"Forward-thinking and creative"},{id:"luxurious",name:"Luxurious",description:"Premium and exclusive"}],k=new Set(u.map(n=>n.id)),U()}function U(){const n=document.getElementById("ai_content_tone");if(!n)return;const t=n.value;n.innerHTML='<option value="">Select content tone...</option>',u.forEach(o=>{const e=document.createElement("option");e.value=o.id,e.textContent=o.name,o.description&&(e.title=o.description),n.appendChild(e)}),t&&(n.value=t)}function te(){Ee()}function Ee(){const n=document.getElementById("contentToneModal");n&&n.remove(),document.body.insertAdjacentHTML("beforeend",`
    <div id="contentToneModal" class="admin-modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" data-action="overlay-close">
      <div class="admin-modal bg-white rounded-lg w-full max-w-2xl max-h-[90vh] flex flex-col" role="dialog" aria-modal="true" aria-labelledby="contentToneTitle">
        <div class="flex justify-between items-center border-b p-4">
          <h3 id="contentToneTitle" class="text-lg font-semibold text-gray-800">Manage Content Tone Options</h3>
          <button type="button" class="text-gray-500 hover:text-gray-700 text-xl" data-action="content-tone-close" aria-label="Close">&times;</button>
        </div>
        <div class="flex-1 overflow-y-auto p-4">
          <div class="space-y-4">
            <div class="flex justify-between items-center">
              <p class="text-sm text-gray-600">Manage the content tone options available for AI content generation.</p>
              <button type="button" class="bg-blue-500 hover:bg-blue-600 text-white rounded text-sm px-3 py-1" data-action="content-tone-add">Add Option</button>
            </div>
            <div id="contentToneList" class="space-y-2"></div>
          </div>
        </div>
        <div class="border-t flex justify-end space-x-2 p-3">
          <button type="button" class="text-gray-600 hover:text-gray-800 px-3 py-1" data-action="content-tone-close">Cancel</button>
          <button type="button" class="btn btn-primary px-3 py-1" data-action="content-tone-save">Save Changes</button>
        </div>
      </div>
    </div>`),q()}function R(){const n=document.getElementById("contentToneModal");n&&n.remove()}function q(){const n=document.getElementById("contentToneList");n&&(n.innerHTML="",u.forEach((t,o)=>{const e=document.createElement("div");e.className="flex items-center space-x-3 bg-gray-50 rounded-lg p-2",e.innerHTML=`
      <input type="text" value="${t.name||""}" class="flex-1 border border-gray-300 rounded text-sm px-2 py-1"
             data-action="content-tone-update" data-index="${o}" data-field="name" placeholder="Name">
      <input type="text" value="${t.description||""}" class="flex-1 border border-gray-300 rounded text-sm px-2 py-1"
             data-action="content-tone-update" data-index="${o}" data-field="description" placeholder="Description (optional)">
      <button type="button" class="text-red-500 hover:text-red-700" data-action="content-tone-remove" data-index="${o}" aria-label="Remove">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
      </button>`,n.appendChild(e)}))}function ne(){u.push({id:"custom_"+Date.now(),name:"New Tone",description:"Custom content tone"}),q()}function _(n,t,o){u[n]&&(u[n][t]=o,t==="name"&&(u[n]._originalId||(u[n]._originalId=u[n].id),u[n].id=(o||"").toLowerCase().replace(/[^a-z0-9]/g,"_")))}function oe(n){!isNaN(n)&&n>=0&&n<u.length&&confirm("Are you sure you want to remove this content tone option?")&&(u.splice(n,1),q())}async function ae(){try{const n=new Set(u.map(e=>e.id)),t=new Set;for(const e of u)e._originalId&&e._originalId!==e.id&&t.add(e._originalId);const o=Array.from(k).filter(e=>!n.has(e)&&!t.has(e));for(const e of u)e._originalId&&e._originalId!==e.id&&k.has(e._originalId)?(await ie(e._originalId),await $(e,!0)):k.has(e.id)?await $(e,!1):await $(e,!0);for(const e of o)await ie(e);await D(),U();try{showNotification("Content Tone Options","Options saved!","success")}catch{}R()}catch(n){try{showNotification("Content Tone Options","Error saving options: "+n.message,"error")}catch{}}}async function $(n,t=!1){try{const d=await(await fetch(`/api/content_tone_options.php?action=${t?"add":"update"}&admin_token=whimsical_admin_2024`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:n.id,value:n.value||n.id,label:n.name,description:n.description})})).json();if(!d.success)try{showNotification("Content Tone Options","Failed to save option: "+d.error,"error")}catch{}return!!d.success}catch(o){try{showNotification("Content Tone Options","Error saving option: "+o.message,"error")}catch{}return!1}}async function ie(n){try{const o=await(await fetch(`/api/content_tone_options.php?action=delete&id=${n}&admin_token=whimsical_admin_2024`,{method:"DELETE"})).json();if(!o.success)try{showNotification("Content Tone Options","Failed to delete option: "+o.error,"error")}catch{}return!!o.success}catch(t){try{showNotification("Content Tone Options","Error deleting option: "+t.message,"error")}catch{}return!1}}async function A(){try{const t=await(await fetch("/api/brand_voice_options.php?action=get_active&admin_token=whimsical_admin_2024")).json();t.success&&Array.isArray(t.options)&&t.options.length>0?(m=t.options.map(o=>({id:o.value,name:o.label,description:o.description})),O=new Set(m.map(o=>o.id)),W()):await Ie()}catch(n){console.error("Error loading brand voice options:",n.message),j()}}async function Ie(){try{(await(await fetch("/api/brand_voice_options.php?action=initialize_defaults&admin_token=whimsical_admin_2024",{method:"POST"})).json()).success?await A():j()}catch(n){console.error("Error initializing default brand voice options:",n.message),j()}}function j(){m=[{id:"friendly_approachable",name:"Friendly & Approachable",description:"Warm, welcoming, and easy to connect with"},{id:"professional_trustworthy",name:"Professional & Trustworthy",description:"Business-focused, reliable, and credible"},{id:"playful_fun",name:"Playful & Fun",description:"Lighthearted, entertaining, and engaging"},{id:"luxurious_premium",name:"Luxurious & Premium",description:"High-end, sophisticated, and exclusive"},{id:"casual_relaxed",name:"Casual & Relaxed",description:"Laid-back, informal, and comfortable"},{id:"authoritative_expert",name:"Authoritative & Expert",description:"Knowledgeable, confident, and commanding"},{id:"warm_personal",name:"Warm & Personal",description:"Intimate, caring, and heartfelt"},{id:"innovative_forward_thinking",name:"Innovative & Forward-Thinking",description:"Creative, cutting-edge, and progressive"},{id:"energetic_dynamic",name:"Energetic & Dynamic",description:"Enthusiastic, vibrant, and exciting"},{id:"sophisticated_elegant",name:"Sophisticated & Elegant",description:"Refined, polished, and tasteful"},{id:"conversational_natural",name:"Conversational & Natural",description:"Dialogue-like, personal, and engaging"},{id:"inspiring_motivational",name:"Inspiring & Motivational",description:"Uplifting, encouraging, and empowering"}],O=new Set(m.map(n=>n.id)),W()}function W(){const n=document.getElementById("ai_brand_voice");if(!n)return;const t=n.value;n.innerHTML='<option value="">Select brand voice...</option>',m.forEach(o=>{const e=document.createElement("option");e.value=o.id,e.textContent=o.name,o.description&&(e.title=o.description),n.appendChild(e)}),t&&(n.value=t)}function se(){ke()}function ke(){const n=document.getElementById("brandVoiceModal");n&&n.remove(),document.body.insertAdjacentHTML("beforeend",`
    <div id="brandVoiceModal" class="admin-modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" data-action="overlay-close">
      <div class="admin-modal bg-white rounded-lg w-full max-w-2xl max-h-[90vh] flex flex-col" role="dialog" aria-modal="true" aria-labelledby="brandVoiceTitle">
        <div class="flex justify-between items-center border-b p-4">
          <h3 id="brandVoiceTitle" class="text-lg font-semibold text-gray-800">Manage Brand Voice Options</h3>
          <button type="button" class="text-gray-500 hover:text-gray-700 text-xl" data-action="brand-voice-close" aria-label="Close">&times;</button>
        </div>
        <div class="flex-1 overflow-y-auto p-4">
          <div class="space-y-4">
            <div class="flex justify-between items-center">
              <p class="text-sm text-gray-600">Manage the brand voice options available for AI content generation.</p>
              <button type="button" class="bg-blue-500 hover:bg-blue-600 text-white rounded text-sm px-3 py-1" data-action="brand-voice-add">Add Option</button>
            </div>
            <div id="brandVoiceList" class="space-y-2"></div>
          </div>
        </div>
        <div class="border-t flex justify-end space-x-2 p-3">
          <button type="button" class="text-gray-600 hover:text-gray-800 px-3 py-1" data-action="brand-voice-close">Cancel</button>
          <button type="button" class="btn btn-primary px-3 py-1" data-action="brand-voice-save">Save Changes</button>
        </div>
      </div>
    </div>`),J()}function z(){const n=document.getElementById("brandVoiceModal");n&&n.remove()}function J(){const n=document.getElementById("brandVoiceList");n&&(n.innerHTML="",m.forEach((t,o)=>{const e=document.createElement("div");e.className="flex items-center space-x-3 bg-gray-50 rounded-lg p-2",e.innerHTML=`
      <input type="text" value="${t.name||""}" class="flex-1 border border-gray-300 rounded text-sm px-2 py-1"
             data-action="brand-voice-update" data-index="${o}" data-field="name" placeholder="Name">
      <input type="text" value="${t.description||""}" class="flex-1 border border-gray-300 rounded text-sm px-2 py-1"
             data-action="brand-voice-update" data-index="${o}" data-field="description" placeholder="Description (optional)">
      <button type="button" class="text-red-500 hover:text-red-700" data-action="brand-voice-remove" data-index="${o}" aria-label="Remove">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
      </button>`,n.appendChild(e)}))}function de(){m.push({id:"custom_"+Date.now(),name:"New Voice",description:"Custom brand voice"}),J()}function x(n,t,o){m[n]&&(m[n][t]=o,t==="name"&&(m[n]._originalId||(m[n]._originalId=m[n].id),m[n].id=(o||"").toLowerCase().replace(/[^a-z0-9]/g,"_")))}function re(n){!isNaN(n)&&n>=0&&n<m.length&&confirm("Are you sure you want to remove this brand voice option?")&&(m.splice(n,1),J())}async function ce(){try{const n=new Set(m.map(e=>e.id)),t=new Set;for(const e of m)e._originalId&&e._originalId!==e.id&&t.add(e._originalId);const o=Array.from(O).filter(e=>!n.has(e)&&!t.has(e));for(const e of m)e._originalId&&e._originalId!==e.id&&O.has(e._originalId)?(await le(e._originalId),await N(e,!0)):O.has(e.id)?await N(e,!1):await N(e,!0);for(const e of o)await le(e);await A(),W();try{showNotification("Brand Voice Options","Options saved!","success")}catch{}z()}catch(n){try{showNotification("Brand Voice Options","Error saving options: "+n.message,"error")}catch{}}}async function N(n,t=!1){try{const d=await(await fetch(`/api/brand_voice_options.php?action=${t?"add":"update"}&admin_token=whimsical_admin_2024`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:n.id,value:n.value||n.id,label:n.name,description:n.description})})).json();if(!d.success)try{showNotification("Brand Voice Options","Failed to save option: "+d.error,"error")}catch{}return!!d.success}catch(o){try{showNotification("Brand Voice Options","Error saving option: "+o.message,"error")}catch{}return!1}}async function le(n){try{const o=await(await fetch(`/api/brand_voice_options.php?action=delete&id=${n}&admin_token=whimsical_admin_2024`,{method:"DELETE"})).json();if(!o.success)try{showNotification("Brand Voice Options","Failed to delete option: "+o.error,"error")}catch{}return!!o.success}catch(t){try{showNotification("Brand Voice Options","Error deleting option: "+t.message,"error")}catch{}return!1}}function qe(){const n=document.getElementById("aiSettingsModal");if(n){n.classList.remove("hidden"),n.style.display="flex";try{typeof loadAISettings=="function"&&loadAISettings()}catch{}try{De()}catch{}try{typeof D=="function"&&D()}catch{}try{typeof A=="function"&&A()}catch{}}}function Oe(){const n=document.getElementById("aiSettingsModal");n&&(n.style.display="none",n.classList.add("hidden"))}async function De(){try{const t=await(await fetch("/api/ai_settings.php?action=get_providers")).json();t.success?Ae(t.providers):console.error("Failed to load AI providers:",t.error)}catch(n){console.error("Error loading AI providers:",n.message)}}function Ae(n){try{window.aiProviders=n}catch{}}function We(n){if(!n)return;const t=document.getElementById(`${n}-content`),o=document.getElementById(`${n}-icon`);t&&t.classList.toggle("hidden"),o&&t&&(o.textContent=t.classList.contains("hidden")?"‚ñ∂":"‚ñº")}function pe(){const n=document.querySelector('input[name="ai_provider"]:checked')?.value||L();["openai","anthropic","google","meta"].forEach(o=>{const e=document.getElementById(`${o}_section`);e&&(n==="jons_ai"?e.classList.add("hidden"):o===n?e.classList.remove("hidden"):e.classList.add("hidden"))});try{typeof window.aiSettings<"u"&&window.aiSettings?Pe(window.aiSettings):n&&n!=="jons_ai"&&G(n)}catch{}}async function ue(){const n={ai_provider:document.querySelector('input[name="ai_provider"]:checked')?.value||L(),openai_api_key:document.getElementById("openai_api_key")?.value||"",openai_model:document.getElementById("openai_model")?.value||"gpt-3.5-turbo",anthropic_api_key:document.getElementById("anthropic_api_key")?.value||"",anthropic_model:document.getElementById("anthropic_model")?.value||"claude-3-haiku-20240307",google_api_key:document.getElementById("google_api_key")?.value||"",google_model:document.getElementById("google_model")?.value||"gemini-pro",meta_api_key:document.getElementById("meta_api_key")?.value||"",meta_model:document.getElementById("meta_model")?.value||"meta-llama/llama-3.1-70b-instruct",ai_temperature:parseFloat(document.getElementById("ai_temperature")?.value||.7),ai_max_tokens:parseInt(document.getElementById("ai_max_tokens")?.value||1e3),ai_timeout:parseInt(document.getElementById("ai_timeout")?.value||30),fallback_to_local:document.getElementById("fallback_to_local")?.checked||!1,ai_brand_voice:document.getElementById("ai_brand_voice")?.value||"",ai_content_tone:document.getElementById("ai_content_tone")?.value||"professional",ai_cost_temperature:parseFloat(document.getElementById("ai_cost_temperature")?.value||.7),ai_price_temperature:parseFloat(document.getElementById("ai_price_temperature")?.value||.7),ai_cost_multiplier_base:parseFloat(document.getElementById("ai_cost_multiplier_base")?.value||1),ai_price_multiplier_base:parseFloat(document.getElementById("ai_price_multiplier_base")?.value||1),ai_conservative_mode:document.getElementById("ai_conservative_mode")?.checked||!1,ai_market_research_weight:parseFloat(document.getElementById("ai_market_research_weight")?.value||.3),ai_cost_plus_weight:parseFloat(document.getElementById("ai_cost_plus_weight")?.value||.4),ai_value_based_weight:parseFloat(document.getElementById("ai_value_based_weight")?.value||.3)};try{const o=await(await fetch("/api/ai_settings.php?action=update_settings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})).json();o.success?Le("AI settings saved successfully!"):me("Failed to save AI settings: "+o.error)}catch(t){me("Error saving AI settings: "+t.message)}}function Le(n){try{showNotification("AI Settings Saved",n,"success")}catch{console.log(n)}setTimeout(()=>{try{Oe()}catch{}},1500)}function me(n){try{showNotification("AI Settings Error",n,"error")}catch{console.error(n)}}async function fe(){const n=document.querySelector('input[name="ai_provider"]:checked')?.value||L();try{try{showNotification("Testing AI Provider",`Testing ${n} provider...`,"info")}catch{}const o=await(await fetch(`/api/ai_settings.php?action=test_provider&provider=${n}`)).json();if(o.success)try{showNotification("AI Provider Test",`‚úÖ ${n} provider test successful!`,"success")}catch{}else try{showNotification("AI Provider Test",`‚ùå ${n} provider test failed: ${o.message}`,"error")}catch{}}catch(t){try{showNotification("AI Provider Test",`‚ùå Test failed: ${t.message}`,"error")}catch{console.error(t)}}}let w={};async function Je(){try{const t=await(await fetch("/api/get_ai_models.php?provider=all")).json();t.success?(w=t.models,g("openai",w.openai),g("anthropic",w.anthropic),g("google",w.google),g("meta",w.meta)):(console.error("‚ùå Failed to load AI models:",t.error),we())}catch(n){console.error("‚ùå Error loading AI models:",n.message),we()}}async function Qe(n){try{const o=await(await fetch("/api/get_ai_models.php?provider=all")).json();o.success?(w=o.models,v("openai",w.openai,n.openai_model),v("anthropic",w.anthropic,n.anthropic_model),v("google",w.google,n.google_model),v("meta",w.meta,n.meta_model)):(console.error("‚ùå Failed to load AI models:",o.error),ve(n))}catch(t){console.error("‚ùå Error loading AI models:",t.message),ve(n)}}function L(){if(typeof window.aiSettings<"u"&&window.aiSettings){const n=["jons_ai","openai","anthropic","google","meta"];for(const t of n)if(window.aiSettings[`${t}_api_key`])return t}return"jons_ai"}async function Pe(n){const t=n.ai_provider||L();if(t!=="jons_ai")try{const e=await(await fetch(`/api/get_ai_models.php?provider=${t}&admin_token=whimsical_admin_2024`)).json();if(e.success){w[t]=e.models;const d=`${t}_model`;v(t,e.models,n[d])}else console.error(`‚ùå Failed to load ${t} models:`,e.error),ye(t,n)}catch(o){console.error(`‚ùå Error loading ${t} models:`,o.message),ye(t,n)}}async function G(n){try{try{showNotification("Refreshing Models",`Loading ${n} models...`,"info")}catch{}const o=await(await fetch(`/api/get_ai_models.php?provider=${n}&admin_token=whimsical_admin_2024`)).json();if(o.success){w[n]=o.models,g(n,o.models);try{showNotification("Models Refreshed",`‚úÖ ${n} models updated`,"success")}catch{}}else{try{showNotification("Models Error",`‚ùå Failed to load ${n} models: ${o.error}`,"error")}catch{}ge(n)}}catch(t){try{showNotification("Models Error",`‚ùå Error loading ${n} models: ${t.message}`,"error")}catch{}ge(n)}}function g(n,t){const o=document.getElementById(`${n}_model`);if(!o)return;const e=o.value;if(o.innerHTML="",!t||t.length===0){o.innerHTML='<option value="">No models available</option>';return}t.forEach(d=>{const i=document.createElement("option");i.value=d.id,i.textContent=`${d.name} - ${d.description}`,i.title=d.description,o.appendChild(i)}),e&&o.querySelector(`option[value="${e}"]`)?o.value=e:o.selectedIndex=0}function v(n,t,o){const e=document.getElementById(`${n}_model`);if(e){if(e.innerHTML="",!t||t.length===0){e.innerHTML='<option value="">No models available</option>';return}t.forEach(d=>{const i=document.createElement("option");i.value=d.id,i.textContent=`${d.name} - ${d.description}`,i.title=d.description,d.id===o&&(i.selected=!0),e.appendChild(i)}),(!o||!e.querySelector(`option[value="${o}"]`))&&(e.selectedIndex=0)}}function we(){const n={openai:[{id:"gpt-4o",name:"GPT-4o",description:"Latest and most capable model"},{id:"gpt-4-turbo",name:"GPT-4 Turbo",description:"Fast and capable"},{id:"gpt-4",name:"GPT-4",description:"Highly capable model"},{id:"gpt-3.5-turbo",name:"GPT-3.5 Turbo",description:"Fast and affordable"}],anthropic:[{id:"claude-3-5-sonnet-20241022",name:"Claude 3.5 Sonnet",description:"Most intelligent model"},{id:"claude-3-5-haiku-20241022",name:"Claude 3.5 Haiku",description:"Fastest model"},{id:"claude-3-opus-20240229",name:"Claude 3 Opus",description:"Most capable for reasoning"},{id:"claude-3-sonnet-20240229",name:"Claude 3 Sonnet",description:"Balanced performance"},{id:"claude-3-haiku-20240307",name:"Claude 3 Haiku",description:"Fast and affordable"}],google:[{id:"gemini-1.5-pro",name:"Gemini 1.5 Pro",description:"Most capable Gemini model"},{id:"gemini-1.5-flash",name:"Gemini 1.5 Flash",description:"Fast and efficient"},{id:"gemini-pro",name:"Gemini Pro",description:"Balanced performance"},{id:"gemini-pro-vision",name:"Gemini Pro Vision",description:"Multimodal capabilities"}],meta:[{id:"meta-llama/llama-3.1-405b-instruct",name:"Llama 3.1 405B",description:"Most capable model"},{id:"meta-llama/llama-3.1-70b-instruct",name:"Llama 3.1 70B",description:"Balanced performance"},{id:"meta-llama/llama-3.1-8b-instruct",name:"Llama 3.1 8B",description:"Fast and affordable"},{id:"meta-llama/llama-3-70b-instruct",name:"Llama 3 70B",description:"Previous generation"},{id:"meta-llama/llama-3-8b-instruct",name:"Llama 3 8B",description:"Lightweight"}]};w=n,g("openai",n.openai),g("anthropic",n.anthropic),g("google",n.google),g("meta",n.meta)}function ge(n){const t={openai:[{id:"gpt-4o",name:"GPT-4o",description:"Latest and most capable model"},{id:"gpt-4-turbo",name:"GPT-4 Turbo",description:"Fast and capable"},{id:"gpt-4",name:"GPT-4",description:"Highly capable model"},{id:"gpt-3.5-turbo",name:"GPT-3.5 Turbo",description:"Fast and affordable"}],anthropic:[{id:"claude-3-5-sonnet-20241022",name:"Claude 3.5 Sonnet",description:"Most intelligent model"},{id:"claude-3-5-haiku-20241022",name:"Claude 3.5 Haiku",description:"Fastest model"},{id:"claude-3-opus-20240229",name:"Claude 3 Opus",description:"Most capable for reasoning"},{id:"claude-3-sonnet-20240229",name:"Claude 3 Sonnet",description:"Balanced performance"},{id:"claude-3-haiku-20240307",name:"Claude 3 Haiku",description:"Fast and affordable"}],google:[{id:"gemini-1.5-pro",name:"Gemini 1.5 Pro",description:"Most capable Gemini model"},{id:"gemini-1.5-flash",name:"Gemini 1.5 Flash",description:"Fast and efficient"},{id:"gemini-pro",name:"Gemini Pro",description:"Balanced performance"},{id:"gemini-pro-vision",name:"Gemini Pro Vision",description:"Multimodal capabilities"}]};t[n]&&(w[n]=t[n],g(n,t[n]))}function ve(n){const t={openai:[{id:"gpt-4o",name:"GPT-4o",description:"Latest and most capable model"},{id:"gpt-4-turbo",name:"GPT-4 Turbo",description:"Fast and capable"},{id:"gpt-4",name:"GPT-4",description:"Highly capable model"},{id:"gpt-3.5-turbo",name:"GPT-3.5 Turbo",description:"Fast and affordable"}],anthropic:[{id:"claude-3-5-sonnet-20241022",name:"Claude 3.5 Sonnet",description:"Most intelligent model"},{id:"claude-3-5-haiku-20241022",name:"Claude 3.5 Haiku",description:"Fastest model"},{id:"claude-3-opus-20240229",name:"Claude 3 Opus",description:"Most capable for reasoning"},{id:"claude-3-sonnet-20240229",name:"Claude 3 Sonnet",description:"Balanced performance"},{id:"claude-3-haiku-20240307",name:"Claude 3 Haiku",description:"Fast and affordable"}],google:[{id:"gemini-1.5-pro",name:"Gemini 1.5 Pro",description:"Most capable Gemini model"},{id:"gemini-1.5-flash",name:"Gemini 1.5 Flash",description:"Fast and efficient"},{id:"gemini-pro",name:"Gemini Pro",description:"Balanced performance"},{id:"gemini-pro-vision",name:"Gemini Pro Vision",description:"Multimodal capabilities"}],meta:[{id:"meta-llama/llama-3.1-405b-instruct",name:"Llama 3.1 405B",description:"Most capable model"},{id:"meta-llama/llama-3.1-70b-instruct",name:"Llama 3.1 70B",description:"Balanced performance"},{id:"meta-llama/llama-3.1-8b-instruct",name:"Llama 3.1 8B",description:"Fast and affordable"},{id:"meta-llama/llama-3-70b-instruct",name:"Llama 3 70B",description:"Previous generation"},{id:"meta-llama/llama-3-8b-instruct",name:"Llama 3 8B",description:"Lightweight"}]};w=t,v("openai",t.openai,n.openai_model),v("anthropic",t.anthropic,n.anthropic_model),v("google",t.google,n.google_model),v("meta",t.meta,n.meta_model)}function ye(n,t){const o={openai:[{id:"gpt-4o",name:"GPT-4o",description:"Latest and most capable model"},{id:"gpt-4-turbo",name:"GPT-4 Turbo",description:"Fast and capable"},{id:"gpt-4",name:"GPT-4",description:"Highly capable model"},{id:"gpt-3.5-turbo",name:"GPT-3.5 Turbo",description:"Fast and affordable"}],anthropic:[{id:"claude-3-5-sonnet-20241022",name:"Claude 3.5 Sonnet",description:"Most intelligent model"},{id:"claude-3-5-haiku-20241022",name:"Claude 3.5 Haiku",description:"Fastest model"},{id:"claude-3-opus-20240229",name:"Claude 3 Opus",description:"Most capable for reasoning"},{id:"claude-3-sonnet-20240229",name:"Claude 3 Sonnet",description:"Balanced performance"},{id:"claude-3-haiku-20240307",name:"Claude 3 Haiku",description:"Fast and affordable"}],google:[{id:"gemini-1.5-pro",name:"Gemini 1.5 Pro",description:"Most capable Gemini model"},{id:"gemini-1.5-flash",name:"Gemini 1.5 Flash",description:"Fast and efficient"},{id:"gemini-pro",name:"Gemini Pro",description:"Balanced performance"},{id:"gemini-pro-vision",name:"Gemini Pro Vision",description:"Multimodal capabilities"}],meta:[{id:"meta-llama/llama-3.1-405b-instruct",name:"Llama 3.1 405B",description:"Most capable model"},{id:"meta-llama/llama-3.1-70b-instruct",name:"Llama 3.1 70B",description:"Balanced performance"},{id:"meta-llama/llama-3.1-8b-instruct",name:"Llama 3.1 8B",description:"Fast and affordable"},{id:"meta-llama/llama-3-70b-instruct",name:"Llama 3 70B",description:"Previous generation"},{id:"meta-llama/llama-3-8b-instruct",name:"Llama 3 8B",description:"Lightweight"}]};if(o[n]){w[n]=o[n];const e=`${n}_model`;v(n,o[n],t[e])}}window.openDatabaseMaintenanceModal=function(){console.log("openDatabaseMaintenanceModal called");const t=document.getElementById("databaseMaintenanceModal");if(!t){console.error("databaseMaintenanceModal element not found!"),window.showError?window.showError("Database Maintenance modal not found. Please refresh the page."):alert("Database Maintenance modal not found. Please refresh the page.");return}console.log("Opening database maintenance modal..."),typeof window.openModal=="function"?window.openModal("databaseMaintenanceModal"):(t.classList.remove("hidden"),t.classList.add("show")),document.getElementById("databaseMaintenanceLoading").style.display="none",switchDatabaseTab(document.querySelector('[data-tab="connection"]'),"connection"),loadCurrentDatabaseConfig()};function Fe(n){return n||(typeof window<"u"?window.event:void 0)}async function Ve(n){const o=Fe(n)?.target||document.querySelector('[data-action="scan-db"], #scanDatabaseConnectionsBtn'),e=document.getElementById("conversionResults");o&&(o.disabled=!0,o.textContent="üîÑ Scanning..."),e&&(e.className="mt-3 px-3 py-2 bg-blue-50 border border-blue-200 rounded text-sm",e.innerHTML="‚è≥ Scanning PHP files for database connections...",e.classList.remove("hidden"));try{const i=await(await fetch("/api/convert_to_centralized_db.php?action=scan&format=json&admin_token=whimsical_admin_2024")).json();if(i.success)i.needs_conversion>0?e&&(e.className="mt-3 px-3 py-2 bg-yellow-50 border border-yellow-200 rounded text-sm",e.innerHTML=`
                        <div class="font-medium text-yellow-800">‚ö†Ô∏è Files Need Conversion</div>
                        <div class="text-xs space-y-1 text-yellow-700">
                            <div>Total PHP files: ${i.total_files}</div>
                            <div>Files needing conversion: ${i.needs_conversion}</div>
                            <div class="">Files with direct PDO connections:</div>
                            <ul class="list-disc list-inside">
                                ${i.files.slice(0,10).map(r=>`<li>${r}</li>`).join("")}
                                ${i.files.length>10?`<li>... and ${i.files.length-10} more</li>`:""}
                            </ul>
                        </div>
                    `):e&&(e.className="mt-3 px-3 py-2 bg-green-50 border border-green-200 rounded text-sm",e.innerHTML=`
                        <div class="font-medium text-green-800">‚úÖ All Files Use Centralized Database!</div>
                        <div class="text-xs text-green-700">Scanned ${i.total_files} PHP files - no conversion needed</div>
                    `);else throw new Error(i.message||"Scan failed")}catch(d){e&&(e.className="mt-3 px-3 py-2 bg-red-50 border border-red-200 rounded text-sm",e.innerHTML=`<div class="text-red-800">‚ùå Scan failed: ${d.message}</div>`)}finally{o&&(o.disabled=!1,o.textContent="üìä Scan Files")}}async function $e(n){const o=Fe(n)?.target||document.querySelector('[data-action="convert-db"], #convertDatabaseConnectionsBtn'),e=document.getElementById("conversionResults");if(confirm("This will modify files with direct PDO connections and create backups. Continue?")){o&&(o.disabled=!0,o.textContent="üîÑ Converting..."),e&&(e.className="mt-3 px-3 py-2 bg-blue-50 border border-blue-200 rounded text-sm",e.innerHTML="‚è≥ Converting files to use centralized database connections...",e.classList.remove("hidden"));try{const i=await(await fetch("/api/convert_to_centralized_db.php?action=convert&format=json&admin_token=whimsical_admin_2024")).json();if(i.success)i.converted>0?e&&(e.className="mt-3 px-3 py-2 bg-green-50 border border-green-200 rounded text-sm",e.innerHTML=`
                        <div class="font-medium text-green-800">üéâ Conversion Completed!</div>
                        <div class="text-xs space-y-1 text-green-700">
                            <div>Files converted: ${i.converted}</div>
                            <div>Conversion failures: ${i.failed}</div>
                            <div class="">üíæ Backups were created for all modified files</div>
                            <div class="text-yellow-700">‚ö†Ô∏è Please test your application to ensure everything works correctly</div>
                        </div>
                        ${i.results.filter(r=>r.status==="converted").length>0?`
                            <details class="">
                                <summary class="cursor-pointer text-green-700 hover:text-green-900">View converted files</summary>
                                <ul class="list-disc list-inside text-xs">
                                    ${i.results.filter(r=>r.status==="converted").map(r=>`<li>${r.file} (${r.changes} changes)</li>`).join("")}
                                </ul>
                            </details>
                        `:""}
                    `):e&&(e.className="mt-3 px-3 py-2 bg-blue-50 border border-blue-200 rounded text-sm",e.innerHTML=`
                        <div class="font-medium text-blue-800">‚ÑπÔ∏è No Files Needed Conversion</div>
                        <div class="text-xs text-blue-700">All files are already using centralized database connections</div>
                    `);else throw new Error(i.message||"Conversion failed")}catch(d){e&&(e.className="mt-3 px-3 py-2 bg-red-50 border border-red-200 rounded text-sm",e.innerHTML=`<div class="text-red-800">‚ùå Conversion failed: ${d.message}</div>`)}finally{o&&(o.disabled=!1,o.textContent="üîÑ Convert All")}}}function Ne(){window.open("/api/convert_to_centralized_db.php?admin_token=whimsical_admin_2024","_blank")}function He(){const n=document.getElementById("databaseBackupTablesContainer"),t=document.getElementById("databaseBackupToggleIcon");!n||!t||(n.classList.contains("hidden")?(n.classList.remove("hidden"),t.textContent="‚ñº"):(n.classList.add("hidden"),t.textContent="‚ñ∂"))}async function Re(n){try{const t=document.getElementById("tableViewModal"),o=document.getElementById("tableViewTitle"),e=document.getElementById("tableViewContent");o&&(o.textContent=`Loading ${n}...`),e&&(e.innerHTML='<div class="text-center"><div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div></div>'),typeof window.openModal=="function"?window.openModal("tableViewModal"):t&&(t.classList.remove("hidden"),t.classList.add("show"));const i=await(await fetch("/api/db_manager.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"query",sql:`SELECT * FROM \`${n}\` LIMIT 100`})})).json();if(i.success&&i.data){if(o&&(o.textContent=`Table: ${n} (${i.row_count} records shown, max 100)`),!Array.isArray(i.data)||i.data.length===0){e&&(e.innerHTML='<div class="text-center text-gray-500">Table is empty</div>');return}const r=Object.keys(i.data[0]),c=`
                <div class="overflow-x-auto max-h-96">
                    <table class="min-w-full bg-white border border-gray-200 text-xs">
                        <thead class="bg-gray-50 sticky top-0">
                            <tr>
                                ${r.map(p=>`<th class="border-b text-left font-semibold text-gray-700">${p}</th>`).join("")}
                            </tr>
                        </thead>
                        <tbody>
                            ${i.data.map(p=>`
                                <tr class="hover:bg-gray-50">
                                    ${r.map(f=>{let y=p[f];return y===null?y='<span class="text-gray-400">NULL</span>':typeof y=="string"&&y.length>50&&(y=y.substring(0,50)+"..."),`<td class="border-b">${y}</td>`}).join("")}
                                </tr>
                            `).join("")}
                        </tbody>
                    </table>
                </div>
            `;e&&(e.innerHTML=c)}else o&&(o.textContent=`Error loading ${n}`),e&&(e.innerHTML=`<div class="text-red-600">Error: ${i.error||"Failed to load table data"}</div>`)}catch(t){console.error("Error viewing table:",t);const o=document.getElementById("tableViewTitle"),e=document.getElementById("tableViewContent");o&&(o.textContent=`Error loading ${n}`),e&&(e.innerHTML=`<div class="text-red-600">Error: ${t.message}</div>`)}}function je(){if(typeof window.closeModal=="function")window.closeModal("tableViewModal");else{const n=document.getElementById("tableViewModal");n&&(n.classList.remove("show"),n.classList.add("hidden"))}}async function Ke(){try{const t=await(await fetch("/api/get_database_info.php")).json();return t.success&&t.data&&t.data.total_active||"several"}catch{return"several"}}async function ze(){const n=await Ke();if(!await(window.showConfirmationModal?window.showConfirmationModal({title:"Database Compact & Repair",subtitle:"Optimize and repair your database for better performance",message:"This operation will create a safety backup first, then optimize and repair all database tables to improve performance and fix any corruption issues.",details:`
            <ul>
                <li>‚úÖ Create automatic safety backup before optimization</li>
                <li>üîß Optimize ${n} database tables for better performance</li>
                <li>üõ†Ô∏è Repair any table corruption or fragmentation issues</li>
                <li>‚ö° Improve database speed and efficiency</li>
                <li>‚è±Ô∏è Process typically takes 2-3 minutes</li>
            </ul>
        `,icon:"üîß",iconType:"info",confirmText:"Start Optimization",cancelText:"Cancel"}):Promise.resolve(confirm("Create a safety backup, then optimize and repair all database tables?"))))return;typeof window.showBackupProgressModal=="function"&&window.showBackupProgressModal("üîß Database Compact & Repair","database-repair");const o=document.getElementById("backupProgressSteps"),e=document.getElementById("backupProgressTitle"),d=document.getElementById("backupProgressSubtitle");e&&(e.textContent="üîß Database Compact & Repair"),d&&(d.textContent="Optimizing and repairing database tables...");try{o&&(o.innerHTML=`
                <div class="flex items-center space-x-3">
                    <div class="flex-shrink-0">
                        <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center">
                            <div class="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                        </div>
                    </div>
                    <div class="flex-1">
                        <p class="text-sm font-medium text-gray-900">Creating safety backup...</p>
                        <p class="text-xs text-gray-500">Backing up database before optimization</p>
                    </div>
                </div>
            `);const r=await(await fetch("/api/backup_database.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({destination:"cloud"})})).json();if(!r.success)throw new Error("Failed to create safety backup: "+(r.error||"Unknown error"));o&&(o.innerHTML=`
                <div class="flex items-center space-x-3">
                    <div class="flex-shrink-0">
                        <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center">
                            <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                    <div class="flex-1">
                        <p class="text-sm font-medium text-gray-900">Safety backup created</p>
                        <p class="text-xs text-gray-500">Database backed up successfully</p>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <div class="flex-shrink-0">
                        <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center">
                            <div class="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                        </div>
                    </div>
                    <div class="flex-1">
                        <p class="text-sm font-medium text-gray-900">Optimizing database tables...</p>
                        <p class="text-xs text-gray-500">Running OPTIMIZE and REPAIR operations</p>
                    </div>
                </div>
            `);const p=await(await fetch("/api/compact_repair_database.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({})})).json();if(!p.success)throw new Error("Database optimization failed: "+(p.error||"Unknown error"));o&&(o.innerHTML=`
                <div class="flex items-center space-x-3">
                    <div class="flex-shrink-0">
                        <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center">
                            <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                    <div class="flex-1">
                        <p class="text-sm font-medium text-gray-900">Safety backup created</p>
                        <p class="text-xs text-gray-500">Database backed up successfully</p>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <div class="flex-shrink-0">
                        <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center">
                            <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                    </div>
                    <div class="flex-1">
                        <p class="text-sm font-medium text-gray-900">Database optimization complete</p>
                        <p class="text-xs text-gray-500">${p.tables_processed||0} tables optimized and repaired</p>
                    </div>
                </div>
            `),typeof window.showBackupCompletionDetails=="function"&&window.showBackupCompletionDetails({success:!0,filename:r.filename,filepath:r.filepath,size:r.size,timestamp:r.timestamp,destinations:["Server"],tables_optimized:p.tables_processed||0,operation_type:"Database Compact & Repair"})}catch(i){console.error("Database optimization error:",i),typeof window.showError=="function"?window.showError(i.message||"Database optimization failed"):alert(i.message||"Database optimization failed")}}function b(n,t,o){if(!n)return;const e="px-3 py-2 border rounded text-sm";t?n.className=`${e} bg-green-50 border-green-200`:n.className=`${e} bg-red-50 border-red-200`,n.innerHTML=o,n.classList.remove("hidden")}async function Ge(n){try{const t=document.getElementById("credentialsUpdateResult"),o=n?.target||document.activeElement,e={host:document.getElementById("newHost")?.value,database:document.getElementById("newDatabase")?.value,username:document.getElementById("newUsername")?.value,password:document.getElementById("newPassword")?.value,environment:document.getElementById("environmentSelect")?.value,ssl_enabled:document.getElementById("sslEnabled")?.checked||!1,ssl_cert:document.getElementById("sslCertPath")?.value||""};if(!e.host||!e.database||!e.username){b(t,!1,"Please fill in all required fields");return}const d=async()=>{o&&(o.disabled=!0,o.textContent="üíæ Updating..."),t&&(t.className="px-3 py-2 bg-blue-50 border border-blue-200 rounded text-sm",t.innerHTML="‚è≥ Updating configuration...",t.classList.remove("hidden"));try{const r=await(await fetch("/api/database_maintenance.php?action=update_config&admin_token=whimsical_admin_2024",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json();r.success?(b(t,!0,`
                        <div class="font-medium text-green-800">‚úÖ Configuration Updated!</div>
                        <div class="text-xs text-green-700">Backup created: ${r.backup_created}</div>
                        <div class="text-xs text-yellow-700">‚ö†Ô∏è Please refresh the page to use new settings</div>
                    `),setTimeout(()=>{try{loadCurrentDatabaseConfig()}catch{}},2e3)):b(t,!1,`Update failed: ${r.message}`)}catch(i){b(t,!1,`Network error: ${i.message}`)}finally{o&&(o.disabled=!1,o.textContent="üíæ Update Credentials")}};typeof window.showConfirmationModal=="function"?window.showConfirmationModal({title:"Update database credentials?",message:`A backup will be created automatically for ${e.environment} environment(s).`,confirmText:"Yes, Update",cancelText:"Cancel",onConfirm:d}):confirm(`Are you sure you want to update database credentials for ${e.environment} environment(s)? A backup will be created automatically.`)&&await d()}catch(t){console.error("[AdminSettings] updateDatabaseConfig error",t)}}async function Ue(n){try{const t=document.getElementById("sslTestResult"),o=n?.target||document.activeElement,e={host:document.getElementById("testHost")?.value||document.getElementById("newHost")?.value,database:document.getElementById("testDatabase")?.value||document.getElementById("newDatabase")?.value,username:document.getElementById("testUsername")?.value||document.getElementById("newUsername")?.value,password:document.getElementById("testPassword")?.value||document.getElementById("newPassword")?.value,ssl_enabled:!0,ssl_cert:document.getElementById("sslCertPath")?.value};if(!e.ssl_cert){b(t,!1,"Please specify SSL certificate path");return}o&&(o.disabled=!0,o.textContent="üîÑ Testing SSL..."),t&&(t.className="px-3 py-2 bg-blue-50 border border-blue-200 rounded text-sm",t.innerHTML="‚è≥ Testing SSL connection...",t.classList.remove("hidden"));try{const i=await(await fetch("/api/database_maintenance.php?action=test_connection&admin_token=whimsical_admin_2024",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json();i.success?b(t,!0,`
                    <div class="font-medium text-green-800">üîí SSL Connection Successful!</div>
                    <div class="text-xs space-y-1 text-green-700">
                        <div>SSL Certificate: Valid</div>
                        <div>Encryption: Active</div>
                        <div>MySQL Version: ${i.info?.mysql_version||""}</div>
                    </div>
                `):b(t,!1,`SSL connection failed: ${i.message}`)}catch(d){b(t,!1,`SSL test error: ${d.message}`)}finally{o&&(o.disabled=!1,o.textContent="üîí Test SSL Connection")}}catch(t){console.error("[AdminSettings] testSSLConnection error",t)}}typeof window<"u"&&(window.scanDatabaseConnections=Ve,window.convertDatabaseConnections=$e,window.openConversionTool=Ne,window.toggleDatabaseBackupTables=He,window.viewTable=Re,window.closeTableViewModal=je,window.compactRepairDatabase=ze,window.updateDatabaseConfig=Ge,window.testSSLConnection=Ue,window.openAISettingsModal=qe,window.closeAISettingsModal=Oe,window.loadAIProviders=De,window.displayAIProviders=Ae,window.toggleSection=We,window.toggleProviderSections=pe,window.saveAISettings=ue,window.showAISettingsSuccess=Le,window.showAISettingsError=me,window.testAIProvider=fe,window.loadAllModels=Je,window.loadAllModelsWithSelection=Qe,window.getDefaultAIProvider=L,window.loadModelsForCurrentProvider=Pe,window.refreshModels=G,window.populateModelDropdown=g,window.populateModelDropdownWithSelection=v,window.loadFallbackModels=we,window.loadFallbackModelsForProvider=ge,window.loadFallbackModelsWithSelection=ve,window.loadFallbackModelsForProviderWithSelection=ye,window.loadContentToneOptions=D,window.initializeDefaultContentToneOptions=Se,window.loadDefaultContentToneOptions=H,window.populateContentToneDropdown=U,window.manageContentToneOptions=te,window.showContentToneModal=Ee,window.closeContentToneModal=R,window.displayContentToneOptions=q,window.addContentToneOption=ne,window.updateContentToneOption=_,window.removeContentToneOption=oe,window.saveContentToneOptions=ae,window.saveContentToneOption=$,window.deleteContentToneOptionFromDB=ie,window.loadBrandVoiceOptions=A,window.initializeDefaultBrandVoiceOptions=Ie,window.loadDefaultBrandVoiceOptions=j,window.populateBrandVoiceDropdown=W,window.manageBrandVoiceOptions=se,window.showBrandVoiceModal=ke,window.closeBrandVoiceModal=z,window.displayBrandVoiceOptions=J,window.addBrandVoiceOption=de,window.updateBrandVoiceOption=x,window.removeBrandVoiceOption=re,window.saveBrandVoiceOptions=ce,window.saveBrandVoiceOption=N,window.deleteBrandVoiceOptionFromDB=le);let Me=!1;function X(n=document){try{const t=[{contains:"scanDatabaseConnections",action:"scan-db"},{contains:"convertDatabaseConnections",action:"convert-db"},{contains:"openConversionTool",action:"open-conversion-tool"},{contains:"compactRepairDatabase",action:"compact-repair"},{contains:"toggleDatabaseBackupTables",action:"toggle-backup-tables"},{contains:"closeTableViewModal",action:"close-table-view"},{contains:"updateDatabaseConfig",action:"update-db-config"},{contains:"testSSLConnection",action:"test-ssl"},{contains:"closeAISettingsModal",action:"ai-close-settings"},{contains:"saveAISettings",action:"ai-save-settings"},{contains:"testAIProvider",action:"ai-test-provider"},{contains:"refreshModels",action:"ai-refresh-models"},{contains:"toggleSection",action:"ai-toggle-section"},{contains:"manageBrandVoiceOptions",action:"ai-manage-brand-voice"},{contains:"manageContentToneOptions",action:"ai-manage-content-tone"},{contains:"closeContentToneModal",action:"content-tone-close"},{contains:"addContentToneOption",action:"content-tone-add"},{contains:"saveContentToneOptions",action:"content-tone-save"},{contains:"closeBrandVoiceModal",action:"brand-voice-close"},{contains:"addBrandVoiceOption",action:"brand-voice-add"},{contains:"saveBrandVoiceOptions",action:"brand-voice-save"}];n.querySelectorAll("[onclick], [onchange]").forEach(e=>{const d=(e.getAttribute("onclick")||e.getAttribute("onchange")||"").toString();for(const i of t)d.includes(i.contains)&&(e.dataset.action||(e.dataset.action=i.action));if(d.includes("viewTable(")){e.dataset.action||(e.dataset.action="view-table");try{const i=d.match(/viewTable\((?:'([^']+)'|\"([^\"]+)\"|([^\)]+))\)/),r=(i&&(i[1]||i[2]||i[3]||"")).toString().trim().replace(/^`|`$/g,"").replace(/^\"|\"$/g,"").replace(/^'|'$/g,"");r&&!e.dataset.table&&(e.dataset.table=r)}catch{}}if(d.includes("updateContentToneOption(")){e.dataset.action||(e.dataset.action="content-tone-update");try{const i=d.match(/updateContentToneOption\((\d+)\s*,\s*'([^']+)'/);i&&(e.dataset.index=i[1],e.dataset.field=i[2])}catch{}}if(d.includes("removeContentToneOption(")){e.dataset.action||(e.dataset.action="content-tone-remove");try{const i=d.match(/removeContentToneOption\((\d+)\)/);i&&(e.dataset.index=i[1])}catch{}}if(d.includes("updateBrandVoiceOption(")){e.dataset.action||(e.dataset.action="brand-voice-update");try{const i=d.match(/updateBrandVoiceOption\((\d+)\s*,\s*'([^']+)'/);i&&(e.dataset.index=i[1],e.dataset.field=i[2])}catch{}}if(d.includes("removeBrandVoiceOption(")){e.dataset.action||(e.dataset.action="brand-voice-remove");try{const i=d.match(/removeBrandVoiceOption\((\d+)\)/);i&&(e.dataset.index=i[1])}catch{}}})}catch(t){console.debug("[AdminSettings] tagInlineHandlersForMigration error",t)}}function ee(n=document){try{const t=['[onclick*="scanDatabaseConnections"]','[onclick*="convertDatabaseConnections"]','[onclick*="openConversionTool"]','[onclick*="compactRepairDatabase"]','[onclick*="toggleDatabaseBackupTables"]','[onclick*="closeTableViewModal"]','[onclick*="viewTable("]','[onclick*="updateDatabaseConfig"]','[onclick*="testSSLConnection"]','[onclick*="closeAISettingsModal"]','[onclick*="saveAISettings"]','[onclick*="testAIProvider"]','[onclick*="refreshModels"]','[onclick*="toggleSection"]','[onclick*="closeContentToneModal"]','[onclick*="addContentToneOption"]','[onclick*="saveContentToneOptions"]','[onclick*="updateContentToneOption"]','[onclick*="removeContentToneOption"]','[onclick*="closeBrandVoiceModal"]','[onclick*="addBrandVoiceOption"]','[onclick*="saveBrandVoiceOptions"]','[onclick*="updateBrandVoiceOption"]','[onclick*="removeBrandVoiceOption"]'];n.querySelectorAll(t.join(",")).forEach(o=>{o.dataset.onclickLegacy||(o.dataset.onclickLegacy=o.getAttribute("onclick")||""),o.removeAttribute("onclick"),o.dataset.migrated="true"})}catch(t){console.debug("[AdminSettings] stripInlineHandlersForMigration error",t)}}function Be(){if(Me)return;Me=!0;const n=()=>{X(),ee()};document.readyState!=="loading"?n():document.addEventListener("DOMContentLoaded",()=>n(),{once:!0}),Te();try{new MutationObserver(o=>{for(const e of o)e.type==="childList"?e.addedNodes.forEach(d=>{d.nodeType===1&&(X(d),ee(d),Te(d))}):e.type==="attributes"&&e.attributeName==="onclick"&&(X(e.target),ee(e.target))}).observe(document.documentElement,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["onclick"]})}catch(t){console.debug("[AdminSettings] MutationObserver unavailable",t)}document.addEventListener("change",t=>{const o=t.target;if(o&&o.matches&&o.matches("#sslEnabled")){const i=document.getElementById("sslOptions");i&&(o.checked?i.classList.remove("hidden"):i.classList.add("hidden"))}if(o&&o.matches&&o.matches('input[name="ai_provider"]')){t.preventDefault();try{typeof window<"u"&&typeof window.toggleProviderSections=="function"?window.toggleProviderSections():typeof pe=="function"&&pe()}catch{}}const e=o&&o.closest&&o.closest('[data-action="content-tone-update"]');if(e||o&&o.dataset&&o.dataset.action==="content-tone-update"){const i=e||o,r=parseInt(i.dataset.index||"-1",10),c=i.dataset.field||"name",p=o.value;if(!isNaN(r)){const f=typeof window<"u"&&typeof window.updateContentToneOption=="function"?window.updateContentToneOption:typeof _=="function"?_:null;f&&f(r,c,p)}}const d=o&&o.closest&&o.closest('[data-action="brand-voice-update"]');if(d||o&&o.dataset&&o.dataset.action==="brand-voice-update"){const i=d||o,r=parseInt(i.dataset.index||"-1",10),c=i.dataset.field||"name",p=o.value;if(!isNaN(r)){const f=typeof window<"u"&&typeof window.updateBrandVoiceOption=="function"?window.updateBrandVoiceOption:typeof x=="function"?x:null;f&&f(r,c,p)}}},!0),document.addEventListener("click",t=>{const o=t.target,e=a=>o.closest(a),d=a=>{try{if(!a)return;if(typeof window<"u"&&typeof a=="string"&&typeof window[a]=="function"){window[a]();return}if(typeof a=="string"){const l=new Function(`return (${a});`)();typeof l=="function"&&l()}}catch(s){console.warn("[AdminSettings] modal callback failed",s)}};if(e('[data-action="scan-db"]')){t.preventDefault(),Ve(t);return}if(e('[data-action="convert-db"]')){t.preventDefault(),$e(t);return}if(e('[data-action="open-conversion-tool"]')){t.preventDefault(),Ne();return}if(e('[data-action="compact-repair"]')){t.preventDefault(),ze();return}if(e('[data-action="toggle-backup-tables"]')){t.preventDefault(),He();return}if(e('[data-action="close-table-view"]')){t.preventDefault(),je();return}const i=e('[data-action="view-table"]');if(i){t.preventDefault();let a=i.dataset.table||i.dataset.tableName;if(!a&&i.dataset.onclickLegacy)try{const s=i.dataset.onclickLegacy.match(/viewTable\((?:'([^']+)'|\"([^\"]+)\"|([^\)]+))\)/);a=(s&&(s[1]||s[2]||s[3]||"")).toString().trim()}catch{}a?Re(a):console.warn("[AdminSettings] view-table clicked but no table name found");return}if(e('[data-action="update-db-config"]')){t.preventDefault(),Ge(t);return}if(e('[data-action="test-ssl"]')){t.preventDefault(),Ue(t);return}if(e('[data-action="perform-export"]')){t.preventDefault(),typeof window<"u"&&typeof window.performExport=="function"?window.performExport():typeof performExport=="function"?performExport():console.warn("[AdminSettings] performExport not found");return}if(e('[data-action="import-sql"]')){t.preventDefault();const a=typeof window<"u"&&typeof window.importSQLFile=="function"?window.importSQLFile:typeof importSQLFile=="function"?importSQLFile:null;a?a():console.warn("[AdminSettings] importSQLFile not found");return}if(e('[data-action="import-csv"]')){t.preventDefault();const a=typeof window<"u"&&typeof window.importCSVFile=="function"?window.importCSVFile:typeof importCSVFile=="function"?importCSVFile:null;a?a():console.warn("[AdminSettings] importCSVFile not found");return}if(e('[data-action="import-json"]')){t.preventDefault();const a=typeof window<"u"&&typeof window.importJSONFile=="function"?window.importJSONFile:typeof importJSONFile=="function"?importJSONFile:null;a?a():console.warn("[AdminSettings] importJSONFile not found");return}const r=e('[data-action="close-admin-modal"]');if(r){t.preventDefault();const a=r.closest(".admin-modal-overlay")||r.closest(".admin-modal");a&&a.remove();return}const c=e('[data-action="modal-cancel"]');if(c){t.preventDefault();const a=c.closest(".admin-modal-overlay")||c.closest(".admin-modal");a&&a.remove();const s=c.dataset.callback;s&&d(s);return}const p=e('[data-action="modal-confirm"]');if(p){t.preventDefault();const a=p.closest(".admin-modal-overlay")||p.closest(".admin-modal");a&&a.remove();const s=p.dataset.callback;s&&d(s);return}const f=e('[data-action="maintenance-cancel"]');if(f){t.preventDefault();const a=f.closest(".admin-modal-overlay");a&&a.remove();try{typeof window<"u"&&typeof window.maintenanceConfirmResolve=="function"&&window.maintenanceConfirmResolve(!1)}catch{}return}const y=e('[data-action="maintenance-continue"]');if(y){t.preventDefault();const a=y.closest(".admin-modal-overlay");a&&a.remove();try{typeof window<"u"&&typeof window.maintenanceConfirmResolve=="function"&&window.maintenanceConfirmResolve(!0)}catch{}return}if(o&&o.matches&&o.matches('[data-action="overlay-close"]')){if(t.target===o){const a=o.id||"";try{a==="roomCategoryManagerModal"&&typeof window.closeRoomCategoryManagerModal=="function"?window.closeRoomCategoryManagerModal():a==="backgroundManagerModal"&&typeof window.closeBackgroundManagerModal=="function"?window.closeBackgroundManagerModal():a==="aiSettingsModal"&&typeof window.closeAISettingsModal=="function"?window.closeAISettingsModal():o.remove()}catch{o.remove()}}return}const B=e('[data-action="open-room-category-manager"]');if(B){t.preventDefault();const a=B.dataset.room?isNaN(B.dataset.room)?B.dataset.room:parseInt(B.dataset.room,10):null;typeof window.openRoomCategoryManagerModal=="function"?window.openRoomCategoryManagerModal(a):typeof openRoomCategoryManagerModal=="function"&&openRoomCategoryManagerModal(a);return}if(e('[data-action="add-room-category"]')){t.preventDefault();const a=typeof window<"u"&&typeof window.addRoomCategory=="function"?window.addRoomCategory:typeof addRoomCategory=="function"?addRoomCategory:null;a?a():console.warn("[AdminSettings] addRoomCategory not found");return}const P=e('[data-action="set-primary-category"]');if(P){t.preventDefault();const a=P.dataset.room,s=P.dataset.categoryId||P.dataset.categoryid,l=typeof window<"u"&&typeof window.setPrimaryCategory=="function"?window.setPrimaryCategory:typeof setPrimaryCategory=="function"?setPrimaryCategory:null;l&&a!=null&&s!=null?l(isNaN(a)?a:parseInt(a,10),parseInt(s,10)):console.warn("[AdminSettings] setPrimaryCategory missing args or not found");return}const Q=e('[data-action="remove-room-category"]');if(Q){t.preventDefault();const a=Q.dataset.assignmentId||Q.dataset.assignmentid,s=typeof window<"u"&&typeof window.removeRoomCategory=="function"?window.removeRoomCategory:typeof removeRoomCategory=="function"?removeRoomCategory:null;s&&a!=null?s(parseInt(a,10)):console.warn("[AdminSettings] removeRoomCategory not found");return}if(e('[data-action="upload-background"]')){t.preventDefault();const a=typeof window<"u"&&typeof window.uploadBackground=="function"?window.uploadBackground:typeof uploadBackground=="function"?uploadBackground:null;a?a():console.warn("[AdminSettings] uploadBackground not found");return}const F=e('[data-action="apply-background"]');if(F){t.preventDefault();const a=F.dataset.room,s=F.dataset.backgroundId||F.dataset.backgroundid,l=typeof window<"u"&&typeof window.applyBackground=="function"?window.applyBackground:typeof applyBackground=="function"?applyBackground:null;l&&a!=null&&s!=null?l(a,parseInt(s,10)):console.warn("[AdminSettings] applyBackground missing args or not found");return}const T=e('[data-action="delete-background"]');if(T){t.preventDefault();const a=T.dataset.backgroundId||T.dataset.backgroundid,s=T.dataset.backgroundName||T.dataset.backgroundname||"",l=typeof window<"u"&&typeof window.deleteBackground=="function"?window.deleteBackground:typeof deleteBackground=="function"?deleteBackground:null;l&&a!=null?l(parseInt(a,10),s):console.warn("[AdminSettings] deleteBackground missing args or not found");return}const S=e('[data-action="preview-background"]');if(S){t.preventDefault();const a=S.dataset.imageUrl||S.dataset.imageurl,s=S.dataset.backgroundName||S.dataset.backgroundname||"",l=typeof window<"u"&&typeof window.previewBackground=="function"?window.previewBackground:typeof previewBackground=="function"?previewBackground:null;l&&a?l(a,s):console.warn("[AdminSettings] previewBackground missing args or not found");return}const K=e('[data-action="close-preview"]');if(K){t.preventDefault();const a=K.closest(".fixed")||K.closest(".admin-modal-overlay");a&&a.remove();return}const C=e('[data-action="map-restore"]');if(C){t.preventDefault();const a=parseInt(C.dataset.mapId||C.dataset.mapid||"-1",10),s=C.dataset.mapName||C.dataset.mapname||"",l=(()=>{try{return decodeURIComponent(s)}catch{return s}})(),h=String(C.dataset.apply||"").toLowerCase()==="true",V=typeof window<"u"&&typeof window.restoreMap=="function"?window.restoreMap:typeof restoreMap=="function"?restoreMap:null;V&&a>=0?V(a,l,h):console.warn("[AdminSettings] restoreMap not found or bad args");return}const E=e('[data-action="map-preview"]');if(E){t.preventDefault();const a=parseInt(E.dataset.mapId||E.dataset.mapid||"-1",10),s=E.dataset.mapName||E.dataset.mapname||"",l=(()=>{try{return decodeURIComponent(s)}catch{return s}})(),h=typeof window<"u"&&typeof window.previewHistoricalMap=="function"?window.previewHistoricalMap:typeof previewHistoricalMap=="function"?previewHistoricalMap:null;h&&a>=0?h(a,l):console.warn("[AdminSettings] previewHistoricalMap not found or bad args");return}const I=e('[data-action="map-delete"]');if(I){t.preventDefault();const a=parseInt(I.dataset.mapId||I.dataset.mapid||"-1",10),s=I.dataset.mapName||I.dataset.mapname||"",l=(()=>{try{return decodeURIComponent(s)}catch{return s}})(),h=typeof window<"u"&&typeof window.deleteHistoricalMap=="function"?window.deleteHistoricalMap:typeof deleteHistoricalMap=="function"?deleteHistoricalMap:null;h&&a>=0?h(a,l):console.warn("[AdminSettings] deleteHistoricalMap not found or bad args");return}const Y=e('[data-action="email-view"]');if(Y){t.preventDefault();const a=parseInt(Y.dataset.emailId||Y.dataset.emailid||"-1",10),s=typeof window<"u"&&typeof window.viewEmailDetails=="function"?window.viewEmailDetails:typeof viewEmailDetails=="function"?viewEmailDetails:null;s&&a>=0?s(a):console.warn("[AdminSettings] viewEmailDetails not found or bad id");return}const Z=e('[data-action="email-edit-resend"]');if(Z){t.preventDefault();const a=parseInt(Z.dataset.emailId||Z.dataset.emailid||"-1",10),s=typeof window<"u"&&typeof window.editAndResendEmail=="function"?window.editAndResendEmail:typeof editAndResendEmail=="function"?editAndResendEmail:null;s&&a>=0?s(a):console.warn("[AdminSettings] editAndResendEmail not found or bad id");return}if(e('[data-action="email-history-close"]')){t.preventDefault();try{if(typeof window<"u"&&typeof window.closeEmailHistoryModal=="function")window.closeEmailHistoryModal();else{const a=document.getElementById("emailHistoryModal")||document.querySelector("#emailHistoryModal");a&&a.remove()}}catch{}return}if(e('[data-action="email-history-filter"]')){t.preventDefault();const a=typeof window<"u"&&typeof window.loadEmailHistory=="function"?window.loadEmailHistory:typeof loadEmailHistory=="function"?loadEmailHistory:null;a?a():console.warn("[AdminSettings] loadEmailHistory not found");return}const be=e('[data-action="email-history-page"]');if(be){t.preventDefault();const a=be.dataset.direction||"",s=typeof window<"u"&&typeof window.loadEmailHistoryPage=="function"?window.loadEmailHistoryPage:typeof loadEmailHistoryPage=="function"?loadEmailHistoryPage:null;s&&a?s(a):console.warn("[AdminSettings] loadEmailHistoryPage not found or dir missing");return}if(e('[data-action="email-edit-close"]')){t.preventDefault();try{if(typeof window<"u"&&typeof window.closeEmailEditModal=="function")window.closeEmailEditModal();else{const a=document.getElementById("emailEditModal");a&&a.remove()}}catch{}return}const M=e('[data-action="dismiss-notification"]');if(M){t.preventDefault();const a=M.closest(".bg-green-100")||M.closest(".shadow-lg")||M.parentElement&&M.parentElement.parentElement||M.closest(".admin-modal-overlay");a&&a.remove&&a.remove();return}if(e('[data-action="email-config-close"]')){t.preventDefault();try{if(typeof window<"u"&&typeof window.closeEmailConfigModal=="function")window.closeEmailConfigModal();else{const a=document.getElementById("emailConfigModal");a&&a.remove()}}catch{}return}if(e('[data-action="email-send-test"]')){t.preventDefault();const a=typeof window<"u"&&typeof window.sendTestEmail=="function"?window.sendTestEmail:typeof sendTestEmail=="function"?sendTestEmail:null;a?a():console.warn("[AdminSettings] sendTestEmail not found");return}if(e('[data-action="template-manager-close"]')){t.preventDefault();try{if(typeof window<"u"&&typeof window.closeTemplateManagerModal=="function")window.closeTemplateManagerModal();else{const s=document.getElementById("templateManagerModal")||document.querySelector("#templateManagerModal")||document.querySelector("#emailTemplateManagerModal")||document.querySelector("#templateManagerModal .admin-modal-overlay")||document.querySelector(".admin-modal-overlay");s&&s.remove()}}catch{}return}if(e('[data-action="email-template-edit-close"]')){t.preventDefault();try{if(typeof window<"u"&&typeof window.closeEmailTemplateEditModal=="function")window.closeEmailTemplateEditModal();else{const a=document.getElementById("emailTemplateEditModal");a&&a.remove()}}catch{}return}if(e('[data-action="email-template-save"]')){t.preventDefault();const a=typeof window<"u"&&typeof window.saveEmailTemplate=="function"?window.saveEmailTemplate:typeof saveEmailTemplate=="function"?saveEmailTemplate:null;a?a():console.warn("[AdminSettings] saveEmailTemplate not found");return}if(e('[data-action="email-template-preview-close"]')){t.preventDefault();try{if(typeof window<"u"&&typeof window.closeEmailTemplatePreviewModal=="function")window.closeEmailTemplatePreviewModal();else{const a=document.getElementById("emailTemplatePreviewModal");a&&a.remove()}}catch{}return}if(e('[data-action="ai-close-settings"]')){t.preventDefault();try{if(typeof window<"u"&&typeof window.closeAISettingsModal=="function")window.closeAISettingsModal();else{const a=document.getElementById("aiSettingsModal");a&&a.remove()}}catch{}return}if(e('[data-action="ai-save-settings"]')){t.preventDefault();const a=typeof window<"u"&&typeof window.saveAISettings=="function"?window.saveAISettings:typeof ue=="function"?ue:null;a?a():console.warn("[AdminSettings] saveAISettings not found");return}if(e('[data-action="ai-test-provider"]')){t.preventDefault();const a=typeof window<"u"&&typeof window.testAIProvider=="function"?window.testAIProvider:typeof fe=="function"?fe:null;a?a():console.warn("[AdminSettings] testAIProvider not found");return}const he=e('[data-action="ai-toggle-section"]');if(he){t.preventDefault();const a=he.dataset.section;try{if(typeof window<"u"&&typeof window.toggleSection=="function")window.toggleSection(a);else if(a){const s=document.getElementById(`${a}-content`),l=document.getElementById(`${a}-icon`);s&&s.classList.toggle("hidden"),l&&(l.textContent=s&&!s.classList.contains("hidden")?"‚ñº":"‚ñ∂")}}catch{}return}const _e=e('[data-action="ai-refresh-models"]');if(_e){t.preventDefault();const a=_e.dataset.provider,s=typeof window<"u"&&typeof window.refreshModels=="function"?window.refreshModels:typeof G=="function"?G:null;s&&a?s(a):console.warn("[AdminSettings] refreshModels not found or provider missing");return}if(e('[data-action="ai-manage-brand-voice"]')){t.preventDefault();const a=typeof window<"u"&&typeof window.manageBrandVoiceOptions=="function"?window.manageBrandVoiceOptions:typeof se=="function"?se:null;a?a():console.warn("[AdminSettings] manageBrandVoiceOptions not found");return}if(e('[data-action="ai-manage-content-tone"]')){t.preventDefault();const a=typeof window<"u"&&typeof window.manageContentToneOptions=="function"?window.manageContentToneOptions:typeof te=="function"?te:null;a?a():console.warn("[AdminSettings] manageContentToneOptions not found");return}if(e('[data-action="content-tone-close"]')){t.preventDefault();const a=typeof window<"u"&&typeof window.closeContentToneModal=="function"?window.closeContentToneModal:typeof R=="function"?R:null;if(a)a();else{const s=document.getElementById("contentToneModal");s&&s.remove()}return}if(e('[data-action="content-tone-add"]')){t.preventDefault();const a=typeof window<"u"&&typeof window.addContentToneOption=="function"?window.addContentToneOption:typeof ne=="function"?ne:null;a?a():console.warn("[AdminSettings] addContentToneOption not found");return}if(e('[data-action="content-tone-save"]')){t.preventDefault();const a=typeof window<"u"&&typeof window.saveContentToneOptions=="function"?window.saveContentToneOptions:typeof ae=="function"?ae:null;a?a():console.warn("[AdminSettings] saveContentToneOptions not found");return}const xe=e('[data-action="content-tone-remove"]');if(xe){t.preventDefault();const a=parseInt(xe.dataset.index||"-1",10),s=typeof window<"u"&&typeof window.removeContentToneOption=="function"?window.removeContentToneOption:typeof oe=="function"?oe:null;s&&!isNaN(a)?s(a):console.warn("[AdminSettings] removeContentToneOption missing args or not found");return}if(e('[data-action="brand-voice-close"]')){t.preventDefault();const a=typeof window<"u"&&typeof window.closeBrandVoiceModal=="function"?window.closeBrandVoiceModal:typeof z=="function"?z:null;if(a)a();else{const s=document.getElementById("brandVoiceModal");s&&s.remove()}return}if(e('[data-action="brand-voice-add"]')){t.preventDefault();const a=typeof window<"u"&&typeof window.addBrandVoiceOption=="function"?window.addBrandVoiceOption:typeof de=="function"?de:null;a?a():console.warn("[AdminSettings] addBrandVoiceOption not found");return}if(e('[data-action="brand-voice-save"]')){t.preventDefault();const a=typeof window<"u"&&typeof window.saveBrandVoiceOptions=="function"?window.saveBrandVoiceOptions:typeof ce=="function"?ce:null;a?a():console.warn("[AdminSettings] saveBrandVoiceOptions not found");return}const Ce=e('[data-action="brand-voice-remove"]');if(Ce){t.preventDefault();const a=parseInt(Ce.dataset.index||"-1",10),s=typeof window<"u"&&typeof window.removeBrandVoiceOption=="function"?window.removeBrandVoiceOption:typeof re=="function"?re:null;s&&!isNaN(a)?s(a):console.warn("[AdminSettings] removeBrandVoiceOption missing args or not found");return}},!0),document.addEventListener("input",t=>{const o=t.target;if(!o||!o.getAttribute)return;const e=o.getAttribute("data-value-target");if(e){const r=document.getElementById(e);r&&(r.textContent=o.value)}const d=o.getAttribute("data-target-id");if(d){const r=document.getElementById(d);if(r&&"value"in r){if(r.value!==o.value){if(window.WF_InputMirrorSync||(window.WF_InputMirrorSync=new WeakSet),window.WF_InputMirrorSync.has(o))return;window.WF_InputMirrorSync.add(r);try{r.value=o.value}catch{}try{r.dispatchEvent(new Event("input",{bubbles:!0}))}catch{}window.WF_InputMirrorSync.delete(r)}}else r&&(r.textContent=o.value)}const i=o.getAttribute("data-action");if(i==="content-tone-change"){const r=parseInt(o.getAttribute("data-index")||"-1",10),c=o.getAttribute("data-field"),p=o.value,f=typeof window<"u"&&typeof window.updateContentToneOption=="function"?window.updateContentToneOption:typeof _=="function"?_:null;f&&!isNaN(r)&&c&&f(r,c,p)}else if(i==="brand-voice-change"){const r=parseInt(o.getAttribute("data-index")||"-1",10),c=o.getAttribute("data-field"),p=o.value,f=typeof window<"u"&&typeof window.updateBrandVoiceOption=="function"?window.updateBrandVoiceOption:typeof x=="function"?x:null;f&&!isNaN(r)&&c&&f(r,c,p)}},!0),document.addEventListener("change",t=>{const o=t.target;if(!o||!o.getAttribute)return;const e=o.getAttribute("data-action");if(e==="content-tone-change"){const d=parseInt(o.getAttribute("data-index")||"-1",10),i=o.getAttribute("data-field"),r=o.value,c=typeof window<"u"&&typeof window.updateContentToneOption=="function"?window.updateContentToneOption:typeof _=="function"?_:null;c&&!isNaN(d)&&i&&c(d,i,r)}else if(e==="brand-voice-change"){const d=parseInt(o.getAttribute("data-index")||"-1",10),i=o.getAttribute("data-field"),r=o.value,c=typeof window<"u"&&typeof window.updateBrandVoiceOption=="function"?window.updateBrandVoiceOption:typeof x=="function"?x:null;c&&!isNaN(d)&&i&&c(d,i,r)}},!0)}typeof window<"u"&&(document.readyState!=="loading"?Be():document.addEventListener("DOMContentLoaded",()=>Be(),{once:!0}));function Te(n=document){try{const t=n.querySelector?n.querySelector("#sslEnabled"):null,o=n.querySelector?n.querySelector("#sslOptions"):null;t&&o&&o.classList.toggle("hidden",!t.checked)}catch{}}
