var he=(o,e)=>()=>(e||o((e={exports:{}}).exports,e),e.exports);var Fe=he((He,_)=>{console.log("Loading WhimsicalFrog Core...");const O={modules:new Map,readyCallbacks:[],initialized:!1,registerModule:function(o,e){return console.log(`üì¶ Registering module: ${o}`),this.modules.set(o,e),this},addModule:function(o,e){return this.registerModule(o,e)},getModule:function(o){return this.modules.get(o)},ready:function(o){return this.initialized?o(this):this.readyCallbacks.push(o),this},init:function(){return this.initialized?this:(console.log("üê∏ Initializing WhimsicalFrog Core..."),this.initialized=!0,this.readyCallbacks.forEach(o=>{try{o(this)}catch(e){console.error("Error in ready callback:",e)}}),console.log("üê∏ WhimsicalFrog Core initialized"),this)}};window.WhimsicalFrog=O;document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>O.init()):O.init();console.log("WhimsicalFrog Core loaded");console.log("Loading utils.js...");window.utils={debounce:function(o,e){let t;return function(...i){const a=()=>{clearTimeout(t),o(...i)};clearTimeout(t),t=setTimeout(a,e)}},throttle:function(o,e){let t;return function(){const n=arguments,i=this;t||(o.apply(i,n),t=!0,setTimeout(()=>t=!1,e))}},createEventEmitter:function(){const o={};return{on:function(e,t){o[e]||(o[e]=[]),o[e].push(t)},emit:function(e,t){o[e]&&o[e].forEach(n=>n(t))},off:function(e,t){o[e]&&(o[e]=o[e].filter(n=>n!==t))}}}};console.log("Utils loaded");(function(o){const e="/api/",t=o.fetch.bind(o);function n(r){return r.startsWith("http://")||r.startsWith("https://")||r.startsWith("/")?r:e+r.replace(/^\/?/,"")}async function i(r,c,d=null,m={}){const f=n(c),u={method:r,headers:{"Content-Type":"application/json",...m.headers||{}},credentials:"same-origin",...m};r!=="GET"&&d!==null&&(u.body=JSON.stringify(d));const p=await t(f,u),E=(p.headers.get("content-type")||"").includes("application/json")?p.json.bind(p):p.text.bind(p);if(!p.ok){const v=await E(),M=typeof v=="string"?v:JSON.stringify(v);throw new Error(`API error ${p.status}: ${M}`)}return E()}function a(r,c={}){return i("GET",r,null,c)}function s(r,c=null,d={}){return i("POST",r,c,d)}function l(r,c,d={}){const m=n(r),f={method:"POST",body:c,credentials:"same-origin",...d};return t(m,f).then(u=>u.ok?u.text():Promise.reject(new Error(`API error ${u.status}`)))}o.apiGet=a,o.apiPost=s,o.apiPostForm=l,o.fetch=function(r,c={}){const d=typeof r=="string"?r:r.url;return/\/api\//.test(d)&&console.warn("‚ö†Ô∏è  Consider using apiGet/apiPost instead of direct fetch for API calls:",d),t(r,c)},console.log("[api-client] Initialized")})(window);var h=typeof h<"u"?h:[],b=typeof b<"u"?b:0;function j(o,e,t=null){if(console.log("Opening image viewer:",{imagePath:o,productName:e,allImages:t}),h=[],b=0,t&&(t.length>0||t instanceof HTMLCollection&&t.length>0)){h=(t instanceof HTMLCollection?Array.from(t):t).map(m=>({src:m.image_path||m.src||m,alt:m.alt_text||m.alt||e}));const d=h.findIndex(m=>m.src===o);d!==-1&&(b=d)}else{const c=document.getElementById("detailedItemModal");if(c){const d=c.querySelectorAll(".overflow-x-auto img");d.length>0&&d.forEach((m,f)=>{h.push({src:m.src,alt:m.alt||e}),m.src===o&&(b=f)})}h.length===0&&(h=[{src:o,alt:e}])}let n=document.getElementById("imageViewerModal");n||(J(),n=document.getElementById("imageViewerModal"));const i=document.getElementById("viewerImage"),a=document.getElementById("viewerImageTitle"),s=document.getElementById("viewerImageCounter");if(!i){console.error("Image viewer elements not found");return}i.src=h[b].src,i.alt=h[b].alt,a&&(a.textContent=e),s&&h.length>1?(s.textContent=`${b+1} of ${h.length}`,s.classList.remove("image-viewer-controls-hidden"),s.classList.add("image-viewer-controls-visible")):s&&(s.classList.remove("image-viewer-controls-visible"),s.classList.add("image-viewer-controls-hidden"));const l=document.getElementById("viewerPrevBtn"),r=document.getElementById("viewerNextBtn");if(l&&r){const c=h.length>1,d=c?"image-viewer-controls-visible":"image-viewer-controls-hidden",m=c?"image-viewer-controls-hidden":"image-viewer-controls-visible";l.classList.remove(m),l.classList.add(d),r.classList.remove(m),r.classList.add(d)}n.classList.remove("image-viewer-modal-closed"),n.classList.add("image-viewer-modal-open"),n.classList.remove("hidden"),n.style.display="flex",n.classList.add("z-image-viewer"),document.body.classList.add("modal-open","image-viewer-open"),document.documentElement.classList.add("modal-open"),console.log("üñºÔ∏è Image viewer opened. Classes added:",{bodyClasses:document.body.className,viewerModalZIndex:getComputedStyle(n).zIndex,viewerModalClasses:n.className}),document.addEventListener("keydown",Y)}function D(){const o=document.getElementById("imageViewerModal");o&&(o.classList.remove("image-viewer-modal-open"),o.classList.add("image-viewer-modal-closed"),o.style.display="none"),document.body.classList.remove("modal-open","image-viewer-open"),document.documentElement.classList.remove("modal-open"),document.body.classList.remove("modal-open-overflow-hidden","modal-open-position-fixed"),document.documentElement.classList.remove("modal-open-overflow-hidden"),document.removeEventListener("keydown",Y)}function N(){h.length<=1||(b=(b-1+h.length)%h.length,V())}function W(){h.length<=1||(b=(b+1)%h.length,V())}function V(){const o=document.getElementById("viewerImage"),e=document.getElementById("viewerImageCounter");!o||!h[b]||(o.src=h[b].src,o.alt=h[b].alt,e&&h.length>1&&(e.textContent=`${b+1} of ${h.length}`))}function Y(o){switch(o.key){case"Escape":D();break;case"ArrowLeft":o.preventDefault(),N();break;case"ArrowRight":o.preventDefault(),W();break}}function J(){document.body.insertAdjacentHTML("beforeend",`
    <div id="imageViewerModal" class="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center p-4 image-viewer-modal image-viewer-modal-closed">
        <div class="relative w-full h-full flex items-center justify-center">
            <!- Close button ->
            <button id="viewerCloseBtn" data-action="closeImageViewer"
                    class="absolute top-4 right-4 text-white hover:text-gray-300 text-4xl font-bold z-10 bg-black bg-opacity-50 rounded-full w-12 h-12 flex items-center justify-center transition-colors">
                &times;
            </button>
            
            <!- Previous button ->
            <button id="viewerPrevBtn" data-action="previousImage"
                    class="absolute left-4 top-1/2 transform -translate-y-1/2 text-white hover:text-gray-300 text-3xl font-bold z-10 bg-black bg-opacity-50 rounded-full w-12 h-12 flex items-center justify-center transition-colors">
                &#8249;
            </button>
            
            <!- Next button ->
            <button id="viewerNextBtn" data-action="nextImage"
                    class="absolute right-4 top-1/2 transform -translate-y-1/2 text-white hover:text-gray-300 text-3xl font-bold z-10 bg-black bg-opacity-50 rounded-full w-12 h-12 flex items-center justify-center transition-colors">
                &#8250;
            </button>
            
            <!- Large image ->
            <img id="viewerImage" src="" alt="" class="max-w-full max-h-full object-contain">
            
            <!- Image info ->
            <div class="absolute bottom-4 left-1/2 transform -translate-x-1/2 text-white text-center bg-black bg-opacity-50 px-4 py-2 rounded-lg">
                <p id="viewerImageTitle" class="font-medium"></p>
                <p id="viewerImageCounter" class="text-sm opacity-75"></p>
            </div>
        </div>
    </div>`);const e=document.getElementById("imageViewerModal");e&&e.addEventListener("click",function(t){t.target===e&&D()})}function z(o){if(!o)return;const e=o.querySelector(".enlarge-tooltip");e&&e.remove();const t=document.createElement("div");t.className="enlarge-tooltip",t.textContent="üîç Click to enlarge",t.classList.add("enlarge-tooltip-styled"),o.appendChild(t),o.addEventListener("mouseenter",()=>{t.classList.add("tooltip-visible"),t.classList.remove("tooltip-hidden")}),o.addEventListener("mouseleave",()=>{t.classList.remove("tooltip-visible"),t.classList.add("tooltip-hidden")})}document.addEventListener("DOMContentLoaded",function(){document.getElementById("imageViewerModal")||J(),document.querySelectorAll('[onclick*="openImageViewer"], .image-viewer-trigger').forEach(e=>{const t=e.closest(".relative")||e.parentElement;t&&t.style.position!=="static"&&z(t)})});window.openImageViewer=j;window.closeImageViewer=D;window.previousImage=N;window.nextImage=W;window.addEnlargeTooltip=z;typeof _<"u"&&_.exports&&(_.exports={openImageViewer:j,closeImageViewer:D,previousImage:N,nextImage:W,addEnlargeTooltip:z});class we{constructor(){this.notifications=new Map,this.nextId=1,this.container=null,this.initialized=!1,this.init()}init(){this.initialized||(this.container||(this.container=document.createElement("div"),this.container.id="wf-notification-container",this.container.className="wf-notification-container",this.container.style.cssText=`
                position: var(-notification-container-position, fixed);
                top: var(-notification-container-top, 24px);
                right: var(-notification-container-right, 24px);
                z-index: var(-notification-container-zindex, 2147483647);
                pointer-events: none;
                max-width: var(-notification-container-width, 420px);
                width: 100%;
            `,document.body.appendChild(this.container)),this.initialized=!0,console.log("‚úÖ WhimsicalFrog Unified Notification System initialized"))}show(e,t="info",n={}){this.initialized||(console.warn("Notification system not initialized, initializing now..."),this.init());const{title:i=null,duration:a=this.getDefaultDuration(t),persistent:s=!1,actions:l=null,autoHide:r=!0}=n,c=this.nextId++,d=this.createNotification(c,e,t,i,s,l);return this.container.appendChild(d),this.notifications.set(c,d),requestAnimationFrame(()=>{d.style.opacity="1",d.style.transform="var(-notification-transform-show, translateX(0) scale(1))"}),!s&&r&&a>0&&setTimeout(()=>{this.remove(c)},a),c}createNotification(e,t,n,i,a,s){const l=document.createElement("div");return l.className=`wf-notification wf-${n}-notification`,l.dataset.id=e,l.dataset.type=n,l.addEventListener("click",r=>{console.log(`Notification ${e} clicked - removing`),r.preventDefault(),r.stopPropagation(),this.remove(e)}),l.addEventListener("mousedown",r=>{console.log(`Notification ${e} mousedown event`)}),l.title="Click to dismiss",l.innerHTML=`
            <div class="wf-notification-content">
                <div class="wf-notification-icon">
                    ${this.getTypeIcon(n)}
                </div>
                <div class="wf-notification-body">
                    ${i?`<div class="wf-notification-title">${i}</div>`:""}
                    <div class="wf-notification-message">
                        ${t}
                    </div>
                    ${s?this.createActions(s):""}
                </div>
                ${a?"":`
                    <button class="wf-notification-close" onclick="event.stopPropagation(); window.wfNotifications.remove(${e})">&times;</button>
                `}
            </div>
        `,(n==="warning"||n==="error")&&setTimeout(()=>{l.parentElement&&(l.classList.add("pulse"),setTimeout(()=>{l.classList.remove("pulse")},150))},200),l}createActions(e){return!e||!Array.isArray(e)?"":`
            <div class="wf-notification-actions">
                ${e.map(t=>`
                    <button onclick="${t.onClick}" class="wf-notification-action ${t.style==="primary"?"primary":"secondary"}">
                        ${t.text}
                    </button>
                `).join("")}
            </div>
        `}getTypeConfig(e){const t={success:{background:"#87ac3a",border:"#6b8e23",color:"white",titleColor:"white",closeColor:"white",shadow:"rgba(135, 172, 58, 0.3)",icon:"‚úÖ"},error:{background:"linear-gradient(135deg, #fee2e2, #fecaca)",border:"#ef4444",color:"#7f1d1d",titleColor:"#dc2626",closeColor:"#ef4444",shadow:"rgba(239, 68, 68, 0.2)",icon:"‚ùå"},warning:{background:"linear-gradient(135deg, #fef3c7, #fde68a)",border:"#f59e0b",color:"#92400e",titleColor:"#d97706",closeColor:"#f59e0b",shadow:"rgba(245, 158, 11, 0.2)",icon:"‚ö†Ô∏è"},info:{background:"linear-gradient(135deg, #dbeafe, #bfdbfe)",border:"#3b82f6",color:"#1e3a8a",titleColor:"#2563eb",closeColor:"#3b82f6",shadow:"rgba(59, 130, 246, 0.2)",icon:"‚ÑπÔ∏è"},validation:{background:"linear-gradient(135deg, #fef3c7, #fde68a)",border:"#f59e0b",color:"#92400e",titleColor:"#d97706",closeColor:"#f59e0b",shadow:"rgba(245, 158, 11, 0.2)",icon:"‚ö†Ô∏è"}};return t[e]||t.info}getDefaultDuration(e){return 5e3}remove(e){console.log(`Attempting to remove notification ${e}`);const t=this.notifications.get(e);t&&t.parentElement?(console.log(`Removing notification ${e} from DOM`),t.style.opacity="0",t.style.transform="var(-notification-transform-enter, translateX(100%) scale(0.9))",setTimeout(()=>{t.parentElement&&(t.remove(),console.log(`Notification ${e} removed from DOM`)),this.notifications.delete(e),console.log(`Notification ${e} deleted from memory`)},400)):console.log(`Notification ${e} not found or already removed`)}removeAll(){this.notifications.forEach((e,t)=>{this.remove(t)})}success(e,t={}){return this.show(e,"success",t)}error(e,t={}){return this.show(e,"error",t)}warning(e,t={}){return this.show(e,"warning",t)}info(e,t={}){return this.show(e,"info",t)}validation(e,t={}){return this.show(e,"validation",t)}getFallbackColor(e,t){const n={success:{background:"linear-gradient(135deg, #87ac3a, #6b8e23)",border:"#556B2F",text:"#ffffff"},error:{background:"linear-gradient(135deg, #dc2626, #b91c1c)",border:"#991b1b",text:"#ffffff"},warning:{background:"linear-gradient(135deg, #f59e0b, #d97706)",border:"#b45309",text:"#ffffff"},info:{background:"linear-gradient(135deg, #3b82f6, #2563eb)",border:"#1d4ed8",text:"#ffffff"},validation:{background:"linear-gradient(135deg, #f59e0b, #d97706)",border:"#b45309",text:"#ffffff"}};return n[e]?.[t]||n.info[t]}getFallbackShadow(e){const t={success:"0 12px 28px rgba(135, 172, 58, 0.35), 0 4px 8px rgba(135, 172, 58, 0.15)",error:"0 12px 28px rgba(220, 38, 38, 0.35), 0 4px 8px rgba(220, 38, 38, 0.15)",warning:"0 12px 28px rgba(245, 158, 11, 0.35), 0 4px 8px rgba(245, 158, 11, 0.15)",info:"0 12px 28px rgba(59, 130, 246, 0.35), 0 4px 8px rgba(59, 130, 246, 0.15)",validation:"0 12px 28px rgba(245, 158, 11, 0.35), 0 4px 8px rgba(245, 158, 11, 0.15)"};return t[e]||t.info}getTypeIcon(e){const t={success:"‚úÖ",error:"‚ùå",warning:"‚ö†Ô∏è",info:"‚ÑπÔ∏è",validation:"‚ö†Ô∏è"};return t[e]||t.info}}window.wfNotifications=new we;function ye(){window._wfNotificationFunctionsRegistered||(window.showNotification=(o,e="info",t={})=>window.wfNotifications.show(o,e,t),window.showSuccess=(o,e={})=>window.wfNotifications.success(o,e),window.showError=(o,e={})=>window.wfNotifications.error(o,e),window.showWarning=(o,e={})=>window.wfNotifications.warning(o,e),window.showInfo=(o,e={})=>window.wfNotifications.info(o,e),window.showValidation=(o,e={})=>window.wfNotifications.validation(o,e),window._wfNotificationFunctionsRegistered=!0,console.log("üì¢ WhimsicalFrog notification functions registered globally"))}ye();window._wfAlertOverridden||(window.alert=function(o){o.includes("added to your cart")||o.includes("added to cart")?window.wfNotifications.success(o):window.wfNotifications.info(o)},window._wfAlertOverridden=!0);window.showToast||(window.showToast=(o,e=null,t={})=>{let n,i;return e===null?(n=o,i="info"):typeof o=="string"&&["success","error","warning","info"].includes(o)?(i=o,n=e):(n=o,i=e||"info"),window.wfNotifications.show(n,i,t)});window.hideNotification=o=>window.wfNotifications.remove(o);window.clearNotifications=()=>window.wfNotifications.removeAll();window.cart&&typeof window.cart=="object"&&(window.cart.showNotification=o=>window.wfNotifications.success(o),window.cart.showErrorNotification=o=>window.wfNotifications.error(o),window.cart.showValidationError=o=>window.wfNotifications.validation(o));console.log("üéâ WhimsicalFrog Unified Notification System ready!");window.NotificationMessages={success:{itemSaved:"Item saved successfully!",itemDeleted:"Item deleted successfully!",imageUploaded:"Image uploaded successfully!",priceUpdated:"Price updated successfully!",stockSynced:"Stock levels synchronized!",templateSaved:"Template saved successfully!",aiProcessingComplete:"AI processing completed! Images have been updated.",marketingGenerated:"üéØ AI content generated successfully!",costBreakdownApplied:"‚úÖ Cost breakdown applied and saved!",settingsSaved:"Settings saved successfully!"},error:{itemNotFound:"Item not found. Please refresh the page.",uploadFailed:"Upload failed. Please try again.",invalidInput:"Please check your input and try again.",networkError:"Network error occurred. Please check your connection.",aiProcessingFailed:"AI processing failed. Please try again.",insufficientData:"Insufficient data provided.",serverError:"Server error occurred. Please contact support if this persists.",fileTooBig:"File is too large. Maximum size allowed is 10MB.",invalidFileType:"Invalid file type. Please upload images only."},warning:{unsavedChanges:"You have unsaved changes. Are you sure you want to leave?",noItemsSelected:"Please select at least one item.",lowStock:"Warning: Stock level is low.",duplicateEntry:"This entry already exists.",dataIncomplete:"Some data may be incomplete."},info:{processing:"Processing your request...",loading:"Loading data...",analyzing:"Analyzing with AI...",saving:"Saving changes...",uploading:"Uploading files..."},validation:{required:"This field is required.",emailInvalid:"Please enter a valid email address.",priceInvalid:"Please enter a valid price.",quantityInvalid:"Please enter a valid quantity.",skuRequired:"SKU is required.",nameRequired:"Name is required.",colorRequired:"Please select a color before adding to cart.",paymentRequired:"Please select a payment method.",shippingRequired:"Please select a shipping method."}};window.getMessage=function(o,e,t="Operation completed"){try{return window.NotificationMessages[o]?.[e]||t}catch{return t}};window.showSuccessMessage=function(o,e){showSuccess(getMessage("success",o,e))};window.showErrorMessage=function(o,e){showError(getMessage("error",o,e))};window.showWarningMessage=function(o,e){showWarning(getMessage("warning",o,e))};window.showInfoMessage=function(o,e){showInfo(getMessage("info",o,e))};window.showValidationMessage=function(o,e){showValidation(getMessage("validation",o,e))};window.showGlobalPopup=function(o,e){console.log("Global popup system - showGlobalPopup called")};window.hideGlobalPopup=function(){console.log("Global popup system - hideGlobalPopup called")};window.hideGlobalPopupImmediate=function(){console.log("Global popup system - hideGlobalPopupImmediate called")};if(typeof UnifiedPopupSystem<"u"){const o=new UnifiedPopupSystem;window.unifiedPopupSystem=o}class X{constructor(){this.overlay=null,this.modal=null,this.currentResolve=null,this.init()}init(){this.createModalHTML(),this.addEventListeners()}createModalHTML(){const e=document.getElementById("global-confirmation-modal");e&&e.remove(),this.overlay=document.createElement("div"),this.overlay.id="global-confirmation-modal",this.overlay.className="confirmation-modal-overlay",this.modal=document.createElement("div"),this.modal.className="confirmation-modal animate-slide-in-up",this.overlay.appendChild(this.modal),document.body.appendChild(this.overlay)}addEventListeners(){this.overlay.addEventListener("click",e=>{e.target===this.overlay&&this.close(!1)}),document.addEventListener("keydown",e=>{e.key==="Escape"&&this.overlay.classList.contains("show")&&this.close(!1)})}show(e={}){return new Promise(t=>{this.currentResolve=t;const{title:n="Confirm Action",message:i="Are you sure you want to proceed?",details:a=null,icon:s="‚ö†Ô∏è",iconType:l="warning",confirmText:r="Confirm",cancelText:c="Cancel",confirmStyle:d="confirm",subtitle:m=null}=e;this.modal.innerHTML=`
                <div class="confirmation-modal-header">
                    <div class="confirmation-modal-icon ${l}">
                        ${s}
                    </div>
                    <h3 class="confirmation-modal-title">${n}</h3>
                    ${m?`<p class="confirmation-modal-subtitle">${m}</p>`:""}
                </div>
                <div class="confirmation-modal-body">
                    <div class="confirmation-modal-message">${i}</div>
                    ${a?`<div class="confirmation-modal-details">${a}</div>`:""}
                </div>
                <div class="confirmation-modal-footer">
                    <button class="confirmation-modal-button cancel" id="modal-cancel">
                        ${c}
                    </button>
                    <button class="confirmation-modal-button ${d}" id="modal-confirm">
                        ${r}
                    </button>
                </div>
            `,document.getElementById("modal-cancel").addEventListener("click",()=>{this.close(!1)}),document.getElementById("modal-confirm").addEventListener("click",()=>{this.close(!0)}),this.overlay.classList.add("show"),setTimeout(()=>{document.getElementById("modal-confirm").focus()},100)})}close(e){this.overlay.classList.remove("show"),setTimeout(()=>{this.currentResolve&&(this.currentResolve(e),this.currentResolve=null)},300)}}let $=null;document.addEventListener("DOMContentLoaded",()=>{$=new X});window.showConfirmationModal=async o=>($||($=new X),await $.show(o));window.confirmAction=async(o,e,t="Confirm")=>await showConfirmationModal({title:o,message:e,confirmText:t,icon:"‚ö†Ô∏è",iconType:"warning"});window.confirmDanger=async(o,e,t="Delete")=>await showConfirmationModal({title:o,message:e,confirmText:t,confirmStyle:"danger",icon:"‚ö†Ô∏è",iconType:"danger"});window.confirmInfo=async(o,e,t="Continue")=>await showConfirmationModal({title:o,message:e,confirmText:t,icon:"‚ÑπÔ∏è",iconType:"info"});window.confirmSuccess=async(o,e,t="Proceed")=>await showConfirmationModal({title:o,message:e,confirmText:t,icon:"‚úÖ",iconType:"success"});window.confirmWithDetails=async(o,e,t,n={})=>await showConfirmationModal({title:o,message:e,details:t,...n});function A(){const o=getComputedStyle(document.documentElement).getPropertyValue("-modal-close-position").trim();document.querySelectorAll(".modal-close").forEach(t=>{t.classList.remove("position-top-left","position-top-center","position-bottom-right","position-bottom-left"),o&&o!=="top-right"&&t.classList.add(`position-${o}`)})}document.addEventListener("DOMContentLoaded",A);function ve(){A()}const be=new MutationObserver(function(o){o.forEach(function(e){e.addedNodes.forEach(function(t){t.nodeType===1&&((t.querySelectorAll?t.querySelectorAll(".modal-close"):[]).length>0&&A(),t.classList&&t.classList.contains("modal-close")&&A())})})});be.observe(document.body,{childList:!0,subtree:!0});window.updateModalClosePositioning=ve;class K{constructor(){this.sessionStartTime=Date.now(),this.pageStartTime=Date.now(),this.lastScrollPosition=0,this.maxScrollDepth=0,this.interactions=[],this.isTracking=!0,this.init()}init(){this.trackVisit(),this.trackPageView(),this.setupEventListeners(),this.setupPageExitTracking(),this.startPeriodicTracking()}trackVisit(){const e={landing_page:window.location.href,referrer:document.referrer,timestamp:Date.now()};this.sendData("track_visit",e)}trackPageView(){const e={page_url:window.location.href,page_title:document.title,page_type:this.getPageType(),item_sku:this.getItemSku(),timestamp:Date.now()};this.sendData("track_page_view",e)}getPageType(){const t=new URLSearchParams(window.location.search).get("page")||"landing";return t==="shop"?"shop":t.startsWith("room")?"product_room":t==="cart"?"cart":t==="admin"?"admin":t==="landing"?"landing":"other"}getItemSku(){const e=new URLSearchParams(window.location.search);if(e.get("product"))return e.get("product");if(e.get("sku"))return e.get("sku");if(e.get("item"))return e.get("item");if(e.get("edit"))return e.get("edit");const t=document.querySelectorAll("[data-product-id], [data-sku], [data-item-sku]");return t.length>0?t[0].dataset.productId||t[0].dataset.sku||t[0].dataset.itemSku:null}setupEventListeners(){document.addEventListener("click",n=>{this.trackInteraction("click",n)}),document.addEventListener("submit",n=>{this.trackInteraction("form_submit",n)});let e;window.addEventListener("scroll",()=>{clearTimeout(e),e=setTimeout(()=>{this.trackScroll()},100)}),document.querySelectorAll('input[type="search"], input[name*="search"]').forEach(n=>{n.addEventListener("input",i=>{i.target.value.length>2&&this.trackInteraction("search",i)})}),this.setupCartTracking(),this.setupItemTracking()}setupCartTracking(){document.addEventListener("click",t=>{if(t.target.classList.contains("add-to-cart-btn")||t.target.closest(".add-to-cart-btn")){const n=t.target.classList.contains("add-to-cart-btn")?t.target:t.target.closest(".add-to-cart-btn"),i=n.dataset.productId||n.dataset.sku;this.trackCartAction("add",i),this.trackInteraction("cart_add",t,{item_sku:i})}}),document.addEventListener("click",t=>{if(t.target.classList.contains("remove-from-cart")||t.target.closest(".remove-from-cart")){const n=t.target.classList.contains("remove-from-cart")?t.target:t.target.closest(".remove-from-cart"),i=n.dataset.productId||n.dataset.sku;this.trackCartAction("remove",i),this.trackInteraction("cart_remove",t,{item_sku:i})}}),document.querySelectorAll('[onclick*="checkout"], .checkout-btn').forEach(t=>{t.addEventListener("click",()=>{this.trackInteraction("checkout_start",null)})})}setupItemTracking(){document.querySelectorAll(".product-card, .product-item, .item-card, .item-item").forEach(t=>{let n=null;new IntersectionObserver(a=>{a.forEach(s=>{if(s.isIntersecting)n=Date.now();else if(n){const l=Date.now()-n,r=t.dataset.productId||t.dataset.sku;r&&l>1e3&&this.trackItemView(r,l),n=null}})},{threshold:.5}).observe(t)}),document.addEventListener("click",t=>{const n=t.target.closest(".product-card, .product-item, .item-card, .item-item");if(n){const i=n.dataset.productId||n.dataset.sku;i&&this.trackInteraction("click",t,{item_sku:i,element_type:"item"})}})}trackInteraction(e,t,n={}){if(!this.isTracking)return;let i={};t&&t.target&&(i={element_type:t.target.tagName.toLowerCase(),element_id:t.target.id,element_text:t.target.textContent?.substring(0,100)||"",element_class:t.target.className});const a={page_url:window.location.href,interaction_type:e,...i,interaction_data:{timestamp:Date.now(),page_x:t?.clientX||0,page_y:t?.clientY||0,...n},item_sku:n.item_sku||this.getItemSku()};this.sendData("track_interaction",a)}trackScroll(){const e=window.pageYOffset||document.documentElement.scrollTop,t=document.documentElement.scrollHeight-window.innerHeight,n=Math.round(e/t*100);n>this.maxScrollDepth&&(this.maxScrollDepth=n,n>=25&&this.maxScrollDepth<25?this.trackInteraction("scroll",null,{scroll_depth:25}):n>=50&&this.maxScrollDepth<50?this.trackInteraction("scroll",null,{scroll_depth:50}):n>=75&&this.maxScrollDepth<75?this.trackInteraction("scroll",null,{scroll_depth:75}):n>=90&&this.maxScrollDepth<90&&this.trackInteraction("scroll",null,{scroll_depth:90}))}trackItemView(e,t){const n={item_sku:e,time_on_page:Math.round(t/1e3)};this.sendData("track_item_view",n)}trackCartAction(e,t){if(!t)return;const n={item_sku:t,action:e};this.sendData("track_cart_action",n)}setupPageExitTracking(){window.addEventListener("beforeunload",()=>{this.trackPageExit()}),document.addEventListener("visibilitychange",()=>{document.hidden?this.trackPageExit():this.pageStartTime=Date.now()})}trackPageExit(){const e=Math.round((Date.now()-this.pageStartTime)/1e3),t={page_url:window.location.href,time_on_page:e,scroll_depth:this.maxScrollDepth,item_sku:this.getItemSku()};this.sendDataSync("track_page_view",t)}startPeriodicTracking(){setInterval(()=>{document.hidden||this.trackPageView()},3e4)}sendData(e,t){this.isTracking&&apiPost(`/api/analytics_tracker.php?action=${e}`,t).catch(n=>{console.warn("Analytics tracking failed:",n)})}sendDataSync(e,t){const n=new FormData;n.append("action",e),n.append("data",JSON.stringify(t)),navigator.sendBeacon?navigator.sendBeacon(`/api/analytics_tracker.php?action=${e}`,n):this.sendData(e,t)}trackConversion(e=0,t=null){const n={conversion_value:e,order_id:t,page_url:window.location.href};this.trackInteraction("checkout_complete",null,n)}trackCustomEvent(e,t={}){this.trackInteraction("custom",null,{event_name:e,...t})}enableTracking(){this.isTracking=!0}disableTracking(){this.isTracking=!1}}document.addEventListener("DOMContentLoaded",function(){localStorage.getItem("analytics_opt_out")!=="true"&&(window.analyticsTracker=new K)});window.trackConversion=function(o,e){window.analyticsTracker&&window.analyticsTracker.trackConversion(o,e)};window.trackCustomEvent=function(o,e){window.analyticsTracker&&window.analyticsTracker.trackCustomEvent(o,e)};window.optOutOfAnalytics=function(){localStorage.setItem("analytics_opt_out","true"),window.analyticsTracker&&window.analyticsTracker.disableTracking()};window.optInToAnalytics=function(){localStorage.removeItem("analytics_opt_out"),window.analyticsTracker?window.analyticsTracker.enableTracking():window.analyticsTracker=new K};console.log("üéØ Loading Simple Room Coordinate System...");function C(o){console.log(`üéØ Initializing simple coordinate system for ${o}...`);const e=document.querySelector(".room-overlay-wrapper");if(!e){console.error("‚ùå Room overlay wrapper not found");return}console.log("‚úÖ Room overlay wrapper found:",e),console.log(`üì° Fetching coordinates from /api/get_room_coordinates.php?room_type=${o}`),fetch(`/api/get_room_coordinates.php?room_type=${o}`).then(t=>(console.log("üì° Response received:",t.status,t.statusText),t.json())).then(t=>{console.log("üì° Data received:",t),t.success&&t.coordinates?(console.log("‚úÖ Coordinates loaded:",t.coordinates),Ee(t.coordinates)):console.error("‚ùå Failed to load coordinates:",t.message)}).catch(t=>{console.error("‚ùå Error loading coordinates:",t)})}function Ee(o){console.log("üéØ Applying simple coordinates...");const e=window.innerWidth;let t;e<=480?t=400/1280:e<=768?t=800/1280:t=1600/1280,console.log(`üìê Screen width: ${e}px, Scale factor: ${t}`),o.forEach((n,i)=>{const a=document.getElementById(`item-icon-${i}`);if(a){const s=Math.round(n.top*t),l=Math.round(n.left*t),r=Math.round(n.width*t),c=Math.round(n.height*t);a.style.position="absolute",a.style.top=`${s}px`,a.style.left=`${l}px`,a.style.width=`${r}px`,a.style.height=`${c}px`,console.log(`‚úÖ Item ${i}: positioned at ${l},${s} (${r}x${c})`)}else console.warn(`‚ö†Ô∏è Item ${i} not found`)})}window.simpleCoordinateSystem=C;document.addEventListener("DOMContentLoaded",function(){console.log("üéØ DOM loaded, checking for room type..."),console.log("üéØ Available window variables:",{ROOM_TYPE:window.ROOM_TYPE,roomType:window.roomType,roomNumber:window.roomNumber}),window.ROOM_TYPE?(console.log(`üéØ Room type found: ${window.ROOM_TYPE}`),C(window.ROOM_TYPE)):window.roomType?(console.log(`üéØ Room type found (fallback): ${window.roomType}`),C(window.roomType)):(console.log("‚ö†Ô∏è No room type found, waiting..."),setTimeout(()=>{console.log("üéØ Retrying after delay..."),console.log("üéØ Available window variables after delay:",{ROOM_TYPE:window.ROOM_TYPE,roomType:window.roomType,roomNumber:window.roomNumber}),window.ROOM_TYPE?(console.log(`üéØ Room type found after delay: ${window.ROOM_TYPE}`),C(window.ROOM_TYPE)):window.roomType?(console.log(`üéØ Room type found after delay (fallback): ${window.roomType}`),C(window.roomType)):console.error("‚ùå Still no room type found")},500))});window.addEventListener("resize",function(){console.log("üéØ Window resized, reapplying coordinates..."),window.ROOM_TYPE?C(window.ROOM_TYPE):window.roomType&&C(window.roomType)});window.roomState={currentItem:null,popupTimeout:null,popupOpen:!1,isShowingPopup:!1,lastShowTime:0,roomNumber:null,roomType:null};window.initializeRoom=function(o,e){window.roomState.roomNumber=o,window.roomState.roomType=e,typeof window.initializeModalEventListeners=="function"&&window.initializeModalEventListeners(),document.addEventListener("click",function(t){const n=document.getElementById("itemPopup");n&&n.classList.contains("show")&&!n.contains(t.target)&&!t.target.closest(".item-icon")&&hidePopupImmediate()}),console.log(`Room ${o} (${e}) initialized with centralized functions`)};window.showPopup=function(o,e){typeof window.showGlobalPopup=="function"?window.showGlobalPopup(o,e):console.error("Global popup system not available")};window.hidePopup=function(){typeof window.hideGlobalPopup=="function"&&window.hideGlobalPopup()};window.hidePopupImmediate=function(){typeof window.hideGlobalPopupImmediate=="function"&&window.hideGlobalPopupImmediate()};window.openQuantityModal=function(o){typeof window.showGlobalItemModal=="function"?(hideGlobalPopup(),window.showGlobalItemModal(o.sku)):Ie(o)};function Ie(o){if(console.log("Using fallback simple modal for:",o.sku),typeof window.addToCartWithModal=="function"){const e=o.sku,t=o.name||o.productName,n=parseFloat(o.retailPrice||o.price),i=o.primaryImageUrl||`images/items/${o.sku}A.png`;window.addToCartWithModal(e,t,n,i);return}console.error("Both detailed modal and fallback systems failed")}window.showItemDetails=function(o){typeof window.showProductDetails=="function"?window.showProductDetails(o):console.error("showProductDetails function not available")};window.setupPopupPersistence=function(){const o=document.getElementById("itemPopup");o&&(o.addEventListener("mouseenter",()=>{clearTimeout(window.roomState.popupTimeout),window.roomState.isShowingPopup=!0,window.roomState.popupOpen=!0}),o.addEventListener("mouseleave",()=>{hidePopup()}))};document.addEventListener("DOMContentLoaded",function(){setupPopupPersistence(),console.log("Room functions initialized and ready")});(function(){const o=document.currentScript;window.roomItems=o.dataset.roomItems?JSON.parse(o.dataset.roomItems):[],window.roomNumber=o.dataset.roomNumber||"",window.roomType=o.dataset.roomType||"",window.ROOM_TYPE=window.roomType,window.originalImageWidth=1280,window.originalImageHeight=896,window.baseAreas=o.dataset.baseAreas?JSON.parse(o.dataset.baseAreas):[],console.log("‚öôÔ∏è room-helper initialized. roomItems:",window.roomItems,"baseAreas:",window.baseAreas),window.roomOverlayWrapper=null;function e(){if(!window.roomOverlayWrapper||!window.baseAreas)return;const n=window.roomOverlayWrapper.offsetWidth,i=window.roomOverlayWrapper.offsetHeight,a=window.originalImageWidth/window.originalImageHeight;let s,l,r=0,c=0;n/i>a?(l=i,s=l*a,r=(n-s)/2):(s=n,l=s/a,c=(i-l)/2);const m=s/window.originalImageWidth,f=l/window.originalImageHeight;window.roomItems.forEach((u,p)=>{const g=document.getElementById("item-icon-"+p),E=window.baseAreas[p];g&&E&&(g.style.top=E.top*f+c+"px",g.style.left=E.left*m+r+"px",g.style.width=E.width*m+"px",g.style.height=E.height*f+"px")})}function t(){const n=document.querySelector(".room-title-overlay");if(!n)return;const i=n.querySelector(".room-title"),a=n.querySelector(".room-description");if(!i)return;const s=i.textContent.length,l=a?a.textContent.length:0,r=s+l,c=window.innerWidth,d=c<=480,m=c<=768;let f,u;d?(f=r<=25?"140px":r<=40?"180px":r<=60?"220px":"240px",u=r<=30?"6px 10px":"8px 12px"):m?(f=r<=30?"160px":r<=50?"210px":r<=70?"250px":"280px",u=r<=30?"8px 12px":"10px 14px"):(f=r<=30?"200px":r<=50?"250px":r<=80?"300px":"400px",u=r<=30?"10px 14px":r<=50?"12px 16px":"14px 18px"),n.style.width=f,n.style.padding=u;let p,g;d?(p=s<=15?"1.6rem":s<=25?"1.3rem":s<=35?"1.1rem":"1rem",g=l<=30?"0.9rem":l<=50?"0.8rem":"0.7rem"):m?(p=s<=15?"2rem":s<=25?"1.7rem":s<=35?"1.4rem":"1.2rem",g=l<=30?"1.1rem":l<=50?"1rem":"0.9rem"):(p=s<=15?"2.5rem":s<=25?"2.2rem":s<=35?"1.9rem":s<=45?"1.6rem":"1.4rem",g=l<=30?"1.3rem":l<=50?"1.2rem":l<=70?"1.1rem":"1rem"),i.style.fontSize=p,i.style.whiteSpace="",i.style.overflow="",i.style.textOverflow="",a&&(a.style.fontSize=g,a.style.whiteSpace="",a.style.overflow="",a.style.textOverflow="")}document.addEventListener("DOMContentLoaded",function(){if(window.roomOverlayWrapper=document.querySelector(".room-modal-content-wrapper"),window.roomOverlayWrapper&&window.baseAreas&&window.baseAreas.length>0){e();let n;window.addEventListener("resize",function(){clearTimeout(n),n=setTimeout(function(){e(),t()},100)})}t()}),document.addEventListener("whimsicalfrog:ready",function(){window.ROOM_TYPE&&typeof initializeRoomCoordinates=="function"&&initializeRoomCoordinates()})})();document.body.addEventListener("click",function(o){const e=o.target.closest('[data-action="openImageViewer"], [data-action="closeDetailedModalOnOverlay"]');if(!e)return;const t=e.dataset.action,n=e.dataset.params?JSON.parse(e.dataset.params):{};t==="openImageViewer"&&typeof openImageViewer=="function"&&openImageViewer(n.src,n.name),t==="closeDetailedModalOnOverlay"&&typeof closeDetailedModalOnOverlay=="function"&&closeDetailedModalOnOverlay(o)});console.log("Loading room-main.js...");class ke{constructor(){this.initialized=!1,this.init()}init(){this.initialized||(console.log("üê∏ Room Main: Initializing..."),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>this.setup()):this.setup(),this.initialized=!0)}setup(){this.setupBackground(),this.setupDoors(),this.setupNavigation(),this.setupBodyStyles(),this.setupModalAutoOpen(),this.setupCleanup(),console.log("üê∏ Room Main: Initialization complete")}setupBackground(){const e=document.getElementById("mainRoomPage");if(e){const t=e.getAttribute("data-bg-url");t&&(e.style.setProperty("--room-bg-url",`url('${t}')`),console.log("üñºÔ∏è Main room background loaded:",t))}}setupDoors(){const e=document.querySelectorAll(".door-area");console.log(`üö™ Found ${e.length} door elements`),e.forEach((t,n)=>{t.style.cursor="pointer",t.style.pointerEvents="auto",t.setAttribute("tabindex","0"),t.setAttribute("role","button"),t.setAttribute("aria-label",`Open ${t.dataset.category||"room"}`),t.addEventListener("keydown",i=>{(i.key==="Enter"||i.key===" ")&&(i.preventDefault(),t.click())})}),console.log("üö™ Door positioning and accessibility configured")}setupNavigation(){const e=document.querySelector("nav.main-nav");e&&(e.classList.add("site-header"),console.log("üß≠ Navigation configured for room overlay"))}setupBodyStyles(){document.body.style.overflow="hidden",console.log("üö™ Body styles configured for fullscreen mode")}setupModalAutoOpen(){const t=new URLSearchParams(window.location.search).get("modal_room");if(t){const n=()=>{window.roomModalManager?(console.log(`üö™ Auto-opening modal for room: ${t}`),window.roomModalManager.show(t)):setTimeout(n,100)};setTimeout(n,500)}}setupCleanup(){window.addEventListener("beforeunload",()=>{document.body.style.overflow=""})}}const Q=new ke;window.roomMainManager=Q;window.WhimsicalFrog&&typeof WhimsicalFrog.ready=="function"&&WhimsicalFrog.ready(o=>{o.addModule("RoomMainManager",Q)});console.log("Room Main Manager loaded and initialized");(function(){let o=null,e=null;function t(){document.getElementById("globalModalContainer")?e=document.getElementById("globalModalContainer"):(e=document.createElement("div"),e.id="globalModalContainer",document.body.appendChild(e))}async function n(d,m=null){console.log("üîß showGlobalItemModal called with SKU:",d,"itemData:",m);try{t(),console.log("üîß Modal container initialized");let f,u;if(m)f=m,u=m.images||[],console.log("üîß Using provided item data:",f);else{console.log("üîß Fetching item data from API for SKU:",d);const v=await apiGet(`/api/get_item_details.php?sku=${d}`);if(console.log("üîß Item details API response status:",v.status,v.statusText),!v.ok)throw new Error(`API request failed: ${v.status} ${v.statusText}`);const M=await v.json();if(console.log("üîß Item details API response data:",M),!M.success)throw new Error(M.message||"Failed to load item details");f=M.item,u=M.images||[],console.log("üîß Item data loaded:",f),console.log("üîß Images loaded:",u.length,"images")}const p=document.getElementById("detailedItemModal");p&&(console.log("üîß Removing existing modal"),p.remove()),console.log("üîß Fetching modal HTML from render API");const g=await apiPost("render_detailed_modal.php",{item:f,images:u});if(!g||typeof g!="string")throw new Error("Modal render API returned invalid HTML");console.log("üîß Modal HTML received, length:",g.length),console.log("üîß Modal HTML preview:",g.substring(0,200)+"..."),e.innerHTML=g,console.log("üîß Modal HTML inserted into container");const E=document.getElementById("detailedItemModal");console.log("üîß Modal element found after insertion:",!!E),o=f,window.currentDetailedItem=f,console.log("üîß Current modal item stored"),c(`js/detailed-item-modal.js?v=${Date.now()}`,"detailed-item-modal-script").then(()=>{console.log("üîß Detailed item modal script loaded."),setTimeout(()=>{if(console.log("üîß Attempting to show modal..."),typeof window.showDetailedModalComponent<"u")console.log("üîß Using showDetailedModalComponent function"),window.showDetailedModalComponent(d,f);else{const v=document.getElementById("detailedItemModal");v&&(v.classList.remove("hidden"),v.style.display="flex")}setTimeout(()=>{typeof window.initializeEnhancedModalContent=="function"&&window.initializeEnhancedModalContent()},100)},50)}).catch(v=>{console.error("üîß Failed to load detailed item modal script:",v)})}catch(f){console.error("üîß Error in showGlobalItemModal:",f),typeof window.showError=="function"?window.showError("Unable to load item details. Please try again."):alert("Unable to load item details. Please try again.")}}function i(){const d=document.getElementById("detailedItemModal");d&&d.remove(),o=null}function a(d){d.target.id==="detailedItemModal"&&i()}function s(){return o}function l(d){typeof window.hidePopupImmediate=="function"&&window.hidePopupImmediate(),n(d.sku,d)}function r(){t(),window.WhimsicalFrog=window.WhimsicalFrog||{},window.WhimsicalFrog.GlobalModal={show:n,close:i,closeOnOverlay:a,getCurrentItem:s,quickAddToCart:l}}function c(d,m){return new Promise((f,u)=>{if(document.getElementById(m)){f();return}const p=document.createElement("script");p.src=d,p.id=m,p.onload=()=>f(),p.onerror=()=>u(new Error(`Script load error for ${d}`)),document.body.appendChild(p)})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",r):r(),window.showItemDetails=n,window.showItemDetailsModal=n,window.showDetailedModal=n,window.closeDetailedModal=i,window.closeDetailedModalOnOverlay=a,window.openQuantityModal=l,console.log("Global Item Modal system loaded")})();(function(){window.currentDetailedItem=window.currentDetailedItem||{};function o(){const l=window.currentDetailedItem;if(!l)return;const r=document.getElementById("detailedMainImage");r&&typeof window.setupImageErrorHandling=="function"&&window.setupImageErrorHandling(r,l.sku),e(),n(l.sku);const c=document.getElementById("additionalInfoToggle");c&&c.addEventListener("click",t)}function e(){const l=document.getElementById("additionalInfoContent"),r=document.getElementById("additionalInfoIcon");l&&l.classList.add("hidden"),r&&r.classList.remove("rotate-180")}function t(){const l=document.getElementById("additionalInfoContent"),r=document.getElementById("additionalInfoIcon");l&&r&&(l.classList.toggle("hidden"),r.classList.toggle("rotate-180"))}async function n(l){const r=document.getElementById("detailedBadgeContainer");if(r){r.innerHTML="";try{const c=await apiGet(`get_badge_scores.php?sku=${l}`);if(c.success&&c.badges){const d=c.badges;["SALE","BESTSELLER","TRENDING","LIMITED_STOCK","PREMIUM"].forEach(f=>{if(d[f]&&d[f].display){const u=d[f],p=i(u.text,u.class);r.appendChild(p)}})}}catch(c){console.error("Error fetching modal badges:",c)}}}function i(l,r){const c=document.createElement("span");return c.className=`inline-block px-2 py-1 rounded-full text-xs font-bold text-white ${r}`,c.textContent=l,c}function a(l,r={}){const c=document.getElementById("detailedItemModal");c&&(window.currentDetailedItem=r,c.classList.remove("hidden"),c.style.display="flex",c.classList.add("z-popup"),c.addEventListener("click",d=>{d.target.dataset.action==="closeDetailedModalOnOverlay"&&s()}),typeof o=="function"&&o())}function s(){const l=document.getElementById("detailedItemModal");l&&(l.classList.add("hidden"),l.style.display="none")}window.initializeEnhancedModalContent=o,window.showDetailedModalComponent=a,window.closeDetailedModalComponent=s})();console.log("Loading simple-room-modal.js...");class Z{constructor(){this.overlay=null,this.isOpen=!1,this.currentRoom=null,this.init()}init(){this.createModalStructure(),this.setupEventListeners(),window.roomModal=this}createModalStructure(){this.overlay=document.createElement("div"),this.overlay.id="roomModalOverlay",this.overlay.className="room-modal-overlay",this.overlay.style.cssText=`
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            display: none;
            justify-content: center;
            align-items: center;
        `;const e=document.createElement("div");e.className="room-modal-content",e.style.cssText=`
            position: relative;
            width: 90vw;
            height: 90vh;
            max-width: 1280px;
            max-height: 896px;
            background: #f0f0f0;
            border-radius: 8px;
            overflow: hidden;
        `;const t=document.createElement("button");t.innerHTML="√ó",t.className="room-modal-close",t.style.cssText=`
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            font-size: 30px;
            color: #333;
            cursor: pointer;
            z-index: 1001;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        `,t.onclick=()=>this.close();const n=document.createElement("div");n.id="roomContent",n.className="room-content-area",n.style.cssText=`
            position: relative;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        `,e.appendChild(t),e.appendChild(n),this.overlay.appendChild(e),document.body.appendChild(this.overlay)}setupEventListeners(){document.addEventListener("click",e=>{const t=e.target.closest("[data-room]");if(t){e.preventDefault();const n=t.dataset.room;this.openRoom(n)}}),this.overlay.addEventListener("click",e=>{e.target===this.overlay&&this.close()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&this.isOpen&&this.close()}),window.addEventListener("resize",()=>{this.isOpen&&this.currentRoom&&setTimeout(()=>{this.loadRoomCoordinates(this.currentRoom)},100)})}async openRoom(e){this.isOpen||(console.log(`Opening room ${e}...`),this.currentRoom=e,this.isOpen=!0,this.overlay.style.display="flex",await this.loadRoomContent(e),await this.loadRoomCoordinates(e))}async loadRoomContent(e){const t=document.getElementById("roomContent");try{const n=`/images/backgrounds/background_room${e}.webp`;t.style.backgroundImage=`url('${n}')`,t.style.backgroundSize="contain",t.style.backgroundPosition="center",t.style.backgroundRepeat="no-repeat",t.dataset.originalWidth="1280",t.dataset.originalHeight="896",t.innerHTML=`
                <div class="room-title" style="position: absolute; top: 20px; left: 20px; color: white; font-size: 24px; font-weight: bold; text-shadow: 2px 2px 4px rgba(0,0,0,0.7); z-index: 10;">
                    Room ${e}
                </div>
                <div id="productIcons" style="position: relative; width: 100%; height: 100%;"></div>
            `,console.log(`Room ${e} content loaded with original dimensions 1280x896`)}catch(n){console.error("Error loading room content:",n),t.innerHTML='<p style="color: red; padding: 20px;">Error loading room content</p>'}}async loadRoomCoordinates(e){try{const n=await(await fetch(`/api/get_room_coordinates.php?room_type=room${e}`)).json();if(n.success&&n.coordinates){const i=document.getElementById("productIcons");i&&(i.innerHTML=""),this.applyCoordinates(n.coordinates),console.log(`Applied ${n.coordinates.length} coordinates for room ${e}`)}else console.warn("No coordinates found for room",e)}catch(t){console.error("Error loading coordinates:",t)}}applyCoordinates(e){const t=document.getElementById("productIcons"),n=document.getElementById("roomContent");if(!t||!n)return;const i=this.calculateScaling(n);console.log("Scaling factors:",i),e.forEach((a,s)=>{const l=document.createElement("div");l.className=`room-product-icon area-${s+1}`;const r=Math.round(a.top*i.scaleY+i.offsetY),c=Math.round(a.left*i.scaleX+i.offsetX),d=Math.round(a.width*i.scaleX),m=Math.round(a.height*i.scaleY);l.style.cssText=`
                position: absolute;
                top: ${r}px;
                left: ${c}px;
                width: ${d}px;
                height: ${m}px;
                background: rgba(135, 172, 58, 0.8);
                border: 2px solid #87ac3a;
                border-radius: 4px;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                font-weight: bold;
                text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
                transition: all 0.3s ease;
                z-index: 5;
            `,l.innerHTML=`<span style="font-size: ${Math.max(10,d/8)}px;">Item ${s+1}</span>`,l.addEventListener("mouseenter",()=>{l.style.background="rgba(135, 172, 58, 1)",l.style.transform="scale(1.05)"}),l.addEventListener("mouseleave",()=>{l.style.background="rgba(135, 172, 58, 0.8)",l.style.transform="scale(1)"}),l.addEventListener("click",()=>{console.log(`Clicked product icon ${s+1} at scaled position ${c},${r} (original: ${a.left},${a.top})`)}),t.appendChild(l),console.log(`Icon ${s+1}: Original(${a.left},${a.top}) -> Scaled(${c},${r})`)})}calculateScaling(e){const t=parseInt(e.dataset.originalWidth)||1280,n=parseInt(e.dataset.originalHeight)||896,i=e.offsetWidth,a=e.offsetHeight,s=i/a,l=t/n;let r,c,d=0,m=0;s>l?(c=a,r=c*l,d=(i-r)/2):(r=i,c=r/l,m=(a-c)/2);const f=r/t,u=c/n;return console.log(`Container: ${i}x${a}, Original: ${t}x${n}`),console.log(`Rendered: ${r}x${c}, Offset: ${d},${m}`),console.log(`Scale: ${f}x${u}`),{scaleX:f,scaleY:u,offsetX:d,offsetY:m,renderedImageWidth:r,renderedImageHeight:c}}close(){if(!this.isOpen)return;console.log("Closing room modal"),this.overlay.style.display="none",this.isOpen=!1,this.currentRoom=null;const e=document.getElementById("roomContent");e&&(e.innerHTML="",e.style.backgroundImage="")}}document.addEventListener("DOMContentLoaded",()=>{new Z,console.log("Simple room modal system initialized")});document.readyState==="loading"||(new Z,console.log("Simple room modal system initialized (immediate)"));console.log("Loading cart system...");const T={items:[],total:0,count:0,initialized:!1},y={addItem:function(o){console.log("Cart: Adding item",o)},removeItem:function(o){console.log("Cart: Removing item",o)},updateItem:function(o,e){console.log("Cart: Updating item",o,e)},clearCart:function(){console.log("Cart: Clearing cart")},getItems:function(){return T.items},getTotal:function(){return T.total},getCount:function(){return T.count},getState:function(){return T},loadCart:function(){console.log("Cart: Loading cart from storage")},updateCartDisplay:function(){console.log("Cart: Updating cart display")},setNotifications:function(o){console.log("Cart: Setting notifications",o)},showCurrentCartStatus:function(){console.log("Cart: Showing current cart status")},showCartStatusToast:function(){console.log("Cart: Showing cart status toast")},renderCart:function(){console.log("Cart: Rendering cart")},checkout:function(){console.log("Cart: Starting checkout")},createPaymentMethodModal:function(){console.log("Cart: Creating payment method modal")},proceedToCheckout:function(){console.log("Cart: Proceeding to checkout")},submitCheckout:function(o,e){console.log("Cart: Submitting checkout",o,e)},loadProfileAddress:function(){console.log("Cart: Loading profile address")},toggleAddressFields:function(){console.log("Cart: Toggling address fields")}};function G(){console.log("[Cart] Initializing cart system..."),y.loadCart(),Me(),y.updateCartDisplay(),T.initialized=!0,console.log("[Cart] Cart system initialized")}function Me(){window.cart={addItem:o=>y.addItem(o),removeItem:o=>y.removeItem(o),updateItem:(o,e)=>y.updateItem(o,e),clearCart:()=>y.clearCart(),getItems:()=>y.getItems(),getTotal:()=>y.getTotal(),getCount:()=>y.getCount(),getState:()=>y.getState()},window.addToCart=o=>y.addItem(o),window.removeFromCart=o=>y.removeItem(o),window.updateCartItem=(o,e)=>y.updateItem(o,e),window.clearCart=()=>y.clearCart(),window.getCartItems=()=>y.getItems(),window.getCartTotal=()=>y.getTotal(),window.getCartCount=()=>y.getCount(),console.log("[Cart] Global functions registered")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",G):G();console.log("Cart system loaded");(function(){if(!window.WhimsicalFrog||typeof window.WhimsicalFrog.registerModule!="function"){console.error("[MainApplication] WhimsicalFrog Core not found.");return}const o={name:"MainApplication",dependencies:[],init(e){this.WF=e,this.ensureSingleNavigation(),this.updateMainCartCounter(),this.setupEventListeners(),this.handleLoginForm(),this.WF.log("Main Application module initialized.")},ensureSingleNavigation(){const e=document.querySelectorAll("nav.main-nav");e.length>1&&(this.WF.log(`Found ${e.length} navigation elements, removing duplicates...`),e.forEach((t,n)=>{n>0&&t.remove()}))},updateMainCartCounter(){const e=document.getElementById("cartCount");window.cart&&e&&(e.textContent=`${window.cart.getCount()} items`)},setupEventListeners(){this.WF.eventBus.on("cartUpdated",()=>this.updateMainCartCounter()),this.WF.ready&&this.WF.ready(()=>this.updateMainCartCounter())},handleLoginForm(){const e=document.getElementById("loginForm");e&&e.addEventListener("submit",async t=>{t.preventDefault();const n=document.getElementById("username").value,i=document.getElementById("password").value,a=document.getElementById("errorMessage");a&&a.classList.add("hidden");try{const s=await this.WF.api.post("/functions/process_login.php",{username:n,password:i});sessionStorage.setItem("user",JSON.stringify(s.user||s)),s.redirectUrl?window.location.href=s.redirectUrl:localStorage.getItem("pendingCheckout")==="true"?(localStorage.removeItem("pendingCheckout"),window.location.href="/?page=cart"):window.location.href=s.role==="Admin"?"/?page=admin":"/?page=room_main"}catch(s){a&&(a.textContent=s.message,a.classList.remove("hidden"))}})},async loadModalBackground(e){if(!e){this.WF.log("[MainApplication] No roomType provided for modal background.","warn");return}try{const t=await this.WF.api.get(`/api/get_background.php?room_type=${e}`);if(t&&t.success&&t.background){const n=t.background;let a=document.documentElement.classList.contains("webp")&&n.webp_filename?n.webp_filename:n.image_filename;a.startsWith("backgrounds/")||(a=`backgrounds/${a}`);const s=`/images/${a}?v=${Date.now()}`,l=document.querySelector(".room-modal-overlay");l?(l.style.setProperty("--dynamic-bg-url",`url('${s}')`),l.style.backgroundImage=`linear-gradient(rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.4)), url('${s}')`,l.style.backgroundSize="cover",l.style.backgroundPosition="center",l.style.backgroundRepeat="no-repeat",this.WF.log(`[MainApplication] Modal overlay background loaded for ${e}: ${s}`)):this.WF.log("[MainApplication] Modal overlay not found when setting background","warn")}else this.WF.log(`[MainApplication] No background data found for ${e}`,"warn")}catch(t){this.WF.log(`[MainApplication] Error loading modal background for ${e}: ${t.message}`,"error")}},resetToPageBackground(){const e=document.querySelector(".room-modal-overlay");e&&(e.style.removeProperty("--dynamic-bg-url"),e.style.removeProperty("background-image"),this.WF.log("[MainApplication] Modal overlay background reset."))}};window.WhimsicalFrog.registerModule(o.name,o)})();function ee(o,e=null){const t=o.dataset.errorHandled||"none",n=o.src;if(t!=="final"){if(e){if(n.includes(`${e}A.webp`)){o.src=`images/items/${e}A.png`,o.dataset.errorHandled="png-tried";return}if(n.includes(`${e}A.png`)){B(o);return}}B(o)}}function te(o){o.dataset.errorHandled||B(o)}function Ce(o,e=null){o.onerror=()=>{e?ee(o,e):te(o)}}function B(o){o.src="images/items/placeholder.webp",o.dataset.errorHandled="final",o.onerror=null}console.log("[ImageErrorHandler] ES module loaded");class L{static async request(e,t={}){const n={headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},credentials:"same-origin"},i={...n,...t,headers:{...n.headers,...t.headers||{}}},a=await fetch(e,i);if(!a.ok)throw new Error(`HTTP ${a.status}: ${a.statusText}`);const s=await a.json();if(s&&s.success===!1)throw new Error(s.error||"API request failed");return s}static get(e,t={}){!e.startsWith("http")&&!e.startsWith("/api/")&&(e=e.startsWith("/")?`/api${e}`:`/api/${e}`);const n=new URL(e,window.location.origin);return Object.keys(t).forEach(i=>{t[i]!==null&&t[i]!==void 0&&n.searchParams.append(i,t[i])}),this.request(n.toString(),{method:"GET"})}static post(e,t={},n={}){return this.request(e,{method:"POST",body:JSON.stringify(t),...n})}static put(e,t={},n={}){return this.request(e,{method:"PUT",body:JSON.stringify(t),...n})}static delete(e,t={}){return this.request(e,{method:"DELETE",...t})}static upload(e,t,n={}){return this.request(e,{method:"POST",body:t,headers:{},...n})}}const k=(o,e)=>L.get(o,e),oe=(o,e,t)=>L.post(o,e,t),ne=(o,e,t)=>L.put(o,e,t),ie=(o,e)=>L.delete(o,e),Le=(o,e,t)=>L.upload(o,e,t);if(window?.location?.hostname==="localhost"||window?.location?.hostname.includes("dev")){const o=window.fetch;window.fetch=function(...e){return typeof e[0]=="string"&&e[0].includes("/api/")&&(console.warn("‚ö†Ô∏è  Consider using ApiClient instead of direct fetch for API calls:",e[0]),console.warn(`Example: apiGet("${e[0]}") or apiPost("${e[0]}", data)`)),o.apply(this,e)}}let xe=class{static setContent(e,t,n=!1){e&&(n?(e.innerHTML='<div class="wf-loading">Loading...</div>',requestAnimationFrame(()=>{e.innerHTML=t})):e.innerHTML=t)}static showToast(e,t="info",n=3e3){const i=document.createElement("div");i.className=`wf-toast wf-toast-${t}`,i.textContent=e,document.body.appendChild(i),setTimeout(()=>i.remove(),n)}};const Se={apiGet:k,apiPost:oe,apiPut:ne,apiDelete:ie,uploadFile:Le,DOMUtils:xe};typeof window<"u"&&(window.Utils=Se);const ae={openEditModal:(o,e)=>window.openEditModal?.(e.type,e.id),openDeleteModal:(o,e)=>window.openDeleteModal?.(e.type,e.id,e.name),performAction:(o,e)=>window.performAction?.(e.action),runCommand:(o,e)=>window.runCommand?.(e.command),loadRoomConfig:()=>window.loadRoomConfig?.(),resetForm:()=>window.resetForm?.()};function Te(){if(document.body.dataset.wfCentralListenersAttached)return;document.body.dataset.wfCentralListenersAttached="true";const o=t=>{try{return t.dataset.params?JSON.parse(t.dataset.params):{}}catch{return{}}},e=(t,n,i)=>{document.body.addEventListener(t,a=>{const s=a.target.closest(`[${n}]`);if(!s)return;t==="click"&&a.preventDefault();const l=o(s),r=ae[s.dataset[i]];r?.(s,l,a)})};e("click","data-action","action"),e("change","data-change-action","changeAction"),e("focusin","data-focus-action","focusAction"),e("focusout","data-blur-action","blurAction"),e("mouseover","data-mouseover-action","mouseoverAction"),e("mouseout","data-mouseout-action","mouseoutAction")}document.addEventListener("DOMContentLoaded",Te);typeof window<"u"&&(window.centralFunctions=ae);class I{static setContent(e,t,n=!1){e&&(n?(e.innerHTML='<div class="text-center text-gray-500 py-4">Loading...</div>',setTimeout(()=>{e.innerHTML=t},100)):e.innerHTML=t)}static createLoadingSpinner(e="Loading..."){return`
            <div class="flex items-center justify-center py-4">
                <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500 mr-3"></div>
                <span class="text-gray-600">${e}</span>
            </div>
        `}static createErrorMessage(e){return`
            <div class="bg-red-50 border border-red-200 rounded-lg p-4 text-red-700">
                <div class="flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
                    </svg>
                    ${e}
                </div>
            </div>
        `}static createSuccessMessage(e){return`
            <div class="bg-green-50 border border-green-200 rounded-lg p-4 text-green-700">
                <div class="flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                    </svg>
                    ${e}
                </div>
            </div>
        `}static showToast(e,t="info",n=3e3){const i="toast-"+Date.now(),a={success:"bg-green-500",error:"bg-red-500",info:"bg-blue-500"},s=document.createElement("div");s.id=i,s.className=`fixed top-4 right-4 ${a[t]} text-white px-6 py-3 rounded-lg shadow-lg z-50 transform transition-transform duration-300 translate-x-full`,s.textContent=e,document.body.appendChild(s),setTimeout(()=>{s.classList.remove("translate-x-full")},100),setTimeout(()=>{s.classList.add("translate-x-full"),setTimeout(()=>{document.getElementById(i)?.remove()},300)},n)}static debounce(e,t){let n;return function(...a){clearTimeout(n),n=setTimeout(()=>e(...a),t)}}static formatCurrency(e){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e)}static escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}static async confirm(e,t="Confirm"){return new Promise(n=>{const i=document.createElement("div");i.className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",i.innerHTML=`
                <div class="bg-white rounded-lg p-6 max-w-md mx-4">
                    <h3 class="text-lg font-semibold mb-4">${I.escapeHtml(t)}</h3>
                    <p class="text-gray-600 mb-6">${I.escapeHtml(e)}</p>
                    <div class="flex justify-end space-x-3">
                        <button class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded" data-action="cancel">Cancel</button>
                        <button class="px-4 py-2 bg-red-500 text-white hover:bg-red-600 rounded" data-action="confirm">Confirm</button>
                    </div>
                </div>
            `,document.body.appendChild(i),i.addEventListener("click",a=>{a.target.dataset.action==="confirm"?(i.remove(),n(!0)):(a.target.dataset.action==="cancel"||a.target===i)&&(i.remove(),n(!1))})})}}typeof window<"u"&&(window.DOMUtils=I,window.debounce=I.debounce,window.formatCurrency=I.formatCurrency,window.escapeHtml=I.escapeHtml,window.showToast=I.showToast,window.confirmDialog=I.confirm);async function Pe(){try{const o=await k("/api/get_room_data.php");if(o.success){const e={room_main:"room_main",shop:"room_main",cart:"room_main",login:"room_main",admin:"room_main"};return o.data.roomDoors.forEach(t=>{const n=`room${t.room_number}`;e[n]=n}),e}}catch(o){console.warn("[DynamicBackground] Failed to generate page-room map:",o)}return{room_main:"room_main",shop:"room_main",cart:"room_main",login:"room_main",admin:"room_main"}}async function R(){try{const e=new URLSearchParams(window.location.search).get("page")||"landing",n=(await Pe())[e]||"landing",i=await k(`/api/get_background.php?room_type=${n}`);if(!i.success||!i.background)return;const{image_filename:a,webp_filename:s}=i.background,r=document.documentElement.classList.contains("webp")&&s?s:a;let c=`images/backgrounds/${r}`;!c.includes("/backgrounds/")&&!r.startsWith("backgrounds/")&&(c=`images/${r}`);let d=document.querySelector(".fullscreen-container")||document.getElementById("mainContent");d||(d=document.body),d.style.setProperty("--dynamic-bg-url",`url('${c}')`),d.classList.add("bg-container","mode-fullscreen","dynamic-bg-loaded"),document.body.classList.add("dynamic-bg-active")}catch(o){console.error("[DynamicBackground] Error loading background:",o)}}document.readyState!=="loading"?R():document.addEventListener("DOMContentLoaded",R);class se{constructor(){this._target=document.createElement("span")}on(e,t){this._target.addEventListener(e,t)}off(e,t){this._target.removeEventListener(e,t)}emit(e,t=null){this._target.dispatchEvent(new CustomEvent(e,{detail:t}))}}const re=new se;typeof window<"u"&&(window.EventBus=se,window.eventBus=re);class $e{constructor(){this.overlay=null,this.content=null,this.isLoading=!1,this.currentRoomNumber=null,this.roomCache=new Map}init(){this.createModalStructure(),this.setupEventListeners(),this.preloadRoomContent(),console.log("[RoomModalManager] initialised")}createModalStructure(){if(document.getElementById("roomModalOverlay")){this.overlay=document.getElementById("roomModalOverlay"),this.content=this.overlay.querySelector(".room-modal-container");return}this.overlay=document.createElement("div"),this.overlay.id="roomModalOverlay",this.overlay.className="room-modal-overlay",this.content=document.createElement("div"),this.content.className="room-modal-container";const e=document.createElement("div");e.className="room-modal-header";const t=document.createElement("div");t.className="back-button-container";const n=document.createElement("button");n.className="room-modal-button",n.textContent="‚Üê Back",n.onclick=()=>this.hide(),t.appendChild(n);const i=document.createElement("div");i.className="room-title-overlay",i.id="roomTitleOverlay";const a=document.createElement("h1");a.id="roomTitle",a.textContent="Loading‚Ä¶";const s=document.createElement("div");s.className="room-description",s.id="roomDescription",i.append(a,s),e.append(t,i);const l=document.createElement("div");l.id="roomModalLoading",l.className="room-modal-loading",l.innerHTML='<div class="room-modal-spinner"></div><p class="room-modal-loading-text">Loading room‚Ä¶</p>';const r=document.createElement("iframe");r.id="roomModalFrame",r.className="room-modal-frame",r.setAttribute("sandbox","allow-scripts allow-same-origin"),this.content.append(e,l,r),this.overlay.appendChild(this.content),document.body.appendChild(this.overlay)}setupEventListeners(){document.body.addEventListener("click",e=>{const t=e.target.closest("[data-room]");t&&(e.preventDefault(),this.show(t.dataset.room))}),this.overlay.addEventListener("click",e=>{e.target===this.overlay&&this.hide()})}show(e){this.isLoading||(this.currentRoomNumber=e,this.isLoading=!0,this.overlay.style.display="flex",document.body.classList.add("modal-open","room-modal-open"),this.loadRoom(e),setTimeout(()=>{this.overlay.classList.add("show"),this.isLoading=!1},10))}hide(){this.overlay.classList.remove("show"),document.body.classList.remove("modal-open","room-modal-open"),setTimeout(()=>{const e=document.getElementById("roomModalFrame");e&&(e.src="about:blank"),this.overlay.style.display="none",this.currentRoomNumber=null},250)}async loadRoom(e){const t=document.getElementById("roomModalLoading"),n=document.getElementById("roomModalFrame"),i=document.getElementById("roomTitle"),a=document.getElementById("roomDescription");t.style.display="flex",n.style.opacity="0",n.src="about:blank";try{const s=await this.getRoomData(e);if(!s)throw new Error("Missing room data");i.textContent=s.metadata.room_name||"Room",a.textContent=s.metadata.room_description||"",n.srcdoc=s.content}catch(s){console.error(`[RoomModalManager] error loading room ${e}:`,s),i.textContent="Error",a.textContent="Could not load content.",t.style.display="none";return}n.onload=()=>{t.style.display="none",n.style.opacity="1",re.emit("roomModalLoaded",{roomNumber:e})}}async getRoomData(e){return this.roomCache.has(e)?this.roomCache.get(e):this.preloadSingleRoom(e)}async preloadRoomContent(){try{const e=await k("/api/get_room_data.php");if(!e.success||!Array.isArray(e.data.productRooms))return;const t=e.data.productRooms.map(n=>this.preloadSingleRoom(n.room_number??n));await Promise.all(t)}catch(e){console.warn("[RoomModalManager] preload failed:",e)}}async preloadSingleRoom(e){if(this.roomCache.has(e))return this.roomCache.get(e);try{const t=await k(`/api/load_room_content.php?room_number=${e}&modal=1`);if(t.success)return this.roomCache.set(e,t),t}catch(t){console.warn(`[RoomModalManager] failed to preload room ${e}:`,t)}return null}}function _e(){const o=new $e;document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>o.init()):o.init(),window.roomModalManager=o,window.WhimsicalFrog&&typeof window.WhimsicalFrog.addModule=="function"&&window.WhimsicalFrog.ready(e=>e.addModule("RoomModalManager",o))}_e();function F(o){if(o.dataset.product)try{return JSON.parse(o.dataset.product)}catch(t){console.warn("[eventManager] invalid JSON in data-product",t)}if(o.dataset.sku)return{sku:o.dataset.sku,name:o.dataset.name||"",price:parseFloat(o.dataset.price||o.dataset.cost||"0"),description:o.dataset.description||"",stock:parseInt(o.dataset.stock||"0",10),category:o.dataset.category||""};const e=o.getAttribute("onmouseenter");if(e){const t=e.match(/showGlobalPopup\(this,\s*(.+)\)/);if(t)try{const n=t[1].replace(/&quot;/g,'"').replace(/&#039;/g,"'");return JSON.parse(n)}catch(n){console.warn("[eventManager] Failed to parse inline JSON",n)}}return null}function le(){document.body.hasAttribute("data-wf-room-delegated-listeners")||(document.body.setAttribute("data-wf-room-delegated-listeners","true"),document.addEventListener("mouseover",o=>{const e=o.target;if(!e||typeof e.closest!="function")return;console.log("[eventManager] mouseover event detected on:",e);const t=e.closest(".item-icon, .room-product-icon");if(!t){console.log("[eventManager] no matching icon found for hover");return}console.log("[eventManager] found icon element:",t,"classes:",t.className);const n=F(t);console.log("[eventManager] extracted product data:",n);const i=window.showGlobalPopup||parent&&parent.showGlobalPopup;console.log("[eventManager] popup function available:",typeof i),typeof i=="function"&&n?window.__wfCurrentPopupAnchor!==t&&(window.__wfCurrentPopupAnchor=t,console.log("[eventManager] calling popup function with:",t,n),i(t,n),Ae(t)):console.warn("[eventManager] cannot show popup - function:",typeof i,"data:",!!n)}),document.addEventListener("click",o=>{const e=o.target;if(!e||typeof e.closest!="function")return;const t=e.closest(".item-icon, .room-product-icon");if(!t)return;o.preventDefault();const n=F(t),i=parent&&parent.showGlobalItemModal||window.showGlobalItemModal||window.showItemDetailsModal||window.showItemDetails||parent&&(parent.showItemDetailsModal||parent.showItemDetails);typeof i=="function"&&n&&i(n.sku,n)}))}function ce(){console.log("[eventManager] setupPopupEventsAfterPositioning() called");const o=document.querySelectorAll(".item-icon, .room-product-icon");console.log("[eventManager] icons found for direct listeners:",o.length),o.forEach(e=>{e.classList.add("clickable-icon");const t=F(e);t&&(e.addEventListener("mouseenter",()=>{const n=window.showGlobalPopup||parent&&parent.showGlobalPopup;typeof n=="function"&&n(e,t)}),e.addEventListener("mouseleave",()=>{const n=window.hideGlobalPopup||parent&&parent.hideGlobalPopup;typeof n=="function"&&n()}),e.addEventListener("click",n=>{n.preventDefault();const i=parent&&parent.showGlobalItemModal||window.showGlobalItemModal||window.showItemDetailsModal||window.showItemDetails||parent&&(parent.showItemDetailsModal||parent.showItemDetails);typeof i=="function"&&i(t.sku,t)}))})}function Ae(o){const e=document.querySelector(".item-popup");if(!e||e.__wfBound)return;e.__wfBound=!0;let t=null;const n=()=>{t&&(clearTimeout(t),t=null)},i=()=>{n(),t=setTimeout(()=>{if(o.matches(":hover")||e.matches(":hover"))return;const s=window.hideGlobalPopup||parent&&parent.hideGlobalPopup;typeof s=="function"&&s(),a()},150)},a=()=>{o.removeEventListener("mouseenter",n),o.removeEventListener("mouseleave",i),e.removeEventListener("mouseenter",n),e.removeEventListener("mouseleave",i),e.__wfBound=!1};o.addEventListener("mouseenter",n),o.addEventListener("mouseleave",i),e.addEventListener("mouseenter",n),e.addEventListener("mouseleave",i)}le();setTimeout(()=>{try{ce()}catch(o){console.warn("[eventManager] setupPopupEventsAfterPositioning failed",o)}},800);window.attachDelegatedItemEvents=le;window.setupPopupEventsAfterPositioning=ce;const de="whimsical_frog_cart",w={items:[],total:0,count:0,notifications:!0};function x(){try{const o={items:w.items,total:w.total,count:w.count,t:Date.now()};localStorage.setItem(de,JSON.stringify(o))}catch(o){console.error("[Cart] Failed to save cart:",o)}}function S(){w.total=w.items.reduce((o,e)=>o+e.price*e.quantity,0),w.count=w.items.reduce((o,e)=>o+e.quantity,0)}function U(o,e,t="",n=5e3){const i=window.wfNotifications||{},a=typeof i[o]=="function"?i[o]:window[`show${o.charAt(0).toUpperCase()+o.slice(1)}`];typeof a=="function"&&a(e,{title:t,duration:n})}const H={load(){try{const o=JSON.parse(localStorage.getItem(de)||"{}");Array.isArray(o.items)?w.items=o.items:w.items=[],S()}catch{w.items=[]}},save:x,add(o,e=1){const t=w.items.find(n=>n.sku===o.sku);t?t.quantity+=e:w.items.push({...o,quantity:e}),S(),x(),U("success",`Added ${o.name||o.sku} (x${e})`,"‚úÖ Added to Cart")},remove(o){const e=w.items.findIndex(t=>t.sku===o);if(e!==-1){const[t]=w.items.splice(e,1);S(),x(),U("info",`${t.name||o} removed`,"Cart")}},updateQuantity(o,e){if(e<=0)return this.remove(o);const t=w.items.find(n=>n.sku===o);t&&(t.quantity=e,S(),x())},clear(){w.items=[],S(),x()},getItems:()=>[...w.items],getTotal:()=>w.total,getCount:()=>w.count,getState:()=>({...w})};H.load();De();function De(){window.cart||(window.cart=H)}async function q(o){try{const t=await(await k(`sales.php?action=get_active_sales&item_sku=${o}`)).json();if(t.success&&t.sale)return{isOnSale:!0,discountPercentage:parseFloat(t.sale.discount_percentage)}}catch(e){console.warn("[SalesChecker] error checking sale",o,e)}return{isOnSale:!1}}const ue=(o,e)=>o*(1-e/100);async function Oe(o,e,t=null){if(!o||!e)return;const n=await q(o.sku),i=parseFloat(o.retailPrice||o.price);if(n.isOnSale&&n.discountPercentage>0){const a=ue(i,n.discountPercentage),s=`<span class="u-text-decoration-line-through u-color-999 u-font-size-0-9em">$${i.toFixed(2)}</span>
      <span class="u-color-dc2626 u-font-weight-bold u-margin-left-5px">$${a.toFixed(2)}</span>
      <span class="u-color-dc2626 u-font-size-0-8em u-margin-left-5px">(${Math.round(n.discountPercentage)}% off)</span>`;e.innerHTML=s,t&&(t.innerHTML=s),Object.assign(o,{salePrice:a,originalPrice:i,isOnSale:!0,discountPercentage:n.discountPercentage})}else e.textContent=`$${i.toFixed(2)}`,t&&(t.textContent=`$${i.toFixed(2)}`),o.isOnSale=!1}let P=null;async function Be(){if(P)return P;try{const e=await(await fetch("/api/badge_content_manager.php?action=get_all&badge_type=sale")).json();if(e.success&&e.badges&&e.badges.length>0){const t=e.badges.filter(n=>n.active).sort((n,i)=>i.weight-n.weight);if(t.length>0)return P=t[0].content,P}}catch(o){console.warn("Failed to fetch dynamic sale badge text:",o)}return"SALE"}async function me(o,e){if(!o)return;const t=parseFloat(e);if(isNaN(t)||t<=0)return;const n=o.querySelector(".sale-badge");n&&n.remove();const i=await Be(),a=document.createElement("div");a.className="sale-badge",a.innerHTML=`<span class="sale-text">${i}</span><span class="sale-percentage">${Math.round(t)}% OFF</span>`,o.appendChild(a)}window.location.search.includes("page=shop")&&document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("[data-sku]").forEach(async o=>{const e=o.getAttribute("data-sku"),t=await q(e);t.isOnSale&&await me(o,t.discountPercentage)})});Object.assign(window,{checkItemSale:q,calculateSalePrice:ue,checkAndDisplaySalePrice:Oe,addSaleBadgeToCard:me});class pe{constructor(){this.modal=null,this.searchInput=null,this.isSearching=!1,this.currentSearchTerm="",this.currentResults=[],this.init()}init(){this.createModalHTML(),this.modal=document.getElementById("searchModal"),this.searchInput=document.getElementById("headerSearchInput"),this.bindEvents()}createModalHTML(){if(document.getElementById("searchModal"))return;document.body.insertAdjacentHTML("beforeend",`<div id="searchModal" class="wf-search-modal hidden">
        <div class="search-modal-content">
          <div class="search-modal-header">
            <h2 class="search-modal-title">Search Results</h2>
            <button class="search-modal-close" type="button">&times;</button>
          </div>
          <div class="search-modal-body" id="searchModalBody"></div>
        </div>
      </div>`)}bindEvents(){this.modal.querySelector(".search-modal-close").addEventListener("click",()=>this.close()),this.searchInput&&(this.searchInput.addEventListener("keypress",n=>{if(n.key==="Enter"){const i=this.searchInput.value.trim();i&&this.performSearch(i)}}),this.searchInput.parentElement?.querySelector("svg")?.addEventListener("click",()=>{const n=this.searchInput.value.trim();n&&this.performSearch(n)})),this.modal.addEventListener("click",t=>{t.target===this.modal&&this.close()}),document.addEventListener("keydown",t=>{t.key==="Escape"&&this.isOpen()&&this.close()})}async performSearch(e){if(!this.isSearching){this.isSearching=!0,this.currentSearchTerm=e,this.showLoading(),this.open();try{const n=await(await k(`search_items.php?q=${encodeURIComponent(e)}`)).json();n.success?this.displayResults(n):this.displayError(n.message||"Search failed")}catch(t){console.error("[Search] error",t),this.displayError("Error searching, please try again.")}finally{this.isSearching=!1}}}showLoading(){const e=document.getElementById("searchModalBody");e.innerHTML=`<div class="search-loading"><div class="spinner"></div><p>Searching for "${this.currentSearchTerm}"...</p></div>`}displayResults(e){this.currentResults=e.results||[];const t=document.getElementById("searchModalBody");if(!e.results.length){t.innerHTML=`<div class="search-no-results"><div class="search-no-results-icon">üîç</div><h3>No results found</h3><p>We couldn't find anything for "${e.search_term}"</p></div>`;return}let n=`<div class="search-results-header">Found <strong>${e.count}</strong> result${e.count!==1?"s":""} for "${e.search_term}"</div><div class="search-results-grid">`;e.results.forEach(i=>{const a=i.in_stock?"in-stock":"out-of-stock",s=i.in_stock?"":"disabled";n+=`<div class="search-result-item"><div class="search-result-clickable" data-sku="${i.sku}"><img src="${i.image_url}" alt="${i.name}" class="search-result-image" onerror="this.src='/images/items/placeholder.webp'"/><div class="search-result-content"><h3>${i.name}</h3><p class="${a}">${i.stock_status}</p><span>${i.formatted_price}</span></div></div><div class="search-result-actions"><button class="search-add-to-cart-btn" data-sku="${i.sku}" ${s}>${i.in_stock?"Add to Cart":"Out of Stock"}</button></div></div>`}),n+="</div>",t.innerHTML=n,t.querySelectorAll(".search-result-clickable").forEach(i=>i.addEventListener("click",()=>this.viewItemDetails(i.dataset.sku))),t.querySelectorAll(".search-add-to-cart-btn").forEach(i=>i.addEventListener("click",a=>this.addToCart(i.dataset.sku,a)))}displayError(e){const t=document.getElementById("searchModalBody");t.innerHTML=`<div class="search-error"><p>${e}</p></div>`}addToCart(e,t){t.stopPropagation();const n=this.currentResults.find(i=>i.sku===e);n&&H.add({sku:n.sku,name:n.name,price:parseFloat(n.price),image:n.image_url},1)}viewItemDetails(e){this.close(),new URLSearchParams(window.location.search).get("page")==="shop"&&typeof window.showItemDetails=="function"?window.showItemDetails(e):window.showGlobalItemModal?.(e)}open(){this.modal.classList.remove("hidden"),document.body.classList.add("modal-open")}close(){this.modal.classList.add("hidden"),document.body.classList.remove("modal-open")}isOpen(){return!this.modal.classList.contains("hidden")}}document.getElementById("headerSearchInput")&&(window.searchModal=new pe);window.SearchModal=pe;let Re=class{constructor(){this.popupEl=null,this.init()}init(){if(this.popupEl)return;const e=document.createElement("style");if(e.innerHTML=`
      .item-popup{pointer-events:auto !important;}
      /* Force correct coordinates and appearance even if legacy bundle overrides */
      .item-popup.positioned{left:auto !important;top:auto !important;}
      /* Neutral background without translucent shade */
      .item-popup{background:transparent !important; box-shadow:none !important;}
    `,document.head.appendChild(e),!this.popupEl){if(document.querySelectorAll(".item-popup").forEach(t=>{t.id!=="itemPopup"&&t.remove()}),this.popupEl=document.getElementById("itemPopup"),!this.popupEl){document.addEventListener("DOMContentLoaded",()=>{this.popupEl=document.getElementById("itemPopup"),this.popupEl&&this.bindPopupInteractions()});return}this.bindPopupInteractions()}}bindPopupInteractions(){!this.popupEl||this.popupEl.dataset.interactionsBound||(this.popupEl.dataset.interactionsBound="1",this.popupEl.addEventListener("click",()=>{typeof window.showGlobalItemModal=="function"&&this.currentItem&&window.showGlobalItemModal(this.currentItem.sku,this.currentItem)}))}show(e,t){if(this.popupEl&&this.popupEl.classList.contains("visible")&&e===this._lastAnchor)return;if(this._lastAnchor=e,console.log("[globalPopup] show called with:",e,t),this.init(),!this.popupEl){console.warn("[globalPopup] popup element not yet available");return}if(!e||!t){console.warn("[globalPopup] missing anchor or item data:",{anchorEl:!!e,item:!!t});return}this.currentItem=t;const n=(u,p)=>{const g=this.popupEl.querySelector(u);g&&(g.textContent=p??"")};n("#popupTitle",t.name||t.productName||t.sku),n("#popupCategory",t.category||""),n("#popupSku",t.sku?`SKU: ${t.sku}`:""),n("#popupDescription",t.description||"");const i=this.popupEl.querySelector("#popupStockBadge"),a=this.popupEl.querySelector("#popupStock");if("stock"in t&&a){const u=Number(t.stock??t.stockLevel??0);a.textContent=u>0?`${u} in stock`:"Out of stock",i&&i.classList.toggle("hidden",u>3)}const s=this.popupEl.querySelector("#popupCurrentPrice"),l=this.popupEl.querySelector("#popupOriginalPrice"),r=this.popupEl.querySelector("#popupSavings");if(s&&(s.textContent=`$${(t.price??t.currentPrice??0).toFixed(2)}`),l&&r){const u=Number(t.originalPrice??t.retailPrice??t.price??0),p=Number(t.price??t.currentPrice??u),g=u>p;l.textContent=`$${u.toFixed(2)}`,r.textContent=`Save $${(u-p).toFixed(2)}`,l.classList.toggle("hidden",!g),r.classList.toggle("hidden",!g);const E=this.popupEl.querySelector("#popupSaleBadge");E&&E.classList.toggle("hidden",!g)}const c=this.popupEl.querySelector("#popupImage");c&&t.image&&(c.src=t.image);const d=e.getBoundingClientRect();let m=d.bottom+6+window.scrollY,f=d.left+window.scrollX;if(e.ownerDocument!==document)try{const u=e.ownerDocument.defaultView.frameElement;if(u){const p=u.getBoundingClientRect();m=p.top+d.bottom+6,f=p.left+d.left,console.log("[globalPopup] adjusted for iframe:",{top:m,left:f})}}catch(u){console.warn("[globalPopup] failed iframe adjustment",u)}this.popupEl.style.top=`${m}px`,this.popupEl.style.left=`${f}px`,this.popupEl.classList.remove("hidden"),this.popupEl.classList.add("measuring"),requestAnimationFrame(()=>{const u=this.popupEl.getBoundingClientRect();let p=u.left,g=u.top;u.right>window.innerWidth&&(p=window.innerWidth-u.width-8),p<0&&(p=8),u.bottom>window.innerHeight&&(g=window.innerHeight-u.height-8),g<0&&(g=8),this.popupEl.style.left=`${p}px`,this.popupEl.style.top=`${g}px`,this.popupEl.classList.remove("measuring"),this.popupEl.classList.add("visible")}),console.log("[globalPopup] positioned popup at:",{top:this.popupEl.style.top,left:this.popupEl.style.left}),document.querySelectorAll(".item-popup.visible").forEach(u=>{u!==this.popupEl&&u.classList.add("hidden")}),this.currentItem=t,this.popupEl.dataset.detailBound||(this.popupEl.dataset.detailBound="1",this.popupEl.addEventListener("click",()=>{typeof window.showGlobalItemModal=="function"&&this.currentItem&&window.showGlobalItemModal(this.currentItem.sku,this.currentItem)})),this.popupEl.classList.remove("hidden"),this.popupEl.classList.add("visible"),console.log("[globalPopup] popup shown")}hide(){console.log("[globalPopup] hide called"),this.popupEl?(this.popupEl.classList.remove("visible"),this.popupEl.classList.add("hidden"),console.log("[globalPopup] popup hidden")):console.warn("[globalPopup] no popup element to hide")}};const fe=new Re;window.showGlobalPopup=(o,e)=>fe.show(o,e);(function(){document.querySelectorAll(".item-popup").forEach(t=>{t.id!=="itemPopup"&&t.remove()})})();window.hideGlobalPopup=()=>fe.hide();function ge(){document.querySelectorAll("iframe").forEach(o=>{try{const e=o.contentWindow;e&&e.location&&e.location.origin===window.location.origin&&(e.showGlobalPopup=window.showGlobalPopup,e.hideGlobalPopup=window.hideGlobalPopup)}catch{}})}ge();window.addEventListener("load",ge);window.handleImageError=ee;window.handleImageErrorSimple=te;window.setupImageErrorHandling=Ce;window.ApiClient=L;window.apiGet=k;window.apiPost=oe;window.apiPut=ne;window.apiDelete=ie;window.DOMUtils=I;window.loadDynamicBackground=R;console.log("[WF] ES-module bootstrap loaded")});export default Fe();
