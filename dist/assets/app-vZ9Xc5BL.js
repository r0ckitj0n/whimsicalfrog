const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/admin-reports-QEqgp-N2.js","assets/auto-C8LTT2Eg.js","assets/admin-marketing-DOemP6rh.js"])))=>i.map(i=>d[i]);
const te="modulepreload",oe=function(n){return"/"+n},j={},L=function(e,t,o){let i=Promise.resolve();if(t&&t.length>0){let r=function(l){return Promise.all(l.map(c=>Promise.resolve(c).then(p=>({status:"fulfilled",value:p}),p=>({status:"rejected",reason:p}))))};var a=r;document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),u=d?.nonce||d?.getAttribute("nonce");i=r(t.map(l=>{if(l=oe(l),l in j)return;j[l]=!0;const c=l.endsWith(".css"),p=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${p}`))return;const m=document.createElement("link");if(m.rel=c?"stylesheet":te,c||(m.as="script"),m.crossOrigin="",m.href=l,u&&m.setAttribute("nonce",u),document.head.appendChild(m),c)return new Promise((f,g)=>{m.addEventListener("load",f),m.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${l}`)))})}))}function s(d){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=d,window.dispatchEvent(u),!u.defaultPrevented)throw d}return i.then(d=>{for(const u of d||[])u.status==="rejected"&&s(u.reason);return e().catch(s)})};(function(){if(window.__WF_RELOAD_TRACER__)return;window.__WF_RELOAD_TRACER__=!0;function e(t){try{const o=new Error(t);console.group(`%c🔍 ${t}`,"color: red; font-weight: bold;"),console.log(o.stack),console.groupEnd()}catch(o){console.warn("ReloadTracer unable to capture stack:",o)}}if(Location&&Location.prototype&&Location.prototype.reload){const t=Location.prototype.reload;Location.prototype.reload=function(...o){return e("window.location.reload intercepted"),t.apply(this,o)}}["assign","replace"].forEach(t=>{if(Location&&Location.prototype&&typeof Location.prototype[t]=="function"){const o=Location.prototype[t];Location.prototype[t]=function(...i){return e(`window.location.${t} intercepted: ${i[0]}`),o.apply(this,i)}}});try{const t=Object.getOwnPropertyDescriptor(Location.prototype,"href");t&&t.set&&Object.defineProperty(Location.prototype,"href",{get:t.get.bind(window.location),set:function(o){e(`location.href set → ${o}`),t.set.call(this,o)},configurable:!0,enumerable:!0})}catch(t){console.warn("ReloadTracer: unable to patch href setter",t)}window.addEventListener("beforeunload",()=>{try{sessionStorage.setItem("__WF_LAST_STACK__",new Error("beforeunload trace").stack)}catch{}}),window.addEventListener("DOMContentLoaded",()=>{const t=sessionStorage.getItem("__WF_LAST_STACK__");t&&(console.group("%c🔍 Reload cause (previous page):","color: orange;font-weight:bold;"),console.log(t),console.groupEnd(),sessionStorage.removeItem("__WF_LAST_STACK__"))}),console.log("✅ ReloadTracer installed")})();window.WhimsicalFrog&&window.WhimsicalFrog.Core?console.log("[WF-Core] Already loaded, skipping initialization"):function(){const n={version:"2.0.0",initialized:!1,debug:!0,modules:{},config:{}};window.handleImageError=function(r,l=null){const c=r.dataset.errorHandled||"none",p=r.src;if(c!=="final"){if(l){if(p.includes(`${l}A.webp`)){r.src=`images/items/${l}A.png`,r.dataset.errorHandled="png-tried";return}if(p.includes(`${l}A.png`)){r.src="images/items/placeholder.webp",r.dataset.errorHandled="final",r.onerror=null;return}}r.src="images/items/placeholder.webp",r.dataset.errorHandled="final",r.onerror=null}},window.handleImageErrorSimple=function(r){r.dataset.errorHandled||(r.src="images/items/placeholder.webp",r.dataset.errorHandled="final",r.onerror=null)},window.setupImageErrorHandling=function(r,l=null){!r||r.tagName!=="IMG"||(r.onerror=function(){window.handleImageError(this,l)})};function e(r,l="info"){if(!n.debug&&l!=="error")return;const c=new Date().toISOString(),p=`[WF-${l.toUpperCase()}]`;switch(l){case"error":console.error(`${p} ${c}`,r);break;case"warn":console.warn(`${p} ${c}`,r);break;case"debug":console.debug(`${p} ${c}`,r);break;default:console.log(`${p} ${c}`,r)}}function t(r,l){return n.modules[r]?(e(`Module '${r}' already registered, skipping`,"warn"),!1):(n.modules[r]={name:r,...l,initialized:!1},e(`Module '${r}' registered successfully`),!0)}const o={events:{},on(r,l){this.events[r]||(this.events[r]=[]),this.events[r].push(l)},emit(r,l){this.events[r]&&this.events[r].forEach(c=>{try{c(l)}catch(p){e(`Error in event handler for '${r}': ${p.message}`,"error")}})},off(r,l){this.events[r]&&(this.events[r]=this.events[r].filter(c=>c!==l))}},i={debounce(r,l){let c;return function(...m){const f=()=>{clearTimeout(c),r(...m)};clearTimeout(c),c=setTimeout(f,l)}},formatCurrency(r){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(r)},escapeHtml(r){const l=document.createElement("div");return l.textContent=r,l.innerHTML},generateId(){return"_"+Math.random().toString(36).substr(2,9)}},s={async request(r,l={}){const c={credentials:"same-origin",headers:{"Content-Type":"application/json",...l.headers}};try{const p=await fetch(r,{...c,...l});if(!p.ok)throw new Error(`API request failed: ${p.status} ${p.statusText}`);const m=p.headers.get("content-type");return m&&m.includes("application/json")?await p.json():await p.text()}catch(p){throw e(`API request error: ${p.message}`,"error"),p}},get(r,l={}){return this.request(r,{...l,method:"GET"})},post(r,l=null,c={}){return this.request(r,{...c,method:"POST",body:l?JSON.stringify(l):null})},put(r,l=null,c={}){return this.request(r,{...c,method:"PUT",body:l?JSON.stringify(l):null})},delete(r,l={}){return this.request(r,{...l,method:"DELETE"})}};function a(){if(n.initialized){e("Core already initialized, skipping","warn");return}e("Initializing WhimsicalFrog Core..."),Object.values(n.modules).forEach(r=>{if(r.init&&typeof r.init=="function")try{r.init(),r.initialized=!0,e(`Module '${r.name}' initialized successfully`)}catch(l){e(`Failed to initialize module '${r.name}': ${l.message}`,"error")}}),n.initialized=!0,e("Core initialization complete")}window.WhimsicalFrog={Core:n,log:e,registerModule:t,on:o.on.bind(o),emit:o.emit.bind(o),off:o.off.bind(o),utils:i,api:s,getState:()=>n,getConfig:()=>n.config,getModule:r=>n.modules[r],addModule:t,ready(r){n.initialized?r():o.on("core:ready",r)}},window.WF=window.WhimsicalFrog,window.wf=window.WhimsicalFrog,n.initialized&&o.emit("core:ready",n);const d=window.fetch;window.fetch=function(r,l={}){return l.credentials=l.credentials||"same-origin",d(r,l)},document.readyState==="loading"?document.addEventListener("DOMContentLoaded",a):setTimeout(a,0);function u(){document.querySelectorAll("img[data-height]").forEach(l=>{const c=l.getAttribute("data-height");c&&(l.style.height=c+"px")})}document.addEventListener("DOMContentLoaded",function(){document.body.hasAttribute("data-wf-image-height-setup")||(u(),document.body.setAttribute("data-wf-image-height-setup","true"))}),e("WhimsicalFrog Core loaded successfully")}();class Y{constructor(){this.state={items:[],total:0,count:0,initialized:!1,notifications:!0},this.init()}init(){this.loadCart(),this.setupEventListeners(),this.state.initialized=!0,console.log("[Cart] System initialized")}loadCart(){try{const e=localStorage.getItem("whimsical_frog_cart");if(e){const t=JSON.parse(e);this.state.items=t.items||[],this.recalculateTotal(),console.log(`[Cart] Loaded ${this.state.items.length} items`)}}catch(e){console.error(`[Cart] Error loading cart: ${e.message}`),this.state.items=[]}}saveCart(){try{const e={items:this.state.items,total:this.state.total,count:this.state.count,timestamp:Date.now()};localStorage.setItem("whimsical_frog_cart",JSON.stringify(e))}catch(e){console.error(`[Cart] Error saving cart: ${e.message}`)}}addItem(e){if(!e||!e.sku)return console.error("[Cart] Invalid item data:",e),!1;const t=this.state.items.findIndex(s=>s.sku===e.sku);let o=parseInt(e.quantity)||1,i=!1;return t>=0?this.state.items[t].quantity+=o:(this.state.items.push({...e,quantity:o,addedAt:Date.now()}),i=!0),this.recalculateTotal(),this.saveCart(),this.updateCartDisplay(),this.state.notifications&&this.showAddToCartNotifications(e,o,this.state.items.find(s=>s.sku===e.sku).quantity,i),window.WhimsicalFrog&&window.WhimsicalFrog.emit("cart:updated",{item:e,action:"add"}),!0}showAddToCartNotifications(e,t,o,i){const s=e.name||e.sku||"Item";parseFloat(e.price);let a=`${s} `;i?a+=`added to cart (${o})`:a+=`quantity updated (${o})`,this.showNotification(a,"success"),setTimeout(()=>{this.showCartStatusToast()},1500)}showCartStatusToast(){const e=this.state.count===1?"item":"items",t=`Cart: ${this.state.count} ${e} • $${this.state.total.toFixed(2)}`;this.showNotification(t,"info",3e3)}showNotification(e,t="info",o=2500){if(window.WhimsicalFrog&&window.WhimsicalFrog.showNotification){window.WhimsicalFrog.showNotification(e,t,o);return}const i=document.createElement("div");i.className=`cart-notification notification-${t}`,i.textContent=e,i.style.cssText=`
            position: fixed;
            top: 20px;
            right: 20px;
            background: ${t==="success"?"#4CAF50":t==="error"?"#f44336":"#2196F3"};
            color: white;
            padding: 12px 20px;
            border-radius: 4px;
            z-index: 10000;
            font-size: 14px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            transform: translateX(100%);
            transition: transform 0.3s ease;
        `,document.body.appendChild(i),setTimeout(()=>{i.style.transform="translateX(0)"},100),setTimeout(()=>{i.style.transform="translateX(100%)",setTimeout(()=>{i.parentNode&&i.parentNode.removeChild(i)},300)},o)}removeItem(e){const t=this.state.items.findIndex(o=>o.sku===e);if(t>=0){const o=this.state.items.splice(t,1)[0];return this.recalculateTotal(),this.saveCart(),this.updateCartDisplay(),window.WhimsicalFrog&&window.WhimsicalFrog.emit("cart:updated",{item:o,action:"remove"}),!0}return!1}updateItem(e,t){const o=this.state.items.find(i=>i.sku===e);return o?(o.quantity=Math.max(0,parseInt(t)||0),o.quantity===0?this.removeItem(e):(this.recalculateTotal(),this.saveCart(),this.updateCartDisplay(),window.WhimsicalFrog&&window.WhimsicalFrog.emit("cart:updated",{item:o,action:"update"}),!0)):!1}clearCart(){this.state.items=[],this.recalculateTotal(),this.saveCart(),this.updateCartDisplay(),window.WhimsicalFrog&&window.WhimsicalFrog.emit("cart:cleared")}recalculateTotal(){this.state.total=this.state.items.reduce((e,t)=>e+(parseFloat(t.price)||0)*(parseInt(t.quantity)||0),0),this.state.count=this.state.items.reduce((e,t)=>e+(parseInt(t.quantity)||0),0)}updateCartDisplay(){document.querySelectorAll(".cart-count, .cart-counter, #cart-count").forEach(i=>{i.textContent=this.state.count,i.style.display=this.state.count>0?"inline":"none"}),document.querySelectorAll(".cart-total, #cart-total").forEach(i=>{i.textContent=`$${this.state.total.toFixed(2)}`}),document.querySelectorAll(".cart-toggle, .cart-button").forEach(i=>{i.classList.toggle("has-items",this.state.count>0)})}setupEventListeners(){document.addEventListener("click",e=>{e.target.matches('.add-to-cart, [data-action="add-to-cart"]')&&(e.preventDefault(),this.handleAddToCartClick(e.target))}),document.addEventListener("change",e=>{if(e.target.matches(".cart-quantity-input")){const t=e.target.dataset.sku,o=parseInt(e.target.value)||0;this.updateItem(t,o)}}),document.addEventListener("click",e=>{if(e.target.matches('.remove-from-cart, [data-action="remove-from-cart"]')){e.preventDefault();const t=e.target.dataset.sku||e.target.closest("[data-sku]")?.dataset.sku;t&&this.removeItem(t)}})}handleAddToCartClick(e){const t=e.closest("[data-sku]")||e.closest(".product-card")||e.closest(".product-item");if(!t){console.warn("[Cart] Could not find product container for add to cart button");return}const o={sku:t.dataset.sku||e.dataset.sku,name:t.dataset.name||t.querySelector(".product-name, .item-name")?.textContent?.trim(),price:t.dataset.price||t.querySelector(".product-price, .item-price")?.textContent?.replace(/[^0-9.]/g,""),image:t.dataset.image||t.querySelector("img")?.src,quantity:1};if(!o.sku){console.error("[Cart] No SKU found for item:",t);return}this.addItem(o)}getItems(){return[...this.state.items]}getTotal(){return this.state.total}getCount(){return this.state.count}getState(){return{...this.state}}setNotifications(e){this.state.notifications=!!e}}typeof window<"u"&&(window.CartSystem=Y);class X{constructor(){this.overlay=null,this.content=null,this.isLoading=!1,this.currentRoomNumber=null,this.roomCache=new Map,this.init()}init(){console.log("[Room] Modal manager initializing..."),this.createModalStructure(),this.setupEventListeners()}createModalStructure(){if(document.getElementById("roomModalOverlay")){console.log("[Room] Using existing modal overlay"),this.overlay=document.getElementById("roomModalOverlay"),this.content=this.overlay.querySelector(".room-modal-container");return}console.log("[Room] Creating new modal overlay structure"),this.overlay=document.createElement("div"),this.overlay.id="roomModalOverlay",this.overlay.className="room-modal-overlay",this.overlay.setAttribute("role","dialog"),this.overlay.setAttribute("aria-modal","true"),this.overlay.setAttribute("aria-labelledby","room-modal-title"),this.overlay.setAttribute("aria-describedby","room-modal-content"),this.isVisible=!1,this.overlay.style.display="none",this.content=document.createElement("div"),this.content.className="room-modal-container";const e=document.createElement("div");e.className="room-modal-header",e.style.cssText=`
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            background: transparent;
            color: white;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            z-index: 10000;
            pointer-events: auto;
        `;const t=document.createElement("button");t.className="room-modal-back-btn bg-primary",t.innerHTML="← Back to Main Room",t.style.cssText=`
            align-self: flex-start;

            background-color: var(--button-bg-primary, #87ac3a);
            border: 1px solid var(--button-bg-primary, #87ac3a);
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
        `,t.addEventListener("click",a=>{a.preventDefault(),a.stopPropagation(),this.close()});const o=document.createElement("div");o.className="room-modal-title-container",o.style.cssText=`
            text-align: right;
            margin-left: auto;
            padding: 8px 16px;
            background: transparent;
            color: white;
        `;const i=document.createElement("h2");i.className="room-modal-title",i.id="room-modal-title",i.textContent="Loading...",i.style.cssText=`
            margin: 0;
            font-size: 1.4rem;
            font-weight: 600;
            color: white;
            text-align: right;
        `,o.appendChild(i);const s=document.createElement("div");s.className="room-modal-body",e.appendChild(t),e.appendChild(o),this.content.appendChild(e),this.content.appendChild(s),this.overlay.appendChild(this.content),document.body.appendChild(this.overlay)}setupEventListeners(){console.log("[Room] Setting up event listeners...");const e=this.overlay.querySelector(".room-modal-close-btn");e&&e.addEventListener("click",()=>this.close());const t=this.overlay.querySelector(".room-modal-back-btn");t&&t.addEventListener("click",()=>this.goBack()),this.overlay.addEventListener("click",o=>{o.target===this.overlay&&this.close()}),document.addEventListener("keydown",o=>{o.key==="Escape"&&this.isOpen()&&this.close()}),document.addEventListener("click",o=>{console.log("[Room] Click detected on:",o.target);const i=o.target.closest("[data-room], .door-link, .room-door");if(console.log("[Room] Door link found:",i),i&&!o.defaultPrevented){console.log("[Room] Processing door click..."),o.preventDefault();const s=i.dataset.room||i.href?.match(/room=(\d+)/)?.[1]||i.getAttribute("data-room-number");console.log("[Room] Room number extracted:",s),s?(console.log("[Room] Opening room:",s),this.openRoom(s)):console.log("[Room] No room number found")}}),console.log("[Room] Event listeners registered successfully")}async openRoom(e){if(this.isLoading){console.log("[Room] Already loading, skipping request");return}console.log(`[Room] Opening room ${e}`),this.currentRoomNumber=e,this.isLoading=!0,this.show(),this.setContent('<div class="loading">Loading room...</div>');try{let t=this.roomCache.get(e);if(!t){const i=await fetch(`/api/load_room_content.php?room=${e}&modal=1`,{headers:{"X-Requested-With":"XMLHttpRequest"}});if(!i.ok)throw new Error(`HTTP ${i.status}: ${i.statusText}`);const s=await i.json();if(!s.success)throw new Error(s.message||"Failed to load room content");t=s.content,s.metadata&&this.updateHeader(s.metadata),this.roomCache.set(e,t),console.log(`[Room] Cached content for room ${e}`),console.log("[Room] Room metadata:",s.metadata)}this.setContent(t);const o=this.overlay.querySelector(".room-title-overlay");o&&o.remove(),this.updateHeaderFromDOM(),window.WhimsicalFrog&&window.WhimsicalFrog.emit("room:opened",{roomNumber:e,content:t})}catch(t){console.error(`[Room] Error loading room ${e}:`,t),this.setContent(`
                <div class="error">
                    <h3>Unable to load room ${e}</h3>
                    <p>Please try again later.</p>
                    <button onclick="window.location.reload()">Refresh Page</button>
                </div>
            `)}finally{this.isLoading=!1}}setContent(e){const t=this.overlay.querySelector(".room-modal-body");if(t){const o=/<script[^>]*>([\s\S]*?)<\/script>/gi,i=[];let s;for(;(s=o.exec(e))!==null;)i.push(s[1]);t.innerHTML=e,i.forEach((a,d)=>{try{console.log(`[Room] Executing modal script ${d+1}`),new Function(a)()}catch(u){console.error(`[Room] Error executing modal script ${d+1}:`,u)}}),this.initializeModalContent()}}initializeModalContent(){const e=this.overlay.querySelector(".room-modal-body");if(!e)return;e.querySelectorAll("img").forEach(a=>{if(window.setupImageErrorHandling){const d=a.closest("[data-sku]")?.dataset.sku;window.setupImageErrorHandling(a,d)}}),e.querySelectorAll('.add-to-cart, [data-action="add-to-cart"]').forEach(a=>{a.addEventListener("click",d=>{d.preventDefault(),d.stopPropagation()})}),e.querySelectorAll("[data-product], .product-link").forEach(a=>{a.addEventListener("click",d=>{d.preventDefault(),window.WhimsicalFrog&&window.WhimsicalFrog.emit("product:modal-requested",{element:a,sku:a.dataset.product||a.dataset.sku})})}),e.querySelectorAll(".room-product-icon").forEach(a=>{const d=a.dataset.sku;if(!d)return;const u={sku:d,name:a.dataset.name,price:Number(a.dataset.price||0),retailPrice:Number(a.dataset.price||0),stockLevel:Number(a.dataset.stockLevel||0),category:a.dataset.category,image:a.dataset.image,description:a.dataset.description||"",marketingLabel:a.dataset.marketingLabel||""};let r,l,c,p;if(a.dataset.originalTop!==void 0&&a.dataset.originalTop!=="")r=parseFloat(a.dataset.originalTop),l=parseFloat(a.dataset.originalLeft),c=parseFloat(a.dataset.originalWidth),p=parseFloat(a.dataset.originalHeight);else{const g=parseFloat(a.style.top)||0,y=parseFloat(a.style.left)||0,v=parseFloat(a.style.width)||80,w=parseFloat(a.style.height)||80;r=g,l=y,c=v,p=w,a.dataset.originalTop=r,a.dataset.originalLeft=l,a.dataset.originalWidth=c,a.dataset.originalHeight=p,console.log(`[Room Modal] Fallback inline coords for icon: top=${r}, left=${l}, w=${c}, h=${p}`)}const m=()=>{console.log("[IconHover] mouseenter on icon",a,u),typeof window.showGlobalPopup=="function"?window.showGlobalPopup(a,u):window.parent&&typeof window.parent.showGlobalPopup=="function"&&window.parent.showGlobalPopup(a,u)},f=()=>{console.log("[IconHover] mouseleave on icon",a),typeof window.hideGlobalPopup=="function"?window.hideGlobalPopup():window.parent&&typeof window.parent.hideGlobalPopup=="function"&&window.parent.hideGlobalPopup()};a.addEventListener("mouseenter",m),a.addEventListener("focus",m),a.addEventListener("mouseleave",f),a.addEventListener("blur",f),a.addEventListener("click",g=>{console.log("[IconClick] Icon clicked",a,u),g.preventDefault(),g.stopPropagation(),typeof window.showGlobalItemModal=="function"?window.showGlobalItemModal(d,u):window.parent&&typeof window.parent.showGlobalItemModal=="function"?window.parent.showGlobalItemModal(d,u):window.WhimsicalFrog&&window.WhimsicalFrog.emit("product:modal-requested",{element:a,sku:d})})})}show(){console.log("[Room] 🎭 show() method called"),console.log("[Room] 🎭 overlay element:",this.overlay),console.log("[Room] 🎭 overlay classList before:",this.overlay?.classList.toString()),this.previouslyFocusedElement=document.activeElement,this.overlay.style.display="flex",this.overlay.classList.add("show"),this.overlay.offsetHeight,this.overlay.style.opacity="1",document.body.style.overflow="hidden",setTimeout(()=>{const e=this.overlay.querySelector(".room-modal-close-btn");e&&(e.focus(),console.log("[Room] 🎭 Focus set to close button for accessibility"))},100),console.log("[Room] 🎭 overlay classList after:",this.overlay.classList.toString()),console.log("[Room] 🎭 overlay opacity after:",this.overlay.style.opacity),console.log("[Room] 🎭 Modal should now be visible with .show class!")}close(){console.log("[Room] 🎭 close() method called"),console.log("[Room] 🎭 overlay classList before close:",this.overlay?.classList.toString()),this.overlay.style.opacity="0",this.overlay.classList.remove("show"),console.log("[Room] 🎭 overlay classList after show removal:",this.overlay?.classList.toString()),setTimeout(()=>{this.overlay.style.display="none",document.body.style.overflow="",this.previouslyFocusedElement&&(this.previouslyFocusedElement.focus(),console.log("[Room] 🎭 Focus restored to previously focused element for accessibility"),this.previouslyFocusedElement=null),console.log("[Room] 🎭 Modal fully closed and hidden")},300),window.WhimsicalFrog&&window.WhimsicalFrog.emit("room:closed",{roomNumber:this.currentRoomNumber}),this.currentRoomNumber=null}goBack(){this.close()}isOpen(){return this.overlay&&this.overlay.style.display!=="none"}preloadRoomContent(){console.log("[Room] Ready for room content loading")}getCurrentRoom(){return this.currentRoomNumber}clearCache(){this.roomCache.clear(),console.log("[Room] Cache cleared")}getCachedRooms(){return Array.from(this.roomCache.keys())}updateHeader(e={}){const t=this.overlay.querySelector(".room-modal-title");if(t){const o=e.room_name||e.category||`Room ${e.room_number||""}`;o&&(t.textContent=o)}}updateHeaderFromDOM(){const e=this.overlay.querySelector(".room-modal-title");if(!e)return;const o=this.overlay.querySelector(".room-modal-body")?.querySelector(".room-title-overlay h3");o&&o.textContent.trim()&&(e.textContent=o.textContent.trim())}}typeof window<"u"&&(window.RoomModalManager=X);class J{constructor(){this.modal=null,this.searchInput=null,this.isSearching=!1,this.currentSearchTerm="",this.currentResults=[],this.init()}init(){console.log("[Search] System initializing..."),this.createModalHTML(),this.setupReferences(),this.bindEvents()}createModalHTML(){if(document.getElementById("searchModal")){console.log("[Search] Using existing search modal");return}document.body.insertAdjacentHTML("beforeend",`
            <div id="searchModal" class="search-modal" style="display: none;">
                <div class="search-modal-content">
                    <div class="search-modal-header">
                        <h2 class="search-modal-title">Search Results</h2>
                        <button class="search-modal-close" type="button">&times;</button>
                    </div>
                    <div class="search-modal-body" id="searchModalBody">
                        <!-- Search results will be populated here -->
                    </div>
                </div>
            </div>
        `);const t=document.createElement("style");t.textContent=`
            .search-modal {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.7);
                z-index: 9998;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            .search-modal-content {
                background: white;
                border-radius: 8px;
                max-width: 90vw;
                max-height: 90vh;
                overflow: auto;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
                min-width: 500px;
            }
            .search-modal-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 16px 20px;
                border-bottom: 1px solid #eee;
                background: #f8f9fa;
                border-radius: 8px 8px 0 0;
            }
            .search-modal-title {
                margin: 0;
                font-size: 18px;
            }
            .search-modal-close {
                background: none;
                border: none;
                font-size: 24px;
                cursor: pointer;
                padding: 0;
                width: 30px;
                height: 30px;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            .search-modal-body {
                padding: 20px;
                min-height: 200px;
            }
            .search-result-item {
                border-bottom: 1px solid #eee;
                padding: 15px 0;
            }
            .search-result-item:last-child {
                border-bottom: none;
            }
            .search-result-title {
                font-weight: bold;
                margin-bottom: 5px;
                color: #007bff;
                text-decoration: none;
            }
            .search-result-title:hover {
                text-decoration: underline;
            }
            .search-result-description {
                color: #666;
                font-size: 14px;
            }
            .search-loading {
                text-align: center;
                padding: 40px;
                color: #666;
            }
            .search-no-results {
                text-align: center;
                padding: 40px;
                color: #666;
            }
        `,document.head.appendChild(t)}setupReferences(){this.modal=document.getElementById("searchModal"),this.searchInput=document.getElementById("headerSearchInput")||document.querySelector('.search-input, input[type="search"]'),this.searchInput||console.log("[Search] No search input found, search functionality disabled")}bindEvents(){if(this.searchInput){if(this.searchInput.addEventListener("keypress",e=>{if(e.key==="Enter"){e.preventDefault();const t=this.searchInput.value.trim();t&&this.performSearch(t)}}),document.addEventListener("click",e=>{if(e.target.matches('.search-button, [data-action="search"]')){e.preventDefault();const t=this.searchInput.value.trim();t&&this.performSearch(t)}}),this.modal){const e=this.modal.querySelector(".search-modal-close");e&&e.addEventListener("click",()=>this.close()),this.modal.addEventListener("click",t=>{t.target===this.modal&&this.close()})}document.addEventListener("keydown",e=>{e.key==="Escape"&&this.isOpen()&&this.close()})}}async performSearch(e){if(this.isSearching){console.log("[Search] Already searching, skipping request");return}console.log(`[Search] Performing search for: "${e}"`),this.currentSearchTerm=e,this.isSearching=!0,this.open(),this.setContent('<div class="search-loading">Searching...</div>');try{const t=`/api/search_items.php?q=${encodeURIComponent(e)}`,o=await fetch(t,{method:"GET",headers:{"X-Requested-With":"XMLHttpRequest"}});if(!o.ok)throw new Error(`Search request failed: ${o.status}`);const i=await o.json();this.currentResults=i,this.displayResults(i,e),window.WhimsicalFrog&&window.WhimsicalFrog.emit("search:completed",{term:e,results:i})}catch(t){console.error("[Search] Error performing search:",t),this.setContent(`
                <div class="search-no-results">
                    <h3>Search Error</h3>
                    <p>Unable to perform search. Please try again later.</p>
                </div>
            `)}finally{this.isSearching=!1}}displayResults(e,t){if(!e||e.length===0){this.setContent(`
                <div class="search-no-results">
                    <h3>No Results Found</h3>
                    <p>No items found for "${t}". Try different keywords.</p>
                </div>
            `);return}let o=`<div class="search-results-header">
            <p>Found ${e.length} result${e.length!==1?"s":""} for "${t}"</p>
        </div>`;e.forEach(i=>{o+=`
                <div class="search-result-item">
                    <a href="${i.url||"#"}" class="search-result-title">
                        ${this.escapeHtml(i.title||i.name||"Untitled")}
                    </a>
                    <div class="search-result-description">
                        ${this.escapeHtml(i.description||i.excerpt||"")}
                        ${i.price?`<br><strong>Price: $${parseFloat(i.price).toFixed(2)}</strong>`:""}
                    </div>
                </div>
            `}),this.setContent(o)}setContent(e){const t=this.modal?.querySelector(".search-modal-body");t&&(t.innerHTML=e,this.initializeResultsContent())}initializeResultsContent(){const e=this.modal?.querySelector(".search-modal-body");if(!e)return;e.querySelectorAll(".search-result-title").forEach(o=>{o.addEventListener("click",i=>{this.close()})})}open(){if(this.modal){this.modal.style.display="flex",document.body.style.overflow="hidden";const e=this.modal.querySelector('input[type="search"], .search-input');e&&setTimeout(()=>e.focus(),100)}}close(){this.modal&&(this.modal.style.display="none",document.body.style.overflow=""),window.WhimsicalFrog&&window.WhimsicalFrog.emit("search:closed",{term:this.currentSearchTerm})}isOpen(){return this.modal&&this.modal.style.display!=="none"}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}search(e){return this.searchInput&&(this.searchInput.value=e),this.performSearch(e)}getCurrentTerm(){return this.currentSearchTerm}getCurrentResults(){return[...this.currentResults]}clearResults(){this.currentResults=[],this.currentSearchTerm="",this.searchInput&&(this.searchInput.value="")}}typeof window<"u"&&(window.SearchSystem=J);class K{constructor(){this.hoverTimeout=null,this.hideTimeout=null,this.currentPopup=null,this.init()}init(){console.log("[Sales] System initializing..."),this.setupEventListeners(),this.initializePageSpecificFeatures()}async checkItemSale(e){try{const o=await(await fetch(`sales.php?action=get_active_sales&item_sku=${e}`,{headers:{"X-Requested-With":"XMLHttpRequest"}})).json();return o.success&&o.sale?{isOnSale:!0,discountPercentage:parseFloat(o.sale.discount_percentage),salePrice:null,originalPrice:null}:{isOnSale:!1}}catch(t){return console.log("[Sales] Error checking sale for",e,t),{isOnSale:!1}}}calculateSalePrice(e,t){return e*(1-t/100)}async checkAndDisplaySalePrice(e,t,o=null,i="popup"){if(!(!e||!t))try{const s=await this.checkItemSale(e.sku);if(s.isOnSale&&s.discountPercentage){const a=parseFloat(e.retailPrice||e.price),d=parseFloat(s.discountPercentage);if(isNaN(d)||d<=0){console.error("[Sales] Invalid discount percentage:",s.discountPercentage);const l=parseFloat(e.retailPrice||e.price);t.textContent=`$${l.toFixed(2)}`,o&&(o.textContent=`$${l.toFixed(2)}`);return}const u=this.calculateSalePrice(a,d),r=`${d}% off`;t.innerHTML=`
                    <span class="sale-price">$${u.toFixed(2)}</span>
                    <span class="original-price" style="text-decoration: line-through; color: #999; margin-left: 8px;">$${a.toFixed(2)}</span>
                    <span class="discount-badge" style="background: #e74c3c; color: white; padding: 2px 6px; border-radius: 3px; font-size: 0.8em; margin-left: 8px;">${r}</span>
                `,o&&(o.innerHTML=`
                        <span class="sale-price">$${u.toFixed(2)}</span>
                        <span class="original-price" style="text-decoration: line-through; color: #999; margin-left: 5px;">$${a.toFixed(2)}</span>
                    `),e.salePrice=u,e.originalPrice=a,e.price=u}else{const a=parseFloat(e.retailPrice||e.price);t.textContent=`$${a.toFixed(2)}`,o&&(o.textContent=`$${a.toFixed(2)}`)}}catch(s){console.error("[Sales] Error in checkAndDisplaySalePrice:",s);const a=parseFloat(e.retailPrice||e.price);t.textContent=`$${a.toFixed(2)}`,o&&(o.textContent=`$${a.toFixed(2)}`)}}addSaleBadgeToCard(e,t){if(!e||!t)return;const o=e.querySelector(".sale-badge");o&&o.remove();const i=document.createElement("div");i.className="sale-badge",i.textContent=`${t}% OFF`,i.style.cssText=`
            position: absolute;
            top: 10px;
            right: 10px;
            background: #e74c3c;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            z-index: 10;
        `,getComputedStyle(e).position==="static"&&(e.style.position="relative"),e.appendChild(i)}hidePopup(){this.currentPopup&&(this.currentPopup.style.display="none")}keepPopupVisible(){this.hideTimeout&&(clearTimeout(this.hideTimeout),this.hideTimeout=null)}async updatePopupContent(e,t){if(!e||!t)return;const o=e.querySelector(".popup-content")||e;o.innerHTML='<div class="popup-loading">Loading...</div>';try{const i=await this.checkItemSale(t.sku);let s="";if(i.isOnSale&&i.discountPercentage){const a=parseFloat(t.retailPrice||t.price);s=`
                    <div class="popup-price">
                        <span class="sale-price">$${this.calculateSalePrice(a,i.discountPercentage).toFixed(2)}</span>
                        <span class="original-price" style="text-decoration: line-through; color: #999;">$${a.toFixed(2)}</span>
                        <span class="discount-badge">${i.discountPercentage}% OFF</span>
                    </div>
                `}else s=`<div class="popup-price">$${parseFloat(t.retailPrice||t.price).toFixed(2)}</div>`;o.innerHTML=`
                <div class="popup-header">
                    <h3 class="popup-title">${this.escapeHtml(t.name||t.sku)}</h3>
                </div>
                <div class="popup-body">
                    ${t.image?`<img src="${t.image}" alt="${this.escapeHtml(t.name||t.sku)}" style="max-width: 100px; height: auto; margin-bottom: 10px;">`:""}
                    ${s}
                    ${t.description?`<p class="popup-description">${this.escapeHtml(t.description)}</p>`:""}
                    <button class="add-to-cart-popup" data-sku="${t.sku}">Add to Cart</button>
                </div>
            `,e.style.cssText=`
                position: absolute;
                background: white;
                border: 1px solid #ddd;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                padding: 15px;
                max-width: 300px;
                z-index: 1000;
                font-size: 14px;
            `}catch(i){console.error("[Sales] Error updating popup content:",i),o.innerHTML=`
                <div class="popup-error">
                    <h3>${this.escapeHtml(t.name||t.sku)}</h3>
                    <p>Unable to load details</p>
                </div>
            `}}positionPopup(e,t){if(!e||!t)return;const o=e.getBoundingClientRect(),i=t.getBoundingClientRect();let s=o.bottom+window.scrollY+10,a=o.left+window.scrollX;a+i.width>window.innerWidth&&(a=window.innerWidth-i.width-10),s+i.height>window.innerHeight+window.scrollY&&(s=o.top+window.scrollY-i.height-10),t.style.top=`${s}px`,t.style.left=`${a}px`}setupEventListeners(){document.addEventListener("mouseenter",async e=>{if(!e.target||typeof e.target.closest!="function")return;const t=e.target.closest("[data-sku], .product-card, .product-item");if(!t)return;const o=t.dataset.sku;o&&(this.hoverTimeout&&clearTimeout(this.hoverTimeout),this.hideTimeout&&clearTimeout(this.hideTimeout),this.hoverTimeout=setTimeout(async()=>{let i=document.getElementById(`popup-${o}`);i||(i=document.createElement("div"),i.id=`popup-${o}`,i.className="product-popup",document.body.appendChild(i));const s={sku:o,name:t.dataset.name||t.querySelector(".product-name, .item-name")?.textContent?.trim(),price:t.dataset.price||t.querySelector(".product-price, .item-price")?.textContent?.replace(/[^0-9.]/g,""),image:t.dataset.image||t.querySelector("img")?.src,description:t.dataset.description};await this.updatePopupContent(i,s),this.positionPopup(t,i),i.style.display="block",this.currentPopup=i,i.addEventListener("mouseenter",()=>this.keepPopupVisible()),i.addEventListener("mouseleave",()=>{this.hideTimeout=setTimeout(()=>this.hidePopup(),300)})},500))},!0),document.addEventListener("mouseleave",e=>{!e.target||typeof e.target.closest!="function"||!e.target.closest("[data-sku], .product-card, .product-item")||(this.hoverTimeout&&(clearTimeout(this.hoverTimeout),this.hoverTimeout=null),this.hideTimeout=setTimeout(()=>this.hidePopup(),300))},!0)}initializePageSpecificFeatures(){((window.WF_PAGE_INFO?.page||(window.location.pathname==="/"?"landing":window.location.pathname.replace(/^\//,"").split("/")[0])||"landing")==="shop"||window.location.pathname.includes("shop"))&&this.initializeShopPage(),this.setupRoomHover()}async initializeShopPage(){console.log("[Sales] Initializing shop page features...");const e=document.querySelectorAll("[data-sku], .product-card");for(const t of e){const o=t.dataset.sku;if(o)try{const i=await this.checkItemSale(o);if(i.isOnSale&&i.discountPercentage){this.addSaleBadgeToCard(t,i.discountPercentage);const s=t.querySelector(".product-price, .item-price");if(s){const a=parseFloat(s.textContent.replace(/[^0-9.]/g,"")),d=this.calculateSalePrice(a,i.discountPercentage);s.innerHTML=`
                                <span class="sale-price">$${d.toFixed(2)}</span>
                                <span class="original-price" style="text-decoration: line-through; color: #999; font-size: 0.9em;">$${a.toFixed(2)}</span>
                            `}}}catch(i){console.error("[Sales] Error processing card for SKU:",o,i)}}}setupRoomHover(){console.log("[Sales] Room hover functionality ready")}escapeHtml(e){if(!e)return"";const t=document.createElement("div");return t.textContent=e,t.innerHTML}async getItemSaleInfo(e){return await this.checkItemSale(e)}calculateDiscount(e,t){return this.calculateSalePrice(e,t)}addSaleBadge(e,t){this.addSaleBadgeToCard(e,t)}}typeof window<"u"&&(window.SalesSystem=K,window.checkItemSale=async n=>window.WF_Sales?await window.WF_Sales.checkItemSale(n):{isOnSale:!1},window.calculateSalePrice=(n,e)=>window.WF_Sales?window.WF_Sales.calculateSalePrice(n,e):n);class I{static async request(e,t={}){const o={headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},credentials:"same-origin"},i={...o,...t,headers:{...o.headers,...t.headers}};try{const s=await fetch(e,i);if(!s.ok)throw new Error(`HTTP ${s.status}: ${s.statusText}`);const a=await s.json();if(a.success===!1)throw new Error(a.error||"API request failed");return a}catch(s){throw console.error("[API] Request failed:",s),s}}static async get(e,t={}){return this.request(e,{...t,method:"GET"})}static async post(e,t=null,o={}){const i={...o,method:"POST"};return t&&(i.body=JSON.stringify(t)),this.request(e,i)}static async put(e,t=null,o={}){const i={...o,method:"PUT"};return t&&(i.body=JSON.stringify(t)),this.request(e,i)}static async delete(e,t={}){return this.request(e,{...t,method:"DELETE"})}}class k{static async setContent(e,t,o=!1){e&&(o&&(e.innerHTML=this.createLoadingSpinner(),await new Promise(i=>setTimeout(i,100))),e.innerHTML=t)}static createLoadingSpinner(e="Loading..."){return`
            <div class="loading-spinner" style="display: flex; align-items: center; justify-content: center; padding: 20px;">
                <div style="width: 20px; height: 20px; border: 2px solid #f3f3f3; border-top: 2px solid #333; border-radius: 50%; animation: spin 1s linear infinite; margin-right: 10px;"></div>
                <span>${this.escapeHtml(e)}</span>
            </div>
            <style>
                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
            </style>
        `}static createErrorMessage(e){return`
            <div class="error-message" style="background: #fee; border: 1px solid #fcc; color: #a00; padding: 10px; border-radius: 4px; margin: 10px 0;">
                <strong>Error:</strong> ${this.escapeHtml(e)}
            </div>
        `}static createSuccessMessage(e){return`
            <div class="success-message" style="background: #efe; border: 1px solid #cfc; color: #060; padding: 10px; border-radius: 4px; margin: 10px 0;">
                <strong>Success:</strong> ${this.escapeHtml(e)}
            </div>
        `}static showToast(e,t="info",o=3e3){const i={success:{bg:"#4caf50",text:"white"},error:{bg:"#f44336",text:"white"},info:{bg:"#2196f3",text:"white"},warning:{bg:"#ff9800",text:"white"}},s=i[t]||i.info,a=document.createElement("div");return a.style.cssText=`
            position: fixed;
            top: 20px;
            right: 20px;
            background: ${s.bg};
            color: ${s.text};
            padding: 12px 20px;
            border-radius: 4px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 10000;
            font-size: 14px;
            max-width: 300px;
            word-wrap: break-word;
            transition: opacity 0.3s ease, transform 0.3s ease;
            transform: translateX(100%);
            opacity: 0;
        `,a.textContent=e,document.body.appendChild(a),setTimeout(()=>{a.style.transform="translateX(0)",a.style.opacity="1"},10),setTimeout(()=>{a.style.transform="translateX(100%)",a.style.opacity="0",setTimeout(()=>{a.parentNode&&a.parentNode.removeChild(a)},300)},o),a}static debounce(e,t){let o;return function(...s){const a=()=>{clearTimeout(o),e(...s)};clearTimeout(o),o=setTimeout(a,t)}}static formatCurrency(e){return isNaN(e)?"$0.00":`$${parseFloat(e).toFixed(2)}`}static escapeHtml(e){if(!e)return"";const t=document.createElement("div");return t.textContent=e,t.innerHTML}static confirm(e,t="Confirm"){return new Promise(o=>{const i=document.createElement("div");i.style.cssText=`
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                z-index: 10001;
                display: flex;
                align-items: center;
                justify-content: center;
            `;const s=document.createElement("div");s.style.cssText=`
                background: white;
                padding: 20px;
                border-radius: 8px;
                box-shadow: 0 4px 20px rgba(0,0,0,0.3);
                max-width: 400px;
                width: 90%;
                text-align: center;
            `,s.innerHTML=`
                <h3 style="margin: 0 0 15px 0; color: #333;">${this.escapeHtml(t)}</h3>
                <p style="margin: 0 0 20px 0; color: #666;">${this.escapeHtml(e)}</p>
                <div style="display: flex; gap: 10px; justify-content: center;">
                    <button class="confirm-btn" style="background: #2196f3; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">Confirm</button>
                    <button class="cancel-btn" style="background: #999; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">Cancel</button>
                </div>
            `,i.appendChild(s),document.body.appendChild(i);const a=()=>{i.parentNode&&i.parentNode.removeChild(i)};s.querySelector(".confirm-btn").addEventListener("click",()=>{a(),o(!0)}),s.querySelector(".cancel-btn").addEventListener("click",()=>{a(),o(!1)}),i.addEventListener("click",d=>{d.target===i&&(a(),o(!1))}),setTimeout(()=>{s.querySelector(".confirm-btn").focus()},100)})}static throttle(e,t){let o;return function(...i){o||(e.apply(this,i),o=!0,setTimeout(()=>o=!1,t))}}static deepClone(e){if(e===null||typeof e!="object")return e;if(e instanceof Date)return new Date(e.getTime());if(e instanceof Array)return e.map(t=>this.deepClone(t));if(typeof e=="object"){const t={};for(const o in e)e.hasOwnProperty(o)&&(t[o]=this.deepClone(e[o]));return t}}}class Z{constructor(){this.api=I,this.dom=k,this.init()}init(){console.log("[Utils] Consolidated utilities initialized"),this.toast=k.showToast,this.confirm=k.confirm,this.debounce=k.debounce,this.throttle=k.throttle,this.formatCurrency=k.formatCurrency,this.escapeHtml=k.escapeHtml,this.deepClone=k.deepClone}async get(e,t={}){return I.get(e,t)}async post(e,t=null,o={}){return I.post(e,t,o)}async put(e,t=null,o={}){return I.put(e,t,o)}async delete(e,t={}){return I.delete(e,t)}showSuccess(e,t=3e3){return k.showToast(e,"success",t)}showError(e,t=5e3){return k.showToast(e,"error",t)}showInfo(e,t=3e3){return k.showToast(e,"info",t)}showWarning(e,t=4e3){return k.showToast(e,"warning",t)}}typeof window<"u"&&(window.WhimsicalFrogUtils=Z,window.ApiClient=I,window.DOMUtils=k,window.apiGet=(n,e={})=>I.get(n,e),window.apiPost=(n,e=null,t={})=>I.post(n,e,t),window.apiPut=(n,e=null,t={})=>I.put(n,e,t),window.apiDelete=(n,e={})=>I.delete(n,e),window.showToast=k.showToast,window.confirm=k.confirm,window.debounce=k.debounce,window.throttle=k.throttle,window.formatCurrency=k.formatCurrency,window.escapeHtml=k.escapeHtml);const ie="/api/";function ne(n){return n.startsWith("http://")||n.startsWith("https://")||n.startsWith("/")?n:`${ie}${n}`}async function z(n,e,t=null,o={}){const i=ne(e),s={method:n,headers:{"Content-Type":"application/json",...o.headers},credentials:"same-origin",...o};n!=="GET"&&t!==null&&(s.body=JSON.stringify(t));const a=await fetch(i,s),d=a.headers.get("content-type")||"",u=d.includes("application/json");if(!a.ok){let r;try{r=u?await a.json():await a.text()}catch{r="Could not parse error response."}let l="An unknown error occurred.";throw typeof r=="string"?l=r:r&&r.message?l=r.message:l=JSON.stringify(r),new Error(`API Error (${a.status}): ${l}`)}return a.status===204||!d?null:u?a.json():a.text()}function ae(n,e={}){return z("GET",n,null,e)}function se(n,e=null,t={}){return z("POST",n,e,t)}const H={get:ae,post:se,request:z},D={modules:new Map,readyCallbacks:[],initialized:!1,api:H,eventBus:{events:{},on(n,e){this.events[n]||(this.events[n]=[]),this.events[n].push(e)},emit(n,e){this.events[n]&&this.events[n].forEach(t=>t(e))}},log(n,e="info"){const t="🐸 [WF]";switch(e){case"warn":console.warn(`${t} ${n}`);break;case"error":console.error(`${t} ${n}`);break;default:console.log(`${t} ${n}`);break}},registerModule(n,e){this.log(`Registering module: ${n}`),this.modules.set(n,e)},getModule(n){return this.modules.get(n)},ready(n){return this.initialized?n(this):this.readyCallbacks.push(n),this},init(){this.initialized||(this.initialized=!0,this.log("Core Initialized"),this.readyCallbacks.forEach(n=>{try{n(this)}catch(e){this.log(`Error in ready callback: ${e}`,"error")}}),this.readyCallbacks=[])}};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>D.init()):D.init();const re={init(){this.WF=D,this.ensureSingleNavigation(),this.updateMainCartCounter(),this.setupEventListeners(),this.handleLoginForm(),this.WF.log("Main Application module initialized.")},ensureSingleNavigation(){const n=document.querySelectorAll("nav.main-nav");n.length>1&&(this.WF.log(`Found ${n.length} navigation elements, removing duplicates...`),n.forEach((e,t)=>{t>0&&e.remove()}))},updateMainCartCounter(){const n=document.getElementById("cartCount");window.cart&&n&&(n.textContent=`${window.cart.getCount()} items`)},setupEventListeners(){this.WF.eventBus&&this.WF.eventBus.on("cartUpdated",()=>this.updateMainCartCounter()),this.WF.ready(()=>this.updateMainCartCounter())},handleLoginForm(){const n=document.getElementById("loginForm");n&&n.addEventListener("submit",async e=>{e.preventDefault();const t=n.querySelector("#username").value,o=n.querySelector("#password").value,i=n.querySelector("#errorMessage");i&&i.classList.add("hidden");try{const s=await this.WF.api.post("/functions/process_login.php",{username:t,password:o});sessionStorage.setItem("user",JSON.stringify(s.user||s)),s.redirectUrl?window.location.href=s.redirectUrl:localStorage.getItem("pendingCheckout")==="true"?(localStorage.removeItem("pendingCheckout"),window.location.href="/checkout"):window.location.href="/dashboard"}catch(s){i&&(i.textContent=s.message||"Invalid username or password.",i.classList.remove("hidden")),console.error("Login failed:",s)}})},async loadModalBackground(n){if(!n){this.WF.log("[MainApplication] No roomType provided for modal background.","warn");return}try{const e=await this.WF.api.get(`/api/get_background.php?room_type=${n}`);if(e&&e.success&&e.background){const{webp_path:t,png_path:o}=e.background;let s=document.documentElement.classList.contains("webp")?t:o;s.startsWith("backgrounds/")||(s=`backgrounds/${s}`);const a=`/images/${s}?v=${Date.now()}`,d=document.querySelector(".room-modal-overlay");d?d.style.setProperty("--dynamic-bg-url",`url('${a}')`):this.WF.log("[MainApplication] Modal overlay not found for background.","warn")}else this.WF.log(`[MainApplication] No background found for roomType: ${n}`,"info")}catch(e){this.WF.log(`[MainApplication] Error loading modal background: ${e}`,"error")}}};D.ready(()=>re.init());function le(n,e){let t;return function(...i){const s=()=>{clearTimeout(t),n(...i)};clearTimeout(t),t=setTimeout(s,e)}}console.log("Utils loaded");const ce={init(){this.categoryButtons=document.querySelectorAll(".category-btn"),this.productCards=document.querySelectorAll(".product-card"),this.productsGrid=document.getElementById("productsGrid"),!(!this.productsGrid||this.categoryButtons.length===0)&&(this.setupEventListeners(),setTimeout(()=>this.equalizeCardHeights(),300),D.log("Shop Page module initialized."))},setupEventListeners(){this.categoryButtons.forEach(n=>{n.addEventListener("click",e=>this.filterByCategory(e))}),window.addEventListener("resize",le(()=>this.equalizeCardHeights(),200))},filterByCategory(n){const e=n.currentTarget,t=e.dataset.category;D.log(`Filtering by category: ${t}`),this.categoryButtons.forEach(o=>o.classList.remove("active")),e.classList.add("active"),this.productCards.forEach(o=>{const i=o.dataset.category,s=t==="all"||i===t;o.classList.toggle("hidden",!s)}),setTimeout(()=>this.equalizeCardHeights(),50)},equalizeCardHeights(){const n=Array.from(this.productCards).filter(e=>!e.classList.contains("hidden"));n.length!==0&&(n.forEach(e=>{e.style.height="auto"}),requestAnimationFrame(()=>{const e=Math.max(...n.map(t=>t.offsetHeight));e>0&&n.forEach(t=>{t.style.height=`${e}px`})}))}};D.ready(()=>ce.init());console.log("🎨 [DBG] Comprehensive dynamic-background-loader.js loaded");console.log("🎨 [DBG] File loaded at:",new Date().toISOString());console.log("🎨 [DBG] Initial URL on file load:",window.location.href);console.log("🎨 [DBG] Initial pathname on file load:",window.location.pathname);async function de(){try{const n=await apiGet("/api/get_room_data.php");if(n.success){const e={room_main:"room_main",shop:"room_main",cart:"room_main",login:"room_main",admin:"room_main"};return n.data.roomDoors&&n.data.roomDoors.forEach(t=>{const o=`room${t.room_number}`;e[o]=o}),e}}catch(n){console.warn("[DynamicBackground] Failed to generate page-room map:",n)}return{room_main:"room_main",shop:"room_main",cart:"room_main",login:"room_main",admin:"room_main"}}async function B(){try{console.log("🎨 [DBG] === loadDynamicBackground() EXECUTION START ==="),console.log("🎨 [DBG] Function execution URL:",window.location.href),console.log("🎨 [DBG] Function execution pathname:",window.location.pathname),console.log("[DynamicBackground] Starting background load process..."),console.log("[DynamicBackground] WF_PAGE_INFO available:",!!window.WF_PAGE_INFO),console.log("[DynamicBackground] WF_PAGE_INFO contents:",window.WF_PAGE_INFO);let n="landing";if(window.WF_PAGE_INFO&&window.WF_PAGE_INFO.page)n=window.WF_PAGE_INFO.page,console.log(`[DynamicBackground] Using PHP-detected page: '${n}'`);else{console.warn("[DynamicBackground] WF_PAGE_INFO not found, using fallback detection");const c=window.location.pathname.split("/").filter(p=>p.length>0);c.length>0&&c[0]!=="index.php"&&(n=c[0]),console.log(`[DynamicBackground] Fallback detected page: '${n}'`)}const t=(await de())[n]||n;console.log(`[DynamicBackground] DEBUG URL: ${window.location.href}, pathname: ${window.location.pathname}`),console.log(`[DynamicBackground] Loading background for page: ${n}, roomType: ${t}`);const o=await apiGet(`/api/get_background.php?room_type=${t}`);if(!o.success||!o.background){console.log(`[DynamicBackground] No background found for ${t}`);return}const{image_filename:i,webp_filename:s}=o.background,d=document.documentElement.classList.contains("webp")&&s?s:i;let u=`images/backgrounds/${d}`;!u.includes("/backgrounds/")&&!d.startsWith("backgrounds/")&&(u=`images/${d}`);let r=document.querySelector(".fullscreen-container")||document.getElementById("mainContent")||document.querySelector(".main-content");r||(r=document.body),r.style.setProperty("--dynamic-bg-url",`url('${u}')`),r.style.setProperty("--dynamic-room-bg-url",`url('${u}')`),r.classList.add("bg-container","mode-fullscreen","dynamic-bg-loaded"),document.body.classList.add("dynamic-bg-active"),console.log(`[DynamicBackground] Background loaded successfully: ${u}`)}catch(n){console.error("[DynamicBackground] Error loading background:",n)}}window.loadDynamicBackground=B;document.readyState!=="loading"?B():document.addEventListener("DOMContentLoaded",B);console.log("🎯 Loading Simple Room Coordinate System...");typeof ROOM_TYPE<"u"&&(window.ROOM_TYPE||(window.ROOM_TYPE=ROOM_TYPE),window.roomType||(window.roomType=ROOM_TYPE));function A(n){console.log(`🎯 Initializing simple coordinate system for ${n}...`);const e=document.querySelector(".room-overlay-wrapper");if(!e){console.error("❌ Room overlay wrapper not found");return}console.log("✅ Room overlay wrapper found:",e),console.log(`📡 Fetching coordinates from /api/get_room_coordinates.php?room_type=${n}`),fetch(`/api/get_room_coordinates.php?room_type=${n}`).then(t=>(console.log("📡 Response received:",t.status,t.statusText),t.json())).then(t=>{console.log("📡 Data received:",t),t.success&&t.coordinates?(console.log("✅ Coordinates loaded:",t.coordinates),ue(t.coordinates)):console.error("❌ Failed to load coordinates:",t.message)}).catch(t=>{console.error("❌ Error loading coordinates:",t)})}function ue(n){console.log("🎯 Applying simple coordinates...");const e=window.innerWidth;let t;e<=480?t=400/1280:e<=768?t=800/1280:t=1600/1280,console.log(`📐 Screen width: ${e}px, Scale factor: ${t}`),n.forEach((o,i)=>{const s=document.getElementById(`item-icon-${i}`);if(s){const a=Math.round(o.top*t),d=Math.round(o.left*t),u=Math.round(o.width*t),r=Math.round(o.height*t);s.style.position="absolute",s.style.top=`${a}px`,s.style.left=`${d}px`,s.style.width=`${u}px`,s.style.height=`${r}px`,console.log(`✅ Item ${i}: positioned at ${d},${a} (${u}x${r})`)}else console.warn(`⚠️ Item ${i} not found`)})}window.simpleCoordinateSystem=A;document.addEventListener("DOMContentLoaded",function(){console.log("🎯 DOM loaded, checking for room type..."),console.log("🎯 Available window variables:",{ROOM_TYPE:window.ROOM_TYPE,roomType:window.roomType,roomNumber:window.roomNumber}),window.ROOM_TYPE?(console.log(`🎯 Room type found: ${window.ROOM_TYPE}`),A(window.ROOM_TYPE)):window.roomType?(console.log(`🎯 Room type found (fallback): ${window.roomType}`),A(window.roomType)):(console.log("⚠️ No room type found, waiting..."),setTimeout(()=>{console.log("🎯 Retrying after delay..."),console.log("🎯 Available window variables after delay:",{ROOM_TYPE:window.ROOM_TYPE,roomType:window.roomType,roomNumber:window.roomNumber}),window.ROOM_TYPE?(console.log(`🎯 Room type found after delay: ${window.ROOM_TYPE}`),A(window.ROOM_TYPE)):window.roomType?(console.log(`🎯 Room type found after delay (fallback): ${window.roomType}`),A(window.roomType)):console.error("❌ Still no room type found")},500))});window.addEventListener("resize",function(){console.log("🎯 Window resized, reapplying coordinates..."),window.ROOM_TYPE?A(window.ROOM_TYPE):window.roomType&&A(window.roomType)});window.apiGet=H.get;window.apiPost=H.post;window.apiRequest=H.request;console.log("[api-aliases] Global API aliases registered");(function(){if(typeof window>"u")return;async function n(e,t=window,o=5e3,i=100){const s=e.split("."),a=Date.now()+o;return new Promise(d=>{function u(){let r=t;for(const l of s)if(r&&l in r)r=r[l];else{r=null;break}if(typeof r=="function")return d(!0);if(Date.now()>a)return d(!1);setTimeout(u,i)}u()})}window.waitForFunction=n,console.log("[wait-for-function] Utility registered")})();(function(){function n(){try{const c=document.currentScript||[...document.querySelectorAll("script")].find(p=>p.src&&p.src.includes("global-item-modal"));if(c&&c.src)return c.src.substring(0,c.src.lastIndexOf("/")+1)}catch(c){console.warn("⚠️  getJsBase() failed to infer script base",c)}return"/js/"}let e=null,t=null;function o(){document.getElementById("globalModalContainer")?t=document.getElementById("globalModalContainer"):(t=document.createElement("div"),t.id="globalModalContainer",document.body.appendChild(t))}async function i(c,p=null){console.log("🔧 showGlobalItemModal called with SKU:",c,"itemData:",p);try{o(),console.log("🔧 Modal container initialized");let m,f;if(p)m=p,f=p.images||[],console.log("🔧 Using provided item data:",m);else{console.log("🔧 Fetching item data from API for SKU:",c);const w=await apiGet("/api/inventory.php");if(console.log("🔧 API response - found",w.length,"items"),m=w.find(b=>b.sku===c),!m)throw new Error(`Item with SKU ${c} not found`);f=[],console.log("🔧 Item data loaded:",m),console.log("🔧 Item price:",m.retailPrice),console.log("🔧 Item stock level:",m.stockLevel),console.log("🔧 All item fields:",Object.keys(m)),console.log("🔧 Full item data:",JSON.stringify(m,null,2)),console.log("🔧 Images loaded:",f.length,"images")}const g=document.getElementById("detailedItemModal");g&&(console.log("🔧 Removing existing modal"),g.remove()),console.log("🔧 Fetching modal HTML from render API"),console.log("🔧 Sending item to modal with stockLevel:",m.stockLevel),console.log("🔧 Full item being sent:",m);const y=await apiPost("render_detailed_modal.php",{item:m,images:f});if(!y||typeof y!="string")throw new Error("Modal render API returned invalid HTML");console.log("🔧 Modal HTML received, length:",y.length),console.log("🔧 Modal HTML preview:",y.substring(0,200)+"..."),t.innerHTML=y,console.log("🔧 Modal HTML inserted into container");const v=document.getElementById("detailedItemModal");console.log("🔧 Modal element found after insertion:",!!v),e=m,window.currentDetailedItem=m,console.log("🔧 Current modal item stored"),l(`${n()}detailed-item-modal.js?v=${Date.now()}`,"detailed-item-modal-script").then(()=>{console.log("🔧 Detailed item modal script loaded."),setTimeout(()=>{if(console.log("🔧 Attempting to show modal..."),typeof window.showDetailedModalComponent<"u")console.log("🔧 Using showDetailedModalComponent function"),window.showDetailedModalComponent(c,m);else{const w=document.getElementById("detailedItemModal");w&&(w.classList.remove("hidden"),w.style.display="flex")}setTimeout(()=>{typeof window.initializeEnhancedModalContent=="function"&&window.initializeEnhancedModalContent()},100)},50)}).catch(w=>{console.error("🔧 Failed to load detailed item modal script:",w)})}catch(m){console.error("🔧 Error in showGlobalItemModal:",m),typeof window.showError=="function"?window.showError("Unable to load item details. Please try again."):alert("Unable to load item details. Please try again.")}}function s(){const c=document.getElementById("detailedItemModal");c&&c.remove(),e=null}function a(c){c.target.id==="detailedItemModal"&&s()}function d(){return e}function u(c){typeof window.hidePopupImmediate=="function"&&window.hidePopupImmediate(),i(c.sku,c)}function r(){o(),window.WhimsicalFrog=window.WhimsicalFrog||{},window.WhimsicalFrog.GlobalModal={show:i,close:s,closeOnOverlay:a,getCurrentItem:d,quickAddToCart:u}}function l(c,p){return new Promise((m,f)=>{if(document.getElementById(p)){m();return}const g=document.createElement("script");g.src=c,g.id=p,g.onload=()=>m(),g.onerror=()=>f(new Error(`Script load error for ${c}`)),document.body.appendChild(g)})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",r):r(),window.showItemDetails=i,window.showItemDetailsModal=i,window.showDetailedModal=i,window.closeDetailedModal=s,window.closeDetailedModalOnOverlay=a,window.openQuantityModal=u,console.log("Global Item Modal system loaded")})();class Q{constructor(){this.overlay=null,this.modal=null,this.currentResolve=null,this.init()}init(){this.createModalHTML(),this.addEventListeners()}createModalHTML(){const e=document.getElementById("global-confirmation-modal");e&&e.remove(),this.overlay=document.createElement("div"),this.overlay.id="global-confirmation-modal",this.overlay.className="confirmation-modal-overlay",this.modal=document.createElement("div"),this.modal.className="confirmation-modal animate-slide-in-up",this.overlay.appendChild(this.modal),document.body.appendChild(this.overlay)}addEventListeners(){this.overlay.addEventListener("click",e=>{e.target===this.overlay&&this.close(!1)}),document.addEventListener("keydown",e=>{e.key==="Escape"&&this.overlay.classList.contains("show")&&this.close(!1)})}show(e={}){return new Promise(t=>{this.currentResolve=t;const{title:o="Confirm Action",message:i="Are you sure you want to proceed?",details:s=null,icon:a="⚠️",iconType:d="warning",confirmText:u="Confirm",cancelText:r="Cancel",confirmStyle:l="confirm",subtitle:c=null}=e;this.modal.innerHTML=`
                <div class="confirmation-modal-header">
                    <div class="confirmation-modal-icon ${d}">
                        ${a}
                    </div>
                    <h3 class="confirmation-modal-title">${o}</h3>
                    ${c?`<p class="confirmation-modal-subtitle">${c}</p>`:""}
                </div>
                <div class="confirmation-modal-body">
                    <div class="confirmation-modal-message">${i}</div>
                    ${s?`<div class="confirmation-modal-details">${s}</div>`:""}
                </div>
                <div class="confirmation-modal-footer">
                    <button class="confirmation-modal-button cancel" id="modal-cancel">
                        ${r}
                    </button>
                    <button class="confirmation-modal-button ${l}" id="modal-confirm">
                        ${u}
                    </button>
                </div>
            `,document.getElementById("modal-cancel").addEventListener("click",()=>{this.close(!1)}),document.getElementById("modal-confirm").addEventListener("click",()=>{this.close(!0)}),this.overlay.classList.add("show"),setTimeout(()=>{document.getElementById("modal-confirm").focus()},100)})}close(e){this.overlay.classList.remove("show"),setTimeout(()=>{this.currentResolve&&(this.currentResolve(e),this.currentResolve=null)},300)}}let N=null;document.addEventListener("DOMContentLoaded",()=>{N=new Q});window.showConfirmationModal=async n=>(N||(N=new Q),await N.show(n));window.confirmAction=async(n,e,t="Confirm")=>await showConfirmationModal({title:n,message:e,confirmText:t,icon:"⚠️",iconType:"warning"});window.confirmDanger=async(n,e,t="Delete")=>await showConfirmationModal({title:n,message:e,confirmText:t,confirmStyle:"danger",icon:"⚠️",iconType:"danger"});window.confirmInfo=async(n,e,t="Continue")=>await showConfirmationModal({title:n,message:e,confirmText:t,icon:"ℹ️",iconType:"info"});window.confirmSuccess=async(n,e,t="Proceed")=>await showConfirmationModal({title:n,message:e,confirmText:t,icon:"✅",iconType:"success"});window.confirmWithDetails=async(n,e,t,o={})=>await showConfirmationModal({title:n,message:e,details:t,...o});console.log("Loading WhimsicalFrog unified popup system...");const h={currentProduct:null,isVisible:!1,hideTimeout:null,popupElement:null,initialized:!1,isInRoomModal:!1};class pe{constructor(){this.init()}init(){h.initialized||(this.setupPopupElement(),this.setupEventListeners(),h.initialized=!0,console.log("✅ WhimsicalFrog Unified Popup System initialized"))}setupPopupElement(){h.popupElement=document.getElementById("productPopup")||document.getElementById("itemPopup"),h.popupElement||(console.log("Creating popup element..."),this.createPopupElement())}createPopupElement(){document.body.insertAdjacentHTML("beforeend",`
            <div id="itemPopup" class="item-popup">
                <div class="popup-content">
                    <div class="popup-header">
                        <div class="popup-image-container u-position-relative">
                            <img id="popupImage" class="popup-image" src="" alt="Product Image">
                            <!- Marketing Badge overlaying image ->
                            <div id="popupMarketingBadge" class="popup-marketing-badge hidden u-position-absolute u-top-6px u-right-6px u-z-index-10">
                                <span class="marketing-badge">
                                    <span id="popupMarketingText"></span>
                                </span>
                            </div>
                        </div>
                        <div class="popup-info">
                            <h3 id="popupTitle" class="popup-title"></h3>
                            <div id="popupMainSalesPitch" class="popup-main-sales-pitch"></div>
                            <p id="popupCategory" class="popup-category"></p>
                            <p id="popupSku" class="popup-sku"></p>
                            <div id="popupStock" class="popup-stock-info"></div>
                            <div id="popupCurrentPrice" class="popup-price"></div>
                        </div>
                    </div>
                    <div class="popup-body">
                        <p id="popupDescription" class="popup-description"></p>
                    </div>
                    <div class="popup-footer">
                        <button id="popupAddBtn" class="popup-btn popup-btn-primary">Add to Cart</button>

                    </div>
                </div>
            </div>
        `),h.popupElement=document.getElementById("itemPopup")}setupEventListeners(){const e=h.popupElement;if(!e)return;e.addEventListener("mouseenter",()=>{this.clearHideTimeout(),h.isVisible=!0}),e.addEventListener("mouseleave",()=>{this.hide()}),document.addEventListener("click",s=>{h.isVisible&&!e.contains(s.target)&&!s.target.closest(".item-icon")&&this.hideImmediate()});const t=e.querySelector(".popup-content")||e.querySelector(".popup-content-enhanced");t&&(t.addEventListener("click",s=>{s.preventDefault(),s.stopPropagation(),this.handleViewDetails()}),t.style.cursor="pointer");const o=e.querySelector("#popupImage");o&&(o.addEventListener("click",s=>{s.preventDefault(),s.stopPropagation(),this.handleViewDetails()}),o.style.cursor="pointer");const i=e.querySelector("#popupAddBtn");i&&i.addEventListener("click",s=>{s.preventDefault(),s.stopPropagation(),this.handleViewDetails()})}show(e,t){console.log("Showing popup for:",e,t),h.initialized||(console.warn("Popup system not initialized, initializing now..."),this.init());const o=h.popupElement;if(!o){console.error("Popup element not found!");return}this.clearHideTimeout(),this.hideImmediate(),this.clearProductState(),h.currentProduct=t,h.isVisible=!0,h.isInRoomModal=document.querySelector(".room-modal-overlay")!==null,window.isShowingPopup=!0,window.popupOpen=!0,window.currentItem=t;const i=e?.ownerDocument||document;if(i!==document){h.inIframeDoc=!0;const a="popup-root";let d=i.getElementById(a);d||(d=i.createElement("div"),d.id=a,i.body.appendChild(d)),d.appendChild(o),o.classList.add("in-room-modal")}else h.inIframeDoc=!1,o.parentNode!==document.body&&(document.body.appendChild(o),o.classList.remove("in-room-modal"));this.updateContent(t),this.positionPopup(e,o),console.log("Popup should now be visible")}updateContent(e){const t=h.popupElement;if(!t)return;const o=t.querySelector("#popupMarketingBadge");o&&o.classList.add("hidden");const i=t.querySelector("#popupImage"),s=t.querySelector("#popupTitle"),a=t.querySelector("#popupMainSalesPitch"),d=t.querySelector("#popupCategory"),u=t.querySelector("#popupSku"),r=t.querySelector("#popupStock"),l=t.querySelector("#popupCurrentPrice"),c=t.querySelector("#popupDescription");if(t.querySelector("#popupSalesPitch"),i&&(i.src=`images/items/${e.sku}A.webp`,typeof window.setupImageErrorHandling=="function"?window.setupImageErrorHandling(i,e.sku):i.onerror=function(){this.src="images/items/placeholder.webp",this.onerror=null}),s&&(s.textContent=e.name||e.productName||"Item"),d&&(d.textContent=e.category||"Item"),u&&(u.textContent=`SKU: ${e.sku}`),r){const p=parseInt(e.stockLevel||e.stock||0);p<=0?(r.textContent="Out of Stock",r.className="popup-stock-info out-of-stock"):p<=5?(r.textContent=`${p} Left`,r.className="popup-stock-info limited-stock"):(r.textContent="In Stock",r.className="popup-stock-info in-stock")}l&&(typeof window.checkAndDisplaySalePrice=="function"?window.checkAndDisplaySalePrice(e,l):l.textContent=`$${parseFloat(e.retailPrice||e.price||0).toFixed(2)}`),c&&(c.textContent=e.description||""),e.sku&&this.loadMarketingData(e.sku,null,a)}async loadMarketingData(e,t,o){try{const i=await apiGet(`get_marketing_data.php?sku=${e}`);if(i.success&&i.exists&&i.marketing_data){const s=i.marketing_data;this.displayMarketingBadge(s),this.displayMainSalesPitch(s,o)}else this.displayGenericMarketingContent(o)}catch(i){console.log("Marketing data not available:",i),this.displayGenericMarketingContent(o)}}displayMainSalesPitch(e,t){if(!t)return;let o="";e.selling_points&&e.selling_points.length>0?o=e.selling_points[0]:e.competitive_advantages&&e.competitive_advantages.length>0?o=e.competitive_advantages[0]:e.customer_benefits&&e.customer_benefits.length>0&&(o=e.customer_benefits[0]),o?t.innerHTML=`<div class="popup-main-pitch">${o}</div>`:t.innerHTML=""}displayMarketingBadge(e){const t=h.popupElement;if(!t)return;const o=t.querySelector("#popupMarketingBadge"),i=t.querySelector("#popupMarketingText");if(!o||!i)return;let s="";e.badges&&e.badges.length>0?s=e.badges[0].text||e.badges[0]:e.primary_badge&&(s=e.primary_badge),s?(i.textContent=s,o.classList.remove("hidden"),o.style.display="block"):(o.classList.add("hidden"),o.style.display="none")}displayGenericMarketingContent(e){if(console.log("🚫 Old popup generic marketing system disabled - using unified system instead"),e){const t=["✨ Experience premium quality and exceptional style!","🌟 Discover the perfect addition to your collection!","💎 Elevate your look with this must-have piece!","🔥 Join the style revolution with this trendy item!","⭐ Transform your wardrobe with superior craftsmanship!"],o=t[Math.floor(Math.random()*t.length)];e.innerHTML=`<div class="popup-main-pitch">${o}</div>`}}hide(e=600){h.isVisible&&(this.clearHideTimeout(),h.hideTimeout=setTimeout(()=>{this.hideImmediate()},e))}hideImmediate(){const e=document.querySelector(".room-modal-overlay.popup-active");e&&e.classList.remove("popup-active");try{if(window.parent&&window.parent!==window){const o=window.parent.document.querySelector(".room-modal-overlay");o&&o.classList.remove("popup-active")}}catch{}this.clearHideTimeout();const t=h.popupElement;t&&(t.classList.remove("show","in-room-modal","visible","positioned"),t.classList.add("hidden")),h.isVisible=!1,window.popupOpen=!1,window.isShowingPopup=!1,console.log("Popup hidden immediately")}clearProductState(){h.currentProduct=null,window.currentItem=null}clearHideTimeout(){h.hideTimeout&&(clearTimeout(h.hideTimeout),h.hideTimeout=null)}handleAddToCart(){console.log("🔧 handleAddToCart called, currentProduct:",h.currentProduct);const e=h.currentProduct||window.currentItem;if(!e){console.error("🔧 No current product in popup state or global state!");return}console.log("🔧 About to hide popup and open modal for SKU:",e.sku);const t=e.sku;this.hideImmediate();let o=window.showGlobalItemModal;typeof o!="function"&&window.parent&&window.parent!==window&&(o=window.parent.showGlobalItemModal),typeof o!="function"&&window.WhimsicalFrog&&window.WhimsicalFrog.GlobalModal&&typeof window.WhimsicalFrog.GlobalModal.show=="function"&&(o=window.WhimsicalFrog.GlobalModal.show),typeof o!="function"&&window.parent&&window.parent.WhimsicalFrog&&window.parent.WhimsicalFrog.GlobalModal&&typeof window.parent.WhimsicalFrog.GlobalModal.show=="function"&&(o=window.parent.WhimsicalFrog.GlobalModal.show),typeof o=="function"?(console.log("🔧 showGlobalItemModal function available, calling with SKU:",t),o(t,e),this.clearProductState()):console.error("🔧 showGlobalItemModal function not available in current or parent context!")}async handleViewDetails(){if(console.log("🔧 handleViewDetails called, currentProduct:",h.currentProduct),!h.currentProduct)return;console.log(`🔧 About to hide popup and open details modal for SKU: ${h.currentProduct.sku}`),this.hideImmediate();const e="WhimsicalFrog.GlobalModal.show";let t=await window.waitForFunction(e,window);if(t){window.WhimsicalFrog.GlobalModal.show(h.currentProduct.sku,h.currentProduct);return}if(window.parent&&window.parent!==window&&(t=await window.waitForFunction(e,window.parent),t)){window.parent.WhimsicalFrog.GlobalModal.show(h.currentProduct.sku,h.currentProduct);return}console.error(`🔧 ${e} function not available in current or parent context!`),typeof window.showGlobalNotification=="function"&&window.showGlobalNotification("Could not open item details. Please try again.","error")}positionPopup(e,t){try{window.parent&&window.parent!==window&&window.parent.document.querySelector(".room-modal-overlay")&&(h.isInRoomModal=!0)}catch{}const o=e.getBoundingClientRect(),i=window.innerWidth,s=window.innerHeight,a=getComputedStyle(document.documentElement),d=h.isInRoomModal,u=document.querySelector(".room-modal-overlay"),r=T=>{const C=parseInt(T,10);return isNaN(C)?0:C},l=r(a.getPropertyValue("--popup-z-index").trim()||"2600"),c=r(a.getPropertyValue("--z-index-page-header").trim()||"0"),p=document.querySelector(".site-header")||document.querySelector(".site-header.universal-page-header"),m=p?r(getComputedStyle(p).zIndex||"0"):0,f=parseInt(a.getPropertyValue("--z-room-modals").trim()||"2400",10),g=Math.max(l,c,m)+1,y=d?f+1:g;d?(t.classList.add("in-room-modal"),u?.classList.add("popup-active")):(t.classList.remove("in-room-modal"),u?.classList.remove("popup-active"));const v=5;let w=a.getPropertyValue("--popup-max-width").trim()||"450px";if(d){let T=i;try{const P=window.parent?.document.querySelector(".room-modal-container")?.getBoundingClientRect();P&&(T=P.width)}catch{}const C=Math.max(200,T-v*2);t.style.maxWidth=`${C}px`,t.style.width="auto",t.style.minWidth="0"}else t.style.maxWidth=w;t.classList.remove("hidden"),t.classList.add("measuring"),t.style.zIndex=y;const b=t.getBoundingClientRect(),S=Math.min(b.width,parseInt(w)||b.width),_=b.height;let E={left:0,top:0,width:i,height:s};if(d)try{const T=window.parent?.document.querySelector(".room-modal-container");if(T){const C=T.getBoundingClientRect();E={left:C.left,top:C.top,width:C.width,height:C.height}}}catch{}let x=o.right-E.left+v;x+S+v>E.width&&(x=o.left-E.left-S-v,x<v&&(x=v));let M=o.top-E.top+o.height/2-_/2;const O=parseInt(a.getPropertyValue("--header-height").trim()||"0",10);let W=0;p&&(W=p.getBoundingClientRect().height);const R=Math.max(O,W)+v;x=Math.max(v,Math.min(x,E.width-S-v)),M<R&&(M=R),M+_+v>E.height&&(M=E.height-_-v),M=Math.max(R,Math.min(M,E.height-_-v)),d&&console.log("[PopupDebug] rect:",o,"containerRect:",E,"left(before clamp):",x,"top(before clamp):",M,"popupSize:",S,_),d||(x+=E.left,M+=E.top),t.style.setProperty("--popup-left",`${x}px`),t.style.setProperty("--popup-top",`${M}px`),t.classList.remove("measuring"),t.classList.add("positioned","visible","show"),console.log("Popup positioned",{left:x,top:M})}registerGlobalFunctions(){window.showGlobalPopup=(e,t)=>this.show(e,t),window.hideGlobalPopup=(e=600)=>this.hide(e),window.hideGlobalPopupImmediate=()=>this.hideImmediate(),window.clearPopupTimeout=()=>this.clearHideTimeout(),window.showPopup=window.showGlobalPopup,window.hidePopup=window.hideGlobalPopup,window.hidePopupImmediate=window.hideGlobalPopupImmediate,console.log("✅ Global popup functions registered")}getState(){return{isVisible:h.isVisible,currentProduct:h.currentProduct,isInRoomModal:h.isInRoomModal,initialized:h.initialized}}}const V=new pe;typeof V.registerGlobalFunctions=="function"&&V.registerGlobalFunctions();window.globalPopupTimeout=null;window.isShowingPopup=!1;window.popupOpen=!1;window.currentItem=null;console.log("🎉 WhimsicalFrog Unified Popup System ready!");class me{constructor(){this.notifications=new Map,this.nextId=1,this.container=null,this.initialized=!1,this.init()}init(){this.initialized||(this.container||(this.container=document.createElement("div"),this.container.id="wf-notification-container",this.container.className="wf-notification-container",this.container.style.cssText=`
                position: var(-notification-container-position, fixed);
                top: var(-notification-container-top, 24px);
                right: var(-notification-container-right, 24px);
                z-index: var(-notification-container-zindex, 2147483647);
                pointer-events: none;
                max-width: var(-notification-container-width, 420px);
                width: 100%;
            `,document.body.appendChild(this.container)),this.initialized=!0,console.log("✅ WhimsicalFrog Unified Notification System initialized"))}show(e,t="info",o={}){this.initialized||(console.warn("Notification system not initialized, initializing now..."),this.init());const{title:i=null,duration:s=this.getDefaultDuration(t),persistent:a=!1,actions:d=null,autoHide:u=!0}=o,r=this.nextId++,l=this.createNotification(r,e,t,i,a,d);return this.container.appendChild(l),this.notifications.set(r,l),requestAnimationFrame(()=>{l.style.opacity="1",l.style.transform="var(-notification-transform-show, translateX(0) scale(1))"}),!a&&u&&s>0&&setTimeout(()=>{this.remove(r)},s),r}createNotification(e,t,o,i,s,a){const d=document.createElement("div");return d.className=`wf-notification wf-${o}-notification`,d.dataset.id=e,d.dataset.type=o,d.addEventListener("click",u=>{console.log(`Notification ${e} clicked - removing`),u.preventDefault(),u.stopPropagation(),this.remove(e)}),d.addEventListener("mousedown",u=>{console.log(`Notification ${e} mousedown event`)}),d.title="Click to dismiss",d.innerHTML=`
            <div class="wf-notification-content">
                <div class="wf-notification-icon">
                    ${this.getTypeIcon(o)}
                </div>
                <div class="wf-notification-body">
                    ${i?`<div class="wf-notification-title">${i}</div>`:""}
                    <div class="wf-notification-message">
                        ${t}
                    </div>
                    ${a?this.createActions(a):""}
                </div>
                ${s?"":`
                    <button class="wf-notification-close" onclick="event.stopPropagation(); window.wfNotifications.remove(${e})">&times;</button>
                `}
            </div>
        `,(o==="warning"||o==="error")&&setTimeout(()=>{d.parentElement&&(d.classList.add("pulse"),setTimeout(()=>{d.classList.remove("pulse")},150))},200),d}createActions(e){return!e||!Array.isArray(e)?"":`
            <div class="wf-notification-actions">
                ${e.map(t=>`
                    <button onclick="${t.onClick}" class="wf-notification-action ${t.style==="primary"?"primary":"secondary"}">
                        ${t.text}
                    </button>
                `).join("")}
            </div>
        `}getTypeConfig(e){const t={success:{background:"#87ac3a",border:"#6b8e23",color:"white",titleColor:"white",closeColor:"white",shadow:"rgba(135, 172, 58, 0.3)",icon:"✅"},error:{background:"linear-gradient(135deg, #fee2e2, #fecaca)",border:"#ef4444",color:"#7f1d1d",titleColor:"#dc2626",closeColor:"#ef4444",shadow:"rgba(239, 68, 68, 0.2)",icon:"❌"},warning:{background:"linear-gradient(135deg, #fef3c7, #fde68a)",border:"#f59e0b",color:"#92400e",titleColor:"#d97706",closeColor:"#f59e0b",shadow:"rgba(245, 158, 11, 0.2)",icon:"⚠️"},info:{background:"linear-gradient(135deg, #dbeafe, #bfdbfe)",border:"#3b82f6",color:"#1e3a8a",titleColor:"#2563eb",closeColor:"#3b82f6",shadow:"rgba(59, 130, 246, 0.2)",icon:"ℹ️"},validation:{background:"linear-gradient(135deg, #fef3c7, #fde68a)",border:"#f59e0b",color:"#92400e",titleColor:"#d97706",closeColor:"#f59e0b",shadow:"rgba(245, 158, 11, 0.2)",icon:"⚠️"}};return t[e]||t.info}getDefaultDuration(e){return 5e3}remove(e){console.log(`Attempting to remove notification ${e}`);const t=this.notifications.get(e);t&&t.parentElement?(console.log(`Removing notification ${e} from DOM`),t.style.opacity="0",t.style.transform="var(-notification-transform-enter, translateX(100%) scale(0.9))",setTimeout(()=>{t.parentElement&&(t.remove(),console.log(`Notification ${e} removed from DOM`)),this.notifications.delete(e),console.log(`Notification ${e} deleted from memory`)},400)):console.log(`Notification ${e} not found or already removed`)}removeAll(){this.notifications.forEach((e,t)=>{this.remove(t)})}success(e,t={}){return this.show(e,"success",t)}error(e,t={}){return this.show(e,"error",t)}warning(e,t={}){return this.show(e,"warning",t)}info(e,t={}){return this.show(e,"info",t)}validation(e,t={}){return this.show(e,"validation",t)}getFallbackColor(e,t){const o={success:{background:"linear-gradient(135deg, #87ac3a, #6b8e23)",border:"#556B2F",text:"#ffffff"},error:{background:"linear-gradient(135deg, #dc2626, #b91c1c)",border:"#991b1b",text:"#ffffff"},warning:{background:"linear-gradient(135deg, #f59e0b, #d97706)",border:"#b45309",text:"#ffffff"},info:{background:"linear-gradient(135deg, #3b82f6, #2563eb)",border:"#1d4ed8",text:"#ffffff"},validation:{background:"linear-gradient(135deg, #f59e0b, #d97706)",border:"#b45309",text:"#ffffff"}};return o[e]?.[t]||o.info[t]}getFallbackShadow(e){const t={success:"0 12px 28px rgba(135, 172, 58, 0.35), 0 4px 8px rgba(135, 172, 58, 0.15)",error:"0 12px 28px rgba(220, 38, 38, 0.35), 0 4px 8px rgba(220, 38, 38, 0.15)",warning:"0 12px 28px rgba(245, 158, 11, 0.35), 0 4px 8px rgba(245, 158, 11, 0.15)",info:"0 12px 28px rgba(59, 130, 246, 0.35), 0 4px 8px rgba(59, 130, 246, 0.15)",validation:"0 12px 28px rgba(245, 158, 11, 0.35), 0 4px 8px rgba(245, 158, 11, 0.15)"};return t[e]||t.info}getTypeIcon(e){const t={success:"✅",error:"❌",warning:"⚠️",info:"ℹ️",validation:"⚠️"};return t[e]||t.info}}window.wfNotifications=new me;function he(){window._wfNotificationFunctionsRegistered||(window.showNotification=(n,e="info",t={})=>window.wfNotifications.show(n,e,t),window.showSuccess=(n,e={})=>window.wfNotifications.success(n,e),window.showError=(n,e={})=>window.wfNotifications.error(n,e),window.showWarning=(n,e={})=>window.wfNotifications.warning(n,e),window.showInfo=(n,e={})=>window.wfNotifications.info(n,e),window.showValidation=(n,e={})=>window.wfNotifications.validation(n,e),window._wfNotificationFunctionsRegistered=!0,console.log("📢 WhimsicalFrog notification functions registered globally"))}he();window._wfAlertOverridden||(window.alert=function(n){n.includes("added to your cart")||n.includes("added to cart")?window.wfNotifications.success(n):window.wfNotifications.info(n)},window._wfAlertOverridden=!0);window.showToast||(window.showToast=(n,e=null,t={})=>{let o,i;return e===null?(o=n,i="info"):typeof n=="string"&&["success","error","warning","info"].includes(n)?(i=n,o=e):(o=n,i=e||"info"),window.wfNotifications.show(o,i,t)});window.hideNotification=n=>window.wfNotifications.remove(n);window.clearNotifications=()=>window.wfNotifications.removeAll();window.cart&&typeof window.cart=="object"&&(window.cart.showNotification=n=>window.wfNotifications.success(n),window.cart.showErrorNotification=n=>window.wfNotifications.error(n),window.cart.showValidationError=n=>window.wfNotifications.validation(n));console.log("🎉 WhimsicalFrog Unified Notification System ready!");console.log("Loading modal-manager.js...");console.log("modal-manager.js loaded successfully");document.addEventListener("DOMContentLoaded",function(){const n=document.getElementById("landingPage");if(!n)return;if(document.body.classList.add("mode-fullscreen"),console.log("🎯 Landing page positioning script loaded"),window.innerWidth<1e3){console.log("🎯 Mobile layout detected, skipping JS positioning");const a=document.querySelector(".area-1");a&&a.setAttribute("href","/shop");return}const e=1280,t=896;let o=[];try{o=JSON.parse(n.dataset.coords||"[]")}catch(a){console.error("Error parsing landing page coordinates:",a);return}const i=o.map(a=>({selector:a.selector.startsWith(".")?a.selector:"."+a.selector,top:a.top,left:a.left,width:a.width,height:a.height}));function s(){const a=window.innerWidth,d=window.innerHeight,u=a/d,r=e/t;let l,c,p;u>r?(l=d/t,c=(a-e*l)/2,p=0):(l=a/e,p=(d-t*l)/2,c=0),i.forEach(m=>{const f=document.querySelector(m.selector);f&&(f.style.top=`${m.top*l+p}px`,f.style.left=`${m.left*l+c}px`,f.style.width=`${m.width*l}px`,f.style.height=`${m.height*l}px`)})}s(),window.addEventListener("resize",s)});console.log("Loading room-main.js...");class fe{constructor(){this.initialized=!1,this.init()}init(){this.initialized||(console.log("🐸 Room Main: Initializing..."),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>this.setup()):this.setup(),this.initialized=!0)}setup(){this.setupBackground(),this.setupDoors(),this.setupNavigation(),this.setupBodyStyles(),this.setupModalAutoOpen(),this.setupCleanup(),console.log("🐸 Room Main: Initialization complete"),setTimeout(()=>{this.performFinalDiagnostics()},1e3)}setupBackground(){const e=document.getElementById("mainRoomPage");if(e){const t=e.getAttribute("data-bg-url");t&&(e.style.setProperty("--dynamic-room-bg-url",`url('${t}')`),console.log("🖼️ Main room background loaded:",t))}}setupDoors(){const e=document.querySelectorAll(".door-area");console.log(`🚪 Found ${e.length} door elements`),this.checkRoomModalManager(),e.forEach((t,o)=>{t.style.cursor="pointer",t.style.pointerEvents="auto",t.setAttribute("tabindex","0"),t.setAttribute("role","button"),t.setAttribute("aria-label",`Open ${t.dataset.category||"room"}`),console.log(`🚪 Door ${o+1}:`,{element:t,room:t.dataset.room,category:t.dataset.category,url:t.dataset.url,hasDataRoom:t.hasAttribute("data-room"),classes:t.className}),t.addEventListener("click",i=>{console.log("🚪 DOOR CLICKED:",{element:t,roomNumber:t.dataset.room,category:t.dataset.category,event:i,timestamp:new Date().toISOString(),roomModalManagerAvailable:!!(window.WF_RoomModal||window.RoomModalManager||window.roomModalManager)}),i.defaultPrevented?console.log("🚪 Click event was prevented by another handler"):console.log("🚪 Click event is not prevented, should be handled by RoomModalManager")}),t.addEventListener("keydown",i=>{(i.key==="Enter"||i.key===" ")&&(i.preventDefault(),console.log("🚪 KEYBOARD ACTIVATION:",{key:i.key,roomNumber:t.dataset.room,element:t}),t.click())})}),console.log("🚪 Door positioning and accessibility configured")}setupNavigation(){const e=document.querySelector("nav.main-nav");e&&(e.classList.add("site-header"),console.log("🧭 Navigation configured for room overlay"))}setupBodyStyles(){document.body.style.overflow="hidden",console.log("🚪 Body styles configured for fullscreen mode")}setupModalAutoOpen(){const t=new URLSearchParams(window.location.search).get("modal_room");if(t){const o=()=>{window.roomModalManager?(console.log(`🚪 Auto-opening modal for room: ${t}`),window.roomModalManager.show(t)):setTimeout(o,100)};setTimeout(o,500)}}setupCleanup(){window.addEventListener("beforeunload",()=>{document.body.style.overflow=""})}checkRoomModalManager(){console.log("🔍 Checking RoomModalManager availability...");const e={"window.WF_RoomModal":window.WF_RoomModal,"window.RoomModalManager (class)":window.RoomModalManager,"window.roomModalManager (instance)":window.roomModalManager,"WhimsicalFrog.modules":window.WhimsicalFrog?.modules,"WhimsicalFrog module room-modal-manager":window.WhimsicalFrog?.modules?.["room-modal-manager"]};if(console.log("🔍 RoomModalManager availability check:",e),!window.roomModalManager&&window.RoomModalManager){console.log("🚨 FORCING RoomModalManager instantiation as failsafe...");try{const t=new window.RoomModalManager;return window.roomModalManager=t,window.WF_RoomModal=t,console.log("✅ RoomModalManager forcefully created:",t),setTimeout(()=>{this.testModalSystem()},500),!0}catch(t){return console.error("❌ Failed to create RoomModalManager:",t),!1}}return Object.values(e).some(t=>t!=null)}testModalSystem(){console.log("🧪 TESTING MODAL SYSTEM..."),window.roomModalManager&&typeof window.roomModalManager.openRoom=="function"?console.log("✅ Modal manager has openRoom method"):console.error("❌ Modal manager missing openRoom method")}performFinalDiagnostics(){console.log("🔬 ROOM MAIN FINAL DIAGNOSTICS:"),console.log("==================================");const e=document.querySelectorAll(".door-area");console.log(`🚪 Total doors found: ${e.length}`),e.forEach((o,i)=>{const s=o.getBoundingClientRect();console.log(`🚪 Door ${i+1} diagnostic:`,{visible:s.width>0&&s.height>0,position:{x:s.x,y:s.y,width:s.width,height:s.height},zIndex:window.getComputedStyle(o).zIndex,pointerEvents:window.getComputedStyle(o).pointerEvents,dataRoom:o.dataset.room,hasClickListener:o.onclick!==null||o.hasAttribute("onclick")})});const t=this.checkRoomModalManager();console.log(`🔍 RoomModalManager final status: ${t?"FOUND":"NOT FOUND"}`),console.log("🎯 Document click listeners check complete"),console.log("=================================="),console.log("🎯 Click on any door now to see detailed logging")}}const ge=window.location.pathname.includes("/room")||window.location.pathname.includes("room_main")||document.getElementById("mainRoomPage")!==null;if(ge){const n=new fe;window.roomMainManager=n,window.WhimsicalFrog&&typeof WhimsicalFrog.ready=="function"&&WhimsicalFrog.ready(e=>{e.addModule("RoomMainManager",n)}),console.log("Room Main Manager loaded and initialized for room page")}else console.log("Room Main Manager skipped - not on a room page");class ee{constructor(){this.sessionStartTime=Date.now(),this.pageStartTime=Date.now(),this.lastScrollPosition=0,this.maxScrollDepth=0,this.interactions=[],this.isTracking=!0,this.init()}init(){this.trackVisit(),this.trackPageView(),this.setupEventListeners(),this.setupPageExitTracking(),this.startPeriodicTracking()}trackVisit(){const e={landing_page:window.location.href,referrer:document.referrer,timestamp:Date.now()};this.sendData("track_visit",e)}trackPageView(){const e={page_url:window.location.href,page_title:document.title,page_type:this.getPageType(),item_sku:this.getItemSku(),timestamp:Date.now()};this.sendData("track_page_view",e)}getPageType(){const t=new URLSearchParams(window.location.search).get("page")||"landing";return t==="shop"?"shop":t.startsWith("room")?"product_room":t==="cart"?"cart":t==="admin"?"admin":t==="landing"?"landing":"other"}getItemSku(){const e=new URLSearchParams(window.location.search);if(e.get("product"))return e.get("product");if(e.get("sku"))return e.get("sku");if(e.get("item"))return e.get("item");if(e.get("edit"))return e.get("edit");const t=document.querySelectorAll("[data-product-id], [data-sku], [data-item-sku]");return t.length>0?t[0].dataset.productId||t[0].dataset.sku||t[0].dataset.itemSku:null}setupEventListeners(){document.addEventListener("click",o=>{this.trackInteraction("click",o)}),document.addEventListener("submit",o=>{this.trackInteraction("form_submit",o)});let e;window.addEventListener("scroll",()=>{clearTimeout(e),e=setTimeout(()=>{this.trackScroll()},100)}),document.querySelectorAll('input[type="search"], input[name*="search"]').forEach(o=>{o.addEventListener("input",i=>{i.target.value.length>2&&this.trackInteraction("search",i)})}),this.setupCartTracking(),this.setupItemTracking()}setupCartTracking(){document.addEventListener("click",t=>{if(t.target.classList.contains("add-to-cart-btn")||t.target.closest(".add-to-cart-btn")){const o=t.target.classList.contains("add-to-cart-btn")?t.target:t.target.closest(".add-to-cart-btn"),i=o.dataset.productId||o.dataset.sku;this.trackCartAction("add",i),this.trackInteraction("cart_add",t,{item_sku:i})}}),document.addEventListener("click",t=>{if(t.target.classList.contains("remove-from-cart")||t.target.closest(".remove-from-cart")){const o=t.target.classList.contains("remove-from-cart")?t.target:t.target.closest(".remove-from-cart"),i=o.dataset.productId||o.dataset.sku;this.trackCartAction("remove",i),this.trackInteraction("cart_remove",t,{item_sku:i})}}),document.querySelectorAll('[onclick*="checkout"], .checkout-btn').forEach(t=>{t.addEventListener("click",()=>{this.trackInteraction("checkout_start",null)})})}setupItemTracking(){document.querySelectorAll(".product-card, .product-item, .item-card, .item-item").forEach(t=>{let o=null;new IntersectionObserver(s=>{s.forEach(a=>{if(a.isIntersecting)o=Date.now();else if(o){const d=Date.now()-o,u=t.dataset.productId||t.dataset.sku;u&&d>1e3&&this.trackItemView(u,d),o=null}})},{threshold:.5}).observe(t)}),document.addEventListener("click",t=>{const o=t.target.closest(".product-card, .product-item, .item-card, .item-item");if(o){const i=o.dataset.productId||o.dataset.sku;i&&this.trackInteraction("click",t,{item_sku:i,element_type:"item"})}})}trackInteraction(e,t,o={}){if(!this.isTracking)return;let i={};t&&t.target&&(i={element_type:t.target.tagName.toLowerCase(),element_id:t.target.id,element_text:t.target.textContent?.substring(0,100)||"",element_class:t.target.className});const s={page_url:window.location.href,interaction_type:e,...i,interaction_data:{timestamp:Date.now(),page_x:t?.clientX||0,page_y:t?.clientY||0,...o},item_sku:o.item_sku||this.getItemSku()};this.sendData("track_interaction",s)}trackScroll(){const e=window.pageYOffset||document.documentElement.scrollTop,t=document.documentElement.scrollHeight-window.innerHeight,o=Math.round(e/t*100);o>this.maxScrollDepth&&(this.maxScrollDepth=o,o>=25&&this.maxScrollDepth<25?this.trackInteraction("scroll",null,{scroll_depth:25}):o>=50&&this.maxScrollDepth<50?this.trackInteraction("scroll",null,{scroll_depth:50}):o>=75&&this.maxScrollDepth<75?this.trackInteraction("scroll",null,{scroll_depth:75}):o>=90&&this.maxScrollDepth<90&&this.trackInteraction("scroll",null,{scroll_depth:90}))}trackItemView(e,t){const o={item_sku:e,time_on_page:Math.round(t/1e3)};this.sendData("track_item_view",o)}trackCartAction(e,t){if(!t)return;const o={item_sku:t,action:e};this.sendData("track_cart_action",o)}setupPageExitTracking(){window.addEventListener("beforeunload",()=>{this.trackPageExit()}),document.addEventListener("visibilitychange",()=>{document.hidden?this.trackPageExit():this.pageStartTime=Date.now()})}trackPageExit(){const e=Math.round((Date.now()-this.pageStartTime)/1e3),t={page_url:window.location.href,time_on_page:e,scroll_depth:this.maxScrollDepth,item_sku:this.getItemSku()};this.sendDataSync("track_page_view",t)}startPeriodicTracking(){setInterval(()=>{document.hidden||this.trackPageView()},3e4)}sendData(e,t){this.isTracking&&apiPost(`/api/analytics_tracker.php?action=${e}`,t).catch(o=>{console.warn("Analytics tracking failed:",o)})}sendDataSync(e,t){const o=new FormData;o.append("action",e),o.append("data",JSON.stringify(t)),navigator.sendBeacon?navigator.sendBeacon(`/api/analytics_tracker.php?action=${e}`,o):this.sendData(e,t)}trackConversion(e=0,t=null){const o={conversion_value:e,order_id:t,page_url:window.location.href};this.trackInteraction("checkout_complete",null,o)}trackCustomEvent(e,t={}){this.trackInteraction("custom",null,{event_name:e,...t})}enableTracking(){this.isTracking=!0}disableTracking(){this.isTracking=!1}}document.addEventListener("DOMContentLoaded",function(){localStorage.getItem("analytics_opt_out")!=="true"&&(window.analyticsTracker=new ee)});window.trackConversion=function(n,e){window.analyticsTracker&&window.analyticsTracker.trackConversion(n,e)};window.trackCustomEvent=function(n,e){window.analyticsTracker&&window.analyticsTracker.trackCustomEvent(n,e)};window.optOutOfAnalytics=function(){localStorage.setItem("analytics_opt_out","true"),window.analyticsTracker&&window.analyticsTracker.disableTracking()};window.optInToAnalytics=function(){localStorage.removeItem("analytics_opt_out"),window.analyticsTracker?window.analyticsTracker.enableTracking():window.analyticsTracker=new ee};(function(){let e=null,t=null,o=null;function i(){if(e&&t)return;e=document.createElement("div"),e.id="wf-login-overlay",e.className="wf-login-overlay",t=document.createElement("div"),t.id="wf-login-modal",t.className="wf-login-modal",t.innerHTML=`
      <div class="wf-login-card">
        <button type="button" class="wf-login-close" aria-label="Close">×</button>
        <h3 class="wf-login-title">Sign in</h3>
        <form id="wfLoginForm" class="wf-login-form">
          <label class="wf-field">
            <span class="wf-label">Username</span>
            <input type="text" name="username" autocomplete="username" required class="wf-input" />
          </label>
          <label class="wf-field">
            <span class="wf-label">Password</span>
            <input type="password" name="password" autocomplete="current-password" required class="wf-input" />
          </label>
          <button type="submit" class="wf-btn wf-btn-primary">Login</button>
        </form>
      </div>`,e.appendChild(t),document.body.appendChild(e),e.addEventListener("click",c=>{c.target===e&&a()}),t.querySelector(".wf-login-close").addEventListener("click",a),document.addEventListener("keydown",c=>{c.key==="Escape"&&e.classList.contains("show")&&a()}),t.querySelector("#wfLoginForm").addEventListener("submit",d)}function s(l){i(),o=l||window.location.pathname+window.location.search+window.location.hash;try{sessionStorage.setItem("wf_login_return_to",o)}catch{}e.classList.add("show");const c=t.querySelector('input[name="username"]');c&&c.focus()}function a(){e&&e.classList.remove("show")}async function d(l){l.preventDefault();const c=l.currentTarget,p=c.username.value.trim(),m=c.password.value;if(!p||!m){window.showValidation&&window.showValidation("Please enter username and password.");return}const f=c.querySelector('button[type="submit"]');f.disabled=!0,f.textContent="Logging in…";try{const g=await fetch("/functions/process_login.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:p,password:m})});if(!g.ok){const b=await u(g);throw new Error(b?.error||"Login failed.")}let w=(await g.json())?.redirectUrl;if(!w)try{w=sessionStorage.getItem("wf_login_return_to")}catch{}w||(w=window.location.pathname||"/"),window.showSuccess&&window.showSuccess("Login successful. Redirecting…"),a(),setTimeout(()=>{window.location.assign(w)},700)}catch(g){window.showError&&window.showError(g.message||"Login failed.")}finally{f.disabled=!1,f.textContent="Login"}}async function u(l){try{return await l.json()}catch{return null}}document.addEventListener("click",l=>{if(!l.target.closest('[data-action="open-login-modal"]')||l.defaultPrevented||l.button!==0||l.metaKey||l.ctrlKey||l.shiftKey||l.altKey)return;l.preventDefault();const p=window.location.pathname+window.location.search+window.location.hash;s(p)});function r(){const l=document.getElementById("loginForm");l&&l.addEventListener("submit",async c=>{c.preventDefault();const p=(l.querySelector("#username")||{}).value?.trim(),m=(l.querySelector("#password")||{}).value;if(!p||!m){window.showValidation&&window.showValidation("Please enter username and password.");return}const g=new URLSearchParams(window.location.search).get("redirect_to");try{sessionStorage.setItem("wf_login_return_to",g||window.location.pathname||"/")}catch{}try{const y=await fetch("/functions/process_login.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:p,password:m})});if(!y.ok){const S=await u(y);throw new Error(S?.error||"Login failed.")}let b=(await y.json())?.redirectUrl;if(!b)try{b=sessionStorage.getItem("wf_login_return_to")}catch{}b||(b="/"),window.showSuccess&&window.showSuccess("Login successful. Redirecting…"),setTimeout(()=>{window.location.assign(b)},700)}catch(y){window.showError&&window.showError(y.message||"Login failed.")}})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",r):r(),window.openLoginModal=s})();(function(){function e(t){document.readyState==="loading"?document.addEventListener("DOMContentLoaded",t,{once:!0}):t()}e(()=>{const t=document.getElementById("wf-contact-form");if(!t)return;const o=document.getElementById("wf-contact-status"),i=document.getElementById("wf-contact-submit");function s(d,u="info"){o&&(o.textContent=d,o.className="text-sm "+(u==="error"?"text-red-600":u==="success"?"text-green-700":"text-gray-700"))}function a(d){i&&(i.disabled=d)}t.addEventListener("submit",async d=>{d.preventDefault();const u=Object.fromEntries(new FormData(t).entries()),r=(u.name||"").trim(),l=(u.email||"").trim(),c=(u.subject||"").trim(),p=(u.message||"").trim();if(!r||r.length>100){s("Please enter your name (max 100 characters).","error");return}if(!l||l.length>255||!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l)){s("Please enter a valid email address.","error");return}if(c&&c.length>150){s("Subject is too long (max 150 characters).","error");return}if(!p||p.length>5e3){s("Please enter a message (max 5000 characters).","error");return}s("Sending...","info"),a(!0);try{const m=await fetch("/api/contact_submit.php",{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({csrf:u.csrf,website:u.website||"",name:r,email:l,subject:c,message:p})}),f=await m.json().catch(()=>({success:!1,error:"Invalid server response"}));m.ok&&f.success?(s(f.message||"Thanks! Your message has been sent.","success"),t.reset()):s(f.error||"Failed to send your message. Please try again later.","error")}catch{s("Network error. Please check your connection and try again.","error")}finally{a(!1)}})})})();(function(){let e=null,t=null;function o(l){try{return decodeURIComponent(escape(atob(l)))}catch{try{return atob(l)}catch{return""}}}function i(l){return String(l).replace(/[&<>"']/g,c=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[c])}function s(){e&&t||(e=document.createElement("div"),e.className="wf-revealco-overlay",e.setAttribute("role","dialog"),e.setAttribute("aria-modal","true"),t=document.createElement("div"),t.className="wf-revealco-modal",t.innerHTML=`
      <div class="wf-revealco-card">
        <button type="button" class="wf-revealco-close" aria-label="Close">×</button>
        <h3 class="wf-revealco-title">Company Information</h3>
        <div class="wf-revealco-body" id="wfRevealCoBody"></div>
      </div>
    `,e.appendChild(t),document.body.appendChild(e),e.addEventListener("click",l=>{l.target===e&&d()}),t.querySelector(".wf-revealco-close").addEventListener("click",d),document.addEventListener("keydown",l=>{l.key==="Escape"&&e.classList.contains("show")&&d()}))}function a(l){s();const c=t.querySelector("#wfRevealCoBody");if(!c)return;const p=Math.floor(Math.random()*8)+1,m=Math.floor(Math.random()*8)+1;c.innerHTML=`
      <div class="wf-revealco-challenge">
        <p class="wf-revealco-hint">Quick check to prevent spam. Please solve:</p>
        <label class="wf-revealco-q">
          <span class="wf-revealco-qtext">${p} + ${m} =</span>
          <input type="text" inputmode="numeric" class="wf-revealco-input" aria-label="Answer" />
        </label>
        <div class="wf-revealco-actions">
          <button type="button" class="wf-btn wf-btn-primary" data-action="reveal">Reveal</button>
          <button type="button" class="wf-btn" data-action="cancel">Cancel</button>
        </div>
        <p class="wf-revealco-status" aria-live="polite"></p>
      </div>
    `;const f=String(p+m),g=c.querySelector(".wf-revealco-input"),y=c.querySelector(".wf-revealco-status");function v(){const w=l.getAttribute("data-enc-email")||"",b=l.getAttribute("data-enc-phone")||"",S=l.getAttribute("data-enc-address")||"",_=l.getAttribute("data-enc-name")||"",E=l.getAttribute("data-enc-owner")||"",x=l.getAttribute("data-enc-site")||"",M=l.getAttribute("data-enc-hours")||"",O=(o(w)||"").trim(),W=(o(b)||"").trim(),G=W.replace(/[^\d+]/g,""),R=(o(S)||"").trim(),T=(o(_)||"").trim(),C=(o(E)||"").trim(),P=(o(x)||"").trim(),U=(o(M)||"").trim(),F=[];if(T&&F.push(`<div class="wf-revealco-row"><span class="wf-revealco-label">Company</span><span>${i(T)}</span></div>`),C&&F.push(`<div class="wf-revealco-row"><span class="wf-revealco-label">Owner</span><span>${i(C)}</span></div>`),P){const $=P.startsWith("http")?P:"https://"+P;F.push(`<div class="wf-revealco-row"><span class="wf-revealco-label">Website</span><a class="wf-revealco-link" target="_blank" rel="noopener" href="${$}">${P}</a></div>`)}if(O){const $=i(O);F.push(`<div class="wf-revealco-row"><span class="wf-revealco-label">Email</span><a class="wf-revealco-link" href="mailto:${$}">${$}</a></div>`)}if(W&&F.push(`<div class="wf-revealco-row"><span class="wf-revealco-label">Phone</span><a class="wf-revealco-link" href="tel:${G}">${i(W)}</a></div>`),R){const $="https://www.google.com/maps/search/?api=1&query="+encodeURIComponent(R);F.push(`<div class="wf-revealco-row"><span class="wf-revealco-label">Address</span><a class="wf-revealco-link" target="_blank" rel="noopener" href="${$}">${i(R)}</a></div>`)}if(U){const $=i(U).replace(/\n/g,"<br>");F.push(`<div class="wf-revealco-row"><span class="wf-revealco-label">Hours</span><span>${$}</span></div>`)}c.innerHTML=`
        <div class="wf-revealco-details">
          ${F.join("")||"<p>No company details available.</p>"}
        </div>
      `}c.addEventListener("click",w=>{const b=w.target.closest("button");if(!b)return;const S=b.getAttribute("data-action");if(S==="cancel"){d();return}S==="reveal"&&((g&&g.value||"").trim()===f?v():(y&&(y.textContent="Incorrect, please try again."),g&&(g.value="",g.focus())))}),e.classList.add("show"),g&&g.focus()}function d(){e&&e.classList.remove("show")}function u(l){const c=l.target.closest("#wf-reveal-company-btn");c&&(l.preventDefault(),a(c))}function r(){const l=document.body;!l||l.dataset.page!=="contact"||document.addEventListener("click",u)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",r,{once:!0}):r()})();console.log("app.js loaded");function q(){if(console.log("[App] Initializing recovered systems..."),window.WF_SYSTEMS_INITIALIZED){console.log("[App] Systems already initialized, skipping");return}const n=new Y;window.WF_Cart=n,window.WhimsicalFrog&&WhimsicalFrog.registerModule&&WhimsicalFrog.registerModule("cart-system",n),console.log("[App] Creating RoomModalManager instance...");const e=new X;window.WF_RoomModal=e,window.roomModalManager=e,window.WhimsicalFrog&&WhimsicalFrog.registerModule&&WhimsicalFrog.registerModule("room-modal-manager",e),console.log("[App] RoomModalManager created and exposed globally:",e);const t=new J;window.WF_Search=t,window.WhimsicalFrog&&WhimsicalFrog.registerModule&&WhimsicalFrog.registerModule("search-system",t);const o=new K;window.WF_Sales=o,window.WhimsicalFrog&&WhimsicalFrog.registerModule&&WhimsicalFrog.registerModule("sales-system",o);const i=new Z;window.WF_Utils=i,window.WhimsicalFrog&&WhimsicalFrog.registerModule&&WhimsicalFrog.registerModule("utilities",i),window.WF_SYSTEMS_INITIALIZED=!0,console.log("[App] All core systems initialized successfully")}window.WhimsicalFrog&&(console.log("[App] WhimsicalFrog object exists:",window.WhimsicalFrog),console.log("[App] WhimsicalFrog.ready function:",window.WhimsicalFrog.ready),console.log("[App] WhimsicalFrog.Core:",window.WhimsicalFrog.Core),console.log("[App] WhimsicalFrog.Core.initialized:",window.WhimsicalFrog.Core?.initialized));if(window.WhimsicalFrog&&window.WhimsicalFrog.ready){console.log("[App] WhimsicalFrog available, attempting ready callback");const n=q,e=function(){console.log("[App] 🎉 Ready callback is EXECUTING!"),n()};try{WhimsicalFrog.ready(e),console.log("[App] Ready callback registered successfully"),window.WhimsicalFrog.Core?.initialized&&(console.log("[App] Core already initialized, callback should have run immediately"),setTimeout(()=>{window.WF_SYSTEMS_INITIALIZED||(console.log("[App] 🚨 Callback never executed, forcing initialization"),q())},200))}catch(t){console.error("[App] Error with ready callback:",t),q()}}else console.log("[App] WhimsicalFrog not ready, setting up fallback initialization"),q();(function(){function e(){try{const t=document.body,o=t?t.dataset:{},i=o&&o.page||window.WF_PAGE_INFO&&window.WF_PAGE_INFO.page||"";if(!(o&&o.isAdmin==="true"||typeof i=="string"&&i.startsWith("admin")))return;const u=(o&&o.path||window.location.pathname||"").split("?")[0].split("#")[0].split("/").filter(Boolean);let r=u[0]==="admin"?u[1]||"dashboard":"";r=(r||"").toLowerCase();const l={index:"dashboard",home:"dashboard",order:"orders",product:"inventory",products:"inventory",customer:"customers",user:"customers",users:"customers",report:"reports",setting:"settings"};l[r]&&(r=l[r]),({dashboard:()=>L(()=>import("./admin-dashboard-CEuPNdqJ.js"),[]),customers:()=>L(()=>import("./admin-customers-C0oGqzp0.js"),[]),inventory:()=>L(()=>import("./admin-inventory-B7HGoq5y.js"),[]),orders:()=>L(()=>import("./admin-orders-CKuoBxab.js"),[]),pos:()=>L(()=>import("./admin-pos-DuYEvZ-S.js"),[]),reports:()=>L(()=>import("./admin-reports-QEqgp-N2.js"),__vite__mapDeps([0,1])),marketing:()=>L(()=>import("./admin-marketing-DOemP6rh.js"),__vite__mapDeps([2,1])),settings:()=>L(()=>import("./admin-settings-BL9St725.js"),[]),categories:()=>L(()=>import("./admin-categories-DctmXD4Z.js"),[])}[r]||(()=>L(()=>import("./admin-dashboard-CEuPNdqJ.js"),[])))().then(()=>console.log(`[App] Admin module loaded for section: ${r}`)).catch(m=>console.error(`[App] Failed to load admin module for section: ${r}`,m))}catch(t){console.error("[App] Error setting up per-page imports",t)}}document.body?e():document.addEventListener("DOMContentLoaded",e,{once:!0})})();
