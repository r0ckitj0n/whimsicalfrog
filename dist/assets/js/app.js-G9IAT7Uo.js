/* empty css              */import{u as Qt,a as Xt,b as Zt,c as Wt,d as wt,A as rt}from"../apiClient-Bz7HftkC.js";class Ot{constructor(){this._target=document.createElement("span")}on(t,e){this._target.addEventListener(t,e)}off(t,e){this._target.removeEventListener(t,e)}emit(t,e=null){this._target.dispatchEvent(new CustomEvent(t,{detail:e}))}}const te=new Ot;typeof window<"u"&&(window.EventBus=Ot,window.eventBus=te);class ee{static setContent(t,e,n=!1){t&&(n?(t.innerHTML='<div class="wf-loading">Loading...</div>',requestAnimationFrame(()=>{t.innerHTML=e})):t.innerHTML=e)}static showToast(t,e="info",n=3e3){const o=document.createElement("div");o.className=`wf-toast wf-toast-${e}`,o.textContent=t,document.body.appendChild(o),setTimeout(()=>o.remove(),n)}}const oe={apiGet:wt,apiPost:Wt,apiPut:Zt,apiDelete:Xt,uploadFile:Qt,DOMUtils:ee};typeof window<"u"&&(window.Utils=oe);(function(){function t(){let n=document.getElementById("wf-header-offset-css");return n||(n=document.createElement("style"),n.id="wf-header-offset-css",document.head.appendChild(n)),n}function e(){const n=t();try{const o=document.querySelector(".universal-page-header"),a=o?Math.ceil(o.getBoundingClientRect().height):0,s=a>0?a+0:120;n.textContent=`:root { --wf-header-height: ${s}px; }`}catch{n.textContent=":root { --wf-header-height: 120px; }"}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",e,{once:!0}):e(),window.addEventListener("resize",e),document.fonts&&document.fonts.ready&&document.fonts.ready.then(e).catch(()=>{})})();class ne{constructor(){this.notifications=new Map,this.nextId=1,this.container=null,this.initialized=!1,this.init()}init(){this.initialized||(this.container||(this.container=document.createElement("div"),this.container.id="wf-notification-container",this.container.className="wf-notification-container",document.body.appendChild(this.container)),this.initialized=!0,console.log("✅ WhimsicalFrog Unified Notification System initialized"))}show(t,e="info",n={}){this.initialized||(console.warn("Notification system not initialized, initializing now..."),this.init());const{title:o=null,duration:a=this.getDefaultDuration(e),persistent:c=!1,actions:s=null,autoHide:m=!0}=n,l=this.nextId++,E=this.createNotification(l,t,e,o,c,s);return this.container.appendChild(E),this.notifications.set(l,E),requestAnimationFrame(()=>{E.classList.add("is-visible")}),!c&&m&&a>0&&setTimeout(()=>{this.remove(l)},a),l}createNotification(t,e,n,o,a,c){const s=document.createElement("div");if(s.className=`wf-notification wf-${n}-notification`,s.dataset.id=t,s.dataset.type=n,s.addEventListener("click",m=>{console.log(`Notification ${t} clicked - removing`),m.preventDefault(),m.stopPropagation(),this.remove(t)}),s.addEventListener("mousedown",m=>{console.log(`Notification ${t} mousedown event`)}),s.title="Click to dismiss",s.innerHTML=`
            <div class="wf-notification-content">
                <div class="wf-notification-icon">
                    ${this.getTypeIcon(n)}
                </div>
                <div class="wf-notification-body">
                    ${o?`<div class="wf-notification-title">${o}</div>`:""}
                    <div class="wf-notification-message">
                        ${e}
                    </div>
                    ${c?this.createActions(c):""}
                </div>
                ${a?"":`
                    <button class="wf-notification-close" type="button" aria-label="Close">&times;</button>
                `}
            </div>
        `,!a){const m=s.querySelector(".wf-notification-close");m&&m.addEventListener("click",l=>{l.stopPropagation(),this.remove(t)})}return c&&Array.isArray(c)&&s.querySelectorAll(".wf-notification-action").forEach((l,E)=>{const _=c[E];_&&l.addEventListener("click",r=>{r.stopPropagation();try{typeof _.onClick=="function"?_.onClick(r):typeof _.onClick=="string"&&_.onClick.trim()&&new Function(_.onClick).call(window)}catch(p){console.warn("Notification action handler failed",p)}})}),(n==="warning"||n==="error")&&setTimeout(()=>{s.parentElement&&(s.classList.add("pulse"),setTimeout(()=>{s.classList.remove("pulse")},150))},200),s}createActions(t){return!t||!Array.isArray(t)?"":`
            <div class="wf-notification-actions">
                ${t.map(e=>`
                    <button type="button" class="wf-notification-action ${e.style==="primary"?"primary":"secondary"}">
                        ${e.text}
                    </button>
                `).join("")}
            </div>
        `}getTypeConfig(t){const e={success:{background:"#87ac3a",border:"#6b8e23",color:"white",titleColor:"white",closeColor:"white",shadow:"rgba(135, 172, 58, 0.3)",icon:"✅"},error:{background:"linear-gradient(135deg, #fee2e2, #fecaca)",border:"#ef4444",color:"#7f1d1d",titleColor:"#dc2626",closeColor:"#ef4444",shadow:"rgba(239, 68, 68, 0.2)",icon:"❌"},warning:{background:"linear-gradient(135deg, #fef3c7, #fde68a)",border:"#f59e0b",color:"#92400e",titleColor:"#d97706",closeColor:"#f59e0b",shadow:"rgba(245, 158, 11, 0.2)",icon:"⚠️"},info:{background:"var(--brand-secondary, #6b8e23)",border:"var(--brand-secondary, #6b8e23)",color:"#ffffff",titleColor:"#ffffff",closeColor:"#ffffff",shadow:"rgba(107, 142, 35, 0.2)",icon:"ℹ️"},validation:{background:"linear-gradient(135deg, #fef3c7, #fde68a)",border:"#f59e0b",color:"#92400e",titleColor:"#d97706",closeColor:"#f59e0b",shadow:"rgba(245, 158, 11, 0.2)",icon:"⚠️"}};return e[t]||e.info}getDefaultDuration(t){return 5e3}remove(t){console.log(`Attempting to remove notification ${t}`);const e=this.notifications.get(t);e&&e.parentElement?(console.log(`Removing notification ${t} from DOM`),e.classList.remove("is-visible"),e.classList.add("slide-out"),setTimeout(()=>{e.parentElement&&(e.remove(),console.log(`Notification ${t} removed from DOM`)),this.notifications.delete(t),console.log(`Notification ${t} deleted from memory`)},400)):console.log(`Notification ${t} not found or already removed`)}removeAll(){this.notifications.forEach((t,e)=>{this.remove(e)})}success(t,e={}){return this.show(t,"success",e)}error(t,e={}){return this.show(t,"error",e)}warning(t,e={}){return this.show(t,"warning",e)}info(t,e={}){return this.show(t,"info",e)}validation(t,e={}){return this.show(t,"validation",e)}getFallbackColor(t,e){const n={success:{background:"linear-gradient(135deg, #87ac3a, #6b8e23)",border:"#556B2F",text:"#ffffff"},error:{background:"linear-gradient(135deg, #dc2626, #b91c1c)",border:"#991b1b",text:"#ffffff"},warning:{background:"linear-gradient(135deg, #f59e0b, #d97706)",border:"#b45309",text:"#ffffff"},info:{background:"linear-gradient(135deg, #3b82f6, #2563eb)",border:"#1d4ed8",text:"#ffffff"},validation:{background:"linear-gradient(135deg, #f59e0b, #d97706)",border:"#b45309",text:"#ffffff"}};return n[t]?.[e]||n.info[e]}getFallbackShadow(t){const e={success:"0 12px 28px rgba(135, 172, 58, 0.35), 0 4px 8px rgba(135, 172, 58, 0.15)",error:"0 12px 28px rgba(220, 38, 38, 0.35), 0 4px 8px rgba(220, 38, 38, 0.15)",warning:"0 12px 28px rgba(245, 158, 11, 0.35), 0 4px 8px rgba(245, 158, 11, 0.15)",info:"0 12px 28px rgba(59, 130, 246, 0.35), 0 4px 8px rgba(59, 130, 246, 0.15)",validation:"0 12px 28px rgba(245, 158, 11, 0.35), 0 4px 8px rgba(245, 158, 11, 0.15)"};return e[t]||e.info}getTypeIcon(t){const e={success:"✅",error:"❌",warning:"⚠️",info:"ℹ️",validation:"⚠️"};return e[t]||e.info}}window.wfNotifications=new ne;function ie(){window._wfNotificationFunctionsRegistered||(window.showNotification=(i,t="info",e={})=>window.wfNotifications.show(i,t,e),window.showSuccess=(i,t={})=>window.wfNotifications.success(i,t),window.showError=(i,t={})=>window.wfNotifications.error(i,t),window.showWarning=(i,t={})=>window.wfNotifications.warning(i,t),window.showInfo=(i,t={})=>window.wfNotifications.info(i,t),window.showValidation=(i,t={})=>window.wfNotifications.validation(i,t),window._wfNotificationFunctionsRegistered=!0,console.log("📢 WhimsicalFrog notification functions registered globally"))}ie();window._wfAlertOverridden||(window.alert=function(i){i.includes("added to your cart")||i.includes("added to cart")?window.wfNotifications.success(i):window.wfNotifications.info(i)},window._wfAlertOverridden=!0);window.showToast||(window.showToast=(i,t=null,e={})=>{let n,o;return t===null?(n=i,o="info"):typeof i=="string"&&["success","error","warning","info"].includes(i)?(o=i,n=t):(n=i,o=t||"info"),window.wfNotifications.show(n,o,e)});window.hideNotification=i=>window.wfNotifications.remove(i);window.clearNotifications=()=>window.wfNotifications.removeAll();window.cart&&typeof window.cart=="object"&&(window.cart.showNotification=i=>window.wfNotifications.success(i),window.cart.showErrorNotification=i=>window.wfNotifications.error(i),window.cart.showValidationError=i=>window.wfNotifications.validation(i));console.log("🎉 WhimsicalFrog Unified Notification System ready!");(function(){if(window.__wfHeaderAuthSync)return;window.__wfHeaderAuthSync=!0;function t(n){try{document&&document.body&&(document.body.setAttribute("data-is-logged-in","true"),n&&n.userId!=null&&document.body.setAttribute("data-user-id",String(n.userId)))}catch{}try{const o=document?.body?.dataset||{},a=n&&n.userId!=null?n.userId:o.userIdRaw||o.userId;a!=null&&window.wfAnalytics&&typeof window.wfAnalytics.identify=="function"&&window.wfAnalytics.identify(String(a))}catch{}try{const o=document.querySelector(".site-header .header-right"),a=o&&o.querySelector('a.nav-link[data-action="open-login-modal"]');if(a){const c=n&&n.username?String(n.username):null;if(c){let s=o.querySelector('.welcome-message a.nav-link[data-action="open-account-settings"]');if(!s){const m=o.querySelector(".welcome-message");m?(s=document.createElement("a"),s.href="#",s.className="nav-link",s.setAttribute("data-action","open-account-settings"),m.innerHTML="",m.appendChild(s)):(s=document.createElement("a"),s.href="#",s.className="nav-link",s.setAttribute("data-action","open-account-settings"),a.parentNode.insertBefore(s,a))}s.textContent=c}a.textContent="Logout",a.href="/logout.php",a.removeAttribute("data-action")}}catch{}try{window.WF_Cart?.refreshFromStorage?.()}catch{}try{window.WF_Cart?.updateCartDisplay?.()}catch{}}function e(){try{if(!(document?.body?.dataset?.isLoggedIn==="true"))return;t({userId:document.body.dataset.userId});try{const o=document?.body?.dataset||{},a=o.userIdRaw||o.userId;a&&window.wfAnalytics&&typeof window.wfAnalytics.identify=="function"&&window.wfAnalytics.identify(String(a))}catch{}}catch{}}window.addEventListener("wf:login-success",n=>{t(n?.detail||{})}),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",e,{once:!0}):e()})();class Mt{constructor(){this.modal=null,this.searchInput=null,this.isSearching=!1,this.currentSearchTerm="",this.currentResults=[],this.init()}init(){this.createModalHTML(),this.modal=document.getElementById("searchModal"),this.searchInput=document.getElementById("headerSearchInput"),this.bindEvents()}createModalHTML(){if(document.getElementById("searchModal"))return;document.body.insertAdjacentHTML("beforeend",`<div id="searchModal" class="wf-search-modal hidden">
        <div class="search-modal-content">
          <div class="search-modal-header">
            <h2 class="search-modal-title">Search Results</h2>
            <button class="search-modal-close" type="button">&times;</button>
          </div>
          <div class="search-modal-body" id="searchModalBody"></div>
        </div>
      </div>`)}bindEvents(){this.modal.querySelector(".search-modal-close").addEventListener("click",()=>this.close()),this.searchInput&&(this.searchInput.addEventListener("keypress",n=>{if(n.key==="Enter"){const o=this.searchInput.value.trim();o&&this.performSearch(o)}}),this.searchInput.parentElement?.querySelector("svg")?.addEventListener("click",()=>{const n=this.searchInput.value.trim();n&&this.performSearch(n)})),this.modal.addEventListener("click",e=>{e.target===this.modal&&this.close()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&this.isOpen()&&this.close()})}async performSearch(t){if(!this.isSearching){this.isSearching=!0,this.currentSearchTerm=t,this.showLoading(),this.open();try{const n=await(await wt(`search_items.php?q=${encodeURIComponent(t)}`)).json();n.success?this.displayResults(n):this.displayError(n.message||"Search failed")}catch(e){console.error("[Search] error",e),this.displayError("Error searching, please try again.")}finally{this.isSearching=!1}}}showLoading(){const t=document.getElementById("searchModalBody");t.innerHTML=`<div class="search-loading"><div class="spinner"></div><p>Searching for "${this.currentSearchTerm}"...</p></div>`}displayResults(t){this.currentResults=t.results||[];const e=document.getElementById("searchModalBody");if(!t.results.length){e.innerHTML=`<div class="search-no-results"><div class="search-no-results-icon">🔍</div><h3>No results found</h3><p>We couldn't find anything for "${t.search_term}"</p></div>`;return}let n=`<div class="search-results-header">Found <strong>${t.count}</strong> result${t.count!==1?"s":""} for "${t.search_term}"</div><div class="search-results-grid">`;t.results.forEach(o=>{const a=o.in_stock?"in-stock":"out-of-stock",c=o.in_stock?"":"disabled";n+=`<div class="search-result-item"><div class="search-result-clickable" data-sku="${o.sku}"><img src="${o.image_url}" alt="${o.name}" class="search-result-image" data-fallback-src="/images/items/placeholder.webp"/><div class="search-result-content"><h3>${o.name}</h3><p class="${a}">${o.stock_status}</p><span>${o.formatted_price}</span></div></div><div class="search-result-actions"><button class="search-add-to-cart-btn" data-sku="${o.sku}" ${c}>${o.in_stock?"Add to Cart":"Out of Stock"}</button></div></div>`}),n+="</div>",e.innerHTML=n,e.querySelectorAll(".search-result-clickable").forEach(o=>o.addEventListener("click",()=>this.viewItemDetails(o.dataset.sku))),e.querySelectorAll(".search-add-to-cart-btn").forEach(o=>o.addEventListener("click",a=>this.addToCart(o.dataset.sku,a)))}displayError(t){const e=document.getElementById("searchModalBody");e.innerHTML=`<div class="search-error"><p>${t}</p></div>`}addToCart(t,e){e.stopPropagation();const n=this.currentResults.find(a=>a.sku===t);if(!n)return;const o={sku:n.sku,name:n.name,price:parseFloat(n.price),image:n.image_url,quantity:1};if(window.WF_Cart&&typeof window.WF_Cart.addItem=="function"){window.WF_Cart.addItem(o);return}if(window.cart&&typeof window.cart.add=="function"){window.cart.add(o,1);try{window.dispatchEvent(new CustomEvent("cartUpdated",{detail:{action:"add",state:window.cart.getState?window.cart.getState():void 0}}))}catch{}}}viewItemDetails(t){this.close(),new URLSearchParams(window.location.search).get("page")==="shop"&&typeof window.showItemDetails=="function"?window.showItemDetails(t):window.showGlobalItemModal?.(t)}open(){this.modal.classList.remove("hidden"),this.modal.classList.add("show"),WFModals?.lockScroll?.()}close(){this.modal.classList.add("hidden"),this.modal.classList.remove("show"),WFModals?.unlockScrollIfNoneOpen?.()}isOpen(){return!this.modal.classList.contains("hidden")&&this.modal.classList.contains("show")}}if(document.getElementById("headerSearchInput"))try{const i=document&&document.body&&document.body.dataset;i&&(i.isAdmin==="true"||i.page&&String(i.page).startsWith("admin"))?console.log("[SearchModal] Admin page detected; skipping search modal initialization."):window.searchModal=new Mt}catch{window.searchModal=new Mt}window.SearchModal=Mt;const Ft="v2";class Z{constructor(){this.popupEl=null,this.hideTimer=null,this.isPointerOverPopup=!1,this.resizeObserver=null,this._anchorViewportRect=null,this._badgeCache=new Map,this.init()}init(){if(this.popupEl)return;const t=document.createElement("style");if(t.innerHTML=`
      .item-popup{pointer-events:auto !important;}
      /* Force correct coordinates and appearance even if legacy bundle overrides */
      .item-popup.positioned{left:auto !important;top:auto !important;}
      /* Neutral background without translucent shade */
      .item-popup{background:transparent !important; box-shadow:none !important;}
    `,document.head.appendChild(t),!this.popupEl){if(document.querySelectorAll(".item-popup").forEach(e=>{e.id!=="itemPopup"&&e.remove()}),this.popupEl=document.getElementById("itemPopup"),!this.popupEl){document.addEventListener("DOMContentLoaded",()=>{this.popupEl=document.getElementById("itemPopup"),this.popupEl&&this.bindPopupInteractions()});return}this.bindPopupInteractions()}}bindPopupInteractions(){if(!this.popupEl)return;if(this.popupEl.dataset.interactionsBound!==Ft)this.popupEl.dataset.interactionsBound=Ft;else return;this.popupEl.addEventListener("click",()=>{try{document.activeElement&&typeof document.activeElement.blur=="function"&&document.activeElement.blur()}catch{}typeof window.hideGlobalPopupImmediate=="function"&&window.hideGlobalPopupImmediate();const n=this.currentItem?.sku;typeof window.showGlobalItemModal=="function"&&n?(console.log("[globalPopup] opening detailed modal from popup click for",n),window.showGlobalItemModal(n,this.currentItem)):window.WhimsicalFrog?.GlobalModal?.show&&n&&(console.log("[globalPopup] opening detailed modal via WF.GlobalModal for",n),window.WhimsicalFrog.GlobalModal.show(n,this.currentItem))}),this.popupEl.addEventListener("mouseenter",()=>{this.isPointerOverPopup=!0,this.cancelHide()}),this.popupEl.addEventListener("mouseleave",()=>{this.isPointerOverPopup=!1,this.scheduleHide()});const t=this.popupEl.querySelector("#popupAddBtn");t&&t.addEventListener("click",n=>{n.preventDefault(),n.stopPropagation();try{document.activeElement&&typeof document.activeElement.blur=="function"&&document.activeElement.blur()}catch{}typeof window.hideGlobalPopupImmediate=="function"&&window.hideGlobalPopupImmediate();const o=this.currentItem?.sku;typeof window.showGlobalItemModal=="function"&&o?(console.log("[globalPopup] opening detailed modal from Add button for",o),window.showGlobalItemModal(o,this.currentItem)):window.WhimsicalFrog?.GlobalModal?.show&&o&&(console.log("[globalPopup] opening detailed modal via WF.GlobalModal (Add) for",o),window.WhimsicalFrog.GlobalModal.show(o,this.currentItem))});const e=this.popupEl.querySelector("#popupImage");if(e){try{e.classList.add("cursor-pointer")}catch{}e.addEventListener("click",n=>{n.preventDefault(),n.stopPropagation();try{document.activeElement&&typeof document.activeElement.blur=="function"&&document.activeElement.blur()}catch{}typeof window.hideGlobalPopupImmediate=="function"&&window.hideGlobalPopupImmediate();const o=this.currentItem?.sku;typeof window.showGlobalItemModal=="function"&&o?(console.log("[globalPopup] opening detailed modal from image click for",o),window.showGlobalItemModal(o,this.currentItem)):window.WhimsicalFrog?.GlobalModal?.show&&o&&(console.log("[globalPopup] opening detailed modal via WF.GlobalModal (image) for",o),window.WhimsicalFrog.GlobalModal.show(o,this.currentItem))})}}static _POS={styleEl:null,rules:new Set};static _ensureStyleEl(){if(!Z._POS.styleEl){const t=document.createElement("style");t.id="wf-globalpopup-styles",document.head.appendChild(t),Z._POS.styleEl=t}return Z._POS.styleEl}static _className(t,e){return`wf-gp-t${Math.round(t)}-l${Math.round(e)}`}static _ensureRule(t,e,n){if(Z._POS.rules.has(t))return;const o=`.item-popup.${t}{position:absolute;top:${Math.round(e)}px !important;left:${Math.round(n)}px !important;}`;Z._ensureStyleEl().appendChild(document.createTextNode(o)),Z._POS.rules.add(t)}_applyPosition(t,e){if(!this.popupEl)return;const n=this.popupEl.dataset.wfGpPosClass;n&&this.popupEl.classList.remove(n);const o=Z._className(t,e);Z._ensureRule(o,t,e),this.popupEl.classList.add(o),this.popupEl.dataset.wfGpPosClass=o}show(t,e){if(this.cancelHide(),this.popupEl&&this.popupEl.classList.contains("visible")&&t===this._lastAnchor)return;if(this._lastAnchor=t,console.log("[globalPopup] show called with:",t,e),this.init(),!this.popupEl){console.warn("[globalPopup] popup element not yet available");return}if(!t||!e){console.warn("[globalPopup] missing anchor or item data:",{anchorEl:!!t,item:!!e});return}this.currentItem=e;const n=(h,S)=>{const b=this.popupEl.querySelector(h);b&&(b.textContent=S??"")};n("#popupTitle",e.name||e.productName||e.sku),n("#popupDescription",e.description||"");const o=this.popupEl.querySelector("#popupStockBadge"),a=this.popupEl.querySelector("#popupStock");if("stock"in e&&a){const h=Number(e.stock??e.stockLevel??0);a.textContent=h>0?`${h} in stock`:"Out of stock",o&&o.classList.toggle("hidden",h>3)}const c=this.popupEl.querySelector("#popupCurrentPrice"),s=this.popupEl.querySelector("#popupOriginalPrice"),m=this.popupEl.querySelector("#popupSavings");if(c&&(c.textContent=`$${(e.price??e.currentPrice??0).toFixed(2)}`),s&&m){const h=Number(e.originalPrice??e.retailPrice??e.price??0),S=Number(e.price??e.currentPrice??h),b=h>S;s.textContent=`$${h.toFixed(2)}`,m.textContent=`Save $${(h-S).toFixed(2)}`,s.classList.toggle("hidden",!b),m.classList.toggle("hidden",!b);const A=this.popupEl.querySelector("#popupSaleBadge");A&&A.classList.toggle("hidden",!b)}const l=this.popupEl.querySelector("#popupImage");l&&e.image&&(l.src=e.image),this._clearPopupBadges();const E=e?.sku;E&&this._loadAndRenderBadges(E);let _=!1;try{if(t.ownerDocument===document)_=!!t.closest(".room-modal-overlay");else{const h=t.ownerDocument?.defaultView?.frameElement;h&&(_=!!h.closest(".room-modal-overlay"))}}catch{}this.popupEl&&this.popupEl.classList.toggle("in-room-modal",!!_);const r=t.getBoundingClientRect();let p=r.bottom+6+window.scrollY,v=r.left+window.scrollX,u={top:r.top,bottom:r.bottom,left:r.left,right:r.right};if(t.ownerDocument!==document)try{const h=t.ownerDocument.defaultView.frameElement;if(h){const S=h.getBoundingClientRect();p=S.top+r.bottom+6,v=S.left+r.left,u={top:S.top+r.top,bottom:S.top+r.bottom,left:S.left+r.left,right:S.left+r.right},console.log("[globalPopup] adjusted for iframe:",{top:p,left:v})}}catch(h){console.warn("[globalPopup] failed iframe adjustment",h)}this._applyPosition(p,v),this._anchorViewportRect=u,this.popupEl.classList.add("measuring"),this.popupEl.classList.remove("hidden"),requestAnimationFrame(()=>{this._clampAndApply(this._anchorViewportRect),this.popupEl.classList.remove("measuring"),this.popupEl.classList.add("visible"),this.popupEl.setAttribute("aria-hidden","false"),console.log("[globalPopup] popup shown"),this._ensureResizeObserver()}),console.log("[globalPopup] positioned popup at:",{top:p,left:v}),document.querySelectorAll(".item-popup.visible").forEach(h=>{h!==this.popupEl&&h.classList.add("hidden")}),this.currentItem=e}_clearPopupBadges(){try{const t=this.popupEl?.querySelector("#popupBadgeContainer");t&&(t.innerHTML="")}catch{}}async _loadAndRenderBadges(t){try{if(!t)return;if(!this._badgeCache.has(t)){const e=await fetch(`/api/get_badge_scores.php?sku=${encodeURIComponent(t)}`,{credentials:"same-origin"});if(!e.ok)throw new Error(`HTTP ${e.status}`);const n=await e.json();n&&n.success&&Array.isArray(n.badges)?this._badgeCache.set(t,n.badges):this._badgeCache.set(t,[])}this._renderBadgesFromCache(t)}catch(e){console.warn("[globalPopup] badge fetch failed",e)}}_renderBadgesFromCache(t){const e=this.popupEl?.querySelector("#popupBadgeContainer");if(!e)return;e.innerHTML="",(this._badgeCache.get(t)||[]).forEach(o=>{const a=document.createElement("div");a.className=`popup-badge ${this._positionClass(o.position_name)}`.trim(),a.textContent=o.content||"",e.appendChild(a)})}_positionClass(t){switch(t){case"top-left":return"pos-top-left";case"top-right":return"pos-top-right";case"bottom-left":return"pos-bottom-left";case"bottom-right":return"pos-bottom-right";default:return"pos-top-left"}}scheduleHide(t=120){this.cancelHide(),this.hideTimer=setTimeout(()=>{this.isPointerOverPopup||this.hideImmediate()},t),console.log("[globalPopup] hide scheduled in",t,"ms")}cancelHide(){this.hideTimer&&(clearTimeout(this.hideTimer),this.hideTimer=null)}hideImmediate(){if(console.log("[globalPopup] hide immediate"),this.popupEl?(this.popupEl.classList.remove("visible"),this.popupEl.classList.add("hidden"),this.popupEl.classList.remove("in-room-modal"),this.popupEl.setAttribute("aria-hidden","true"),console.log("[globalPopup] popup hidden")):console.warn("[globalPopup] no popup element to hide"),this.resizeObserver)try{this.resizeObserver.disconnect()}catch{}this.resizeObserver=null,this._anchorViewportRect=null}_clampAndApply(t){if(!this.popupEl||!t)return;const e=this.popupEl.getBoundingClientRect(),n=8,o=window.innerHeight-t.bottom-n,a=t.top-n;let c;o>=e.height?c=t.bottom+6:a>=e.height?c=t.top-e.height-6:o>=a?c=Math.max(n,Math.min(t.bottom+6,window.innerHeight-e.height-n)):c=Math.max(n,Math.min(t.top-e.height-6,window.innerHeight-e.height-n));let s=Math.min(Math.max(t.left,n),window.innerWidth-e.width-n);s=Math.min(Math.max(s,n),window.innerWidth-e.width-n),c=Math.min(Math.max(c,n),window.innerHeight-e.height-n);const m=Math.round(s+window.scrollX),l=Math.round(c+window.scrollY);this._applyPosition(l,m)}_ensureResizeObserver(){if(!(this.resizeObserver||!window.ResizeObserver)){this.resizeObserver=new ResizeObserver(()=>{this._clampAndApply(this._anchorViewportRect)});try{this.resizeObserver.observe(this.popupEl)}catch{}}}}const gt=new Z;window.showGlobalPopup=(i,t)=>gt.show(i,t);(function(){document.querySelectorAll(".item-popup").forEach(e=>{e.id!=="itemPopup"&&e.remove()})})();window.hideGlobalPopup=()=>gt.scheduleHide();window.hideGlobalPopupImmediate=()=>gt.hideImmediate();window.scheduleHideGlobalPopup=i=>gt.scheduleHide(i);window.cancelHideGlobalPopup=()=>gt.cancelHide();function Rt(){document.querySelectorAll("iframe").forEach(i=>{try{const t=i.contentWindow;t&&t.location&&t.location.origin===window.location.origin&&(t.showGlobalPopup=window.showGlobalPopup,t.hideGlobalPopup=window.hideGlobalPopup,t.hideGlobalPopupImmediate=window.hideGlobalPopupImmediate,t.scheduleHideGlobalPopup=window.scheduleHideGlobalPopup,t.cancelHideGlobalPopup=window.cancelHideGlobalPopup)}catch{}})}Rt();window.addEventListener("load",Rt);const zt="whimsical_frog_cart",K={items:[],total:0,count:0,notifications:!0};function ft(){try{const i={items:K.items,total:K.total,count:K.count,t:Date.now()};localStorage.setItem(zt,JSON.stringify(i))}catch(i){console.error("[Cart] Failed to save cart:",i)}}function ht(){K.total=K.items.reduce((i,t)=>i+t.price*t.quantity,0),K.count=K.items.reduce((i,t)=>i+t.quantity,0)}function xt(i,t,e="",n=5e3){const o=window.wfNotifications||{};if(typeof o[i]=="function")try{o[i].call(o,t,{title:e,duration:n});return}catch{}const a=window[`show${i.charAt(0).toUpperCase()+i.slice(1)}`];typeof a=="function"&&a(t,{title:e,duration:n})}const ct={load(){try{const i=JSON.parse(localStorage.getItem(zt)||"{}");Array.isArray(i.items)?K.items=i.items:K.items=[],ht()}catch{K.items=[]}},save:ft,add(i,t=1){const e=K.items.find(n=>n.sku===i.sku);e?e.quantity+=t:K.items.push({...i,quantity:t}),ht(),ft(),xt("success",`Added ${i.name||i.sku} (x${t})`,"✅ Added to Cart")},remove(i){const t=K.items.findIndex(e=>e.sku===i);if(t!==-1){const[e]=K.items.splice(t,1);ht(),ft(),xt("info",`${e.name||i} removed`,"Cart")}},updateQuantity(i,t){if(t<=0)return this.remove(i);const e=K.items.find(n=>n.sku===i);e&&(e.quantity=t,ht(),ft())},clear(){K.items=[],ht(),ft()},getItems:()=>[...K.items],getTotal:()=>K.total,getCount:()=>K.count,getState:()=>({...K})};ct.load();ae();function ae(){window.cart||(window.cart=ct)}window.WF_Cart||(window.WF_Cart={addItem:i=>{try{const t=Number(i?.quantity||1);return ct.add(i,t),Promise.resolve()}catch(t){return Promise.reject(t)}},removeItem:i=>{try{return ct.remove(i),Promise.resolve()}catch(t){return Promise.reject(t)}},updateQuantity:(i,t)=>{try{return ct.updateQuantity(i,t),Promise.resolve()}catch(e){return Promise.reject(e)}},getItems:()=>Promise.resolve(ct.getItems()),getCount:()=>Promise.resolve(ct.getCount()),getTotal:()=>Promise.resolve(ct.getTotal())});async function It(i){try{const t=await wt("sales.php",{action:"get_active_sales",item_sku:i});if(t.success&&t.sale)return{isOnSale:!0,discountPercentage:parseFloat(t.sale.discount_percentage)}}catch(t){console.warn("[SalesChecker] error checking sale",i,t)}return{isOnSale:!1}}const Bt=(i,t)=>i*(1-t/100);async function se(i,t,e=null){if(!i||!t)return;const n=await It(i.sku),o=parseFloat(i.retailPrice||i.price);if(n.isOnSale&&n.discountPercentage>0){const a=Bt(o,n.discountPercentage),c=`<span class="u-text-decoration-line-through u-color-999 u-font-size-0-9em">$${o.toFixed(2)}</span>
      <span class="u-color-dc2626 u-font-weight-bold u-margin-left-5px">$${a.toFixed(2)}</span>
      <span class="u-color-dc2626 u-font-size-0-8em u-margin-left-5px">(${Math.round(n.discountPercentage)}% off)</span>`;t.innerHTML=c,e&&(e.innerHTML=c),Object.assign(i,{salePrice:a,originalPrice:o,isOnSale:!0,discountPercentage:n.discountPercentage})}else t.textContent=`$${o.toFixed(2)}`,e&&(e.textContent=`$${o.toFixed(2)}`),i.isOnSale=!1}let bt=null;async function re(){if(bt)return bt;try{const i=await wt("/api/badge_content_manager.php",{action:"get_all",badge_type:"sale"});if(i.success&&i.badges&&i.badges.length>0){const t=i.badges.filter(e=>e.active).sort((e,n)=>n.weight-e.weight);if(t.length>0)return bt=t[0].content,bt}}catch(i){console.warn("Failed to fetch dynamic sale badge text:",i)}return"SALE"}async function Ht(i,t){if(!i)return;const e=parseFloat(t);if(isNaN(e)||e<=0)return;const n=i.querySelector(".sale-badge");n&&n.remove();const o=await re(),a=document.createElement("div");a.className="sale-badge",a.innerHTML=`<span class="sale-text">${o}</span><span class="sale-percentage">${Math.round(e)}% OFF</span>`,i.appendChild(a)}window.location.search.includes("page=shop")&&document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("[data-sku]").forEach(async i=>{const t=i.getAttribute("data-sku"),e=await It(t);e.isOnSale&&await Ht(i,e.discountPercentage)})});Object.assign(window,{checkItemSale:It,calculateSalePrice:Bt,checkAndDisplaySalePrice:se,addSaleBadgeToCard:Ht});(function(){try{const d=document&&document.body&&document.body.dataset;if(d&&(d.isAdmin==="true"||d.page&&String(d.page).startsWith("admin"))){console.log("[GlobalItemModal] Admin page detected; skipping initialization.");return}}catch{}let i=null,t=null;function e(d,g=document){return g.querySelector(d)}function n(d,g=document){return Array.from(g.querySelectorAll(d))}const o={sku:"",basePrice:0,item:null,colors:[],sizes:[],genders:[],selected:{gender:"",colorId:"",colorName:"",colorCode:"",sizeName:"",sizeCode:"",sizeAdj:0,sizeStock:null,colorStock:null}},a=d=>`$${Number(d||0).toFixed(2)}`;function c(d){return String(d||"").trim().toUpperCase().replace(/[^A-Z0-9]+/g,"")}async function s(d){try{if(typeof window.apiGet=="function")return await window.apiGet(d)}catch{}const g=await fetch(d,{credentials:"same-origin"});if(!g.ok)throw new Error(`Request failed: ${g.status}`);return g.json()}async function m(d,g={}){try{if(typeof window.apiPost=="function")return await window.apiPost(d,g)}catch{}const w=d.startsWith("http")||d.startsWith("/")?d:`/api/${d}`,L=await fetch(w,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},credentials:"same-origin",body:JSON.stringify(g)});if(!L.ok)throw new Error(`Request failed: ${L.status}`);return(L.headers.get("content-type")||"").includes("application/json")?L.json():L.text()}function l(d,g){const w=e('[data-action="addDetailedToCart"]',d);w&&(w.disabled=!g,w.classList.toggle("opacity-50",!g),w.classList.toggle("cursor-not-allowed",!g),w.setAttribute("aria-disabled",String(!g)))}function E(d){const g=e("#detailedQuantity",d);if(!g)return;let w=o.selected.sizeStock;if((w===null||typeof w>"u"||Number.isNaN(Number(w)))&&(w=o.selected.colorStock),(w===null||typeof w>"u"||Number.isNaN(Number(w)))&&(w=Number(o.item?.stockLevel)),Number.isFinite(w)||(w=99),Number(w)<=0){g.min="0",g.max="0",g.value="0",l(d,!1);return}g.min="1",g.max=String(w);const L=Math.max(1,Math.min(Number(g.value||1),Number(w)));g.value=String(L)}function _(d){const g=Number(o.item?.price??o.item?.currentPrice??o.item?.retailPrice??o.item?.originalPrice??0),w=Number(o.selected.sizeAdj||0),L=e("#detailedCurrentPrice",d);L&&(L.textContent=a(g+w))}function r(d){const w=n(".required-field",d).filter(L=>!L.closest(".hidden")).every(L=>L.value&&L.value!=="");return l(d,w),w}function p(d,g,w,L){if(!d)return;const x=d.value;d.innerHTML="";const M=document.createElement("option");M.value="",M.textContent=L||"Select an option...",d.appendChild(M),g.forEach(z=>{const D=document.createElement("option"),{value:T,label:P}=w(z),N=Number(z&&typeof z.stock_level<"u"?z.stock_level:NaN),$=Number.isFinite(N)&&N<=0;D.value=T,D.textContent=$?`${P} (Out of stock)`:P,$&&(D.disabled=!0,D.classList.add("option-out-of-stock")),Object.entries(z).forEach(([W,ot])=>{try{D.dataset[W]=ot}catch{}}),d.appendChild(D)}),Array.from(d.options).some(z=>z.value===x)?d.value=x:d.value=""}async function v(d,g){try{const w=await s(`/api/item_genders.php?action=get_all&item_sku=${encodeURIComponent(g)}`),L=Array.isArray(w?.genders)?w.genders:[];o.genders=L;const x=e("#genderSelection",d),M=e("#itemGenderSelect",d);L.length>0?(p(M,L,B=>({value:B.gender,label:B.gender}),"Select a style..."),x?.classList.remove("hidden")):x?.classList.add("hidden")}catch{e("#genderSelection",d)?.classList.add("hidden")}}async function u(d,g,w){try{const L=w?encodeURIComponent(w):"0",x=await s(`/api/item_sizes.php?action=get_sizes&item_sku=${encodeURIComponent(g)}&color_id=${L}`),M=Array.isArray(x?.sizes)?x.sizes:[];o.sizes=M;const B=e("#sizeSelection",d),z=e("#itemSizeSelect",d);M.length>0?(p(z,M,P=>({value:P.size_code,label:P.size_name}),"Select a size..."),B?.classList.remove("hidden")):B?.classList.add("hidden");const D=e("#sizeStockInfo",d),T=M.find(P=>String(P.size_code)===String(z?.value||""));D&&(D.textContent=T?Number(T.stock_level)>0?`In stock: ${T.stock_level}`:"Out of stock":""),T?(o.selected.sizeAdj=Number(T.price_adjustment||0),o.selected.sizeStock=Number(T.stock_level)):(o.selected.sizeAdj=0,o.selected.sizeStock=null),_(d),E(d)}catch{e("#sizeSelection",d)?.classList.add("hidden")}}async function h(d,g){try{const w=await s(`/api/item_colors.php?action=get_colors&item_sku=${encodeURIComponent(g)}`),L=Array.isArray(w?.colors)?w.colors:[];o.colors=L;const x=e("#colorSelection",d),M=e("#itemColorSelect",d);L.length>0?(p(M,L,T=>({value:String(T.id),label:T.color_name}),"Select a color..."),x?.classList.remove("hidden")):x?.classList.add("hidden");const B=e("#colorStockInfo",d),z=L.find(T=>String(T.id)===String(M?.value||""));B&&(B.textContent=z?Number(z.stock_level)>0?`In stock: ${z.stock_level}`:"Out of stock":"");const D=M?.value||"";await u(d,g,D)}catch{e("#colorSelection",d)?.classList.add("hidden"),await u(d,g,"")}}async function S(d,g,w){o.sku=g,o.item=w||{},o.basePrice=Number(w?.price??w?.currentPrice??w?.retailPrice??w?.originalPrice??0),o.selected={gender:"",colorId:"",colorName:"",colorCode:"",sizeName:"",sizeCode:"",sizeAdj:0,sizeStock:null,colorStock:null},["#itemGenderSelect","#itemColorSelect","#itemSizeSelect"].forEach(L=>{const x=e(L,d);x&&(x.value="")}),l(d,!0),await v(d,g),await h(d,g),_(d),E(d),r(d)}function b(){try{window.WFModals&&typeof WFModals.lockScroll=="function"&&WFModals.lockScroll()}catch{}}function A(){try{window.WFModals&&typeof WFModals.unlockScrollIfNoneOpen=="function"&&WFModals.unlockScrollIfNoneOpen()}catch{}}function q(d){const g=e("#detailedCurrentPrice"),w=e("#detailedOriginalPrice"),L=e("#detailedSavings");if(!g||!w||!L)return;const x=Number(d?.originalPrice??d?.retailPrice??d?.price??0),M=Number(d?.price??d?.currentPrice??d?.retailPrice??x);g.textContent=`$${M.toFixed(2)}`;const B=x>M;w.textContent=`$${x.toFixed(2)}`,L.textContent=`Save $${(x-M).toFixed(2)}`,w.classList.toggle("hidden",!B),L.classList.toggle("hidden",!B)}function F(d){n('[data-action="closeDetailedModal"]',d).forEach(w=>{w.addEventListener("click",L=>{L.preventDefault();try{J()}catch{}A()})}),d.addEventListener("click",w=>{const L=!w.target.closest(".detailed-item-modal-container");if(w.target===d||w.target?.dataset?.action==="closeDetailedModalOnOverlay"||L){try{J()}catch{}A()}});function g(w){if(w.key==="Escape"){try{J()}catch{}A(),document.removeEventListener("keydown",g)}}document.addEventListener("keydown",g)}function G(d,g){d.addEventListener("click",M=>{const B=M.target.closest('[data-action="switchDetailedImage"]');if(B)try{const D=JSON.parse(B.getAttribute("data-params")||"{}").url,T=e("#detailedMainImage",d);T&&D&&(T.src=D)}catch{}}),d.addEventListener("click",M=>{const B=M.target.closest('[data-action="adjustDetailedQuantity"]');if(B){M.preventDefault();try{const z=JSON.parse(B.getAttribute("data-params")||"{}"),D=Number(z.delta||0),T=e("#detailedQuantity",d);if(!T)return;const P=Number(T.getAttribute("min")||1),N=Number(T.getAttribute("max")||99),$=Math.max(P,Math.min(N,Number(T.value||1)+D));T.value=String($)}catch{}}}),d.addEventListener("click",async M=>{const B=M.target.closest('[data-action="addDetailedToCart"]');if(B){M.preventDefault();try{const D=JSON.parse(B.getAttribute("data-params")||"{}").sku||g?.sku,T=e("#detailedQuantity",d),P=Math.max(1,Number(T?.value||1));if(!D)return;try{const N={sku:String(D),quantity:Number(P)};window.dispatchEvent(new CustomEvent("wf:product_add_attempt",{detail:N})),window.wfAnalytics?.track?.("wf:product_add_attempt",N)}catch{}if(!r(d)){n(".required-field",d).forEach(N=>{!N.value&&!N.closest(".hidden")&&(N.classList.add("ring-2","ring-red-300"),setTimeout(()=>N.classList.remove("ring-2","ring-red-300"),1e3))});return}if(window.WF_Cart&&typeof window.WF_Cart.addItem=="function"){const N=Number(g?.price??g?.currentPrice??g?.retailPrice??g?.originalPrice??0),$=o.colors.find(ut=>String(ut.id)===String(e("#itemColorSelect",d)?.value||"")),W=o.sizes.find(ut=>String(ut.size_code)===String(e("#itemSizeSelect",d)?.value||"")),ot=String(e("#itemGenderSelect",d)?.value||"").trim(),tt=Number(W?.price_adjustment||0),et=N+tt,Q=g?.name??g?.title??"",yt=Array.isArray(g?.images)?g.images[0]?.url??g.images[0]:void 0,nt=($?.image_path?$.image_path:void 0)??g?.image??yt??"",lt=[D];ot&&lt.push(`G${c(ot)}`),W?.size_code&&lt.push(`S${c(W.size_code)}`),$?.id&&lt.push(`C${String($.id)}`);const pt=lt.join("-"),Et={...g||{},sku:pt,baseSku:D,quantity:P,price:et,name:Q,image:nt,optionGender:ot||void 0,optionSize:W?.size_name||void 0,optionSizeCode:W?.size_code||void 0,optionColor:$?.color_name||void 0,optionColorCode:$?.color_code||void 0,optionColorId:$?.id||void 0};await window.WF_Cart.addItem(Et)}else typeof window.addToCart=="function"&&window.addToCart(D,P);try{J()}catch{}A()}catch(z){console.error("[DetailedModal] add to cart failed",z)}}});const w=e("#additionalInfoToggle",d),L=e("#additionalInfoContent",d),x=e("#additionalInfoIcon",d);w&&L&&w.addEventListener("click",()=>{const M=L.classList.toggle("hidden");x&&x.classList.toggle("rot-180",!M)}),g&&q(g),d.dataset.optionHandlersBound||(d.addEventListener("change",async M=>{const B=M.target&&M.target.closest&&M.target.closest("#itemColorSelect"),z=M.target&&M.target.closest&&M.target.closest("#itemSizeSelect"),D=M.target&&M.target.closest&&M.target.closest("#itemGenderSelect");if(D&&(o.selected.gender=String(D.value||""),r(d)),B){const T=String(B.value||""),P=o.colors.find(W=>String(W.id)===T);o.selected.colorId=T,o.selected.colorName=P?.color_name||"",o.selected.colorCode=P?.color_code||"",o.selected.colorStock=P?Number(P.stock_level||0):null;const N=e("#colorStockInfo",d);N&&(N.textContent=P?Number(P.stock_level)>0?`In stock: ${P.stock_level}`:"Out of stock":"");const $=e("#detailedMainImage",d);$&&P?.image_path&&($.src=P.image_path),await u(d,o.sku,T),r(d),E(d)}if(z){const T=String(z.value||""),P=o.sizes.find($=>String($.size_code)===T);o.selected.sizeName=P?.size_name||"",o.selected.sizeCode=P?.size_code||"",o.selected.sizeAdj=Number(P?.price_adjustment||0),o.selected.sizeStock=P?Number(P.stock_level||0):null;const N=e("#sizeStockInfo",d);N&&(N.textContent=P?Number(P.stock_level)>0?`In stock: ${P.stock_level}`:"Out of stock":""),_(d),r(d),E(d)}}),d.dataset.optionHandlersBound="1")}function U(d,g){const w=document.getElementById("detailedItemModal");if(!w){console.warn("[DetailedModal] modal element not found");return}w.setAttribute("role","dialog"),w.setAttribute("aria-modal","true"),w.setAttribute("aria-hidden","false"),w.classList.remove("hidden"),w.classList.add("show"),document.body.classList.add("modal-open"),b();const L=e('[data-action="closeDetailedModal"]',w)||w;try{L.focus&&L.focus()}catch{}w.dataset.interactionsBound||(F(w),G(w,g),w.dataset.interactionsBound="1");try{S(w,d,g)}catch(x){console.error("[DetailedModal] options init failed",x)}try{const x={sku:String(d),name:g?.name||g?.title||"",price:Number(g?.price??g?.currentPrice??g?.retailPrice??g?.originalPrice??0)};window.dispatchEvent(new CustomEvent("wf:product_view",{detail:x})),window.wfAnalytics?.track?.("wf:product_view",x)}catch{}}function j(){document.getElementById("globalModalContainer")?t=document.getElementById("globalModalContainer"):(t=document.createElement("div"),t.id="globalModalContainer",document.body.appendChild(t))}async function O(d,g=null){console.log("🔧 showGlobalItemModal called with SKU:",d,"itemData:",g);try{j(),console.log("🔧 Modal container initialized");let w,L;if(g)w=g,L=g.images||[],console.log("🔧 Using provided item data:",w);else{console.log("🔧 Fetching item data from API for SKU:",d);const z=await s("/api/inventory.php");if(console.log("🔧 API response - found",z.length,"items"),w=z.find(D=>D.sku===d),!w)throw new Error(`Item with SKU ${d} not found`);L=[],console.log("🔧 Item data loaded:",w),console.log("Item data loaded:",w),console.log("Item stock level:",w.stockLevel),console.log("All item fields:",Object.keys(w)),console.log("Full item data:",JSON.stringify(w,null,2)),console.log("Images loaded:",L.length,"images")}const x=document.getElementById("detailedItemModal");x&&(console.log("🔧 Removing existing modal"),x.remove()),console.log("Sending item to modal with stockLevel:",w.stockLevel),console.log("Full item being sent:",w);const M=await m("render_detailed_modal.php",{item:w,images:L});if(!M||typeof M!="string")throw new Error("Modal render API returned invalid HTML");console.log("🔧 Modal HTML received, length:",M.length),console.log("🔧 Modal HTML preview:",M.substring(0,200)+"..."),t.innerHTML=M,console.log("🔧 Modal HTML inserted into container");const B=document.getElementById("detailedItemModal");if(console.log("🔧 Modal element found after insertion:",!!B),B)try{B.classList.add("admin-modal-offset-under-header")}catch{}i=w,window.currentDetailedItem=w,console.log("🔧 Current modal item stored"),console.log("🔧 Attempting to show modal..."),U(d,w)}catch(w){console.error("🔧 Error in showGlobalItemModal:",w),typeof window.showError=="function"?window.showError("Unable to load item details. Please try again."):alert("Unable to load item details. Please try again.")}}function J(){const d=document.getElementById("detailedItemModal");d&&d.remove(),window.WFModals&&typeof window.WFModals.unlockScrollIfNoneOpen=="function"&&window.WFModals.unlockScrollIfNoneOpen();try{const g=i&&(i.sku||i.baseSku)||null;if(g){const w={sku:String(g)};window.dispatchEvent(new CustomEvent("wf:product_close",{detail:w})),window.wfAnalytics?.track?.("wf:product_close",w)}}catch{}i=null}function V(d){d.target.id==="detailedItemModal"&&J()}function H(){return i}function X(d){typeof window.hidePopupImmediate=="function"&&window.hidePopupImmediate(),O(d.sku,d)}function dt(){j(),window.WhimsicalFrog=window.WhimsicalFrog||{},window.WhimsicalFrog.GlobalModal={show:O,close:J,closeOnOverlay:V,getCurrentItem:H,quickAddToCart:X}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",dt):dt(),window.showGlobalItemModal=O,window.showItemDetails=O,window.showItemDetailsModal=O,window.showDetailedModal=O,window.closeDetailedModal=J,window.closeDetailedModalOnOverlay=V,window.openQuantityModal=X,console.log("Global Item Modal system loaded")})();(function(){try{let e=function(){const s=document.getElementById("cartModalOverlay");s&&s.remove();const m=document.createElement("div");m.id="cartModalOverlay",m.className="confirmation-modal-overlay";const l=document.createElement("div");l.className="confirmation-modal cart-modal animate-slide-in-up",l.innerHTML=`
        <div class="bg-white rounded-lg shadow-xl overflow-hidden w-full max-w-3xl max-h-[90vh] flex flex-col">
          <div class="flex-shrink-0 bg-white border-b border-gray-200 cart-header">
            <div class="cart-modal-header-bar">
              <h1 class="cart-modal-title">Shopping Cart</h1>
              <button type="button" class="cart-modal-close-btn" data-action="close-cart-modal" aria-label="Close cart">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
                <span>Close</span>
              </button>
            </div>
          </div>
          <div id="cartModalItems" class="flex-1 overflow-y-auto cart_column_layout cart_column_direction cart-scrollbar">
            <div class="p-6 text-center text-gray-500">Loading cart...</div>
          </div>
          <div id="cartModalFooter" class="cart-modal-footer"></div>
        </div>
      `,m.appendChild(l),document.body.appendChild(m),t.overlay=m,t.container=l,t.itemsEl=m.querySelector("#cartModalItems"),m.addEventListener("click",E=>{E.target===m&&a()}),m.querySelector('[data-action="close-cart-modal"]').addEventListener("click",()=>a()),t.keydownHandler||(t.keydownHandler=E=>{try{E.key==="Escape"&&t.overlay&&t.overlay.classList.contains("show")&&a()}catch{}},document.addEventListener("keydown",t.keydownHandler))},n=function(){if(t.overlay&&t.overlay.classList.contains("show"))try{window.WF_Cart&&typeof window.WF_Cart.renderCart=="function"&&window.WF_Cart.renderCart()}catch(s){console.error("[CartModal] Failed to render cart in modal:",s)}},o=function(){if(!t.overlay||!t.overlay.querySelector(".cart-modal-header-bar")){if(t.overlay){try{t.overlay.remove()}catch{}t.overlay=null}e()}t.overlay.classList.add("show");try{window.WFModals&&window.WFModals.lockScroll&&window.WFModals.lockScroll()}catch{}try{window.WF_Cart?.refreshFromStorage?.()}catch{}n(),setTimeout(()=>{try{window.WF_Cart?.renderCart?.()}catch{}},120)},a=function(){if(t.overlay){t.overlay.classList.remove("show");try{window.WFModals&&window.WFModals.unlockScrollIfNoneOpen&&window.WFModals.unlockScrollIfNoneOpen()}catch{}}};if(window.WF_CartModal&&window.WF_CartModal.initialized)return;try{const s=document&&document.body&&document.body.dataset;if(s&&(s.isAdmin==="true"||s.page&&String(s.page).startsWith("admin"))){console.log("[CartModal] Admin page detected; skipping cart modal initialization.");return}}catch{}const t={overlay:null,container:null,itemsEl:null,keydownHandler:null};window.WF_CartModal={open:o,close:a,initialized:!0},window.openCartModal=o,window.closeCartModal=a,document.addEventListener("click",s=>{s.target&&s.target.closest&&s.target.closest("a.cart-link")&&(s.metaKey||s.ctrlKey||s.shiftKey||s.button===1||(s.preventDefault(),o()))}),document.addEventListener("click",s=>{const m=s.target&&s.target.closest&&s.target.closest(".cart-checkout-btn");if(!m||s.metaKey||s.ctrlKey||s.shiftKey||s.button===1||m.classList.contains("is-disabled")||m.classList.contains("disabled")||m.hasAttribute("disabled")||m.getAttribute("aria-disabled")==="true")return;s.preventDefault(),s.stopPropagation();try{a()}catch{}if(window.WF_PaymentModal&&typeof window.WF_PaymentModal.open=="function"){try{localStorage.setItem("pendingCheckout","true")}catch{}window.WF_PaymentModal.open();return}const E=m.getAttribute("href")||"/payment";try{localStorage.setItem("pendingCheckout","true")}catch{}if(!(document&&document.body&&document.body.getAttribute("data-is-logged-in")==="true")&&typeof window.openLoginModal=="function"){const r=window.location.pathname+window.location.search+window.location.hash;window.openLoginModal(r,{suppressRedirect:!0,onSuccess:()=>{try{document&&document.body&&document.body.setAttribute("data-is-logged-in","true")}catch{}window.location.href=E}});return}window.location.href=E}),window.addEventListener("cartUpdated",n);const c=()=>{try{window.WF_Cart?.refreshFromStorage?.()}catch{}n()};window.addEventListener("focus",()=>setTimeout(c,50)),document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&setTimeout(c,50)}),window.addEventListener("pageshow",()=>setTimeout(c,50)),window.addEventListener("wf:login-success",()=>{try{try{window.WF_Cart?.refreshFromStorage?.()}catch{}try{window.WF_Cart?.updateCartDisplay?.()}catch{}if(t.overlay&&t.overlay.classList.contains("show")){try{a()}catch{}try{t.overlay.remove()}catch{}t.overlay=null,t.container=null,t.itemsEl=null,e(),setTimeout(()=>{try{o(),setTimeout(()=>{try{window.WF_Cart?.refreshFromStorage?.()}catch{}try{window.WF_Cart?.renderCart?.()}catch{}},140)}catch{}},140)}else setTimeout(()=>{try{window.WF_Cart?.refreshFromStorage?.()}catch{}try{window.WF_Cart?.renderCart?.()}catch{}},80)}catch{}}),e(),console.log("[CartModal] initialized")}catch(t){console.error("[CartModal] init error",t)}})();(function(){try{const r=document&&document.body&&document.body.dataset;if(r&&(r.isAdmin==="true"||r.page&&String(r.page).startsWith("admin"))){console.log("[LoginModal] Admin page detected; skipping login modal initialization.");return}}catch{}let t=null,e=null,n=null,o={};function a(){if(t&&e)return;t=document.createElement("div"),t.id="wf-login-overlay",t.className="wf-login-overlay",e=document.createElement("div"),e.id="wf-login-modal",e.className="wf-login-modal",e.innerHTML=`
      <div class="wf-login-card">
        <button type="button" class="wf-login-close" aria-label="Close">×</button>
        <h3 class="wf-login-title">Sign in</h3>
        <form id="wfLoginForm" class="wf-login-form">
          <label class="wf-field">
            <span class="wf-label">Username</span>
            <input type="text" name="username" autocomplete="username" required class="wf-input" />
          </label>
          <label class="wf-field">
            <span class="wf-label">Password</span>
            <input type="password" name="password" autocomplete="current-password" required class="wf-input" />
          </label>
          <button type="submit" class="wf-btn wf-btn-primary">Login</button>
        </form>
      </div>`,t.appendChild(e),document.body.appendChild(t),t.addEventListener("click",p=>{p.target===t&&s()}),e.querySelector(".wf-login-close").addEventListener("click",s),document.addEventListener("keydown",p=>{p.key==="Escape"&&t.classList.contains("show")&&s()}),e.querySelector("#wfLoginForm").addEventListener("submit",m)}function c(r,p){a(),o=p||{},n=r||window.location.pathname+window.location.search+window.location.hash;try{sessionStorage.setItem("wf_login_return_to",n)}catch{}t.classList.add("show");try{window.WFModals?.lockScroll?.()}catch{}const v=e.querySelector('input[name="username"]');v&&v.focus()}function s(){if(t){t.classList.remove("show");try{window.WFModals?.unlockScrollIfNoneOpen?.()}catch{}}}async function m(r){r.preventDefault();const p=r.currentTarget,v=p.username.value.trim(),u=p.password.value;if(!v||!u){window.showValidation&&window.showValidation("Please enter username and password.");return}const h=p.querySelector('button[type="submit"]');h.disabled=!0,h.textContent="Logging in…";try{const S=typeof window<"u"&&window.__WF_BACKEND_ORIGIN?String(window.__WF_BACKEND_ORIGIN):window.location.origin,b=new URL("/functions/process_login.php",S).toString(),A=await fetch(b,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:v,password:u}),credentials:"include"});if(!A.ok){const O=await l(A);throw new Error(O?.error||"Login failed.")}const q=await E(A);let F=q&&q.userId!=null?q.userId:void 0;if(F==null)try{const O=new URL("/api/whoami.php",S).toString(),V=(await fetch(O,{credentials:"include"}).then(H=>H.ok?H.json():null))?.userId;V!=null&&(F=V)}catch{}const G=q?.redirectUrl;let U=G;if(!U)try{U=sessionStorage.getItem("wf_login_return_to")}catch{}U||(U=window.location.pathname||"/");try{if(document&&document.body){document.body.setAttribute("data-is-logged-in","true");const O=Number(F);Number.isFinite(O)&&O>0?(document.body.setAttribute("data-user-id",String(O)),F=O):F=void 0}}catch{}try{window.dispatchEvent(new CustomEvent("wf:login-success",{detail:{serverRedirect:G,target:U,userId:F??void 0,username:q?.username,role:q?.role}}));try{window.WF_Cart?.refreshFromStorage?.()}catch{}try{window.dispatchEvent(new CustomEvent("cartUpdated",{detail:{action:"auth",state:window.WF_Cart?.getState?.()}}))}catch{}}catch{}try{o&&typeof o.onSuccess=="function"&&o.onSuccess(U,G)}catch{}!!(o&&o.suppressRedirect===!0)?(window.showSuccess&&window.showSuccess("Login successful."),s()):(window.showSuccess&&window.showSuccess("Login successful. Redirecting…"),s(),setTimeout(()=>{window.location.assign(U)},700))}catch(S){window.showError&&window.showError(S.message||"Login failed.")}finally{h.disabled=!1,h.textContent="Login"}}async function l(r){try{return await r.json()}catch{return null}}async function E(r){try{const p=r.headers&&r.headers.get&&r.headers.get("content-type")||"",u=(await r.text()||"").trim();if(!p.includes("application/json"))return{};if(!u)return{};try{return JSON.parse(u)}catch{return{}}}catch{return{}}}document.addEventListener("click",r=>{if(!r.target.closest('[data-action="open-login-modal"]')||r.defaultPrevented||r.button!==0||r.metaKey||r.ctrlKey||r.shiftKey||r.altKey)return;r.preventDefault();const v=window.location.pathname+window.location.search+window.location.hash;c(v)});function _(){const r=document.getElementById("loginForm");r&&r.dataset.wfLoginHandler!=="true"&&(r.dataset.wfLoginHandler="true",r.addEventListener("submit",async p=>{p.preventDefault();const v=(r.querySelector("#username")||{}).value?.trim(),u=(r.querySelector("#password")||{}).value;if(!v||!u){window.showValidation&&window.showValidation("Please enter username and password.");return}const S=new URLSearchParams(window.location.search).get("redirect_to");try{sessionStorage.setItem("wf_login_return_to",S||window.location.pathname||"/")}catch{}try{const b=typeof window<"u"&&window.__WF_BACKEND_ORIGIN?String(window.__WF_BACKEND_ORIGIN):window.location.origin,A=new URL("/functions/process_login.php",b).toString(),q=await fetch(A,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:v,password:u}),credentials:"include"});if(!q.ok){const j=await l(q);throw new Error(j?.error||"Login failed.")}const F=await E(q),G=F?.redirectUrl;let U=G;if(!U)try{U=sessionStorage.getItem("wf_login_return_to")}catch{}U||(U="/");try{window.dispatchEvent(new CustomEvent("wf:login-success",{detail:{serverRedirect:G,target:U,userId:F&&F.userId!=null?F.userId:void 0,username:F?.username,role:F?.role}}))}catch{}try{window.WF_Cart?.refreshFromStorage?.()}catch{}try{window.dispatchEvent(new CustomEvent("cartUpdated",{detail:{action:"auth",state:window.WF_Cart?.getState?.()}}))}catch{}try{if(F?.userId==null){const j=new URL("/api/whoami.php",b).toString(),J=(await fetch(j,{credentials:"include"}).then(H=>H.ok?H.json():null))?.userId,V=Number(J);if(Number.isFinite(V)&&V>0){try{document&&document.body&&document.body.setAttribute("data-user-id",String(V))}catch{}try{window.dispatchEvent(new CustomEvent("wf:login-success",{detail:{serverRedirect:G,target:U,userId:V,username:F?.username,role:F?.role}}))}catch{}}}}catch{}window.showSuccess&&window.showSuccess("Login successful. Redirecting…"),setTimeout(()=>{window.location.assign(U)},700)}catch(b){window.showError&&window.showError(b.message||"Login failed.")}}))}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",_):_(),window.openLoginModal=c})();const ce="/api/";function Nt(i){return typeof i!="string"||i.startsWith("http://")||i.startsWith("https://")||i.startsWith("/")?i:`${ce}${i}`}async function Dt(i,t,e=null,n={}){const o=String(i||"GET").toUpperCase();if(o==="GET")return n&&Object.keys(n).length>0?rt.request(Nt(t),{method:"GET",...n}):rt.get(t);if(o==="POST")return rt.post(t,e,n);if(o==="PUT")return rt.put(t,e,n);if(o==="DELETE")return rt.delete(t,n);const a={method:o,credentials:"same-origin",headers:{"Content-Type":"application/json",...n.headers||{}},...n};return e!==null&&typeof a.body>"u"&&(a.body=JSON.stringify(e)),rt.request(Nt(t),a)}function de(i,t={}){return t&&Object.keys(t).length>0?Dt("GET",i,null,t):rt.get(i)}function le(i,t=null,e={}){return rt.post(i,t,e)}const mt={get:de,post:le,request:Dt};(function(){try{let e=function(r,p){try{window.dispatchEvent(new CustomEvent(r,{detail:p}))}catch{}},n=function(r,p={}){const v=`wf:checkout:${r}`;e(v,p);try{window.wfAnalytics&&typeof window.wfAnalytics.track=="function"&&window.wfAnalytics.track(v,p)}catch{}try{console.debug("[Checkout][track]",r,p)}catch{}},o=function(r){return`$${(parseFloat(r)||0).toFixed(2)}`},a=function(){try{return document&&document.body&&document.body.getAttribute("data-is-logged-in")==="true"}catch{return!1}},c=function(){if(t.overlay&&t.container)return;const r=document.getElementById("paymentModalOverlay");r&&r.remove();const p=document.createElement("div");p.id="paymentModalOverlay",p.className="confirmation-modal-overlay under-header checkout-overlay";const v=document.createElement("div");v.className="confirmation-modal payment-modal animate-slide-in-up",p.appendChild(v),document.body.appendChild(p),t.overlay=p,t.container=v,p.addEventListener("click",u=>{u.target===p&&_()}),t.keydownHandler||(t.keydownHandler=u=>{try{u.key==="Escape"&&t.overlay&&t.overlay.classList.contains("show")&&_()}catch{}},document.addEventListener("keydown",t.keydownHandler))},s=function(){t.container.innerHTML=`
        <div class="payment-header">
          <h3 class="payment-title">Checkout</h3>
          <p class="payment-subtitle">Complete your purchase without leaving the page</p>
        </div>
        <div class="payment-body">
          <div class="payment-grid">
            <div class="left-col">
              <div class="section-card">
                <h4 class="section-title">Shipping address</h4>
                <div id="pm-addressList" class="space-y-2"></div>
                <div class="mt-2 mt-10">
                  <button id="pm-addAddressToggle" class="modal-button btn-secondary">Add new address</button>
                </div>
                <div id="pm-addAddressForm" class="hidden mt-10">
                  <div class="form-row">
                    <div>
                      <label for="pm-addr_name">Label</label>
                      <input id="pm-addr_name" type="text" placeholder="Home" />
                    </div>
                    <div></div>
                  </div>
                  <div class="form-row">
                    <div>
                      <label for="pm-addr_line1">Address line 1</label>
                      <input id="pm-addr_line1" type="text" />
                    </div>
                    <div>
                      <label for="pm-addr_line2">Address line 2</label>
                      <input id="pm-addr_line2" type="text" />
                    </div>
                  </div>
                  <div class="form-row form-row-3">
                    <div>
                      <label for="pm-addr_city">City</label>
                      <input id="pm-addr_city" type="text" />
                    </div>
                    <div>
                      <label for="pm-addr_state">State</label>
                      <input id="pm-addr_state" type="text" />
                    </div>
                    <div>
                      <label for="pm-addr_zip">ZIP</label>
                      <input id="pm-addr_zip" type="text" />
                    </div>
                  </div>
                  <div class="mt-8 flex items-center gap-8">
                    <input id="pm-addr_default" type="checkbox" />
                    <label for="pm-addr_default">Set as default</label>
                  </div>
                  <div class="mt-10 flex gap-8">
                    <button id="pm-saveAddressBtn" class="modal-button btn-primary">Save address</button>
                    <button id="pm-cancelAddressBtn" class="modal-button btn-secondary">Cancel</button>
                  </div>
                </div>
              </div>

              <div class="section-card mt-14">
                <h4 class="section-title">Shipping method</h4>
                <select id="pm-shippingMethodSelect">
                  <option value="Customer Pickup">Customer Pickup</option>
                  <option value="Local Delivery">Local Delivery</option>
                  <option value="USPS">USPS</option>
                  <option value="FedEx">FedEx</option>
                  <option value="UPS">UPS</option>
                </select>
                <p class="hint mt-8">Select a method. Address is required for delivery and carriers.</p>
              </div>

              <div class="section-card mt-14">
                <h4 class="section-title">Payment</h4>
                <div class="radio-row" role="radiogroup" aria-label="Payment method">
                  <label><input type="radio" name="pm-paymentMethod" value="Square" id="pm-pm-square" /> Square (card)</label>
                  <label><input type="radio" name="pm-paymentMethod" value="Cash" id="pm-pm-cash" /> Cash</label>
                </div>
                <div id="pmSquareNote" class="hint mt-6">Square is currently unavailable.</div>
                <div id="pm-cardContainerWrap" class="hidden mt-10">
                  <div id="pm-card-container"></div>
                  <div id="pm-card-errors" class="error hidden mt-6"></div>
                </div>
              </div>
            </div>

            <div class="right-col">
              <div class="section-card">
                <h4 class="section-title">Order summary</h4>
                <div id="pm-orderItems" class="summary-lines"></div>
                <div class="summary-lines mt-10">
                  <div class="summary-line"><span class="label">Subtotal</span> <span id="pm-orderSubtotal" class="value">$0.00</span></div>
                  <div class="summary-line"><span class="label">Shipping</span> <span id="pm-orderShipping" class="value">$0.00</span></div>
                  <div class="summary-line"><span class="label">Tax</span> <span id="pm-orderTax" class="value">$0.00</span></div>
                  <div class="summary-line summary-total"><span class="label">Total</span> <span id="pm-orderTotal" class="value">$0.00</span></div>
                </div>
              </div>
            </div>
          </div>
          <div id="pm-checkoutError" class="error hidden mt-8"></div>
        </div>
        <div class="confirmation-modal-footer payment-footer">
          <button class="confirmation-modal-button cancel" id="pm-cancelBtn">Cancel</button>
          <button class="confirmation-modal-button confirm" id="pm-placeOrderBtn" disabled>Place order</button>
        </div>
      `,m()},m=function(){const r=window.WF_Cart||window.cart||null;let p=(()=>{try{const f=document.body?.dataset?.userIdRaw||document.body?.dataset?.userId;return f?String(f):null}catch{return null}})();const v=f=>t.container.querySelector(f),u=v("#pm-addressList"),h=v("#pm-addAddressToggle"),S=v("#pm-addAddressForm"),b=v("#pm-saveAddressBtn"),A=v("#pm-cancelAddressBtn"),q=v("#pm-shippingMethodSelect"),F=v("#pm-pm-square"),G=v("#pmSquareNote"),U=v("#pm-orderItems"),j=v("#pm-orderSubtotal"),O=v("#pm-orderShipping"),J=v("#pm-orderTax"),V=v("#pm-orderTotal"),H=v("#pm-placeOrderBtn"),X=v("#pm-checkoutError"),dt=v("#pm-cardContainerWrap"),d=v("#pm-card-container"),g=v("#pm-card-errors"),w=v("#pm-cancelBtn"),L=v("#pm-addr_name"),x=v("#pm-addr_line1"),M=v("#pm-addr_line2"),B=v("#pm-addr_city"),z=v("#pm-addr_state"),D=v("#pm-addr_zip"),T=v("#pm-addr_default");if(w&&w.addEventListener("click",_),!r){X&&(X.textContent="Checkout unavailable. Cart system not ready.",X.classList.remove("hidden"));return}let P=[],N=null,$={subtotal:0,shipping:0,tax:0,total:0};const W={enabled:!1,applicationId:null,environment:"sandbox",locationId:null,payments:null,card:null,sdkLoaded:!1};function ot(){try{return window.__wfReceiptOpen===!0}catch{return!1}}function tt(f){X&&(f?(X.textContent=f,X.classList.remove("hidden")):(X.classList.add("hidden"),X.textContent=""))}function et(){const f=t.container.querySelector('input[name="pm-paymentMethod"]:checked');return f?f.value:null}function Q(){const f=r.getItems?r.getItems():[],y=Array.isArray(f)&&f.length>0,I=et(),Y=!((q?.value||"Customer Pickup")!=="Customer Pickup")||!!N,at=!!p;H&&(H.disabled=!(y&&I&&Y&&at))}function yt(){if(!U||!V)return;const f=r.getItems?r.getItems():[];if(!f.length){U.innerHTML='<div class="hint">Your cart is empty.</div>',j&&(j.textContent=o(0)),O&&(O.textContent=o(0)),J&&(J.textContent=o(0)),V.textContent=o(0),Q();return}const y=f.map(I=>{const k=Number(I.quantity||0),C=Number(I.price||0),Y=k*C,at=[];I.optionSize&&at.push(I.optionSize),I.optionColor&&at.push(I.optionColor);const vt=at.length?`<div class="hint">${at.join(" • ")}</div>`:"";return`
            <div class="summary-line align-start">
              <div class="label flex-1">${(I.name||I.sku||"").toString()}${vt}</div>
              <div class="value min-w-140 text-right">${k} × ${o(C)}<div class="fw-800">${o(Y)}</div></div>
            </div>
          `}).join("");U.innerHTML=y,j&&(j.textContent=o($.subtotal)),O&&(O.textContent=o($.shipping)),J&&(J.textContent=o($.tax)),V.textContent=o($.total||(r.getTotal?r.getTotal():0)),Q(),n("order_summary_viewed",{items:f.length,subtotal:$.subtotal,shipping:$.shipping,tax:$.tax,total:$.total})}function Pt(){if(!u)return;if(!P.length){u.innerHTML='<div class="hint">No addresses yet. Add one to enable shipping.</div>',S&&S.classList.remove("hidden"),n("address_list_viewed",{addresses:P.length});return}const f=P.map(y=>{const I=String(y.id),k=N?String(N)===I:y.is_default==1;!N&&k&&(N=I);const C=y.address_line2?`${y.address_line2}<br/>`:"";return`
            <label class="flex items-start gap-3 p-2 rounded hover:bg-gray-50 cursor-pointer">
              <input type="radio" name="pm-shippingAddress" class="form-radio mt-1" value="${I}" ${k?"checked":""} />
              <div class="text-sm">
                <div class="font-medium">${y.address_name||"Address"}</div>
                <div class="hint">
                  ${y.address_line1}<br/>
                  ${C}
                  ${y.city}, ${y.state} ${y.zip_code}
                </div>
                ${y.is_default==1?'<div class="text-xs text-green-600">Default</div>':""}
              </div>
            </label>
          `}).join("");u.innerHTML=f,u.querySelectorAll('input[name="pm-shippingAddress"]').forEach(y=>{y.addEventListener("change",I=>{N=I.target.value,Q(),it();try{const k=P.find(C=>String(C.id)===String(N));n("address_select",{addressId:String(N||""),zip:k?.zip_code||null})}catch{}})})}async function nt(){try{try{const k=document.body?.dataset?.userIdRaw||document.body?.dataset?.userId;k&&(p=String(k))}catch{}if(!p&&a()){u&&(u.innerHTML='<div class="hint">Loading your account…</div>');for(let k=0;k<6&&!p;k++){await new Promise(C=>setTimeout(C,250));try{const C=document.body?.dataset?.userIdRaw||document.body?.dataset?.userId;C&&(p=String(C))}catch{}}}if(!p){if(a())try{const k=await mt.get("/api/whoami.php"),C=k?.userIdRaw||k?.userId;if(C!=null&&String(C)!==""){p=String(C);try{document&&document.body&&(document.body.setAttribute("data-user-id",String(k?.userId??"")),document.body.setAttribute("data-user-id-raw",p))}catch{}}}catch(k){console.warn("[PaymentModal] loadAddresses: session fallback failed",k)}if(!p){console.warn("[PaymentModal] loadAddresses: missing userId. body.dataset=",document.body?.dataset||{}),u&&(u.innerHTML='<div class="hint">Sign in to manage shipping addresses.</div>');return}}u&&(u.innerHTML='<div class="hint">Loading addresses…</div>');const f=`/api/customer_addresses.php?action=get_addresses&user_id=${encodeURIComponent(p)}`,y=await mt.get(f);P=Array.isArray(y?.addresses)?y.addresses:[];const I=P.find(k=>String(k.is_default)==="1");N=I?String(I.id):P[0]?String(P[0].id):null,Pt(),Q()}catch(f){console.error("[PaymentModal] Failed to load addresses",f),u&&(u.innerHTML='<div class="error">Failed to load addresses.</div>')}}async function lt(){try{const f=document.body?.dataset?.userIdRaw||document.body?.dataset?.userId;f&&(p=String(f))}catch{}if(p)return p;if(a()){for(let f=0;f<6&&!p;f++){await new Promise(y=>setTimeout(y,150));try{const y=document.body?.dataset?.userIdRaw||document.body?.dataset?.userId;y&&(p=String(y))}catch{}}if(!p)try{const f=await mt.get("/api/whoami.php"),y=f?.userIdRaw||f?.userId;if(y!=null&&String(y)!==""){p=String(y);try{document&&document.body&&(document.body.setAttribute("data-user-id",String(f?.userId??"")),document.body.setAttribute("data-user-id-raw",p))}catch{}}}catch(f){console.warn("[PaymentModal] resolveUserIdWithFallback: session call failed",f)}}return p||null}function pt(f){if(!S)return;const y=typeof f=="boolean"?f:S.classList.contains("hidden");S.classList.toggle("hidden",!y)}async function Et(){const f={user_id:p,address_name:(L?.value||"").trim()||"Address",address_line1:(x?.value||"").trim(),address_line2:(M?.value||"").trim(),city:(B?.value||"").trim(),state:(z?.value||"").trim(),zip_code:(D?.value||"").trim(),is_default:!!(T&&T.checked)};if(!f.address_line1||!f.city||!f.state||!f.zip_code){tt("Please complete all required address fields.");return}try{tt(""),b&&(b.disabled=!0);const y=await mt.post("/api/customer_addresses.php?action=add_address",f);await nt(),pt(!1),b&&(b.disabled=!1),y?.address_id&&(N=String(y.address_id)),Q(),n("address_add",{default:!!f.is_default})}catch(y){console.error("[PaymentModal] Failed to save address",y),tt(y.message||"Failed to save address."),n("address_add_error",{message:y?.message||String(y)}),b&&(b.disabled=!1)}}async function ut(){return W.sdkLoaded||await new Promise((f,y)=>{if(document.getElementById("sq-web-payments-sdk"))return W.sdkLoaded=!0,f(!0);const k=document.createElement("script");k.id="sq-web-payments-sdk",k.src="https://web.squarecdn.com/v1/square.js",k.onload=()=>{W.sdkLoaded=!0,f(!0)},k.onerror=()=>y(new Error("Failed to load Square SDK")),document.head.appendChild(k)}),!0}async function kt(){try{if(!W.enabled||!W.applicationId||!W.locationId||!W.sdkLoaded||!window.Square||!dt||!d)return;W.payments||(W.payments=window.Square.payments(W.applicationId,W.locationId)),W.card||(W.card=await W.payments.card(),await W.card.attach("#pm-card-container"));const f=et()==="Square";dt.classList.toggle("hidden",!f)}catch(f){console.error("[PaymentModal] Square init failed",f),g&&(g.textContent="Card input failed to initialize.",g.classList.remove("hidden"))}}async function Vt(){try{const y=(await mt.get("/api/square_settings.php?action=get_settings"))?.settings||{},I=!!(y&&(y.square_enabled===!0||y.square_enabled==="1"||y.square_enabled===1));if(W.enabled=I,W.applicationId=y.square_application_id||null,W.environment=y.square_environment||"sandbox",W.locationId=y.square_location_id||null,F&&(F.disabled=!I),G&&G.classList.toggle("hidden",!!I),!et())if(I&&F)F.checked=!0;else{const C=t.container.querySelector('input[name="pm-paymentMethod"][value="Cash"]');C&&(C.checked=!0)}I&&W.applicationId&&W.locationId&&(await ut(),await kt())}catch{console.warn("[PaymentModal] Square settings unavailable; keeping Square disabled"),F&&(F.disabled=!0),G&&G.classList.remove("hidden")}finally{Q()}}async function it(){if(ot()){console.debug("[PaymentModal] Skipping pricing update while receipt is open");return}try{const f=r.getItems?r.getItems():[],y=(Array.isArray(f)?f:[]).map(C=>({sku:(C&&(C.sku||C.itemId||C.id||"")).toString(),quantity:Number(C&&C.quantity!=null?C.quantity:0)})).filter(C=>!!C.sku&&C.quantity>0);if(Array.isArray(f)&&f.length>y.length){const C=f.filter(Y=>!Y||!(Y.sku||Y.itemId||Y.id)).map(Y=>({raw:Y}));console.warn("[PaymentModal] Some cart items are missing a SKU and were excluded from pricing payload.",{missingCount:f.length-y.length,missing:C})}const I={itemIds:y.map(C=>C.sku),quantities:y.map(C=>C.quantity),shippingMethod:q?.value||"Customer Pickup"};if(N){const C=P.find(Y=>String(Y.id)===String(N));C&&C.zip_code&&(I.zip=String(C.zip_code))}I.debug=!0;const k=await mt.post("/api/checkout_pricing.php",I);if(console.debug("[PaymentModal] pricing request ->",I,"response ->",k),k&&k.success&&k.pricing){$=k.pricing,j&&(j.textContent=o($.subtotal)),O&&(O.textContent=o($.shipping)),J&&(J.textContent=o($.tax)),V&&(V.textContent=o($.total)),k.debug&&console.info("[PaymentModal] pricing debug ->",k.debug);try{n("pricing_updated",{subtotal:Number($.subtotal||0),shipping:Number($.shipping||0),tax:Number($.tax||0),total:Number($.total||0),method:I.shippingMethod,zip:I.zip||null})}catch{}Array.isArray(f)&&f.length>0&&Number($.subtotal)===0&&console.warn("[PaymentModal] Subtotal returned as $0.00 despite items present. Possible SKU/price mismatch in DB.",{skus:I.itemIds,quantities:I.quantities,shippingMethod:I.shippingMethod,debug:k.debug||null})}}catch(f){console.warn("[PaymentModal] Pricing update failed",f),tt(`Pricing update failed: ${f?.message||"Unknown error"}`);try{n("pricing_error",{message:f?.message||String(f)})}catch{}}}function Kt(){const f=r.getItems?r.getItems():[],y=(Array.isArray(f)?f:[]).map(R=>({sku:(R&&(R.sku||R.itemId||R.id||"")).toString(),quantity:Number(R&&R.quantity!=null?R.quantity:0),optionColor:R?.optionColor??null,optionSize:R?.optionSize??null})).filter(R=>!!R.sku&&R.quantity>0);if(Array.isArray(f)&&f.length>y.length){const R=f.filter(st=>!st||!(st.sku||st.itemId||st.id)).map(st=>({raw:st}));console.warn("[PaymentModal] Some cart items are missing a SKU and were excluded from order payload.",{missingCount:f.length-y.length,missing:R})}const I=y.map(R=>R.sku),k=y.map(R=>R.quantity),C=y.map(R=>R.optionColor),Y=y.map(R=>R.optionSize),at=et(),vt=q?.value||"Customer Pickup";let Ct=null;if(vt!=="Customer Pickup"&&N){const R=P.find(st=>String(st.id)===String(N));R&&(Ct={id:R.id,address_name:R.address_name,address_line1:R.address_line1,address_line2:R.address_line2,city:R.city,state:R.state,zip_code:R.zip_code,is_default:R.is_default})}const Yt=Number($.total||(r.getTotal?r.getTotal():0)),At={customerId:p,itemIds:I,quantities:k,colors:C,sizes:Y,paymentMethod:at,total:Yt,shippingMethod:vt,...Ct?{shippingAddress:Ct}:{}};return At.debug=!0,At}async function Jt(){try{tt(""),H&&(H.disabled=!0,H.textContent="Placing…");try{const k=r.getItems?r.getItems():[];n("order_start",{count:Array.isArray(k)?k.length:0,method:et()||null})}catch{}if(!p)if(typeof window.openLoginModal=="function"){const k=window.location.pathname+window.location.search+window.location.hash;throw window.openLoginModal(k,{suppressRedirect:!0,onSuccess:()=>{try{document&&document.body&&document.body.setAttribute("data-is-logged-in","true")}catch{}try{p=document.body?.dataset?.userId||p}catch{}nt(),Q(),it()}}),new Error("Please sign in to place your order.")}else throw new Error("Please sign in to place your order.");const f=Kt();if(!f.itemIds.length)throw new Error("Your cart is empty.");if(!f.paymentMethod)throw new Error("Please choose a payment method.");if(f.shippingMethod!=="Customer Pickup"&&!f.shippingAddress)throw new Error("Please choose a shipping address.");if(f.paymentMethod==="Square")try{if(await ut(),await kt(),!W.card)throw new Error("Card input unavailable.");g&&(g.textContent="",g.classList.add("hidden"));const k=await W.card.tokenize();if(k.status!=="OK"){const C=k&&k.errors&&k.errors[0]&&k.errors[0].message||"Card tokenization failed";throw new Error(C)}f.squareToken=k.token}catch(k){throw g&&(g.textContent=k.message||"Card error",g.classList.remove("hidden")),k}const y=await mt.post("/api/add-order.php",f);if(console.debug("[PaymentModal] order request ->",f,"response ->",y),y&&y.debug&&console.info("[PaymentModal] order debug ->",y.debug),y&&y.success&&y.orderId){try{n("order_success",{orderId:y.orderId,total:Number(f.total||0)})}catch{}try{window.WF_ReceiptModal&&window.WF_ReceiptModal.open&&window.WF_ReceiptModal.open(y.orderId)}catch{}try{setTimeout(()=>{r.clearCart&&r.clearCart()},0)}catch{}try{_()}catch{}return}const I=y&&typeof y=="object"&&y.error?y.error:typeof y=="string"?y:null;throw new Error(I||"Failed to create order.")}catch(f){console.error("[PaymentModal] Order failed",f),tt(f.message||"Order failed.");try{n("order_failure",{message:f?.message||String(f)})}catch{}H&&(H.disabled=!1,H.textContent="Place order")}}h&&h.addEventListener("click",()=>pt()),A&&A.addEventListener("click",()=>pt(!1)),b&&b.addEventListener("click",()=>Et()),q&&q.addEventListener("change",async()=>{Q(),await it()}),q&&q.addEventListener("change",()=>{try{n("shipping_method_change",{method:q.value||"Customer Pickup"})}catch{}}),t.container.querySelectorAll('input[name="pm-paymentMethod"]').forEach(f=>{f.addEventListener("change",async()=>{Q(),et()==="Square"?(await ut(),await kt()):dt&&dt.classList.add("hidden");try{n("payment_method_select",{method:et()||null})}catch{}})}),H&&H.addEventListener("click",Jt),window.addEventListener("cartUpdated",async()=>{ot()||(yt(),await it())}),window.addEventListener("wf:login-success",async f=>{try{const y=f?.detail?.userId!=null?f.detail.userId:document.body?.dataset?.userId,I=Number(y);Number.isFinite(I)&&I>0&&(p=String(I))}catch{}p||await lt(),await nt(),Q(),await it()},{once:!1});try{if(document&&document.body){const f=async()=>{try{const k=document.body?.dataset?.userId,C=Number(k);if(Number.isFinite(C)&&C>0){const Y=String(C);p!==Y&&(p=Y,await nt(),Q(),await it())}}catch{}},y=async()=>{try{document.body?.getAttribute("data-is-logged-in")==="true"&&!p&&(await lt(),p&&(await nt(),Q(),await it()))}catch{}};new MutationObserver(k=>{for(const C of k)C.type==="attributes"&&(C.attributeName==="data-user-id"?f():C.attributeName==="data-is-logged-in"&&y())}).observe(document.body,{attributes:!0,attributeFilter:["data-user-id","data-is-logged-in"]})}}catch{}yt(),Vt(),nt().catch(()=>{}).finally(()=>{it()})},l=function(){c(),s(),t.overlay.classList.add("show");try{window.WFModals&&window.WFModals.lockScroll&&window.WFModals.lockScroll()}catch{}try{n("open")}catch{}},E=function(){if(!a()&&typeof window.openLoginModal=="function"){const r=window.location.pathname+window.location.search+window.location.hash;window.openLoginModal(r,{suppressRedirect:!0,onSuccess:()=>{try{document&&document.body&&document.body.setAttribute("data-is-logged-in","true")}catch{}l(),resolveUserIdWithFallback().then(async()=>{userId&&(await loadAddresses(),ensurePlaceButtonState(),await updatePricing())}).catch(()=>{})}});const p=v=>{try{const u=v?.detail?.userId||document.body?.dataset?.userId;u&&document&&document.body&&document.body.setAttribute("data-user-id",String(u))}catch{}try{(!t.overlay||!t.overlay.classList.contains("show"))&&l()}catch{}};window.addEventListener("wf:login-success",p,{once:!0});return}l()},_=function(){if(t.overlay){t.overlay.classList.remove("show");try{window.WFModals&&window.WFModals.unlockScrollIfNoneOpen&&window.WFModals.unlockScrollIfNoneOpen()}catch{}}};if(window.WF_PaymentModal&&window.WF_PaymentModal.initialized)return;try{const r=document&&document.body&&document.body.dataset;if(r&&(r.isAdmin==="true"||r.page&&String(r.page).startsWith("admin"))){console.log("[PaymentModal] Admin page detected; skipping payment modal initialization.");return}}catch{}const t={overlay:null,container:null,keydownHandler:null};window.WF_PaymentModal={open:E,close:_,initialized:!0},c(),console.log("[PaymentModal] initialized")}catch(t){console.error("[PaymentModal] init error",t)}})();(function(){const i={overlay:null,container:null,content:null,header:null,orderId:null};function t(){if(i.overlay&&i.container)return;const c=document.getElementById("receiptModalOverlay");c&&c.remove();const s=document.createElement("div");s.id="receiptModalOverlay",s.className="confirmation-modal-overlay under-header checkout-overlay";const m=document.createElement("div");m.className="confirmation-modal receipt-modal animate-slide-in-up";const l=document.createElement("div");l.className="confirmation-modal-header receipt-modal-header",l.innerHTML=`
      <div class="left">
        <h3 class="title">Order Receipt</h3>
      </div>
      <div class="right actions">
        <button type="button" class="btn-secondary btn-print">Print</button>
        <button type="button" class="btn-secondary btn-close" aria-label="Close receipt">Close</button>
      </div>
    `;const E=document.createElement("div");E.className="confirmation-modal-content receipt-modal-content",m.appendChild(l),m.appendChild(E),s.appendChild(m),document.body.appendChild(s),l.querySelector(".btn-close")?.addEventListener("click",a),l.querySelector(".btn-print")?.addEventListener("click",()=>{try{window.print()}catch{}}),i.overlay=s,i.container=m,i.content=E,i.header=l}async function e(c){const s=`/receipt.php?orderId=${encodeURIComponent(c)}`,m=await fetch(s,{credentials:"include"});if(!m.ok)throw new Error(`Failed to load receipt (${m.status})`);return await m.text()}function n(c){try{const s=c.querySelector(".js-print-button");s&&s.addEventListener("click",m=>{m.preventDefault();try{window.print()}catch{}},{once:!0})}catch{}}async function o(c){t(),i.orderId=c;try{window.__wfReceiptOpen=!0}catch{}i.content.innerHTML='<div class="receipt-loading">Loading receipt…</div>',i.overlay.classList.add("show");try{window.WFModals&&window.WFModals.lockScroll&&window.WFModals.lockScroll()}catch{}try{const s=await e(c);i.content.innerHTML=`<div class="receipt-print-root">${s}</div>`,n(i.content)}catch(s){console.error("[ReceiptModal] Error loading receipt:",s),i.content.innerHTML='<div class="error">Sorry, we could not load your receipt. Please try again.</div>'}}function a(){if(i.overlay){i.overlay.classList.remove("show");try{window.WFModals&&window.WFModals.unlockScrollIfNoneOpen&&window.WFModals.unlockScrollIfNoneOpen()}catch{}try{window.__wfReceiptOpen=!1}catch{}try{window.dispatchEvent(new CustomEvent("receiptModalClosed"))}catch{}}}window.WF_ReceiptModal={open:o,close:a}})();(function(){if(typeof document>"u")return;(e=>{document.readyState==="loading"?document.addEventListener("DOMContentLoaded",e,{once:!0}):e()})(()=>{if(!document.getElementById("productsGrid"))return;const n=Array.from(document.querySelectorAll("#productsGrid .product-card")),o=Array.from(document.querySelectorAll("#productsGrid .add-to-cart-btn")),a=Array.from(document.querySelectorAll(".category-navigation .category-btn"));function c(m){if(!m)return;const l=m.dataset&&m.dataset.sku||"";if(!l)return;const E=m.dataset&&m.dataset.name||(m.querySelector(".product-title")?.textContent||"").trim(),_=m.dataset&&m.dataset.price||"",r=Number.parseFloat(_)||0,p=m.querySelector(".product-stock"),v=p?Number.parseInt(p.getAttribute("data-stock")||"0",10):0,u=m.querySelector("img.product-image"),h=u?u.getAttribute("src"):"",S=m.querySelector(".description-text-full"),b=S?S.textContent.trim():"",A={sku:l,name:E,price:r,retailPrice:r,currentPrice:r,stockLevel:v,image:h,description:b};window.WhimsicalFrog?.GlobalModal?.show?window.WhimsicalFrog.GlobalModal.show(l,A):typeof window.showGlobalItemModal=="function"?window.showGlobalItemModal(l,A):typeof window.showDetailedModal=="function"?window.showDetailedModal(l,A):console.warn("[shop-compat] Modal system not available")}o.forEach(m=>{m.addEventListener("click",l=>{l.preventDefault(),l.stopPropagation();const E=m.closest(".product-card");c(E)})}),n.forEach(m=>{m.addEventListener("click",l=>{l.target.closest(".product-more-toggle, .add-to-cart-btn")||c(m)})});function s(m){n.forEach(l=>{const E=l.dataset.category,_=m==="all"||E===m;l.classList.toggle("hidden",!_)})}a.forEach(m=>{m.addEventListener("click",l=>{l.preventDefault();const E=m.dataset.category;a.forEach(_=>_.classList.remove("active")),m.classList.add("active"),s(E)})})})})();document.addEventListener("DOMContentLoaded",function(){const i=document.getElementById("landingPage");if(!i)return;if(document.body.classList.add("mode-fullscreen"),console.log("🎯 Landing page positioning script loaded"),window.innerWidth<1e3){console.log("🎯 Mobile layout detected, skipping JS positioning");const _=document.querySelector(".area-1");_&&_.setAttribute("href","/shop");return}const t=1280,e=896;let n=[];try{n=JSON.parse(i.dataset.coords||"[]")}catch(_){console.error("Error parsing landing page coordinates:",_);return}const o=n.map(_=>({selector:_.selector.startsWith(".")?_.selector:"."+_.selector,top:_.top,left:_.left,width:_.width,height:_.height})),a={styleEl:null,rules:new Set};function c(){return a.styleEl||(a.styleEl=document.createElement("style"),a.styleEl.id="landing-page-runtime-styles",document.head.appendChild(a.styleEl)),a.styleEl}function s(_,r,p,v){return{t:Math.round(_),l:Math.round(r),w:Math.round(p),h:Math.round(v)}}function m({t:_,l:r,w:p,h:v}){return`lp-pos-t${_}-l${r}-w${p}-h${v}`}function l(_,r){if(a.rules.has(_))return;const p=`#landingPage .${_} { top:${r.t}px; left:${r.l}px; width:${r.w}px; height:${r.h}px; }`;c().appendChild(document.createTextNode(p)),a.rules.add(_)}function E(){const _=window.innerWidth,r=window.innerHeight,p=_/r,v=t/e;let u,h,S;p>v?(u=r/e,h=(_-t*u)/2,S=0):(u=_/t,S=(r-e*u)/2,h=0),o.forEach(b=>{const A=document.querySelector(b.selector);if(!A)return;const q=s(b.top*u+S,b.left*u+h,b.width*u,b.height*u),F=m(q);l(F,q);const G=A.dataset.lpPosClass;G&&G!==F&&A.classList.remove(G),A.classList.contains(F)||A.classList.add(F),A.dataset.lpPosClass=F})}E(),window.addEventListener("resize",E)});console.log("Loading room-main.js...");const $t="wf-room-main-runtime";function ue(){let i=document.getElementById($t);return i||(i=document.createElement("style"),i.id=$t,document.head.appendChild(i)),i}const _t=new Map;function me(i){if(!i)return null;if(_t.has(i))return _t.get(i);const e=`rm-bg-${_t.size+1}`;return ue().appendChild(document.createTextNode(`#mainRoomPage.${e}{--room-bg-url:url('${i}');background-image:url('${i}');}`)),_t.set(i,e),e}class pe{constructor(){this.initialized=!1,this.init()}init(){if(this.initialized)return;if(!document.getElementById("mainRoomPage")){console.log("Not a room main page; RoomMainManager will not initialize."),this.initialized=!0;return}console.log("🐸 Room Main: Initializing..."),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>this.setup()):this.setup(),this.initialized=!0}setup(){document.getElementById("mainRoomPage")&&(this.setupBackground(),this.setupDoors(),this.setupNavigation(),this.setupBodyStyles(),this.setupModalAutoOpen(),this.setupCleanup(),console.log("🐸 Room Main: Initialization complete"))}setupBackground(){const t=document.getElementById("mainRoomPage");if(t){const e=t.getAttribute("data-bg-url");if(e){const n=me(e);t.dataset.bgClass&&t.dataset.bgClass!==n&&t.classList.remove(t.dataset.bgClass),n&&(t.classList.add(n),t.dataset.bgClass=n),t.classList.add("room-bg-loaded"),console.log("🖼️ Main room background loaded:",e)}}}setupDoors(){const t=document.querySelectorAll(".door-area");console.log(`🚪 Found ${t.length} door elements`),t.forEach((e,n)=>{e.classList.add("door-interactive"),e.setAttribute("tabindex","0"),e.setAttribute("role","button"),e.setAttribute("aria-label",`Open ${e.dataset.category||"room"}`),e.addEventListener("click",o=>{o.preventDefault();const a=e.dataset.room||e.getAttribute("data-room"),c=e.dataset.url||e.getAttribute("data-url");if(window.roomModalManager&&typeof window.roomModalManager.show=="function"){console.log(`🚪 Opening room modal for room ${a}`);try{window.roomModalManager.show(a)}catch(s){console.warn("Room modal open failed, navigating instead",s),c&&(window.location.href=c)}}else c?(console.log(`↪️ Navigating to ${c}`),window.location.href=c):console.warn("No room modal manager and no URL to navigate to. Door click ignored.")}),e.addEventListener("keydown",o=>{(o.key==="Enter"||o.key===" ")&&(o.preventDefault(),e.click())})}),console.log("🚪 Door positioning and accessibility configured")}setupNavigation(){const t=document.querySelector("nav.main-nav");t&&(t.classList.add("site-header"),console.log("🧭 Navigation configured for room overlay"))}setupBodyStyles(){document.body.classList.add("wf-no-scroll"),console.log("🚪 Body styles configured for fullscreen mode")}setupModalAutoOpen(){const e=new URLSearchParams(window.location.search).get("modal_room");if(e){const n=()=>{window.roomModalManager?(console.log(`🚪 Auto-opening modal for room: ${e}`),window.roomModalManager.show(e)):setTimeout(n,100)};setTimeout(n,500)}}setupCleanup(){window.addEventListener("beforeunload",()=>{document.body.classList.remove("wf-no-scroll")})}}const qt=new pe,fe=!!document.getElementById("mainRoomPage");fe&&(window.roomMainManager=qt,window.WhimsicalFrog&&typeof WhimsicalFrog.ready=="function"&&WhimsicalFrog.ready(i=>{i.addModule("RoomMainManager",qt)}),console.log("Room Main Manager loaded and initialized"));const Tt="room-modal-runtime-classes";function Gt(){let i=document.getElementById(Tt);return i||(i=document.createElement("style"),i.id=Tt,document.head.appendChild(i)),i}const St=new Map;function he(i){if(!i)return null;if(St.has(i))return St.get(i);const e=`room-bg-${St.size+1}`;return Gt().appendChild(document.createTextNode(`.room-overlay-wrapper.${e}, .room-modal-body.${e}{--room-bg-image:url('${i}');background-image:url('${i}');}`)),St.set(i,e),e}const Lt=new Map;function we(i,t,e,n){const o=Math.max(0,Math.round(Number(i)||0)),a=Math.max(0,Math.round(Number(t)||0)),c=Math.max(1,Math.round(Number(e)||1)),s=Math.max(1,Math.round(Number(n)||1)),m=`${o}-${a}-${c}-${s}`;if(Lt.has(m))return Lt.get(m);const l=`icon-pos-t${o}-l${a}-w${c}-h${s}`;return Gt().appendChild(document.createTextNode(`.room-product-icon.${l}{--icon-top:${o}px;--icon-left:${a}px;--icon-width:${c}px;--icon-height:${s}px;top:${o}px;left:${a}px;width:${c}px;height:${s}px;}`)),Lt.set(m,l),l}class Ut{constructor(){this.overlay=null,this.content=null,this.isLoading=!1,this.currentRoomNumber=null,this.roomCache=new Map,this.init()}init(){this.createModalStructure(),this.setupEventListeners()}createModalStructure(){if(document.getElementById("roomModalOverlay")){this.overlay=document.getElementById("roomModalOverlay"),this.content=this.overlay.querySelector(".room-modal-container");return}this.overlay=document.createElement("div"),this.overlay.id="roomModalOverlay",this.overlay.className="room-modal-overlay",this.overlay.setAttribute("role","dialog"),this.overlay.setAttribute("aria-modal","true"),this.overlay.setAttribute("aria-labelledby","room-modal-title"),this.overlay.setAttribute("aria-describedby","room-modal-content"),this.isVisible=!1,this.content=document.createElement("div"),this.content.className="room-modal-container";const t=document.createElement("div");t.className="room-modal-header";const e=document.createElement("button");e.className="room-modal-back-btn bg-primary",e.innerHTML="← Back to Main Room",e.addEventListener("click",s=>{s.preventDefault(),s.stopPropagation(),this.close()});const n=document.createElement("div");n.className="back-button-container",n.appendChild(e);const o=document.createElement("div");o.className="room-modal-title-container",o.classList.add("wf-brand-primary-bg");const a=document.createElement("h2");a.className="room-modal-title wf-brand-font",a.id="room-modal-title",a.textContent="Loading...",o.appendChild(a);const c=document.createElement("div");c.className="room-modal-body",t.appendChild(n),t.appendChild(o),this.content.appendChild(t),this.content.appendChild(c),this.overlay.appendChild(this.content),document.body.appendChild(this.overlay)}setupEventListeners(){this.overlay.addEventListener("click",t=>{t.target===this.overlay&&this.close()}),document.addEventListener("keydown",t=>{t.key==="Escape"&&this.isOpen()&&this.close()}),document.addEventListener("click",t=>{const e=t.target.closest("[data-room], .door-link, .room-door");if(e&&!t.defaultPrevented){t.preventDefault();const n=e.dataset.room||e.href?.match(/room=(\d+)/)?.[1]||e.getAttribute("data-room-number");n&&this.openRoom(n)}}),document.addEventListener("click",t=>{t.target.closest('[data-action="refresh-page"]')&&(t.preventDefault(),window.location.reload())})}async openRoom(t){if(!this.isLoading){this.currentRoomNumber=t,this.isLoading=!0,this.show(),this.setContent('<div class="loading">Loading room...</div>');try{let e=this.roomCache.get(t);if(!e){const n=await fetch(`/api/load_room_content.php?room=${encodeURIComponent(t)}&modal=1`,{headers:{"X-Requested-With":"XMLHttpRequest"}});if(!n.ok)throw new Error(`HTTP ${n.status}: ${n.statusText}`);const o=await n.json();if(!o.success)throw new Error(o.message||"Failed to load room content");e=o.content,o.metadata&&this.updateHeader(o.metadata),this.roomCache.set(t,e)}this.setContent(e),this.updateHeaderFromDOM(),window.WhimsicalFrog&&typeof window.WhimsicalFrog.emit=="function"&&window.WhimsicalFrog.emit("room:opened",{roomNumber:t,content:e});try{window.dispatchEvent(new CustomEvent("wf:room:open",{detail:{roomNumber:String(t)}}))}catch{}try{window.wfAnalytics?.track?.("wf:room:open",{roomNumber:String(t)})}catch{}}catch(e){console.error(`[Room] Error loading room ${t}:`,e),this.setContent(`
                <div class="error">
                    <h3>Unable to load room ${t}</h3>
                    <p>Please try again later.</p>
                    <button type="button" data-action="refresh-page">Refresh Page</button>
                </div>
            `)}finally{this.isLoading=!1}}}setContent(t){const e=this.overlay.querySelector(".room-modal-body");if(!e)return;const n=/<script[^>]*>([\s\S]*?)<\/script>/gi,o=[];let a;for(;(a=n.exec(t))!==null;)o.push(a[1]);e.innerHTML=t,o.forEach((c,s)=>{try{new Function(c)()}catch(m){console.error(`[Room] Error executing modal script ${s+1}:`,m)}}),this.initializeModalContent()}initializeModalContent(){const t=this.overlay.querySelector(".room-modal-body");if(!t)return;t.querySelectorAll("img").forEach(l=>{if(window.setupImageErrorHandling){const E=l.closest("[data-sku]")?.dataset.sku;window.setupImageErrorHandling(l,E)}}),t.querySelectorAll('.add-to-cart, [data-action="add-to-cart"]').forEach(l=>{l.addEventListener("click",E=>{E.preventDefault(),E.stopPropagation()})}),t.querySelectorAll("[data-product], .product-link").forEach(l=>{l.addEventListener("click",E=>{E.preventDefault(),window.WhimsicalFrog&&window.WhimsicalFrog.emit("product:modal-requested",{element:l,sku:l.dataset.product||l.dataset.sku})})}),t.querySelectorAll(".room-product-icon").forEach(l=>{const E=l.dataset.sku;if(!E)return;const _={sku:E,name:l.dataset.name,price:Number(l.dataset.price||0),retailPrice:Number(l.dataset.price||0),stockLevel:Number(l.dataset.stockLevel||0),category:l.dataset.category,image:l.dataset.image,description:l.dataset.description||"",marketingLabel:l.dataset.marketingLabel||""};let r,p,v,u;if(l.dataset.originalTop!==void 0&&l.dataset.originalTop!=="")r=parseFloat(l.dataset.originalTop),p=parseFloat(l.dataset.originalLeft),v=parseFloat(l.dataset.originalWidth),u=parseFloat(l.dataset.originalHeight);else{const b=getComputedStyle(l);r=parseFloat(b.top)||0,p=parseFloat(b.left)||0,v=parseFloat(b.width)||80,u=parseFloat(b.height)||80,l.dataset.originalTop=r,l.dataset.originalLeft=p,l.dataset.originalWidth=v,l.dataset.originalHeight=u}const h=()=>{typeof window.showGlobalPopup=="function"?window.showGlobalPopup(l,_):window.parent&&typeof window.parent.showGlobalPopup=="function"&&window.parent.showGlobalPopup(l,_)},S=()=>{typeof window.hideGlobalPopup=="function"?window.hideGlobalPopup():window.parent&&typeof window.parent.hideGlobalPopup=="function"&&window.parent.hideGlobalPopup()};l.addEventListener("mouseenter",h),l.addEventListener("focus",h),l.addEventListener("mouseleave",S),l.addEventListener("blur",S),l.addEventListener("click",b=>{b.preventDefault(),b.stopPropagation();try{window.dispatchEvent(new CustomEvent("wf:room:item_view",{detail:{roomNumber:String(this.currentRoomNumber||n||""),sku:E}}))}catch{}try{window.wfAnalytics?.track?.("wf:room:item_view",{roomNumber:String(this.currentRoomNumber||n||""),sku:E})}catch{}typeof window.showGlobalItemModal=="function"?window.showGlobalItemModal(E,_):window.parent&&typeof window.parent.showGlobalItemModal=="function"?window.parent.showGlobalItemModal(E,_):window.WhimsicalFrog&&window.WhimsicalFrog.emit("product:modal-requested",{element:l,sku:E})})});const e=this.overlay.querySelector("#modalRoomPage");if(!e)return;const n=e.getAttribute("data-room");n&&(window.ROOM_TYPE=`room${n}`,window.roomType=`room${n}`,window.roomNumber=n);const o=1280,a=896,c=this.overlay.querySelector(".room-overlay-wrapper")||this.overlay.querySelector(".room-modal-body"),s=async()=>{if(!c||!n)return;const l=`room${n}`;try{const _=await(await fetch(`/api/get_background.php?room_type=${l}`)).json();if(_.success&&_.background){const r=_.background;let v=document.documentElement.classList.contains("webp")&&r.webp_filename?r.webp_filename:r.image_filename;v.startsWith("backgrounds/")||(v=`backgrounds/${v}`);const u=`/images/${v}`,h=he(u);c.dataset.roomBgClass&&c.dataset.roomBgClass!==h&&c.classList.remove(c.dataset.roomBgClass),h&&(c.classList.add(h),c.dataset.roomBgClass=h)}}catch(E){console.error("[Room Modal] Error loading background:",E)}},m=()=>{if(!c)return;const l=c.getBoundingClientRect();if(l.width===0||l.height===0)return;const E=l.width/o,_=l.height/a,r=Math.max(E,_),p=o*r,v=a*r,u=(l.width-p)/2,h=(l.height-v)/2;t.querySelectorAll(".room-product-icon").forEach(b=>{let A,q,F,G;if(b.dataset.originalTop)A=parseFloat(b.dataset.originalTop),q=parseFloat(b.dataset.originalLeft),F=parseFloat(b.dataset.originalWidth),G=parseFloat(b.dataset.originalHeight);else{const H=getComputedStyle(b);A=parseFloat(H.getPropertyValue("--icon-top"))||parseFloat(H.top)||0,q=parseFloat(H.getPropertyValue("--icon-left"))||parseFloat(H.left)||0,F=parseFloat(H.getPropertyValue("--icon-width"))||parseFloat(H.width)||80,G=parseFloat(H.getPropertyValue("--icon-height"))||parseFloat(H.height)||80,b.dataset.originalTop=A,b.dataset.originalLeft=q,b.dataset.originalWidth=F,b.dataset.originalHeight=G}const U=Math.round(A*r+h),j=Math.round(q*r+u),O=Math.round(F*r),J=Math.round(G*r),V=we(U,j,O,J);b.dataset.iconPosClass&&b.dataset.iconPosClass!==V&&b.classList.remove(b.dataset.iconPosClass),b.classList.add("positioned"),b.classList.add(V),b.dataset.iconPosClass=V})};this._resizeHandler&&(window.removeEventListener("resize",this._resizeHandler),this._resizeHandler=null),this._resizeHandler=()=>{clearTimeout(this._resizeTimeout),this._resizeTimeout=setTimeout(m,100)},window.addEventListener("resize",this._resizeHandler),s().then(()=>{setTimeout(()=>{m(),setTimeout(m,500)},300)})}show(t){if(t!=null){this.openRoom(t);return}this.previouslyFocusedElement=document.activeElement,this.overlay.classList.add("show"),document.body.classList.add("modal-open","room-modal-open"),this.overlay.offsetHeight,window.WFModals?.lockScroll?.(),setTimeout(()=>{const e=this.overlay.querySelector(".room-modal-back-btn");e&&e.focus()},100)}close(){this._resizeHandler&&(window.removeEventListener("resize",this._resizeHandler),this._resizeHandler=null),this.overlay.classList.remove("show"),document.body.classList.remove("modal-open","room-modal-open"),setTimeout(()=>{window.WFModals?.unlockScrollIfNoneOpen?.(),this.previouslyFocusedElement&&(this.previouslyFocusedElement.focus(),this.previouslyFocusedElement=null)},300),window.WhimsicalFrog&&typeof window.WhimsicalFrog.emit=="function"&&window.WhimsicalFrog.emit("room:closed",{roomNumber:this.currentRoomNumber});try{window.dispatchEvent(new CustomEvent("wf:room:close",{detail:{roomNumber:String(this.currentRoomNumber||"")}}))}catch{}try{window.wfAnalytics?.track?.("wf:room:close",{roomNumber:String(this.currentRoomNumber||"")})}catch{}this.currentRoomNumber=null}goBack(){this.close()}isOpen(){return this.overlay&&this.overlay.classList.contains("show")}preloadRoomContent(){}getCurrentRoom(){return this.currentRoomNumber}clearCache(){this.roomCache.clear()}getCachedRooms(){return Array.from(this.roomCache.keys())}updateHeader(t={}){const e=this.overlay.querySelector(".room-modal-title");if(e){const n=t.room_name||t.category||`Room ${t.room_number||""}`;n&&(e.textContent=n)}}updateHeaderFromDOM(){const t=this.overlay.querySelector(".room-modal-title");if(!t)return;const n=this.overlay.querySelector(".room-modal-body")?.querySelector(".room-title-overlay h3");n&&n.textContent.trim()&&(t.textContent=n.textContent.trim())}}typeof window<"u"&&(window.RoomModalManager=Ut);(function(){try{let e=function(u){const h=u&&typeof u=="object"?{...u}:{};return"page"in h||(h.page=t.page),"url"in h||(h.url=t.url),!("userId"in h)&&t.userId&&(h.userId=t.userId),h},n=function(){try{const u=document&&document.body&&document.body.dataset;return(u?.currency||u?.currencyCode||"USD").toUpperCase()}catch{return"USD"}},o=function(u){try{const h=u?.sku||u?.id||u?.itemId||u?.baseSku,S=Number(u?.quantity||u?.qty||1),b=Number(u?.price||u?.value||0),A=u?.name||u?.title||void 0,q={item_id:String(h||""),item_name:A,price:b,quantity:S};return h?[q]:[]}catch{return[]}},a=function(u,h){const S=n(),b=o(h),A=Number(h?.total||h?.value||h?.price||0),q=h?.orderId||h?.transaction_id||void 0;switch(u){case"wf:page_view":return{name:"page_view",params:{}};case"wf:product_view":return{name:"view_item",params:{currency:S,value:A||b[0]?.price||0,items:b}};case"wf:product_add_attempt":case"wf:cart:add":return{name:"add_to_cart",params:{currency:S,value:A||b[0]?.price||0,items:b}};case"wf:cart:remove":return{name:"remove_from_cart",params:{currency:S,items:b}};case"wf:checkout:order_start":return{name:"begin_checkout",params:{currency:S,value:A||0,items:b}};case"wf:checkout:order_success":return{name:"purchase",params:{currency:S,value:A||0,transaction_id:q||String(Date.now()),items:b}};default:return null}},c=function(u,h){switch(u){case"wf:product_view":return{name:"Product Viewed",properties:h};case"wf:product_add_attempt":case"wf:cart:add":return{name:"Product Added",properties:h};case"wf:cart:remove":return{name:"Product Removed",properties:h};case"wf:checkout:order_start":return{name:"Checkout Started",properties:h};case"wf:checkout:order_success":return{name:"Order Completed",properties:h};default:return null}},s=function(u,h){try{if(!(window.analytics&&typeof window.analytics.track=="function"))return;const S=c(u,h);if(S){window.analytics.track(S.name,e(S.properties||{}));return}window.analytics.track(u,h)}catch{}},m=function(u,h){try{if(typeof window.gtag!="function")return;const S=a(u,h);if(S){window.gtag("event",S.name,S.params);return}window.gtag("event",u,h)}catch{}},l=function(u,h){try{const S=window.dataLayer||(window.dataLayer=[]);S.push({event:u,...h});const b=a(u,h);b&&(S.push({ecommerce:null}),S.push({event:b.name,ecommerce:b.params}))}catch{}},E=function(u,h){try{window.plausible&&window.plausible(u,{props:h})}catch{}},_=function(u,h){try{window.posthog&&typeof window.posthog.capture=="function"&&window.posthog.capture(u,h)}catch{}},r=function(u,h={}){const S=String(u||"").trim();if(!S)return;const b=e(h);s(S,b),m(S,b),l(S,b),E(S,b),_(S,b);try{console.debug("[wfAnalytics]",S,b)}catch{}},p=function(u,h={}){try{window.analytics&&typeof window.analytics.identify=="function"&&window.analytics.identify(u,h)}catch{}try{window.posthog&&typeof window.posthog.identify=="function"&&window.posthog.identify(u,h)}catch{}},v=function(u){try{const h=u?.type||"wf:event",S=u?.detail||{};r(h,S)}catch{}};if(typeof window>"u"||window.wfAnalytics&&window.wfAnalytics.__initialized)return;const t={get page(){try{return window.location?.pathname||"/"}catch{return"/"}},get url(){try{return window.location?.href||""}catch{return""}},get userId(){try{const u=document&&document.body&&document.body.dataset;return u?.userIdRaw||u?.userId||null}catch{return null}}};try{window.addEventListener("wf:ready",v),window.addEventListener("wf:login-success",v),window.addEventListener("wf:logout",v),["wf:checkout:open","wf:checkout:order_summary_viewed","wf:checkout:address_list_viewed","wf:checkout:address_select","wf:checkout:address_add","wf:checkout:address_add_error","wf:checkout:shipping_method_change","wf:checkout:payment_method_select","wf:checkout:pricing_updated","wf:checkout:pricing_error","wf:checkout:order_start","wf:checkout:order_success","wf:checkout:order_failure"].forEach(h=>window.addEventListener(h,v))}catch{}window.wfAnalytics={track:r,identify:p,__initialized:!0};try{window.dispatchEvent(new CustomEvent("wf:analytics-ready",{detail:{provider:"wfAnalytics"}}))}catch{}try{console.log("[wfAnalytics] initialized")}catch{}}catch(t){try{console.warn("[wfAnalytics] init failed",t)}catch{}}})();(function(){try{let t=function(o,a){try{window.wfAnalytics&&window.wfAnalytics.track&&window.wfAnalytics.track(o,a||{})}catch{}},e=function(){try{t("wf:page_view",{title:document?.title||"",referrer:document?.referrer||""})}catch{}},n=function(o){try{const a=o.querySelector('input[type="search"], input[name="q"], input[name="query"], input[name="s"]'),c=(a&&a.value||"").trim();if(!c)return;t("wf:search_submit",{query:c,action:o.getAttribute("action")||window.location.pathname})}catch{}};if(typeof window>"u"||window.__wfAnalyticsHooks)return;window.__wfAnalyticsHooks=!0,document.readyState==="loading"?document.addEventListener("DOMContentLoaded",e,{once:!0}):setTimeout(e,0),document.addEventListener("click",o=>{try{const a=o.target&&(o.target.closest?o.target.closest("a[href]"):null);if(!a)return;const c=a.getAttribute("href");if(!c||c.startsWith("mailto:")||c.startsWith("tel:")||c==="#"||c.startsWith("#"))return;const s=new URL(c,window.location.origin);if(s.origin!==window.location.origin)return;t("wf:navigation_click",{href:s.pathname+s.search+s.hash,text:(a.textContent||"").trim().slice(0,100),id:a.id||null,classes:a.className||""})}catch{}}),document.addEventListener("submit",o=>{const a=o.target;try{if(!a||a.nodeName!=="FORM")return;(a.getAttribute("role")==="search"||!!a.querySelector('input[type="search"], input[name="q"], input[name="query"], input[name="s"]'))&&n(a)}catch{}},!0),window.addEventListener("cartUpdated",o=>{try{const a=o?.detail||{},c=a.state||{},m=(Array.isArray(c.items)?c.items:[]).reduce((E,_)=>E+(Number(_.quantity)||0),0),l=Number(c.total||c.subtotal||0);t("wf:cart:updated",{action:a.action||"unknown",count:m,subtotal:l})}catch{}}),document.addEventListener("click",o=>{try{const a=o.target&&(o.target.closest?o.target.closest("[data-sku], [data-item-id]"):null);if(!a)return;const c=a.getAttribute("data-sku"),s=a.getAttribute("data-item-id");t("wf:product_click",{sku:c||null,itemId:s||null})}catch{}},!0),window.addEventListener("wf:form:success",o=>t("wf:form:success",o?.detail||{})),window.addEventListener("wf:form:error",o=>t("wf:form:error",o?.detail||{}));try{window.addEventListener("error",o=>{try{if(o?.error)t("wf:error",{message:String(o.error?.message||o.message||"error"),filename:o.filename||null,lineno:o.lineno||null,colno:o.colno||null,stack:String(o.error?.stack||"")});else if(o?.target&&(o.target.src||o.target.href)){const a=o.target,c=a.src||a.href||"";t("wf:error:resource",{tag:a.tagName,src:c})}}catch{}},!0),window.addEventListener("unhandledrejection",o=>{try{const a=o?.reason;t("wf:error:unhandledrejection",{message:String(a?.message||a||"unhandledrejection"),stack:String(a?.stack||"")})}catch{}})}catch{}try{const o=performance&&performance.getEntriesByType?performance.getEntriesByType("navigation")[0]:null;if(o){const l=Math.max(0,o.responseStart);t("wf:perf:ttfb",{ttfb:l})}let a=0,c=!1;if("PerformanceObserver"in window)try{const l=new PerformanceObserver(_=>{const r=_.getEntries(),p=r[r.length-1];p&&(a=p.startTime)});l.observe({type:"largest-contentful-paint",buffered:!0});const E=()=>{if(!c){c=!0;try{l.disconnect()}catch{}t("wf:perf:lcp",{lcp:Math.round(a)})}};document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&E()},{once:!0}),window.addEventListener("pagehide",E,{once:!0})}catch{}let s=0,m=!1;if("PerformanceObserver"in window)try{const l=new PerformanceObserver(_=>{for(const r of _.getEntries()){const p=r;p.hadRecentInput||(s+=p.value||0)}});l.observe({type:"layout-shift",buffered:!0});const E=()=>{if(!m){m=!0;try{l.disconnect()}catch{}t("wf:perf:cls",{cls:Number(s.toFixed(4))})}};document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&E()},{once:!0}),window.addEventListener("pagehide",E,{once:!0})}catch{}}catch{}}catch(t){try{console.warn("[wfAnalyticsHooks] init failed",t)}catch{}}})();class jt{constructor(){this.state={items:[],total:0,count:0,initialized:!1,notifications:!0},this.init()}init(){this.loadCart(),this.setupEventListeners(),this.updateCartDisplay(),this.state.initialized=!0;try{window.dispatchEvent(new CustomEvent("cartUpdated",{detail:{action:"init",state:this.getState()}}))}catch{}console.log("[Cart] System initialized")}loadCart(){try{const t=localStorage.getItem("whimsical_frog_cart");if(t){const e=JSON.parse(t);this.state.items=e.items||[],this.recalculateTotal(),console.log(`[Cart] Loaded ${this.state.items.length} items`)}}catch(t){console.error(`[Cart] Error loading cart: ${t.message}`),this.state.items=[]}}saveCart(){try{const t={items:this.state.items,total:this.state.total,count:this.state.count,timestamp:Date.now()};localStorage.setItem("whimsical_frog_cart",JSON.stringify(t))}catch(t){console.error(`[Cart] Error saving cart: ${t.message}`)}}addItem(t){if(!t||!t.sku)return console.error("[Cart] Invalid item data:",t),!1;const e=this.state.items.findIndex(a=>a.sku===t.sku),n=parseInt(t.quantity)||1;let o=!1;e>=0?this.state.items[e].quantity+=n:(this.state.items.push({...t,quantity:n,addedAt:Date.now()}),o=!0),this.recalculateTotal(),this.saveCart(),this.updateCartDisplay(),this.state.notifications&&this.showAddToCartNotifications(t,n,this.state.items.find(a=>a.sku===t.sku).quantity,o),window.WhimsicalFrog&&window.WhimsicalFrog.emit("cart:updated",{item:t,action:"add"});try{window.dispatchEvent(new CustomEvent("cartUpdated",{detail:{item:t,action:"add",state:this.getState()}}))}catch{}return!0}showAddToCartNotifications(t,e,n,o){const a=t.name||t.sku||"Item";parseFloat(t.price);let c=`${a} `;o?c+=`added to cart (${n})`:c+=`quantity updated (${n})`,this.showNotification(c,"success"),setTimeout(()=>{this.showCartStatusToast()},1500)}showCartStatusToast(){const t=this.state.count===1?"item":"items",e=`Cart: ${this.state.count} ${t} • $${this.state.total.toFixed(2)}`;this.showNotification(e,"info",3e3)}showNotification(t,e="info",n=2500){if(window.wfNotifications&&typeof window.wfNotifications.show=="function"){window.wfNotifications.show(t,e,{duration:n});return}if(typeof window.showNotification=="function"){window.showNotification(t,e,{duration:n});return}if(window.WhimsicalFrog&&typeof window.WhimsicalFrog.showNotification=="function"){window.WhimsicalFrog.showNotification(t,e,n);return}const o=document.createElement("div");o.className="cart-notification",e==="success"?o.classList.add("is-success"):e==="error"?o.classList.add("is-error"):o.classList.add("is-info"),o.textContent=t,document.body.appendChild(o),setTimeout(()=>{o.classList.add("show")},100),setTimeout(()=>{o.classList.remove("show"),setTimeout(()=>{o.parentNode&&o.parentNode.removeChild(o)},300)},n)}removeItem(t){const e=this.state.items.findIndex(n=>n.sku===t);if(e>=0){const n=this.state.items.splice(e,1)[0];this.recalculateTotal(),this.saveCart(),this.updateCartDisplay(),window.WhimsicalFrog&&window.WhimsicalFrog.emit("cart:updated",{item:n,action:"remove"});try{window.dispatchEvent(new CustomEvent("cartUpdated",{detail:{item:n,action:"remove",state:this.getState()}}))}catch{}return!0}return!1}updateItem(t,e){const n=this.state.items.find(o=>o.sku===t);if(n){if(n.quantity=Math.max(0,parseInt(e)||0),n.quantity===0)return this.removeItem(t);this.recalculateTotal(),this.saveCart(),this.updateCartDisplay(),window.WhimsicalFrog&&window.WhimsicalFrog.emit("cart:updated",{item:n,action:"update"});try{window.dispatchEvent(new CustomEvent("cartUpdated",{detail:{item:n,action:"update",state:this.getState()}}))}catch{}return!0}return!1}clearCart(){this.state.items=[],this.recalculateTotal(),this.saveCart(),this.updateCartDisplay(),window.WhimsicalFrog&&window.WhimsicalFrog.emit("cart:cleared");try{window.dispatchEvent(new CustomEvent("cartUpdated",{detail:{action:"clear",state:this.getState()}}))}catch{}}recalculateTotal(){this.state.total=this.state.items.reduce((t,e)=>t+(parseFloat(e.price)||0)*(parseInt(e.quantity)||0),0),this.state.count=this.state.items.reduce((t,e)=>t+(parseInt(e.quantity)||0),0)}updateCartDisplay(){document.querySelectorAll(".cart-count, .cart-counter, #cart-count").forEach(c=>{c.textContent=this.state.count,c.classList.toggle("hidden",this.state.count===0)}),document.querySelectorAll(".cart-total, #cart-total").forEach(c=>{c.textContent=`$${this.state.total.toFixed(2)}`}),document.querySelectorAll("#cartCount").forEach(c=>{const s=this.state.count===1?"item":"items";c.textContent=`${this.state.count} ${s}`}),document.querySelectorAll("#cartTotal").forEach(c=>{c.textContent=`$${this.state.total.toFixed(2)}`}),document.querySelectorAll(".cart-toggle, .cart-button").forEach(c=>{c.classList.toggle("has-items",this.state.count>0)})}setupEventListeners(){document.addEventListener("click",t=>{t.target.matches('.add-to-cart, [data-action="add-to-cart"]')&&(t.preventDefault(),this.handleAddToCartClick(t.target))}),document.addEventListener("change",t=>{if(t.target.matches(".cart-quantity-input")){const e=t.target.dataset.sku,n=parseInt(t.target.value)||0;this.updateItem(e,n)}}),document.addEventListener("click",t=>{const e=t.target&&t.target.closest&&t.target.closest('.remove-from-cart, [data-action="remove-from-cart"], .cart-item-remove');if(e){t.preventDefault();try{t.stopPropagation(),t.stopImmediatePropagation&&t.stopImmediatePropagation()}catch{}const n=e.dataset.sku||e.closest("[data-sku]")?.dataset.sku;n&&this.removeItem(n)}})}handleAddToCartClick(t){const e=t.closest("[data-sku]")||t.closest(".product-card")||t.closest(".product-item");if(!e){console.warn("[Cart] Could not find product container for add to cart button");return}const n={sku:e.dataset.sku||t.dataset.sku,name:e.dataset.name||e.querySelector(".product-name, .item-name")?.textContent?.trim(),price:e.dataset.price||e.querySelector(".product-price, .item-price")?.textContent?.replace(/[^0-9.]/g,""),image:e.dataset.image||e.querySelector("img")?.src,quantity:1};if(!n.sku){console.error("[Cart] No SKU found for item:",e);return}this.addItem(n)}async renderCart(){const t=document.getElementById("cartModalItems")||document.getElementById("cartItems");if(!t)return;const e=document.getElementById("cartModalFooter"),n=a=>`$${(parseFloat(a)||0).toFixed(2)}`;if(!this.state.items.length){t.innerHTML='<div class="p-6 text-center text-gray-600">Your cart is empty.</div>',e&&(e.innerHTML=`
                  <div class="cart-footer-bar">
                    <div class="cart-subtotal"><span>Subtotal</span><strong>${n(this.state.total)}</strong></div>
                    <a class="cart-checkout-btn is-disabled" aria-disabled="true">Checkout</a>
                  </div>
                `);return}const o=this.state.items.map(a=>{const c=(parseFloat(a.price)||0)*(parseInt(a.quantity)||0),s=a.image?`<img src="${a.image}" alt="${a.name||a.sku}" class="cart-item-image"/>`:"",m=[];a.optionGender&&m.push(a.optionGender),a.optionSize&&m.push(a.optionSize),a.optionColor&&m.push(a.optionColor);const l=m.length?`<div class="cart-item-options text-sm text-gray-500">${m.join(" • ")}</div>`:"";return`
                <div class="cart-item" data-sku="${a.sku}">
                  ${s}
                  <div class="cart-item-details">
                    <div class="cart-item-title">${a.name||a.sku}</div>
                    ${l}
                    <div class="cart-item-price">${n(a.price)}</div>
                  </div>
                  <div class="cart-item-quantity">
                    <input type="number" min="0" class="cart-quantity-input" data-sku="${a.sku}" value="${a.quantity}" />
                  </div>
                  <div class="cart-item-remove remove-from-cart" data-sku="${a.sku}" aria-label="Remove item" title="Remove">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-trash" viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false">
                      <polyline points="3 6 5 6 21 6"></polyline>
                      <path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"></path>
                      <path d="M10 11v6"></path>
                      <path d="M14 11v6"></path>
                      <path d="M9 6V4a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2"></path>
                    </svg>
                  </div>
                  <div class="cart-item-line-total">${n(c)}</div>
                </div>
              `}).join("");if(e){t.innerHTML=o;const a=this.state.count>0?"":"is-disabled",c=this.state.count>0?' href="/payment"':"";e.innerHTML=`
              <div class="cart-footer-bar">
                <div class="cart-subtotal"><span>Subtotal</span><strong>${n(this.state.total)}</strong></div>
                <a class="cart-checkout-btn ${a}"${c}>Checkout</a>
              </div>
            `}else{const a=`
              <div class="cart-summary">
                <div class="summary-row"><span>Subtotal</span><span>${n(this.state.total)}</span></div>
                <div class="summary-total">Total: <span>${n(this.state.total)}</span></div>
                <a class="cart-checkout-btn" href="/payment">Checkout</a>
              </div>
            `;t.innerHTML=o+a}}getItems(){return[...this.state.items]}getTotal(){return this.state.total}getCount(){return this.state.count}getState(){return{...this.state}}refreshFromStorage(){try{this.loadCart()}catch{}try{this.saveCart()}catch{}try{this.updateCartDisplay()}catch{}try{window.dispatchEvent(new CustomEvent("cartUpdated",{detail:{action:"refresh",state:this.getState()}}))}catch{}return this.getState()}setNotifications(t){this.state.notifications=!!t}}typeof window<"u"&&(window.CartSystem=jt);if(typeof window<"u"){if((window.__WF_MIN_BOOT||(window.__WF_MIN_BOOT={loads:0})).loads++,console.log("[Vite] Minimal app bootstrap loaded",window.__WF_MIN_BOOT.loads),window.apiGet=window.apiGet||wt,window.apiPost=window.apiPost||Wt,!window.roomModalManager)try{window.roomModalManager=new Ut,console.log("[Vite] RoomModalManager initialized")}catch(i){console.warn("[Vite] Failed to initialize RoomModalManager",i)}try{window.__WF_CartSystemInstance||(window.__WF_CartSystemInstance=new jt);const i=window.__WF_CartSystemInstance;window.WF_Cart=Object.assign(window.WF_Cart||{},{addItem:t=>{try{i.addItem(t);try{window.dispatchEvent(new CustomEvent("wf:cart:add",{detail:{sku:t?.sku||t?.id||null,quantity:t?.quantity??1}}))}catch{}try{window.wfAnalytics?.track?.("wf:cart:add",{sku:t?.sku||t?.id||null,quantity:t?.quantity??1})}catch{}return Promise.resolve()}catch(e){return Promise.reject(e)}},removeItem:t=>{try{const e=i.removeItem(t);try{window.dispatchEvent(new CustomEvent("wf:cart:remove",{detail:{sku:String(t)}}))}catch{}try{window.wfAnalytics?.track?.("wf:cart:remove",{sku:String(t)})}catch{}return Promise.resolve(e)}catch(e){return Promise.reject(e)}},updateQuantity:(t,e)=>{try{const n=i.updateItem(t,e);try{window.dispatchEvent(new CustomEvent("wf:cart:update",{detail:{sku:String(t),quantity:Number(e)}}))}catch{}try{window.wfAnalytics?.track?.("wf:cart:update",{sku:String(t),quantity:Number(e)})}catch{}return Promise.resolve(n)}catch(n){return Promise.reject(n)}},clearCart:()=>{try{i.clearCart();try{window.dispatchEvent(new CustomEvent("wf:cart:clear",{detail:{}}))}catch{}try{window.wfAnalytics?.track?.("wf:cart:clear",{})}catch{}return!0}catch{return!1}},renderCart:()=>i.renderCart(),refreshFromStorage:()=>i.refreshFromStorage(),updateCartDisplay:()=>i.updateCartDisplay(),getItems:()=>i.getItems(),getCount:()=>i.getCount(),getTotal:()=>i.getTotal()})}catch(i){console.warn("[Vite] CartSystem bridge failed",i)}}
