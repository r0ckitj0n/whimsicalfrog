const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/admin-reports-QEqgp-N2.js","assets/auto-C8LTT2Eg.js","assets/admin-marketing-DOemP6rh.js"])))=>i.map(i=>d[i]);
const te="modulepreload",oe=function(s){return"/"+s},U={},E=function(e,t,o){let n=Promise.resolve();if(t&&t.length>0){let a=function(i){return Promise.all(i.map(u=>Promise.resolve(u).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};var c=a;document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),d=l?.nonce||l?.getAttribute("nonce");n=a(t.map(i=>{if(i=oe(i),i in U)return;U[i]=!0;const u=i.endsWith(".css"),m=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${i}"]${m}`))return;const h=document.createElement("link");if(h.rel=u?"stylesheet":te,u||(h.as="script"),h.crossOrigin="",h.href=i,d&&h.setAttribute("nonce",d),document.head.appendChild(h),u)return new Promise((p,f)=>{h.addEventListener("load",p),h.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${i}`)))})}))}function r(l){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=l,window.dispatchEvent(d),!d.defaultPrevented)throw l}return n.then(l=>{for(const d of l||[])d.status==="rejected"&&r(d.reason);return e().catch(r)})};window.WhimsicalFrog&&window.WhimsicalFrog.Core?console.log("[WF-Core] Already loaded, skipping initialization"):function(){const s={version:"2.0.0",initialized:!1,debug:!0,modules:{},config:{}};window.handleImageError=function(a,i=null){const u=a.dataset.errorHandled||"none",m=a.src;if(u!=="final"){if(i){if(m.includes(`${i}A.webp`)){a.src=`images/items/${i}A.png`,a.dataset.errorHandled="png-tried";return}if(m.includes(`${i}A.png`)){a.src="images/items/placeholder.webp",a.dataset.errorHandled="final",a.onerror=null;return}}a.src="images/items/placeholder.webp",a.dataset.errorHandled="final",a.onerror=null}},window.handleImageErrorSimple=function(a){a.dataset.errorHandled||(a.src="images/items/placeholder.webp",a.dataset.errorHandled="final",a.onerror=null)},window.setupImageErrorHandling=function(a,i=null){!a||a.tagName!=="IMG"||(a.onerror=function(){window.handleImageError(this,i)})};function e(a,i="info"){if(!s.debug&&i!=="error")return;const u=new Date().toISOString(),m=`[WF-${i.toUpperCase()}]`;switch(i){case"error":console.error(`${m} ${u}`,a);break;case"warn":console.warn(`${m} ${u}`,a);break;case"debug":console.debug(`${m} ${u}`,a);break;default:console.log(`${m} ${u}`,a)}}function t(a,i){return s.modules[a]?(e(`Module '${a}' already registered, skipping`,"warn"),!1):(s.modules[a]={name:a,...i,initialized:!1},e(`Module '${a}' registered successfully`),!0)}const o={events:{},on(a,i){this.events[a]||(this.events[a]=[]),this.events[a].push(i)},emit(a,i){this.events[a]&&this.events[a].forEach(u=>{try{u(i)}catch(m){e(`Error in event handler for '${a}': ${m.message}`,"error")}})},off(a,i){this.events[a]&&(this.events[a]=this.events[a].filter(u=>u!==i))}},n={debounce(a,i){let u;return function(...h){const p=()=>{clearTimeout(u),a(...h)};clearTimeout(u),u=setTimeout(p,i)}},formatCurrency(a){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(a)},escapeHtml(a){const i=document.createElement("div");return i.textContent=a,i.innerHTML},generateId(){return"_"+Math.random().toString(36).substr(2,9)}},r={async request(a,i={}){const u={credentials:"same-origin",headers:{"Content-Type":"application/json",...i.headers}};try{const m=await fetch(a,{...u,...i});if(!m.ok)throw new Error(`API request failed: ${m.status} ${m.statusText}`);const h=m.headers.get("content-type");return h&&h.includes("application/json")?await m.json():await m.text()}catch(m){throw e(`API request error: ${m.message}`,"error"),m}},get(a,i={}){return this.request(a,{...i,method:"GET"})},post(a,i=null,u={}){return this.request(a,{...u,method:"POST",body:i?JSON.stringify(i):null})},put(a,i=null,u={}){return this.request(a,{...u,method:"PUT",body:i?JSON.stringify(i):null})},delete(a,i={}){return this.request(a,{...i,method:"DELETE"})}};function c(){if(s.initialized){e("Core already initialized, skipping","warn");return}e("Initializing WhimsicalFrog Core..."),Object.values(s.modules).forEach(a=>{if(a.init&&typeof a.init=="function")try{a.init(),a.initialized=!0,e(`Module '${a.name}' initialized successfully`)}catch(i){e(`Failed to initialize module '${a.name}': ${i.message}`,"error")}}),s.initialized=!0,e("Core initialization complete")}window.WhimsicalFrog={Core:s,log:e,registerModule:t,on:o.on.bind(o),emit:o.emit.bind(o),off:o.off.bind(o),utils:n,api:r,getState:()=>s,getConfig:()=>s.config,getModule:a=>s.modules[a],addModule:t,ready(a){s.initialized?a():o.on("core:ready",a)}},window.WF=window.WhimsicalFrog,window.wf=window.WhimsicalFrog,s.initialized&&o.emit("core:ready",s);const l=window.fetch;window.fetch=function(a,i={}){return i.credentials=i.credentials||"same-origin",l(a,i)},document.readyState==="loading"?document.addEventListener("DOMContentLoaded",c):setTimeout(c,0);function d(){document.querySelectorAll("img[data-height]").forEach(i=>{const u=i.getAttribute("data-height");u&&(i.style.height=u+"px")})}document.addEventListener("DOMContentLoaded",function(){document.body.hasAttribute("data-wf-image-height-setup")||(d(),document.body.setAttribute("data-wf-image-height-setup","true"))}),e("WhimsicalFrog Core loaded successfully")}();class V{constructor(){this.state={items:[],total:0,count:0,initialized:!1,notifications:!0},this.init()}init(){this.loadCart(),this.setupEventListeners(),this.state.initialized=!0,console.log("[Cart] System initialized")}loadCart(){try{const e=localStorage.getItem("whimsical_frog_cart");if(e){const t=JSON.parse(e);this.state.items=t.items||[],this.recalculateTotal(),console.log(`[Cart] Loaded ${this.state.items.length} items`)}}catch(e){console.error(`[Cart] Error loading cart: ${e.message}`),this.state.items=[]}}saveCart(){try{const e={items:this.state.items,total:this.state.total,count:this.state.count,timestamp:Date.now()};localStorage.setItem("whimsical_frog_cart",JSON.stringify(e))}catch(e){console.error(`[Cart] Error saving cart: ${e.message}`)}}addItem(e){if(!e||!e.sku)return console.error("[Cart] Invalid item data:",e),!1;const t=this.state.items.findIndex(r=>r.sku===e.sku);let o=parseInt(e.quantity)||1,n=!1;return t>=0?this.state.items[t].quantity+=o:(this.state.items.push({...e,quantity:o,addedAt:Date.now()}),n=!0),this.recalculateTotal(),this.saveCart(),this.updateCartDisplay(),this.state.notifications&&this.showAddToCartNotifications(e,o,this.state.items.find(r=>r.sku===e.sku).quantity,n),window.WhimsicalFrog&&window.WhimsicalFrog.emit("cart:updated",{item:e,action:"add"}),!0}showAddToCartNotifications(e,t,o,n){const r=e.name||e.sku||"Item";parseFloat(e.price);let c=`${r} `;n?c+=`added to cart (${o})`:c+=`quantity updated (${o})`,this.showNotification(c,"success"),setTimeout(()=>{this.showCartStatusToast()},1500)}showCartStatusToast(){const e=this.state.count===1?"item":"items",t=`Cart: ${this.state.count} ${e} â€¢ $${this.state.total.toFixed(2)}`;this.showNotification(t,"info",3e3)}showNotification(e,t="info",o=2500){if(window.WhimsicalFrog&&window.WhimsicalFrog.showNotification){window.WhimsicalFrog.showNotification(e,t,o);return}const n=document.createElement("div");n.className=`cart-notification notification-${t}`,n.textContent=e,n.style.cssText=`
            position: fixed;
            top: 20px;
            right: 20px;
            background: ${t==="success"?"#4CAF50":t==="error"?"#f44336":"#2196F3"};
            color: white;
            padding: 12px 20px;
            border-radius: 4px;
            z-index: 10000;
            font-size: 14px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            transform: translateX(100%);
            transition: transform 0.3s ease;
        `,document.body.appendChild(n),setTimeout(()=>{n.style.transform="translateX(0)"},100),setTimeout(()=>{n.style.transform="translateX(100%)",setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n)},300)},o)}removeItem(e){const t=this.state.items.findIndex(o=>o.sku===e);if(t>=0){const o=this.state.items.splice(t,1)[0];return this.recalculateTotal(),this.saveCart(),this.updateCartDisplay(),window.WhimsicalFrog&&window.WhimsicalFrog.emit("cart:updated",{item:o,action:"remove"}),!0}return!1}updateItem(e,t){const o=this.state.items.find(n=>n.sku===e);return o?(o.quantity=Math.max(0,parseInt(t)||0),o.quantity===0?this.removeItem(e):(this.recalculateTotal(),this.saveCart(),this.updateCartDisplay(),window.WhimsicalFrog&&window.WhimsicalFrog.emit("cart:updated",{item:o,action:"update"}),!0)):!1}clearCart(){this.state.items=[],this.recalculateTotal(),this.saveCart(),this.updateCartDisplay(),window.WhimsicalFrog&&window.WhimsicalFrog.emit("cart:cleared")}recalculateTotal(){this.state.total=this.state.items.reduce((e,t)=>e+(parseFloat(t.price)||0)*(parseInt(t.quantity)||0),0),this.state.count=this.state.items.reduce((e,t)=>e+(parseInt(t.quantity)||0),0)}updateCartDisplay(){document.querySelectorAll(".cart-count, .cart-counter, #cart-count").forEach(n=>{n.textContent=this.state.count,n.style.display=this.state.count>0?"inline":"none"}),document.querySelectorAll(".cart-total, #cart-total").forEach(n=>{n.textContent=`$${this.state.total.toFixed(2)}`}),document.querySelectorAll(".cart-toggle, .cart-button").forEach(n=>{n.classList.toggle("has-items",this.state.count>0)})}setupEventListeners(){document.addEventListener("click",e=>{e.target.matches('.add-to-cart, [data-action="add-to-cart"]')&&(e.preventDefault(),this.handleAddToCartClick(e.target))}),document.addEventListener("change",e=>{if(e.target.matches(".cart-quantity-input")){const t=e.target.dataset.sku,o=parseInt(e.target.value)||0;this.updateItem(t,o)}}),document.addEventListener("click",e=>{if(e.target.matches('.remove-from-cart, [data-action="remove-from-cart"]')){e.preventDefault();const t=e.target.dataset.sku||e.target.closest("[data-sku]")?.dataset.sku;t&&this.removeItem(t)}})}handleAddToCartClick(e){const t=e.closest("[data-sku]")||e.closest(".product-card")||e.closest(".product-item");if(!t){console.warn("[Cart] Could not find product container for add to cart button");return}const o={sku:t.dataset.sku||e.dataset.sku,name:t.dataset.name||t.querySelector(".product-name, .item-name")?.textContent?.trim(),price:t.dataset.price||t.querySelector(".product-price, .item-price")?.textContent?.replace(/[^0-9.]/g,""),image:t.dataset.image||t.querySelector("img")?.src,quantity:1};if(!o.sku){console.error("[Cart] No SKU found for item:",t);return}this.addItem(o)}getItems(){return[...this.state.items]}getTotal(){return this.state.total}getCount(){return this.state.count}getState(){return{...this.state}}setNotifications(e){this.state.notifications=!!e}}typeof window<"u"&&(window.CartSystem=V);class Y{constructor(){this.overlay=null,this.content=null,this.isLoading=!1,this.currentRoomNumber=null,this.roomCache=new Map,this.init()}init(){console.log("[Room] Modal manager initializing..."),this.createModalStructure(),this.setupEventListeners()}createModalStructure(){if(document.getElementById("roomModalOverlay")){console.log("[Room] Using existing modal overlay"),this.overlay=document.getElementById("roomModalOverlay"),this.content=this.overlay.querySelector(".room-modal-container");return}console.log("[Room] Creating new modal overlay structure"),this.overlay=document.createElement("div"),this.overlay.id="roomModalOverlay",this.overlay.className="room-modal-overlay",this.overlay.setAttribute("role","dialog"),this.overlay.setAttribute("aria-modal","true"),this.overlay.setAttribute("aria-labelledby","room-modal-title"),this.overlay.setAttribute("aria-describedby","room-modal-content"),this.isVisible=!1,this.overlay.style.display="none",this.content=document.createElement("div"),this.content.className="room-modal-container";const e=document.createElement("div");e.className="room-modal-header",e.style.cssText=`
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            background: transparent;
            color: white;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            z-index: 10000;
            pointer-events: auto;
        `;const t=document.createElement("button");t.className="room-modal-back-btn bg-primary",t.innerHTML="â† Back to Main Room",t.style.cssText=`
            align-self: flex-start;

            background-color: var(--button-bg-primary, #87ac3a);
            border: 1px solid var(--button-bg-primary, #87ac3a);
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
        `,t.addEventListener("click",c=>{c.preventDefault(),c.stopPropagation(),this.close()});const o=document.createElement("div");o.className="room-modal-title-container",o.style.cssText=`
            text-align: right;
            margin-left: auto;
            padding: 8px 16px;
            background: transparent;
            color: white;
        `;const n=document.createElement("h2");n.className="room-modal-title",n.id="room-modal-title",n.textContent="Loading...",n.style.cssText=`
            margin: 0;
            font-size: 1.4rem;
            font-weight: 600;
            color: white;
            text-align: right;
        `,o.appendChild(n);const r=document.createElement("div");r.className="room-modal-body",e.appendChild(t),e.appendChild(o),this.content.appendChild(e),this.content.appendChild(r),this.overlay.appendChild(this.content),document.body.appendChild(this.overlay)}setupEventListeners(){console.log("[Room] Setting up event listeners...");const e=this.overlay.querySelector(".room-modal-close-btn");e&&e.addEventListener("click",()=>this.close());const t=this.overlay.querySelector(".room-modal-back-btn");t&&t.addEventListener("click",()=>this.goBack()),this.overlay.addEventListener("click",o=>{o.target===this.overlay&&this.close()}),document.addEventListener("keydown",o=>{o.key==="Escape"&&this.isOpen()&&this.close()}),document.addEventListener("click",o=>{console.log("[Room] Click detected on:",o.target);const n=o.target.closest("[data-room], .door-link, .room-door");if(console.log("[Room] Door link found:",n),n&&!o.defaultPrevented){console.log("[Room] Processing door click..."),o.preventDefault();const r=n.dataset.room||n.href?.match(/room=(\d+)/)?.[1]||n.getAttribute("data-room-number");console.log("[Room] Room number extracted:",r),r?(console.log("[Room] Opening room:",r),this.openRoom(r)):console.log("[Room] No room number found")}}),console.log("[Room] Event listeners registered successfully")}async openRoom(e){if(this.isLoading){console.log("[Room] Already loading, skipping request");return}console.log(`[Room] Opening room ${e}`),this.currentRoomNumber=e,this.isLoading=!0,this.show(),this.setContent('<div class="loading">Loading room...</div>');try{let t=this.roomCache.get(e);if(!t){const n=await fetch(`/api/load_room_content.php?room=${e}&modal=1`,{headers:{"X-Requested-With":"XMLHttpRequest"}});if(!n.ok)throw new Error(`HTTP ${n.status}: ${n.statusText}`);const r=await n.json();if(!r.success)throw new Error(r.message||"Failed to load room content");t=r.content,r.metadata&&this.updateHeader(r.metadata),this.roomCache.set(e,t),console.log(`[Room] Cached content for room ${e}`),console.log("[Room] Room metadata:",r.metadata)}this.setContent(t);const o=this.overlay.querySelector(".room-title-overlay");o&&o.remove(),this.updateHeaderFromDOM(),window.WhimsicalFrog&&window.WhimsicalFrog.emit("room:opened",{roomNumber:e,content:t})}catch(t){console.error(`[Room] Error loading room ${e}:`,t),this.setContent(`
                <div class="error">
                    <h3>Unable to load room ${e}</h3>
                    <p>Please try again later.</p>
                    <button onclick="window.location.reload()">Refresh Page</button>
                </div>
            `)}finally{this.isLoading=!1}}setContent(e){const t=this.overlay.querySelector(".room-modal-body");if(t){const o=/<script[^>]*>([\s\S]*?)<\/script>/gi,n=[];let r;for(;(r=o.exec(e))!==null;)n.push(r[1]);t.innerHTML=e,n.forEach((c,l)=>{try{console.log(`[Room] Executing modal script ${l+1}`),new Function(c)()}catch(d){console.error(`[Room] Error executing modal script ${l+1}:`,d)}}),this.initializeModalContent()}}initializeModalContent(){const e=this.overlay.querySelector(".room-modal-body");if(!e)return;e.querySelectorAll("img").forEach(l=>{if(window.setupImageErrorHandling){const d=l.closest("[data-sku]")?.dataset.sku;window.setupImageErrorHandling(l,d)}}),e.querySelectorAll('.add-to-cart, [data-action="add-to-cart"]').forEach(l=>{l.addEventListener("click",d=>{d.preventDefault(),d.stopPropagation()})}),e.querySelectorAll("[data-product], .product-link").forEach(l=>{l.addEventListener("click",d=>{d.preventDefault(),window.WhimsicalFrog&&window.WhimsicalFrog.emit("product:modal-requested",{element:l,sku:l.dataset.product||l.dataset.sku})})}),e.querySelectorAll(".room-product-icon").forEach(l=>{const d=l.dataset.sku;if(!d)return;const a={sku:d,name:l.dataset.name,price:Number(l.dataset.price||0),retailPrice:Number(l.dataset.price||0),stockLevel:Number(l.dataset.stockLevel||0),category:l.dataset.category,image:l.dataset.image,description:l.dataset.description||"",marketingLabel:l.dataset.marketingLabel||""};let i,u,m,h;if(l.dataset.originalTop!==void 0&&l.dataset.originalTop!=="")i=parseFloat(l.dataset.originalTop),u=parseFloat(l.dataset.originalLeft),m=parseFloat(l.dataset.originalWidth),h=parseFloat(l.dataset.originalHeight);else{const g=parseFloat(l.style.top)||0,k=parseFloat(l.style.left)||0,w=parseFloat(l.style.width)||80,y=parseFloat(l.style.height)||80;i=g,u=k,m=w,h=y,l.dataset.originalTop=i,l.dataset.originalLeft=u,l.dataset.originalWidth=m,l.dataset.originalHeight=h,console.log(`[Room Modal] Fallback inline coords for icon: top=${i}, left=${u}, w=${m}, h=${h}`)}const p=()=>{console.log("[IconHover] mouseenter on icon",l,a),typeof window.showGlobalPopup=="function"?window.showGlobalPopup(l,a):window.parent&&typeof window.parent.showGlobalPopup=="function"&&window.parent.showGlobalPopup(l,a)},f=()=>{console.log("[IconHover] mouseleave on icon",l),typeof window.hideGlobalPopup=="function"?window.hideGlobalPopup():window.parent&&typeof window.parent.hideGlobalPopup=="function"&&window.parent.hideGlobalPopup()};l.addEventListener("mouseenter",p),l.addEventListener("focus",p),l.addEventListener("mouseleave",f),l.addEventListener("blur",f),l.addEventListener("click",g=>{console.log("[IconClick] Icon clicked",l,a),g.preventDefault(),g.stopPropagation(),typeof window.showGlobalItemModal=="function"?window.showGlobalItemModal(d,a):window.parent&&typeof window.parent.showGlobalItemModal=="function"?window.parent.showGlobalItemModal(d,a):window.WhimsicalFrog&&window.WhimsicalFrog.emit("product:modal-requested",{element:l,sku:d})})});const c=this.overlay.querySelector("#modalRoomPage");if(c){const l=c.getAttribute("data-room");l&&(window.ROOM_TYPE=`room${l}`,window.roomType=`room${l}`,window.roomNumber=l,console.log(`[Room Modal] Set global room variables: ROOM_TYPE=${window.ROOM_TYPE}, roomNumber=${window.roomNumber}`));const d=1280,a=896,i=this.overlay.querySelector(".room-overlay-wrapper"),u=async()=>{if(!i||!l)return;const h=`room${l}`;try{const f=await(await fetch(`/api/get_background.php?room_type=${h}`)).json();if(f.success&&f.background){const g=f.background;let w=document.documentElement.classList.contains("webp")&&g.webp_filename?g.webp_filename:g.image_filename;w.startsWith("backgrounds/")||(w=`backgrounds/${w}`);const y=`/images/${w}`;i.style.setProperty("--room-bg-image",`url('${y}')`),getComputedStyle(i).getPropertyValue("--room-bg-image")||(i.style.backgroundImage=`url('${y}')`,i.classList.add("dynamic-room-bg-loaded")),console.log(`[Room Modal] Background loaded: ${y}`)}}catch(p){console.error("[Room Modal] Error loading background:",p)}},m=()=>{if(!i)return;const h=i.getBoundingClientRect();if(h.width===0||h.height===0)return;const p=h.width/d,f=h.height/a,g=Math.max(p,f),k=d*g,w=a*g,y=(h.width-k)/2,L=(h.height-w)/2,A=e.querySelectorAll(".room-product-icon");A.forEach(v=>{let M,P,x,C;if(v.dataset.originalTop)M=parseFloat(v.dataset.originalTop),P=parseFloat(v.dataset.originalLeft),x=parseFloat(v.dataset.originalWidth),C=parseFloat(v.dataset.originalHeight);else{const S=getComputedStyle(v);M=parseFloat(S.getPropertyValue("--icon-top"))||parseFloat(v.style.top)||0,P=parseFloat(S.getPropertyValue("--icon-left"))||parseFloat(v.style.left)||0,x=parseFloat(S.getPropertyValue("--icon-width"))||parseFloat(v.style.width)||80,C=parseFloat(S.getPropertyValue("--icon-height"))||parseFloat(v.style.height)||80,v.dataset.originalTop=M,v.dataset.originalLeft=P,v.dataset.originalWidth=x,v.dataset.originalHeight=C,console.log(`[Room Modal] Fallback inline coords for icon: top=${M}, left=${P}, w=${x}, h=${C}`)}const B=Math.round(M*g+L),R=Math.round(P*g+y),W=Math.round(x*g),O=Math.round(C*g);v.style.setProperty("--icon-top",B+"px"),v.style.setProperty("--icon-left",R+"px"),v.style.setProperty("--icon-width",W+"px"),v.style.setProperty("--icon-height",O+"px")}),console.log(`[Room Modal] Scaled ${A.length} product icons with scale factor: ${g.toFixed(3)}`)};this._resizeHandler&&(window.removeEventListener("resize",this._resizeHandler),this._resizeHandler=null),this._resizeHandler=()=>{clearTimeout(this._resizeTimeout),this._resizeTimeout=setTimeout(m,100)},window.addEventListener("resize",this._resizeHandler),u().then(()=>{setTimeout(()=>{m(),setTimeout(m,500)},300)})}}show(){console.log("[Room] ðŸŽ­ show() method called"),console.log("[Room] ðŸŽ­ overlay element:",this.overlay),console.log("[Room] ðŸŽ­ overlay classList before:",this.overlay?.classList.toString()),this.previouslyFocusedElement=document.activeElement,this.overlay.style.display="flex",this.overlay.classList.add("show"),this.overlay.offsetHeight,this.overlay.style.opacity="1",WFModals?.lockScroll?.(),setTimeout(()=>{const e=this.overlay.querySelector(".room-modal-close-btn");e&&(e.focus(),console.log("[Room] ðŸŽ­ Focus set to close button for accessibility"))},100),console.log("[Room] ðŸŽ­ overlay classList after:",this.overlay.classList.toString()),console.log("[Room] ðŸŽ­ overlay opacity after:",this.overlay.style.opacity),console.log("[Room] ðŸŽ­ Modal should now be visible with .show class!")}close(){console.log("[Room] ðŸŽ­ close() method called"),console.log("[Room] ðŸŽ­ overlay classList before close:",this.overlay?.classList.toString()),this._resizeHandler&&(window.removeEventListener("resize",this._resizeHandler),this._resizeHandler=null),this.overlay.style.opacity="0",this.overlay.classList.remove("show"),console.log("[Room] ðŸŽ­ overlay classList after show removal:",this.overlay?.classList.toString()),setTimeout(()=>{this.overlay.style.display="none",WFModals?.unlockScrollIfNoneOpen?.(),this.previouslyFocusedElement&&(this.previouslyFocusedElement.focus(),console.log("[Room] ðŸŽ­ Focus restored to previously focused element for accessibility"),this.previouslyFocusedElement=null),console.log("[Room] ðŸŽ­ Modal fully closed and hidden")},300),window.WhimsicalFrog&&window.WhimsicalFrog.emit("room:closed",{roomNumber:this.currentRoomNumber}),this.currentRoomNumber=null}goBack(){this.close()}isOpen(){return this.overlay&&this.overlay.style.display!=="none"}preloadRoomContent(){console.log("[Room] Ready for room content loading")}getCurrentRoom(){return this.currentRoomNumber}clearCache(){this.roomCache.clear(),console.log("[Room] Cache cleared")}getCachedRooms(){return Array.from(this.roomCache.keys())}updateHeader(e={}){const t=this.overlay.querySelector(".room-modal-title");if(t){const o=e.room_name||e.category||`Room ${e.room_number||""}`;o&&(t.textContent=o)}}updateHeaderFromDOM(){const e=this.overlay.querySelector(".room-modal-title");if(!e)return;const o=this.overlay.querySelector(".room-modal-body")?.querySelector(".room-title-overlay h3");o&&o.textContent.trim()&&(e.textContent=o.textContent.trim())}}typeof window<"u"&&(window.RoomModalManager=Y);class X{constructor(){this.modal=null,this.searchInput=null,this.isSearching=!1,this.currentSearchTerm="",this.currentResults=[],this.init()}init(){console.log("[Search] System initializing..."),this.createModalHTML(),this.setupReferences(),this.bindEvents()}createModalHTML(){if(document.getElementById("searchModal")){console.log("[Search] Using existing search modal");return}document.body.insertAdjacentHTML("beforeend",`
            <div id="searchModal" class="search-modal" style="display: none;">
                <div class="search-modal-content">
                    <div class="search-modal-header">
                        <h2 class="search-modal-title">Search Results</h2>
                        <button class="search-modal-close" type="button">&times;</button>
                    </div>
                    <div class="search-modal-body" id="searchModalBody">
                        <!-- Search results will be populated here -->
                    </div>
                </div>
            </div>
        `);const t=document.createElement("style");t.textContent=`
            .search-modal {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.7);
                z-index: 9998;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            .search-modal-content {
                background: white;
                border-radius: 8px;
                max-width: 90vw;
                max-height: 90vh;
                overflow: auto;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
                min-width: 500px;
            }
            .search-modal-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 16px 20px;
                border-bottom: 1px solid #eee;
                background: #f8f9fa;
                border-radius: 8px 8px 0 0;
            }
            .search-modal-title {
                margin: 0;
                font-size: 18px;
            }
            .search-modal-close {
                background: none;
                border: none;
                font-size: 24px;
                cursor: pointer;
                padding: 0;
                width: 30px;
                height: 30px;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            .search-modal-body {
                padding: 20px;
                min-height: 200px;
            }
            .search-result-item {
                border-bottom: 1px solid #eee;
                padding: 15px 0;
            }
            .search-result-item:last-child {
                border-bottom: none;
            }
            .search-result-title {
                font-weight: bold;
                margin-bottom: 5px;
                color: #007bff;
                text-decoration: none;
            }
            .search-result-title:hover {
                text-decoration: underline;
            }
            .search-result-description {
                color: #666;
                font-size: 14px;
            }
            .search-loading {
                text-align: center;
                padding: 40px;
                color: #666;
            }
            .search-no-results {
                text-align: center;
                padding: 40px;
                color: #666;
            }
        `,document.head.appendChild(t)}setupReferences(){this.modal=document.getElementById("searchModal"),this.searchInput=document.getElementById("headerSearchInput")||document.querySelector('.search-input, input[type="search"]'),this.searchInput||console.log("[Search] No search input found, search functionality disabled")}bindEvents(){if(this.searchInput){if(this.searchInput.addEventListener("keypress",e=>{if(e.key==="Enter"){e.preventDefault();const t=this.searchInput.value.trim();t&&this.performSearch(t)}}),document.addEventListener("click",e=>{if(e.target.matches('.search-button, [data-action="search"]')){e.preventDefault();const t=this.searchInput.value.trim();t&&this.performSearch(t)}}),this.modal){const e=this.modal.querySelector(".search-modal-close");e&&e.addEventListener("click",()=>this.close()),this.modal.addEventListener("click",t=>{t.target===this.modal&&this.close()})}document.addEventListener("keydown",e=>{e.key==="Escape"&&this.isOpen()&&this.close()})}}async performSearch(e){if(this.isSearching){console.log("[Search] Already searching, skipping request");return}console.log(`[Search] Performing search for: "${e}"`),this.currentSearchTerm=e,this.isSearching=!0,this.open(),this.setContent('<div class="search-loading">Searching...</div>');try{const t=`/api/search_items.php?q=${encodeURIComponent(e)}`,o=await fetch(t,{method:"GET",headers:{"X-Requested-With":"XMLHttpRequest"}});if(!o.ok)throw new Error(`Search request failed: ${o.status}`);const n=await o.json();this.currentResults=n,this.displayResults(n,e),window.WhimsicalFrog&&window.WhimsicalFrog.emit("search:completed",{term:e,results:n})}catch(t){console.error("[Search] Error performing search:",t),this.setContent(`
                <div class="search-no-results">
                    <h3>Search Error</h3>
                    <p>Unable to perform search. Please try again later.</p>
                </div>
            `)}finally{this.isSearching=!1}}displayResults(e,t){if(!e||e.length===0){this.setContent(`
                <div class="search-no-results">
                    <h3>No Results Found</h3>
                    <p>No items found for "${t}". Try different keywords.</p>
                </div>
            `);return}let o=`<div class="search-results-header">
            <p>Found ${e.length} result${e.length!==1?"s":""} for "${t}"</p>
        </div>`;e.forEach(n=>{o+=`
                <div class="search-result-item">
                    <a href="${n.url||"#"}" class="search-result-title">
                        ${this.escapeHtml(n.title||n.name||"Untitled")}
                    </a>
                    <div class="search-result-description">
                        ${this.escapeHtml(n.description||n.excerpt||"")}
                        ${n.price?`<br><strong>Price: $${parseFloat(n.price).toFixed(2)}</strong>`:""}
                    </div>
                </div>
            `}),this.setContent(o)}setContent(e){const t=this.modal?.querySelector(".search-modal-body");t&&(t.innerHTML=e,this.initializeResultsContent())}initializeResultsContent(){const e=this.modal?.querySelector(".search-modal-body");if(!e)return;e.querySelectorAll(".search-result-title").forEach(o=>{o.addEventListener("click",n=>{this.close()})})}open(){if(this.modal){this.modal.style.display="flex",document.body.style.overflow="hidden";const e=this.modal.querySelector('input[type="search"], .search-input');e&&setTimeout(()=>e.focus(),100)}}close(){this.modal&&(this.modal.style.display="none",document.body.style.overflow=""),window.WhimsicalFrog&&window.WhimsicalFrog.emit("search:closed",{term:this.currentSearchTerm})}isOpen(){return this.modal&&this.modal.style.display!=="none"}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}search(e){return this.searchInput&&(this.searchInput.value=e),this.performSearch(e)}getCurrentTerm(){return this.currentSearchTerm}getCurrentResults(){return[...this.currentResults]}clearResults(){this.currentResults=[],this.currentSearchTerm="",this.searchInput&&(this.searchInput.value="")}}typeof window<"u"&&(window.SearchSystem=X);class J{constructor(){this.hoverTimeout=null,this.hideTimeout=null,this.currentPopup=null,this.init()}init(){console.log("[Sales] System initializing..."),this.setupEventListeners(),this.initializePageSpecificFeatures()}async checkItemSale(e){try{const o=await(await fetch(`sales.php?action=get_active_sales&item_sku=${e}`,{headers:{"X-Requested-With":"XMLHttpRequest"}})).json();return o.success&&o.sale?{isOnSale:!0,discountPercentage:parseFloat(o.sale.discount_percentage),salePrice:null,originalPrice:null}:{isOnSale:!1}}catch(t){return console.log("[Sales] Error checking sale for",e,t),{isOnSale:!1}}}calculateSalePrice(e,t){return e*(1-t/100)}async checkAndDisplaySalePrice(e,t,o=null,n="popup"){if(!(!e||!t))try{const r=await this.checkItemSale(e.sku);if(r.isOnSale&&r.discountPercentage){const c=parseFloat(e.retailPrice||e.price),l=parseFloat(r.discountPercentage);if(isNaN(l)||l<=0){console.error("[Sales] Invalid discount percentage:",r.discountPercentage);const i=parseFloat(e.retailPrice||e.price);t.textContent=`$${i.toFixed(2)}`,o&&(o.textContent=`$${i.toFixed(2)}`);return}const d=this.calculateSalePrice(c,l),a=`${l}% off`;t.innerHTML=`
                    <span class="sale-price">$${d.toFixed(2)}</span>
                    <span class="original-price" style="text-decoration: line-through; color: #999; margin-left: 8px;">$${c.toFixed(2)}</span>
                    <span class="discount-badge" style="background: #e74c3c; color: white; padding: 2px 6px; border-radius: 3px; font-size: 0.8em; margin-left: 8px;">${a}</span>
                `,o&&(o.innerHTML=`
                        <span class="sale-price">$${d.toFixed(2)}</span>
                        <span class="original-price" style="text-decoration: line-through; color: #999; margin-left: 5px;">$${c.toFixed(2)}</span>
                    `),e.salePrice=d,e.originalPrice=c,e.price=d}else{const c=parseFloat(e.retailPrice||e.price);t.textContent=`$${c.toFixed(2)}`,o&&(o.textContent=`$${c.toFixed(2)}`)}}catch(r){console.error("[Sales] Error in checkAndDisplaySalePrice:",r);const c=parseFloat(e.retailPrice||e.price);t.textContent=`$${c.toFixed(2)}`,o&&(o.textContent=`$${c.toFixed(2)}`)}}addSaleBadgeToCard(e,t){if(!e||!t)return;const o=e.querySelector(".sale-badge");o&&o.remove();const n=document.createElement("div");n.className="sale-badge",n.textContent=`${t}% OFF`,n.style.cssText=`
            position: absolute;
            top: 10px;
            right: 10px;
            background: #e74c3c;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            z-index: 10;
        `,getComputedStyle(e).position==="static"&&(e.style.position="relative"),e.appendChild(n)}hidePopup(){this.currentPopup&&(this.currentPopup.style.display="none")}keepPopupVisible(){this.hideTimeout&&(clearTimeout(this.hideTimeout),this.hideTimeout=null)}async updatePopupContent(e,t){if(!e||!t)return;const o=e.querySelector(".popup-content")||e;o.innerHTML='<div class="popup-loading">Loading...</div>';try{const n=await this.checkItemSale(t.sku);let r="";if(n.isOnSale&&n.discountPercentage){const c=parseFloat(t.retailPrice||t.price);r=`
                    <div class="popup-price">
                        <span class="sale-price">$${this.calculateSalePrice(c,n.discountPercentage).toFixed(2)}</span>
                        <span class="original-price" style="text-decoration: line-through; color: #999;">$${c.toFixed(2)}</span>
                        <span class="discount-badge">${n.discountPercentage}% OFF</span>
                    </div>
                `}else r=`<div class="popup-price">$${parseFloat(t.retailPrice||t.price).toFixed(2)}</div>`;o.innerHTML=`
                <div class="popup-header">
                    <h3 class="popup-title">${this.escapeHtml(t.name||t.sku)}</h3>
                </div>
                <div class="popup-body">
                    ${t.image?`<img src="${t.image}" alt="${this.escapeHtml(t.name||t.sku)}" style="max-width: 100px; height: auto; margin-bottom: 10px;">`:""}
                    ${r}
                    ${t.description?`<p class="popup-description">${this.escapeHtml(t.description)}</p>`:""}
                    <button class="add-to-cart-popup" data-sku="${t.sku}">Add to Cart</button>
                </div>
            `,e.style.cssText=`
                position: absolute;
                background: white;
                border: 1px solid #ddd;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                padding: 15px;
                max-width: 300px;
                z-index: 1000;
                font-size: 14px;
            `}catch(n){console.error("[Sales] Error updating popup content:",n),o.innerHTML=`
                <div class="popup-error">
                    <h3>${this.escapeHtml(t.name||t.sku)}</h3>
                    <p>Unable to load details</p>
                </div>
            `}}positionPopup(e,t){if(!e||!t)return;const o=e.getBoundingClientRect(),n=t.getBoundingClientRect();let r=o.bottom+window.scrollY+10,c=o.left+window.scrollX;c+n.width>window.innerWidth&&(c=window.innerWidth-n.width-10),r+n.height>window.innerHeight+window.scrollY&&(r=o.top+window.scrollY-n.height-10),t.style.top=`${r}px`,t.style.left=`${c}px`}setupEventListeners(){document.addEventListener("mouseenter",async e=>{if(!e.target||typeof e.target.closest!="function")return;const t=e.target.closest("[data-sku], .product-card, .product-item");if(!t)return;const o=t.dataset.sku;o&&(this.hoverTimeout&&clearTimeout(this.hoverTimeout),this.hideTimeout&&clearTimeout(this.hideTimeout),this.hoverTimeout=setTimeout(async()=>{let n=document.getElementById(`popup-${o}`);n||(n=document.createElement("div"),n.id=`popup-${o}`,n.className="product-popup",document.body.appendChild(n));const r={sku:o,name:t.dataset.name||t.querySelector(".product-name, .item-name")?.textContent?.trim(),price:t.dataset.price||t.querySelector(".product-price, .item-price")?.textContent?.replace(/[^0-9.]/g,""),image:t.dataset.image||t.querySelector("img")?.src,description:t.dataset.description};await this.updatePopupContent(n,r),this.positionPopup(t,n),n.style.display="block",this.currentPopup=n,n.addEventListener("mouseenter",()=>this.keepPopupVisible()),n.addEventListener("mouseleave",()=>{this.hideTimeout=setTimeout(()=>this.hidePopup(),300)})},500))},!0),document.addEventListener("mouseleave",e=>{!e.target||typeof e.target.closest!="function"||!e.target.closest("[data-sku], .product-card, .product-item")||(this.hoverTimeout&&(clearTimeout(this.hoverTimeout),this.hoverTimeout=null),this.hideTimeout=setTimeout(()=>this.hidePopup(),300))},!0)}initializePageSpecificFeatures(){((window.WF_PAGE_INFO?.page||(window.location.pathname==="/"?"landing":window.location.pathname.replace(/^\//,"").split("/")[0])||"landing")==="shop"||window.location.pathname.includes("shop"))&&this.initializeShopPage(),this.setupRoomHover()}async initializeShopPage(){console.log("[Sales] Initializing shop page features...");const e=document.querySelectorAll("[data-sku], .product-card");for(const t of e){const o=t.dataset.sku;if(o)try{const n=await this.checkItemSale(o);if(n.isOnSale&&n.discountPercentage){this.addSaleBadgeToCard(t,n.discountPercentage);const r=t.querySelector(".product-price, .item-price");if(r){const c=parseFloat(r.textContent.replace(/[^0-9.]/g,"")),l=this.calculateSalePrice(c,n.discountPercentage);r.innerHTML=`
                                <span class="sale-price">$${l.toFixed(2)}</span>
                                <span class="original-price" style="text-decoration: line-through; color: #999; font-size: 0.9em;">$${c.toFixed(2)}</span>
                            `}}}catch(n){console.error("[Sales] Error processing card for SKU:",o,n)}}}setupRoomHover(){console.log("[Sales] Room hover functionality ready")}escapeHtml(e){if(!e)return"";const t=document.createElement("div");return t.textContent=e,t.innerHTML}async getItemSaleInfo(e){return await this.checkItemSale(e)}calculateDiscount(e,t){return this.calculateSalePrice(e,t)}addSaleBadge(e,t){this.addSaleBadgeToCard(e,t)}}typeof window<"u"&&(window.SalesSystem=J,window.checkItemSale=async s=>window.WF_Sales?await window.WF_Sales.checkItemSale(s):{isOnSale:!1},window.calculateSalePrice=(s,e)=>window.WF_Sales?window.WF_Sales.calculateSalePrice(s,e):s);class _{static async request(e,t={}){const o={headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},credentials:"same-origin"},n={...o,...t,headers:{...o.headers,...t.headers}};try{const r=await fetch(e,n);if(!r.ok)throw new Error(`HTTP ${r.status}: ${r.statusText}`);const c=await r.json();if(c.success===!1)throw new Error(c.error||"API request failed");return c}catch(r){throw console.error("[API] Request failed:",r),r}}static async get(e,t={}){return this.request(e,{...t,method:"GET"})}static async post(e,t=null,o={}){const n={...o,method:"POST"};return t&&(n.body=JSON.stringify(t)),this.request(e,n)}static async put(e,t=null,o={}){const n={...o,method:"PUT"};return t&&(n.body=JSON.stringify(t)),this.request(e,n)}static async delete(e,t={}){return this.request(e,{...t,method:"DELETE"})}}class b{static async setContent(e,t,o=!1){e&&(o&&(e.innerHTML=this.createLoadingSpinner(),await new Promise(n=>setTimeout(n,100))),e.innerHTML=t)}static createLoadingSpinner(e="Loading..."){return`
            <div class="loading-spinner" style="display: flex; align-items: center; justify-content: center; padding: 20px;">
                <div style="width: 20px; height: 20px; border: 2px solid #f3f3f3; border-top: 2px solid #333; border-radius: 50%; animation: spin 1s linear infinite; margin-right: 10px;"></div>
                <span>${this.escapeHtml(e)}</span>
            </div>
            <style>
                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
            </style>
        `}static createErrorMessage(e){return`
            <div class="error-message" style="background: #fee; border: 1px solid #fcc; color: #a00; padding: 10px; border-radius: 4px; margin: 10px 0;">
                <strong>Error:</strong> ${this.escapeHtml(e)}
            </div>
        `}static createSuccessMessage(e){return`
            <div class="success-message" style="background: #efe; border: 1px solid #cfc; color: #060; padding: 10px; border-radius: 4px; margin: 10px 0;">
                <strong>Success:</strong> ${this.escapeHtml(e)}
            </div>
        `}static showToast(e,t="info",o=3e3){const n={success:{bg:"#4caf50",text:"white"},error:{bg:"#f44336",text:"white"},info:{bg:"#2196f3",text:"white"},warning:{bg:"#ff9800",text:"white"}},r=n[t]||n.info,c=document.createElement("div");return c.style.cssText=`
            position: fixed;
            top: 20px;
            right: 20px;
            background: ${r.bg};
            color: ${r.text};
            padding: 12px 20px;
            border-radius: 4px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 10000;
            font-size: 14px;
            max-width: 300px;
            word-wrap: break-word;
            transition: opacity 0.3s ease, transform 0.3s ease;
            transform: translateX(100%);
            opacity: 0;
        `,c.textContent=e,document.body.appendChild(c),setTimeout(()=>{c.style.transform="translateX(0)",c.style.opacity="1"},10),setTimeout(()=>{c.style.transform="translateX(100%)",c.style.opacity="0",setTimeout(()=>{c.parentNode&&c.parentNode.removeChild(c)},300)},o),c}static debounce(e,t){let o;return function(...r){const c=()=>{clearTimeout(o),e(...r)};clearTimeout(o),o=setTimeout(c,t)}}static formatCurrency(e){return isNaN(e)?"$0.00":`$${parseFloat(e).toFixed(2)}`}static escapeHtml(e){if(!e)return"";const t=document.createElement("div");return t.textContent=e,t.innerHTML}static confirm(e,t="Confirm"){return new Promise(o=>{const n=document.createElement("div");n.style.cssText=`
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                z-index: 10001;
                display: flex;
                align-items: center;
                justify-content: center;
            `;const r=document.createElement("div");r.style.cssText=`
                background: white;
                padding: 20px;
                border-radius: 8px;
                box-shadow: 0 4px 20px rgba(0,0,0,0.3);
                max-width: 400px;
                width: 90%;
                text-align: center;
            `,r.innerHTML=`
                <h3 style="margin: 0 0 15px 0; color: #333;">${this.escapeHtml(t)}</h3>
                <p style="margin: 0 0 20px 0; color: #666;">${this.escapeHtml(e)}</p>
                <div style="display: flex; gap: 10px; justify-content: center;">
                    <button class="confirm-btn" style="background: #2196f3; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">Confirm</button>
                    <button class="cancel-btn" style="background: #999; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">Cancel</button>
                </div>
            `,n.appendChild(r),document.body.appendChild(n);const c=()=>{n.parentNode&&n.parentNode.removeChild(n)};r.querySelector(".confirm-btn").addEventListener("click",()=>{c(),o(!0)}),r.querySelector(".cancel-btn").addEventListener("click",()=>{c(),o(!1)}),n.addEventListener("click",l=>{l.target===n&&(c(),o(!1))}),setTimeout(()=>{r.querySelector(".confirm-btn").focus()},100)})}static throttle(e,t){let o;return function(...n){o||(e.apply(this,n),o=!0,setTimeout(()=>o=!1,t))}}static deepClone(e){if(e===null||typeof e!="object")return e;if(e instanceof Date)return new Date(e.getTime());if(e instanceof Array)return e.map(t=>this.deepClone(t));if(typeof e=="object"){const t={};for(const o in e)e.hasOwnProperty(o)&&(t[o]=this.deepClone(e[o]));return t}}}class K{constructor(){this.api=_,this.dom=b,this.init()}init(){console.log("[Utils] Consolidated utilities initialized"),this.toast=b.showToast,this.confirm=b.confirm,this.debounce=b.debounce,this.throttle=b.throttle,this.formatCurrency=b.formatCurrency,this.escapeHtml=b.escapeHtml,this.deepClone=b.deepClone}async get(e,t={}){return _.get(e,t)}async post(e,t=null,o={}){return _.post(e,t,o)}async put(e,t=null,o={}){return _.put(e,t,o)}async delete(e,t={}){return _.delete(e,t)}showSuccess(e,t=3e3){return b.showToast(e,"success",t)}showError(e,t=5e3){return b.showToast(e,"error",t)}showInfo(e,t=3e3){return b.showToast(e,"info",t)}showWarning(e,t=4e3){return b.showToast(e,"warning",t)}}typeof window<"u"&&(window.WhimsicalFrogUtils=K,window.ApiClient=_,window.DOMUtils=b,window.apiGet=(s,e={})=>_.get(s,e),window.apiPost=(s,e=null,t={})=>_.post(s,e,t),window.apiPut=(s,e=null,t={})=>_.put(s,e,t),window.apiDelete=(s,e={})=>_.delete(s,e),window.showToast=b.showToast,window.confirm=b.confirm,window.debounce=b.debounce,window.throttle=b.throttle,window.formatCurrency=b.formatCurrency,window.escapeHtml=b.escapeHtml);const ne="/api/";function ie(s){return s.startsWith("http://")||s.startsWith("https://")||s.startsWith("/")?s:`${ne}${s}`}async function H(s,e,t=null,o={}){const n=ie(e),r={method:s,headers:{"Content-Type":"application/json",...o.headers},credentials:"same-origin",...o};s!=="GET"&&t!==null&&(r.body=JSON.stringify(t));const c=await fetch(n,r),l=c.headers.get("content-type")||"",d=l.includes("application/json");if(!c.ok){let a;try{a=d?await c.json():await c.text()}catch{a="Could not parse error response."}let i="An unknown error occurred.";throw typeof a=="string"?i=a:a&&a.message?i=a.message:i=JSON.stringify(a),new Error(`API Error (${c.status}): ${i}`)}return c.status===204||!l?null:d?c.json():c.text()}function se(s,e={}){return H("GET",s,null,e)}function ae(s,e=null,t={}){return H("POST",s,e,t)}const q={get:se,post:ae,request:H},F={modules:new Map,readyCallbacks:[],initialized:!1,api:q,eventBus:{events:{},on(s,e){this.events[s]||(this.events[s]=[]),this.events[s].push(e)},emit(s,e){this.events[s]&&this.events[s].forEach(t=>t(e))}},log(s,e="info"){const t="ðŸ¸ [WF]";switch(e){case"warn":console.warn(`${t} ${s}`);break;case"error":console.error(`${t} ${s}`);break;default:console.log(`${t} ${s}`);break}},registerModule(s,e){this.log(`Registering module: ${s}`),this.modules.set(s,e)},getModule(s){return this.modules.get(s)},ready(s){return this.initialized?s(this):this.readyCallbacks.push(s),this},init(){this.initialized||(this.initialized=!0,this.log("Core Initialized"),this.readyCallbacks.forEach(s=>{try{s(this)}catch(e){this.log(`Error in ready callback: ${e}`,"error")}}),this.readyCallbacks=[])}};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>F.init()):F.init();const re={init(){this.WF=F,this.ensureSingleNavigation(),this.updateMainCartCounter(),this.setupEventListeners(),this.handleLoginForm(),this.WF.log("Main Application module initialized.")},ensureSingleNavigation(){const s=document.querySelectorAll("nav.main-nav");s.length>1&&(this.WF.log(`Found ${s.length} navigation elements, removing duplicates...`),s.forEach((e,t)=>{t>0&&e.remove()}))},updateMainCartCounter(){const s=document.getElementById("cartCount");window.cart&&s&&(s.textContent=`${window.cart.getCount()} items`)},setupEventListeners(){this.WF.eventBus&&this.WF.eventBus.on("cartUpdated",()=>this.updateMainCartCounter()),this.WF.ready(()=>this.updateMainCartCounter())},handleLoginForm(){const s=document.getElementById("loginForm");s&&s.addEventListener("submit",async e=>{e.preventDefault();const t=s.querySelector("#username").value,o=s.querySelector("#password").value,n=s.querySelector("#errorMessage");n&&n.classList.add("hidden");try{const r=await this.WF.api.post("/functions/process_login.php",{username:t,password:o});sessionStorage.setItem("user",JSON.stringify(r.user||r)),r.redirectUrl?window.location.href=r.redirectUrl:localStorage.getItem("pendingCheckout")==="true"?(localStorage.removeItem("pendingCheckout"),window.location.href="/checkout"):window.location.href="/dashboard"}catch(r){n&&(n.textContent=r.message||"Invalid username or password.",n.classList.remove("hidden")),console.error("Login failed:",r)}})},async loadModalBackground(s){if(!s){this.WF.log("[MainApplication] No roomType provided for modal background.","warn");return}try{const e=await this.WF.api.get(`/api/get_background.php?room_type=${s}`);if(e&&e.success&&e.background){const{webp_path:t,png_path:o}=e.background;let r=document.documentElement.classList.contains("webp")?t:o;r.startsWith("backgrounds/")||(r=`backgrounds/${r}`);const c=`/images/${r}?v=${Date.now()}`,l=document.querySelector(".room-modal-overlay");l?l.style.setProperty("--dynamic-bg-url",`url('${c}')`):this.WF.log("[MainApplication] Modal overlay not found for background.","warn")}else this.WF.log(`[MainApplication] No background found for roomType: ${s}`,"info")}catch(e){this.WF.log(`[MainApplication] Error loading modal background: ${e}`,"error")}}};F.ready(()=>re.init());function le(s,e){let t;return function(...n){const r=()=>{clearTimeout(t),s(...n)};clearTimeout(t),t=setTimeout(r,e)}}console.log("Utils loaded");const ce={init(){this.categoryButtons=document.querySelectorAll(".category-btn"),this.productCards=document.querySelectorAll(".product-card"),this.productsGrid=document.getElementById("productsGrid"),!(!this.productsGrid||this.categoryButtons.length===0)&&(this.setupEventListeners(),setTimeout(()=>this.equalizeCardHeights(),300),F.log("Shop Page module initialized."))},setupEventListeners(){this.categoryButtons.forEach(s=>{s.addEventListener("click",e=>this.filterByCategory(e))}),window.addEventListener("resize",le(()=>this.equalizeCardHeights(),200))},filterByCategory(s){const e=s.currentTarget,t=e.dataset.category;F.log(`Filtering by category: ${t}`),this.categoryButtons.forEach(o=>o.classList.remove("active")),e.classList.add("active"),this.productCards.forEach(o=>{const n=o.dataset.category,r=t==="all"||n===t;o.classList.toggle("hidden",!r)}),setTimeout(()=>this.equalizeCardHeights(),50)},equalizeCardHeights(){const s=Array.from(this.productCards).filter(e=>!e.classList.contains("hidden"));s.length!==0&&(s.forEach(e=>{e.style.height="auto"}),requestAnimationFrame(()=>{const e=Math.max(...s.map(t=>t.offsetHeight));e>0&&s.forEach(t=>{t.style.height=`${e}px`})}))}};F.ready(()=>ce.init());console.log("ðŸšª [DBG] dynamic-background-loader.js loaded");async function j(s){try{if(new URLSearchParams(window.location.search).get("from")==="main"){console.log("Coming from main room - using CSS room background with main room body background");return}const o=await apiGet(`/api/get_background.php?room_type=${s}`);if(o.success&&o.background){const n=o.background,r=n.webp_filename||n.image_filename,c=r.startsWith("background_")?r:`background_${r}`,l=window.location.origin+`/images/backgrounds/${c}?v=${Date.now()}`,d=document.getElementById("modalRoomPage")?document.querySelector(".room-modal-iframe-container"):document.getElementById("mainRoomPage")||document.getElementById("landingPage");d?(d.style.backgroundImage=`url('${l}')`,d.classList.add("dynamic-room-bg-loaded"),console.log(`Dynamic room background loaded: ${n.background_name} (${l})`)):console.log("Room wrapper not found, using fallback background")}else console.log("Using fallback room background - no dynamic background found")}catch(e){console.error("Error loading dynamic room background:",e),console.log("Using fallback room background due to error")}}async function de(){try{console.log("ðŸ” Looking for #landingPage element...");const s=document.querySelector("#landingPage");if(console.log("ðŸ” landingPage element found:",s),s){console.log("ðŸŽ¯ Detected landing page, loading landing background"),j("landing");return}else console.log("âŒ No #landingPage element found, continuing to room detection...");const e=await apiGet("/api/get_room_coordinates.php");if(!e.success){console.error("Failed to get room data:",e.message),console.log("Background system will operate in degraded mode");return}if(!e.data.roomDoors||e.data.roomDoors.length===0){console.log("No room doors found - background system will use default");return}const t=e.data.roomTypeMapping,o=e.data.roomDoors,n=document.querySelector("[data-room-name]");if(n){const r=n.getAttribute("data-room-name");let c="";const l=o.find(d=>d.room_name.toLowerCase()===r.toLowerCase()||d.door_label.toLowerCase()===r.toLowerCase());if(l)c=t[l.room_number];else{const a=new URLSearchParams(window.location.search).get("page")||"";t[a.replace("room","")]&&(c=a)}c&&j(c)}}catch(s){console.error("Error loading dynamic room background:",s)}}document.addEventListener("DOMContentLoaded",de);console.log("ðŸŽ¯ Loading Simple Room Coordinate System...");function $(s){console.log(`ðŸŽ¯ Initializing simple coordinate system for ${s}...`);const e=document.querySelector(".room-overlay-wrapper");if(!e){console.error("âŒ Room overlay wrapper not found");return}console.log("âœ… Room overlay wrapper found:",e),console.log(`ðŸ“¡ Fetching coordinates from /api/get_room_coordinates.php?room_type=${s}`),fetch(`/api/get_room_coordinates.php?room_type=${s}`).then(t=>(console.log("ðŸ“¡ Response received:",t.status,t.statusText),t.json())).then(t=>{console.log("ðŸ“¡ Data received:",t),t.success&&t.coordinates?(console.log("âœ… Coordinates loaded:",t.coordinates),ue(t.coordinates)):console.error("âŒ Failed to load coordinates:",t.message)}).catch(t=>{console.error("âŒ Error loading coordinates:",t)})}function ue(s){console.log("ðŸŽ¯ Applying simple coordinates...");const e=window.innerWidth;let t;e<=480?t=400/1280:e<=768?t=800/1280:t=1600/1280,console.log(`ðŸ“ Screen width: ${e}px, Scale factor: ${t}`),s.forEach((o,n)=>{const r=document.getElementById(`item-icon-${n}`);if(r){const c=Math.round(o.top*t),l=Math.round(o.left*t),d=Math.round(o.width*t),a=Math.round(o.height*t);r.style.position="absolute",r.style.top=`${c}px`,r.style.left=`${l}px`,r.style.width=`${d}px`,r.style.height=`${a}px`,console.log(`âœ… Item ${n}: positioned at ${l},${c} (${d}x${a})`)}else console.warn(`âš ï¸ Item ${n} not found`)})}window.simpleCoordinateSystem=$;document.addEventListener("DOMContentLoaded",function(){console.log("ðŸŽ¯ DOM loaded, checking for room type..."),console.log("ðŸŽ¯ Available window variables:",{ROOM_TYPE:window.ROOM_TYPE,roomType:window.roomType,roomNumber:window.roomNumber}),window.ROOM_TYPE?(console.log(`ðŸŽ¯ Room type found: ${window.ROOM_TYPE}`),$(window.ROOM_TYPE)):window.roomType?(console.log(`ðŸŽ¯ Room type found (fallback): ${window.roomType}`),$(window.roomType)):(console.log("âš ï¸ No room type found, waiting..."),setTimeout(()=>{console.log("ðŸŽ¯ Retrying after delay..."),console.log("ðŸŽ¯ Available window variables after delay:",{ROOM_TYPE:window.ROOM_TYPE,roomType:window.roomType,roomNumber:window.roomNumber}),window.ROOM_TYPE?(console.log(`ðŸŽ¯ Room type found after delay: ${window.ROOM_TYPE}`),$(window.ROOM_TYPE)):window.roomType?(console.log(`ðŸŽ¯ Room type found after delay (fallback): ${window.roomType}`),$(window.roomType)):console.error("âŒ Still no room type found")},500))});window.addEventListener("resize",function(){console.log("ðŸŽ¯ Window resized, reapplying coordinates..."),window.ROOM_TYPE?$(window.ROOM_TYPE):window.roomType&&$(window.roomType)});window.apiGet=q.get;window.apiPost=q.post;window.apiRequest=q.request;console.log("[api-aliases] Global API aliases registered");(function(){if(typeof window>"u")return;async function s(e,t=window,o=5e3,n=100){const r=e.split("."),c=Date.now()+o;return new Promise(l=>{function d(){let a=t;for(const i of r)if(a&&i in a)a=a[i];else{a=null;break}if(typeof a=="function")return l(!0);if(Date.now()>c)return l(!1);setTimeout(d,n)}d()})}window.waitForFunction=s,console.log("[wait-for-function] Utility registered")})();console.log("Loading modal-manager.js...");(function(){const e=[".room-modal-overlay.show",".wf-revealco-overlay.show","#global-confirmation-modal.show",".image-viewer-modal-open",".confirmation-modal-overlay.show","#searchModal.show",".wf-login-overlay.show","#quantityModal:not(.hidden)","#detailedItemModal:not(.hidden)",".modal-overlay.show",".modal-overlay:not(.hidden)",".admin-modal-overlay.show",".admin-modal-overlay:not(.hidden)"].join(", ");function t(){return!!document.querySelector(e)}function o(){document.body.classList.add("modal-open"),document.documentElement.classList.add("modal-open")}function n(){t()||(document.body.classList.remove("modal-open"),document.documentElement.classList.remove("modal-open"))}window.WFModals=window.WFModals||{},window.WFModals.SELECTOR_ANY_OPEN=e,window.WFModals.isAnyModalOpen=t,window.WFModals.lockScroll=o,window.WFModals.unlockScrollIfNoneOpen=n,console.log("[WFModals] initialized")})();console.log("modal-manager.js loaded successfully");(function(){let s=null,e=null;function t(){document.getElementById("globalModalContainer")?e=document.getElementById("globalModalContainer"):(e=document.createElement("div"),e.id="globalModalContainer",document.body.appendChild(e))}async function o(i,u=null){console.log("ðŸ”§ showGlobalItemModal called with SKU:",i,"itemData:",u);try{t(),console.log("ðŸ”§ Modal container initialized");let m,h;if(u)m=u,h=u.images||[],console.log("ðŸ”§ Using provided item data:",m);else{console.log("ðŸ”§ Fetching item data from API for SKU:",i);const k=await apiGet("/api/inventory.php");if(console.log("ðŸ”§ API response - found",k.length,"items"),m=k.find(w=>w.sku===i),!m)throw new Error(`Item with SKU ${i} not found`);h=[],console.log("ðŸ”§ Item data loaded:",m),console.log("Item data loaded:",m),console.log("Item stock level:",m.stockLevel),console.log("All item fields:",Object.keys(m)),console.log("Full item data:",JSON.stringify(m,null,2)),console.log("Images loaded:",h.length,"images")}const p=document.getElementById("detailedItemModal");p&&(console.log("ðŸ”§ Removing existing modal"),p.remove()),console.log("Sending item to modal with stockLevel:",m.stockLevel),console.log("Full item being sent:",m);const f=await apiPost("render_detailed_modal.php",{item:m,images:h});if(!f||typeof f!="string")throw new Error("Modal render API returned invalid HTML");console.log("ðŸ”§ Modal HTML received, length:",f.length),console.log("ðŸ”§ Modal HTML preview:",f.substring(0,200)+"..."),e.innerHTML=f,console.log("ðŸ”§ Modal HTML inserted into container");const g=document.getElementById("detailedItemModal");console.log("ðŸ”§ Modal element found after insertion:",!!g),s=m,window.currentDetailedItem=m,console.log("ðŸ”§ Current modal item stored"),a(`js/detailed-item-modal.js?v=${Date.now()}`,"detailed-item-modal-script").then(()=>{console.log("ðŸ”§ Detailed item modal script loaded."),setTimeout(()=>{if(console.log("ðŸ”§ Attempting to show modal..."),typeof window.showDetailedModalComponent<"u")console.log("ðŸ”§ Using showDetailedModalComponent function"),window.showDetailedModalComponent(i,m);else{const k=document.getElementById("detailedItemModal");k&&(k.classList.remove("hidden"),k.style.display="flex",window.WFModals&&typeof window.WFModals.lockScroll=="function"&&window.WFModals.lockScroll())}setTimeout(()=>{typeof window.initializeEnhancedModalContent=="function"&&window.initializeEnhancedModalContent()},100)},50)}).catch(k=>{console.error("ðŸ”§ Failed to load detailed item modal script:",k)})}catch(m){console.error("ðŸ”§ Error in showGlobalItemModal:",m),typeof window.showError=="function"?window.showError("Unable to load item details. Please try again."):alert("Unable to load item details. Please try again.")}}function n(){const i=document.getElementById("detailedItemModal");i&&i.remove(),window.WFModals&&typeof window.WFModals.unlockScrollIfNoneOpen=="function"&&window.WFModals.unlockScrollIfNoneOpen(),s=null}function r(i){i.target.id==="detailedItemModal"&&n()}function c(){return s}function l(i){typeof window.hidePopupImmediate=="function"&&window.hidePopupImmediate(),o(i.sku,i)}function d(){t(),window.WhimsicalFrog=window.WhimsicalFrog||{},window.WhimsicalFrog.GlobalModal={show:o,close:n,closeOnOverlay:r,getCurrentItem:c,quickAddToCart:l}}function a(i,u){return new Promise((m,h)=>{if(document.getElementById(u)){m();return}const p=document.createElement("script");p.src=i,p.id=u,p.onload=()=>m(),p.onerror=()=>h(new Error(`Script load error for ${i}`)),document.body.appendChild(p)})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",d):d(),window.showItemDetails=o,window.showItemDetailsModal=o,window.showDetailedModal=o,window.closeDetailedModal=n,window.closeDetailedModalOnOverlay=r,window.openQuantityModal=l,console.log("Global Item Modal system loaded")})();class Q{constructor(){this.overlay=null,this.modal=null,this.currentResolve=null,this.init()}init(){this.createModalHTML(),this.addEventListeners()}createModalHTML(){const e=document.getElementById("global-confirmation-modal");e&&e.remove(),this.overlay=document.createElement("div"),this.overlay.id="global-confirmation-modal",this.overlay.className="confirmation-modal-overlay",this.modal=document.createElement("div"),this.modal.className="confirmation-modal animate-slide-in-up",this.overlay.appendChild(this.modal),document.body.appendChild(this.overlay)}addEventListeners(){this.overlay.addEventListener("click",e=>{e.target===this.overlay&&this.close(!1)}),document.addEventListener("keydown",e=>{e.key==="Escape"&&this.overlay.classList.contains("show")&&this.close(!1)})}show(e={}){return new Promise(t=>{this.currentResolve=t;const{title:o="Confirm Action",message:n="Are you sure you want to proceed?",details:r=null,icon:c="âš ï¸",iconType:l="warning",confirmText:d="Confirm",cancelText:a="Cancel",confirmStyle:i="confirm",subtitle:u=null}=e;this.modal.innerHTML=`
                <div class="confirmation-modal-header">
                    <div class="confirmation-modal-icon ${l}">
                        ${c}
                    </div>
                    <h3 class="confirmation-modal-title">${o}</h3>
                    ${u?`<p class="confirmation-modal-subtitle">${u}</p>`:""}
                </div>
                <div class="confirmation-modal-body">
                    <div class="confirmation-modal-message">${n}</div>
                    ${r?`<div class="confirmation-modal-details">${r}</div>`:""}
                </div>
                <div class="confirmation-modal-footer">
                    <button class="confirmation-modal-button cancel" id="modal-cancel">
                        ${a}
                    </button>
                    <button class="confirmation-modal-button ${i}" id="modal-confirm">
                        ${d}
                    </button>
                </div>
            `,document.getElementById("modal-cancel").addEventListener("click",()=>{this.close(!1)}),document.getElementById("modal-confirm").addEventListener("click",()=>{this.close(!0)}),this.overlay.classList.add("show"),setTimeout(()=>{document.getElementById("modal-confirm").focus()},100)})}close(e){this.overlay.classList.remove("show"),setTimeout(()=>{this.currentResolve&&(this.currentResolve(e),this.currentResolve=null)},300)}}let D=null;document.addEventListener("DOMContentLoaded",()=>{D=new Q});window.showConfirmationModal=async s=>(D||(D=new Q),await D.show(s));window.confirmAction=async(s,e,t="Confirm")=>await showConfirmationModal({title:s,message:e,confirmText:t,icon:"âš ï¸",iconType:"warning"});window.confirmDanger=async(s,e,t="Delete")=>await showConfirmationModal({title:s,message:e,confirmText:t,confirmStyle:"danger",icon:"âš ï¸",iconType:"danger"});window.confirmInfo=async(s,e,t="Continue")=>await showConfirmationModal({title:s,message:e,confirmText:t,icon:"â„¹ï¸",iconType:"info"});window.confirmSuccess=async(s,e,t="Proceed")=>await showConfirmationModal({title:s,message:e,confirmText:t,icon:"âœ…",iconType:"success"});window.confirmWithDetails=async(s,e,t,o={})=>await showConfirmationModal({title:s,message:e,details:t,...o});window.showGlobalPopup=function(s,e){console.log("Global popup system - showGlobalPopup called")};window.hideGlobalPopup=function(){console.log("Global popup system - hideGlobalPopup called")};window.hideGlobalPopupImmediate=function(){console.log("Global popup system - hideGlobalPopupImmediate called")};if(typeof UnifiedPopupSystem<"u"){const s=new UnifiedPopupSystem;window.unifiedPopupSystem=s}class me{constructor(){this.notifications=new Map,this.nextId=1,this.container=null,this.initialized=!1,this.init()}init(){this.initialized||(this.container||(this.container=document.createElement("div"),this.container.id="wf-notification-container",this.container.className="wf-notification-container",this.container.style.cssText=`
                position: var(-notification-container-position, fixed);
                top: var(-notification-container-top, 24px);
                right: var(-notification-container-right, 24px);
                z-index: var(-notification-container-zindex, 2147483647);
                pointer-events: none;
                max-width: var(-notification-container-width, 420px);
                width: 100%;
            `,document.body.appendChild(this.container)),this.initialized=!0,console.log("âœ… WhimsicalFrog Unified Notification System initialized"))}show(e,t="info",o={}){this.initialized||(console.warn("Notification system not initialized, initializing now..."),this.init());const{title:n=null,duration:r=this.getDefaultDuration(t),persistent:c=!1,actions:l=null,autoHide:d=!0}=o,a=this.nextId++,i=this.createNotification(a,e,t,n,c,l);return this.container.appendChild(i),this.notifications.set(a,i),requestAnimationFrame(()=>{i.style.opacity="1",i.style.transform="var(-notification-transform-show, translateX(0) scale(1))"}),!c&&d&&r>0&&setTimeout(()=>{this.remove(a)},r),a}createNotification(e,t,o,n,r,c){const l=document.createElement("div");return l.className=`wf-notification wf-${o}-notification`,l.dataset.id=e,l.dataset.type=o,l.addEventListener("click",d=>{console.log(`Notification ${e} clicked - removing`),d.preventDefault(),d.stopPropagation(),this.remove(e)}),l.addEventListener("mousedown",d=>{console.log(`Notification ${e} mousedown event`)}),l.title="Click to dismiss",l.innerHTML=`
            <div class="wf-notification-content">
                <div class="wf-notification-icon">
                    ${this.getTypeIcon(o)}
                </div>
                <div class="wf-notification-body">
                    ${n?`<div class="wf-notification-title">${n}</div>`:""}
                    <div class="wf-notification-message">
                        ${t}
                    </div>
                    ${c?this.createActions(c):""}
                </div>
                ${r?"":`
                    <button class="wf-notification-close" onclick="event.stopPropagation(); window.wfNotifications.remove(${e})">&times;</button>
                `}
            </div>
        `,(o==="warning"||o==="error")&&setTimeout(()=>{l.parentElement&&(l.classList.add("pulse"),setTimeout(()=>{l.classList.remove("pulse")},150))},200),l}createActions(e){return!e||!Array.isArray(e)?"":`
            <div class="wf-notification-actions">
                ${e.map(t=>`
                    <button onclick="${t.onClick}" class="wf-notification-action ${t.style==="primary"?"primary":"secondary"}">
                        ${t.text}
                    </button>
                `).join("")}
            </div>
        `}getTypeConfig(e){const t={success:{background:"#87ac3a",border:"#6b8e23",color:"white",titleColor:"white",closeColor:"white",shadow:"rgba(135, 172, 58, 0.3)",icon:"âœ…"},error:{background:"linear-gradient(135deg, #fee2e2, #fecaca)",border:"#ef4444",color:"#7f1d1d",titleColor:"#dc2626",closeColor:"#ef4444",shadow:"rgba(239, 68, 68, 0.2)",icon:"âŒ"},warning:{background:"linear-gradient(135deg, #fef3c7, #fde68a)",border:"#f59e0b",color:"#92400e",titleColor:"#d97706",closeColor:"#f59e0b",shadow:"rgba(245, 158, 11, 0.2)",icon:"âš ï¸"},info:{background:"linear-gradient(135deg, #dbeafe, #bfdbfe)",border:"#3b82f6",color:"#1e3a8a",titleColor:"#2563eb",closeColor:"#3b82f6",shadow:"rgba(59, 130, 246, 0.2)",icon:"â„¹ï¸"},validation:{background:"linear-gradient(135deg, #fef3c7, #fde68a)",border:"#f59e0b",color:"#92400e",titleColor:"#d97706",closeColor:"#f59e0b",shadow:"rgba(245, 158, 11, 0.2)",icon:"âš ï¸"}};return t[e]||t.info}getDefaultDuration(e){return 5e3}remove(e){console.log(`Attempting to remove notification ${e}`);const t=this.notifications.get(e);t&&t.parentElement?(console.log(`Removing notification ${e} from DOM`),t.style.opacity="0",t.style.transform="var(-notification-transform-enter, translateX(100%) scale(0.9))",setTimeout(()=>{t.parentElement&&(t.remove(),console.log(`Notification ${e} removed from DOM`)),this.notifications.delete(e),console.log(`Notification ${e} deleted from memory`)},400)):console.log(`Notification ${e} not found or already removed`)}removeAll(){this.notifications.forEach((e,t)=>{this.remove(t)})}success(e,t={}){return this.show(e,"success",t)}error(e,t={}){return this.show(e,"error",t)}warning(e,t={}){return this.show(e,"warning",t)}info(e,t={}){return this.show(e,"info",t)}validation(e,t={}){return this.show(e,"validation",t)}getFallbackColor(e,t){const o={success:{background:"linear-gradient(135deg, #87ac3a, #6b8e23)",border:"#556B2F",text:"#ffffff"},error:{background:"linear-gradient(135deg, #dc2626, #b91c1c)",border:"#991b1b",text:"#ffffff"},warning:{background:"linear-gradient(135deg, #f59e0b, #d97706)",border:"#b45309",text:"#ffffff"},info:{background:"linear-gradient(135deg, #3b82f6, #2563eb)",border:"#1d4ed8",text:"#ffffff"},validation:{background:"linear-gradient(135deg, #f59e0b, #d97706)",border:"#b45309",text:"#ffffff"}};return o[e]?.[t]||o.info[t]}getFallbackShadow(e){const t={success:"0 12px 28px rgba(135, 172, 58, 0.35), 0 4px 8px rgba(135, 172, 58, 0.15)",error:"0 12px 28px rgba(220, 38, 38, 0.35), 0 4px 8px rgba(220, 38, 38, 0.15)",warning:"0 12px 28px rgba(245, 158, 11, 0.35), 0 4px 8px rgba(245, 158, 11, 0.15)",info:"0 12px 28px rgba(59, 130, 246, 0.35), 0 4px 8px rgba(59, 130, 246, 0.15)",validation:"0 12px 28px rgba(245, 158, 11, 0.35), 0 4px 8px rgba(245, 158, 11, 0.15)"};return t[e]||t.info}getTypeIcon(e){const t={success:"âœ…",error:"âŒ",warning:"âš ï¸",info:"â„¹ï¸",validation:"âš ï¸"};return t[e]||t.info}}window.wfNotifications=new me;function he(){window._wfNotificationFunctionsRegistered||(window.showNotification=(s,e="info",t={})=>window.wfNotifications.show(s,e,t),window.showSuccess=(s,e={})=>window.wfNotifications.success(s,e),window.showError=(s,e={})=>window.wfNotifications.error(s,e),window.showWarning=(s,e={})=>window.wfNotifications.warning(s,e),window.showInfo=(s,e={})=>window.wfNotifications.info(s,e),window.showValidation=(s,e={})=>window.wfNotifications.validation(s,e),window._wfNotificationFunctionsRegistered=!0,console.log("ðŸ“¢ WhimsicalFrog notification functions registered globally"))}he();window._wfAlertOverridden||(window.alert=function(s){s.includes("added to your cart")||s.includes("added to cart")?window.wfNotifications.success(s):window.wfNotifications.info(s)},window._wfAlertOverridden=!0);window.showToast||(window.showToast=(s,e=null,t={})=>{let o,n;return e===null?(o=s,n="info"):typeof s=="string"&&["success","error","warning","info"].includes(s)?(n=s,o=e):(o=s,n=e||"info"),window.wfNotifications.show(o,n,t)});window.hideNotification=s=>window.wfNotifications.remove(s);window.clearNotifications=()=>window.wfNotifications.removeAll();window.cart&&typeof window.cart=="object"&&(window.cart.showNotification=s=>window.wfNotifications.success(s),window.cart.showErrorNotification=s=>window.wfNotifications.error(s),window.cart.showValidationError=s=>window.wfNotifications.validation(s));console.log("ðŸŽ‰ WhimsicalFrog Unified Notification System ready!");document.addEventListener("DOMContentLoaded",function(){const s=document.getElementById("landingPage");if(!s)return;if(document.body.classList.add("mode-fullscreen"),console.log("ðŸŽ¯ Landing page positioning script loaded"),window.innerWidth<1e3){console.log("ðŸŽ¯ Mobile layout detected, skipping JS positioning");const c=document.querySelector(".area-1");c&&c.setAttribute("href","/shop");return}const e=1280,t=896;let o=[];try{o=JSON.parse(s.dataset.coords||"[]")}catch(c){console.error("Error parsing landing page coordinates:",c);return}const n=o.map(c=>({selector:c.selector.startsWith(".")?c.selector:"."+c.selector,top:c.top,left:c.left,width:c.width,height:c.height}));function r(){const c=window.innerWidth,l=window.innerHeight,d=c/l,a=e/t;let i,u,m;d>a?(i=l/t,u=(c-e*i)/2,m=0):(i=c/e,m=(l-t*i)/2,u=0),n.forEach(h=>{const p=document.querySelector(h.selector);p&&(p.style.top=`${h.top*i+m}px`,p.style.left=`${h.left*i+u}px`,p.style.width=`${h.width*i}px`,p.style.height=`${h.height*i}px`)})}r(),window.addEventListener("resize",r)});console.log("Loading room-main.js...");class pe{constructor(){this.initialized=!1,this.init()}init(){this.initialized||(console.log("ðŸ¸ Room Main: Initializing..."),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>this.setup()):this.setup(),this.initialized=!0)}setup(){this.setupBackground(),this.setupDoors(),this.setupNavigation(),this.setupBodyStyles(),this.setupModalAutoOpen(),this.setupCleanup(),console.log("ðŸ¸ Room Main: Initialization complete")}setupBackground(){const e=document.getElementById("mainRoomPage");if(e){const t=e.getAttribute("data-bg-url");t&&(e.style.setProperty("--room-bg-url",`url('${t}')`),console.log("ðŸ–¼ï¸ Main room background loaded:",t))}}setupDoors(){const e=document.querySelectorAll(".door-area");console.log(`ðŸšª Found ${e.length} door elements`),e.forEach((t,o)=>{t.style.cursor="pointer",t.style.pointerEvents="auto",t.setAttribute("tabindex","0"),t.setAttribute("role","button"),t.setAttribute("aria-label",`Open ${t.dataset.category||"room"}`),t.addEventListener("keydown",n=>{(n.key==="Enter"||n.key===" ")&&(n.preventDefault(),t.click())})}),console.log("ðŸšª Door positioning and accessibility configured")}setupNavigation(){const e=document.querySelector("nav.main-nav");e&&(e.classList.add("site-header"),console.log("ðŸ§­ Navigation configured for room overlay"))}setupBodyStyles(){document.body.style.overflow="hidden",console.log("ðŸšª Body styles configured for fullscreen mode")}setupModalAutoOpen(){const t=new URLSearchParams(window.location.search).get("modal_room");if(t){const o=()=>{window.roomModalManager?(console.log(`ðŸšª Auto-opening modal for room: ${t}`),window.roomModalManager.show(t)):setTimeout(o,100)};setTimeout(o,500)}}setupCleanup(){window.addEventListener("beforeunload",()=>{document.body.style.overflow=""})}}const Z=new pe;window.roomMainManager=Z;window.WhimsicalFrog&&typeof WhimsicalFrog.ready=="function"&&WhimsicalFrog.ready(s=>{s.addModule("RoomMainManager",Z)});console.log("Room Main Manager loaded and initialized");class ee{constructor(){this.sessionStartTime=Date.now(),this.pageStartTime=Date.now(),this.lastScrollPosition=0,this.maxScrollDepth=0,this.interactions=[],this.isTracking=!0,this.init()}init(){this.trackVisit(),this.trackPageView(),this.setupEventListeners(),this.setupPageExitTracking(),this.startPeriodicTracking()}trackVisit(){const e={landing_page:window.location.href,referrer:document.referrer,timestamp:Date.now()};this.sendData("track_visit",e)}trackPageView(){const e={page_url:window.location.href,page_title:document.title,page_type:this.getPageType(),item_sku:this.getItemSku(),timestamp:Date.now()};this.sendData("track_page_view",e)}getPageType(){const t=new URLSearchParams(window.location.search).get("page")||"landing";return t==="shop"?"shop":t.startsWith("room")?"product_room":t==="cart"?"cart":t==="admin"?"admin":t==="landing"?"landing":"other"}getItemSku(){const e=new URLSearchParams(window.location.search);if(e.get("product"))return e.get("product");if(e.get("sku"))return e.get("sku");if(e.get("item"))return e.get("item");if(e.get("edit"))return e.get("edit");const t=document.querySelectorAll("[data-product-id], [data-sku], [data-item-sku]");return t.length>0?t[0].dataset.productId||t[0].dataset.sku||t[0].dataset.itemSku:null}setupEventListeners(){document.addEventListener("click",o=>{this.trackInteraction("click",o)}),document.addEventListener("submit",o=>{this.trackInteraction("form_submit",o)});let e;window.addEventListener("scroll",()=>{clearTimeout(e),e=setTimeout(()=>{this.trackScroll()},100)}),document.querySelectorAll('input[type="search"], input[name*="search"]').forEach(o=>{o.addEventListener("input",n=>{n.target.value.length>2&&this.trackInteraction("search",n)})}),this.setupCartTracking(),this.setupItemTracking()}setupCartTracking(){document.addEventListener("click",t=>{if(t.target.classList.contains("add-to-cart-btn")||t.target.closest(".add-to-cart-btn")){const o=t.target.classList.contains("add-to-cart-btn")?t.target:t.target.closest(".add-to-cart-btn"),n=o.dataset.productId||o.dataset.sku;this.trackCartAction("add",n),this.trackInteraction("cart_add",t,{item_sku:n})}}),document.addEventListener("click",t=>{if(t.target.classList.contains("remove-from-cart")||t.target.closest(".remove-from-cart")){const o=t.target.classList.contains("remove-from-cart")?t.target:t.target.closest(".remove-from-cart"),n=o.dataset.productId||o.dataset.sku;this.trackCartAction("remove",n),this.trackInteraction("cart_remove",t,{item_sku:n})}}),document.querySelectorAll('[onclick*="checkout"], .checkout-btn').forEach(t=>{t.addEventListener("click",()=>{this.trackInteraction("checkout_start",null)})})}setupItemTracking(){document.querySelectorAll(".product-card, .product-item, .item-card, .item-item").forEach(t=>{let o=null;new IntersectionObserver(r=>{r.forEach(c=>{if(c.isIntersecting)o=Date.now();else if(o){const l=Date.now()-o,d=t.dataset.productId||t.dataset.sku;d&&l>1e3&&this.trackItemView(d,l),o=null}})},{threshold:.5}).observe(t)}),document.addEventListener("click",t=>{const o=t.target.closest(".product-card, .product-item, .item-card, .item-item");if(o){const n=o.dataset.productId||o.dataset.sku;n&&this.trackInteraction("click",t,{item_sku:n,element_type:"item"})}})}trackInteraction(e,t,o={}){if(!this.isTracking)return;let n={};t&&t.target&&(n={element_type:t.target.tagName.toLowerCase(),element_id:t.target.id,element_text:t.target.textContent?.substring(0,100)||"",element_class:t.target.className});const r={page_url:window.location.href,interaction_type:e,...n,interaction_data:{timestamp:Date.now(),page_x:t?.clientX||0,page_y:t?.clientY||0,...o},item_sku:o.item_sku||this.getItemSku()};this.sendData("track_interaction",r)}trackScroll(){const e=window.pageYOffset||document.documentElement.scrollTop,t=document.documentElement.scrollHeight-window.innerHeight,o=Math.round(e/t*100);o>this.maxScrollDepth&&(this.maxScrollDepth=o,o>=25&&this.maxScrollDepth<25?this.trackInteraction("scroll",null,{scroll_depth:25}):o>=50&&this.maxScrollDepth<50?this.trackInteraction("scroll",null,{scroll_depth:50}):o>=75&&this.maxScrollDepth<75?this.trackInteraction("scroll",null,{scroll_depth:75}):o>=90&&this.maxScrollDepth<90&&this.trackInteraction("scroll",null,{scroll_depth:90}))}trackItemView(e,t){const o={item_sku:e,time_on_page:Math.round(t/1e3)};this.sendData("track_item_view",o)}trackCartAction(e,t){if(!t)return;const o={item_sku:t,action:e};this.sendData("track_cart_action",o)}setupPageExitTracking(){window.addEventListener("beforeunload",()=>{this.trackPageExit()}),document.addEventListener("visibilitychange",()=>{document.hidden?this.trackPageExit():this.pageStartTime=Date.now()})}trackPageExit(){const e=Math.round((Date.now()-this.pageStartTime)/1e3),t={page_url:window.location.href,time_on_page:e,scroll_depth:this.maxScrollDepth,item_sku:this.getItemSku()};this.sendDataSync("track_page_view",t)}startPeriodicTracking(){setInterval(()=>{document.hidden||this.trackPageView()},3e4)}sendData(e,t){this.isTracking&&apiPost(`/api/analytics_tracker.php?action=${e}`,t).catch(o=>{console.warn("Analytics tracking failed:",o)})}sendDataSync(e,t){const o=new FormData;o.append("action",e),o.append("data",JSON.stringify(t)),navigator.sendBeacon?navigator.sendBeacon(`/api/analytics_tracker.php?action=${e}`,o):this.sendData(e,t)}trackConversion(e=0,t=null){const o={conversion_value:e,order_id:t,page_url:window.location.href};this.trackInteraction("checkout_complete",null,o)}trackCustomEvent(e,t={}){this.trackInteraction("custom",null,{event_name:e,...t})}enableTracking(){this.isTracking=!0}disableTracking(){this.isTracking=!1}}document.addEventListener("DOMContentLoaded",function(){localStorage.getItem("analytics_opt_out")!=="true"&&(window.analyticsTracker=new ee)});window.trackConversion=function(s,e){window.analyticsTracker&&window.analyticsTracker.trackConversion(s,e)};window.trackCustomEvent=function(s,e){window.analyticsTracker&&window.analyticsTracker.trackCustomEvent(s,e)};window.optOutOfAnalytics=function(){localStorage.setItem("analytics_opt_out","true"),window.analyticsTracker&&window.analyticsTracker.disableTracking()};window.optInToAnalytics=function(){localStorage.removeItem("analytics_opt_out"),window.analyticsTracker?window.analyticsTracker.enableTracking():window.analyticsTracker=new ee};(function(){let e=null,t=null,o=null;function n(){if(e&&t)return;e=document.createElement("div"),e.id="wf-login-overlay",e.className="wf-login-overlay",t=document.createElement("div"),t.id="wf-login-modal",t.className="wf-login-modal",t.innerHTML=`
      <div class="wf-login-card">
        <button type="button" class="wf-login-close" aria-label="Close">Ã—</button>
        <h3 class="wf-login-title">Sign in</h3>
        <form id="wfLoginForm" class="wf-login-form">
          <label class="wf-field">
            <span class="wf-label">Username</span>
            <input type="text" name="username" autocomplete="username" required class="wf-input" />
          </label>
          <label class="wf-field">
            <span class="wf-label">Password</span>
            <input type="password" name="password" autocomplete="current-password" required class="wf-input" />
          </label>
          <button type="submit" class="wf-btn wf-btn-primary">Login</button>
        </form>
      </div>`,e.appendChild(t),document.body.appendChild(e),e.addEventListener("click",u=>{u.target===e&&c()}),t.querySelector(".wf-login-close").addEventListener("click",c),document.addEventListener("keydown",u=>{u.key==="Escape"&&e.classList.contains("show")&&c()}),t.querySelector("#wfLoginForm").addEventListener("submit",l)}function r(i){n(),o=i||window.location.pathname+window.location.search+window.location.hash;try{sessionStorage.setItem("wf_login_return_to",o)}catch{}e.classList.add("show"),WFModals?.lockScroll?.();const u=t.querySelector('input[name="username"]');u&&u.focus()}function c(){e&&(e.classList.remove("show"),WFModals?.unlockScrollIfNoneOpen?.())}async function l(i){i.preventDefault();const u=i.currentTarget,m=u.username.value.trim(),h=u.password.value;if(!m||!h){window.showValidation&&window.showValidation("Please enter username and password.");return}const p=u.querySelector('button[type="submit"]');p.disabled=!0,p.textContent="Logging inâ€¦";try{const f=await fetch("/functions/process_login.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:m,password:h})});if(!f.ok){const y=await d(f);throw new Error(y?.error||"Login failed.")}let w=(await f.json())?.redirectUrl;if(!w)try{w=sessionStorage.getItem("wf_login_return_to")}catch{}w||(w=window.location.pathname||"/"),window.showSuccess&&window.showSuccess("Login successful. Redirectingâ€¦"),c(),setTimeout(()=>{window.location.assign(w)},700)}catch(f){window.showError&&window.showError(f.message||"Login failed.")}finally{p.disabled=!1,p.textContent="Login"}}async function d(i){try{return await i.json()}catch{return null}}document.addEventListener("click",i=>{if(!i.target.closest('[data-action="open-login-modal"]')||i.defaultPrevented||i.button!==0||i.metaKey||i.ctrlKey||i.shiftKey||i.altKey)return;i.preventDefault();const m=window.location.pathname+window.location.search+window.location.hash;r(m)});function a(){const i=document.getElementById("loginForm");i&&i.addEventListener("submit",async u=>{u.preventDefault();const m=(i.querySelector("#username")||{}).value?.trim(),h=(i.querySelector("#password")||{}).value;if(!m||!h){window.showValidation&&window.showValidation("Please enter username and password.");return}const f=new URLSearchParams(window.location.search).get("redirect_to");try{sessionStorage.setItem("wf_login_return_to",f||window.location.pathname||"/")}catch{}try{const g=await fetch("/functions/process_login.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:m,password:h})});if(!g.ok){const L=await d(g);throw new Error(L?.error||"Login failed.")}let y=(await g.json())?.redirectUrl;if(!y)try{y=sessionStorage.getItem("wf_login_return_to")}catch{}y||(y="/"),window.showSuccess&&window.showSuccess("Login successful. Redirectingâ€¦"),setTimeout(()=>{window.location.assign(y)},700)}catch(g){window.showError&&window.showError(g.message||"Login failed.")}})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",a):a(),window.openLoginModal=r})();(function(){function e(t){document.readyState==="loading"?document.addEventListener("DOMContentLoaded",t,{once:!0}):t()}e(()=>{const t=document.getElementById("wf-contact-form");if(!t)return;const o=document.getElementById("wf-contact-status"),n=document.getElementById("wf-contact-submit");function r(l,d="info"){o&&(o.textContent=l,o.className="text-sm "+(d==="error"?"text-red-600":d==="success"?"text-green-700":"text-gray-700"))}function c(l){n&&(n.disabled=l)}t.addEventListener("submit",async l=>{l.preventDefault();const d=Object.fromEntries(new FormData(t).entries()),a=(d.name||"").trim(),i=(d.email||"").trim(),u=(d.subject||"").trim(),m=(d.message||"").trim();if(!a||a.length>100){r("Please enter your name (max 100 characters).","error");return}if(!i||i.length>255||!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i)){r("Please enter a valid email address.","error");return}if(u&&u.length>150){r("Subject is too long (max 150 characters).","error");return}if(!m||m.length>5e3){r("Please enter a message (max 5000 characters).","error");return}r("Sending...","info"),c(!0);try{const h=await fetch("/api/contact_submit.php",{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({csrf:d.csrf,website:d.website||"",name:a,email:i,subject:u,message:m})}),p=await h.json().catch(()=>({success:!1,error:"Invalid server response"}));h.ok&&p.success?(r(p.message||"Thanks! Your message has been sent.","success"),t.reset()):r(p.error||"Failed to send your message. Please try again later.","error")}catch{r("Network error. Please check your connection and try again.","error")}finally{c(!1)}})})})();(function(){let e=null,t=null;function o(i){try{return decodeURIComponent(escape(atob(i)))}catch{try{return atob(i)}catch{return""}}}function n(i){return String(i).replace(/[&<>"']/g,u=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[u])}function r(){e&&t||(e=document.createElement("div"),e.className="wf-revealco-overlay",e.setAttribute("role","dialog"),e.setAttribute("aria-modal","true"),t=document.createElement("div"),t.className="wf-revealco-modal",t.innerHTML=`
      <div class="wf-revealco-card">
        <button type="button" class="wf-revealco-close" aria-label="Close">Ã—</button>
        <h3 class="wf-revealco-title">Company Information</h3>
        <div class="wf-revealco-body" id="wfRevealCoBody"></div>
      </div>
    `,e.appendChild(t),document.body.appendChild(e),e.addEventListener("click",i=>{i.target===e&&l()}),t.querySelector(".wf-revealco-close").addEventListener("click",l),document.addEventListener("keydown",i=>{i.key==="Escape"&&e.classList.contains("show")&&l()}))}function c(i){r();const u=t.querySelector("#wfRevealCoBody");if(!u)return;const m=Math.floor(Math.random()*8)+1,h=Math.floor(Math.random()*8)+1;u.innerHTML=`
      <div class="wf-revealco-challenge">
        <p class="wf-revealco-hint">Quick check to prevent spam. Please solve:</p>
        <label class="wf-revealco-q">
          <span class="wf-revealco-qtext">${m} + ${h} =</span>
          <input type="text" inputmode="numeric" class="wf-revealco-input" aria-label="Answer" />
        </label>
        <div class="wf-revealco-actions">
          <button type="button" class="wf-btn wf-btn-primary" data-action="reveal">Reveal</button>
          <button type="button" class="wf-btn" data-action="cancel">Cancel</button>
        </div>
        <p class="wf-revealco-status" aria-live="polite"></p>
      </div>
    `;const p=String(m+h),f=u.querySelector(".wf-revealco-input"),g=u.querySelector(".wf-revealco-status");function k(){const w=i.getAttribute("data-enc-email")||"",y=i.getAttribute("data-enc-phone")||"",L=i.getAttribute("data-enc-address")||"",A=i.getAttribute("data-enc-name")||"",v=i.getAttribute("data-enc-owner")||"",M=i.getAttribute("data-enc-site")||"",P=i.getAttribute("data-enc-hours")||"",x=(o(w)||"").trim(),C=(o(y)||"").trim(),B=C.replace(/[^\d+]/g,""),R=(o(L)||"").trim(),W=(o(A)||"").trim(),O=(o(v)||"").trim(),S=(o(M)||"").trim(),z=(o(P)||"").trim(),T=[];if(W&&T.push(`<div class="wf-revealco-row"><span class="wf-revealco-label">Company</span><span>${n(W)}</span></div>`),O&&T.push(`<div class="wf-revealco-row"><span class="wf-revealco-label">Owner</span><span>${n(O)}</span></div>`),S){const I=S.startsWith("http")?S:"https://"+S;T.push(`<div class="wf-revealco-row"><span class="wf-revealco-label">Website</span><a class="wf-revealco-link" target="_blank" rel="noopener" href="${I}">${S}</a></div>`)}if(x){const I=n(x);T.push(`<div class="wf-revealco-row"><span class="wf-revealco-label">Email</span><a class="wf-revealco-link" href="mailto:${I}">${I}</a></div>`)}if(C&&T.push(`<div class="wf-revealco-row"><span class="wf-revealco-label">Phone</span><a class="wf-revealco-link" href="tel:${B}">${n(C)}</a></div>`),R){const I="https://www.google.com/maps/search/?api=1&query="+encodeURIComponent(R);T.push(`<div class="wf-revealco-row"><span class="wf-revealco-label">Address</span><a class="wf-revealco-link" target="_blank" rel="noopener" href="${I}">${n(R)}</a></div>`)}if(z){const I=n(z).replace(/\n/g,"<br>");T.push(`<div class="wf-revealco-row"><span class="wf-revealco-label">Hours</span><span>${I}</span></div>`)}u.innerHTML=`
        <div class="wf-revealco-details">
          ${T.join("")||"<p>No company details available.</p>"}
        </div>
      `}u.addEventListener("click",w=>{const y=w.target.closest("button");if(!y)return;const L=y.getAttribute("data-action");if(L==="cancel"){l();return}L==="reveal"&&((f&&f.value||"").trim()===p?k():(g&&(g.textContent="Incorrect, please try again."),f&&(f.value="",f.focus())))}),e.classList.add("show"),WFModals?.lockScroll?.(),f&&f.focus()}function l(){e&&(e.classList.remove("show"),WFModals?.unlockScrollIfNoneOpen?.())}function d(i){const u=i.target.closest("#wf-reveal-company-btn");u&&(i.preventDefault(),c(u))}function a(){const i=document.body;!i||i.dataset.page!=="contact"||document.addEventListener("click",d)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",a,{once:!0}):a()})();(function(){function e(n){if(!n||!n.dataset)return;const r=n.dataset,c=r.originalTop,l=r.originalLeft,d=r.originalWidth,a=r.originalHeight;c!=null&&c!==""&&n.style.setProperty("--icon-top",`${parseFloat(c)||0}px`),l!=null&&l!==""&&n.style.setProperty("--icon-left",`${parseFloat(l)||0}px`),d!=null&&d!==""&&n.style.setProperty("--icon-width",`${parseFloat(d)||0}px`),a!=null&&a!==""&&n.style.setProperty("--icon-height",`${parseFloat(a)||0}px`)}function t(n=document){try{const r=n.querySelectorAll?.(".item-icon, .room-product-icon");if(!r||!r.length)return;r.forEach(e)}catch(r){console.warn("[room-icons-init] initAll failed",r)}}function o(){t(document);try{new MutationObserver(r=>{for(const c of r)c.addedNodes&&c.addedNodes.forEach(l=>{if(!(l instanceof Element))return;l.matches?.(".item-icon, .room-product-icon")&&e(l);const d=l.querySelectorAll?.(".item-icon, .room-product-icon");d&&d.forEach(e)})}).observe(document.documentElement,{childList:!0,subtree:!0})}catch(n){console.warn("[room-icons-init] MutationObserver not available",n)}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",o,{once:!0}):o()})();(function(){if(window.__WF_IMAGE_CAROUSEL_INIT__)return;window.__WF_IMAGE_CAROUSEL_INIT__=!0,window.carouselStates=window.carouselStates||{};function e(a){if(!a||!a.id)return null;const i=a.id;if(!window.carouselStates[i]){const u=a.querySelectorAll(".carousel-slide"),m=(a.dataset.autoplay||"").toString()==="true";window.carouselStates[i]={currentSlide:0,totalSlides:u.length||0,autoplay:m,autoplayInterval:null},m&&(u.length||0)>1&&(t(i),a.addEventListener("mouseenter",()=>o(i)),a.addEventListener("mouseleave",()=>t(i)))}return window.carouselStates[i]}function t(a){const i=window.carouselStates[a];i&&(o(a),i.autoplayInterval=setInterval(()=>c(a,1),3e3))}function o(a){const i=window.carouselStates[a];i&&i.autoplayInterval&&(clearInterval(i.autoplayInterval),i.autoplayInterval=null)}function n(a){const i=document.getElementById(a);return i||console.warn("[image-carousel] Container not found for id:",a),i}function r(a,i){if(!a)return;a.querySelectorAll(".carousel-slide").forEach((p,f)=>{p.classList.toggle("carousel-image-active",f===i),p.classList.toggle("carousel-image-inactive",f!==i)}),a.querySelectorAll(".carousel-thumbnail").forEach((p,f)=>{p.classList.toggle("carousel-thumbnail-active",f===i),p.classList.toggle("carousel_border_color_active",f===i),p.classList.toggle("carousel_border_color_inactive",f!==i)}),a.querySelectorAll(".carousel-indicator").forEach((p,f)=>{p.classList.toggle("active",f===i),p.classList.toggle("carousel_indicator_bg_active",f===i),p.classList.toggle("carousel_indicator_bg_inactive",f!==i)})}function c(a,i){const u=window.carouselStates[a]||e(n(a)),m=n(a);if(!u||!m)return;const h=(u.currentSlide+i+u.totalSlides)%u.totalSlides;l(a,h)}function l(a,i){const u=window.carouselStates[a]||e(n(a)),m=n(a);if(!u||!m)return;const h=Math.max(0,Math.min(i,u.totalSlides-1));r(m,h),u.currentSlide=h}window.changeSlide=c,window.goToSlide=l;function d(){document.querySelectorAll(".image-carousel-container.carousel-container[id]").forEach(a=>{e(a)}),console.log("[image-carousel] Initialized")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",d,{once:!0}):d()})();(function(){if(window.__WF_FOOTER_NEWSLETTER_INIT__)return;window.__WF_FOOTER_NEWSLETTER_INIT__=!0;function e(o){!o||o.dataset.wfNewsletterInit==="true"||(o.dataset.wfNewsletterInit="true",o.addEventListener("submit",function(n){n.preventDefault();const r=this.querySelector('input[name="email"]'),c=this.querySelector(".footer-newsletter-button");if(!r||!c)return;const l=r.value.trim(),d=c.textContent;c.textContent="Subscribing...",c.disabled=!0,fetch("/api/newsletter_signup.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"email="+encodeURIComponent(l)}).then(a=>a.json()).then(a=>{if(a&&a.success)c.textContent="Subscribed!",c.classList.add("footer-newsletter-success"),r.value="",setTimeout(()=>{c.textContent=d,c.disabled=!1,c.classList.remove("footer-newsletter-success")},3e3);else throw new Error(a&&(a.message||a.error)||"Subscription failed")}).catch(a=>{console.error("[newsletter] signup error:",a),c.textContent="Try Again",c.disabled=!1,c.classList.add("footer-newsletter-error"),setTimeout(()=>{c.textContent=d,c.classList.remove("footer-newsletter-error")},3e3)})},{once:!1}))}function t(){document.querySelectorAll(".footer-newsletter-form").forEach(e),console.log("[footer-newsletter] Initialized")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",t,{once:!0}):t()})();class fe{constructor(){this.modal=document.getElementById("aiProcessingModal"),this.progressBar=document.getElementById("aiProcessingProgressBar"),this.results=document.getElementById("aiProcessingResults"),this.error=document.getElementById("aiProcessingError"),this.details=document.getElementById("aiProcessingDetails"),this.cancelBtn=document.getElementById("aiProcessingCancelBtn"),this.doneBtn=document.getElementById("aiProcessingDoneBtn"),this.closeBtn=document.getElementById("aiProcessingCloseBtn"),this.currentProcessing=null,this.setupEventListeners()}setupEventListeners(){this.cancelBtn&&this.cancelBtn.addEventListener("click",()=>this.cancel()),this.doneBtn&&this.doneBtn.addEventListener("click",()=>this.close()),this.closeBtn&&this.closeBtn.addEventListener("click",()=>this.close()),this.modal&&this.modal.addEventListener("click",e=>{e.target===this.modal&&this.cancel()})}show(){this.modal&&(this.modal.classList.remove("hidden"),this.reset())}hide(){this.modal&&this.modal.classList.add("hidden")}close(){if(this.hide(),this.onComplete)try{this.onComplete()}catch{}}cancel(){if(this.currentProcessing&&console.log("Canceling AI processing..."),this.hide(),this.onCancel)try{this.onCancel()}catch{}}reset(){this.progressBar&&(this.progressBar.style.width="0%");for(let e=1;e<=3;e++)this.resetStep(e);this.results&&this.results.classList.add("hidden"),this.error&&this.error.classList.add("hidden"),this.details&&this.details.classList.add("hidden"),this.cancelBtn&&this.cancelBtn.classList.remove("hidden"),this.doneBtn&&this.doneBtn.classList.add("hidden"),this.closeBtn&&this.closeBtn.classList.add("hidden")}resetStep(e){const t=document.getElementById(`step${e}Icon`),o=document.getElementById(`step${e}Status`);if(!(!t||!o))switch(t.className="w-6 h-6 rounded-full border-2 border-gray-300 flex items-center justify-center",t.innerHTML='<div class="w-2 h-2 bg-gray-300 rounded-full"></div>',e){case 1:o.textContent="Analyzing image to detect object boundaries...";break;case 2:o.textContent="Waiting for analysis...";break;case 3:o.textContent="Waiting for cropping...";break}}updateProgress(e){this.progressBar&&(this.progressBar.style.width=`${e}%`)}updateStep(e,t,o=!1,n=!1){const r=document.getElementById(`step${e}Icon`),c=document.getElementById(`step${e}Status`);!r||!c||(c.textContent=t,n?(r.className="w-6 h-6 rounded-full border-2 border-red-500 bg-red-500 flex items-center justify-center",r.innerHTML='<svg class="w-3 h-3 text-white" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>'):o?(r.className="w-6 h-6 rounded-full border-2 border-green-500 bg-green-500 flex items-center justify-center",r.innerHTML='<svg class="w-3 h-3 text-white" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>'):(r.className="w-6 h-6 rounded-full border-2 border-blue-500 bg-blue-500 flex items-center justify-center",r.innerHTML='<div class="w-2 h-2 bg-white rounded-full animate-pulse"></div>'))}showSuccess(e,t=[]){this.updateProgress(100),this.results&&this.results.classList.remove("hidden");const o=document.getElementById("aiProcessingResultText");o&&(o.textContent=e),Array.isArray(t)&&t.length&&this.showDetails(t),this.cancelBtn&&this.cancelBtn.classList.add("hidden"),this.doneBtn&&this.doneBtn.classList.remove("hidden"),this.closeBtn&&this.closeBtn.classList.remove("hidden")}showError(e){this.error&&this.error.classList.remove("hidden");const t=document.getElementById("aiProcessingErrorText");t&&(t.textContent=e),this.cancelBtn&&this.cancelBtn.classList.add("hidden"),this.doneBtn&&this.doneBtn.classList.remove("hidden"),this.closeBtn&&this.closeBtn.classList.remove("hidden")}showDetails(e){this.details&&this.details.classList.remove("hidden");const t=document.getElementById("aiProcessingDetailsList");t&&(t.innerHTML="",e.forEach(o=>{const n=document.createElement("div");n.textContent=`â€¢ ${o}`,t.appendChild(n)}))}async processImage(e,t,o={}){this.show(),this.currentProcessing=!0;try{this.updateStep(1,"Analyzing image with AI...",!1,!1),this.updateProgress(10);const n=await fetch("/api/process_image_ai.php",{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({action:"process_image",imagePath:e,sku:t,options:o})});if(!n.ok)throw new Error(`HTTP ${n.status}: ${n.statusText}`);const r=await n.json();if(!r.success)throw new Error(r.error||"Processing failed");return this.processSteps(r),r}catch(n){throw console.error("AI processing error:",n),this.updateStep(1,"Analysis failed",!1,!0),this.showError(n.message),n}finally{this.currentProcessing=null}}processSteps(e){const t=e.processing_steps||[];let o=1,n=20;if(t.forEach(r=>{if(r.includes("AI edge analysis")||r.includes("AI Analysis"))this.updateStep(1,"AI analysis completed",!0,!1),o=2,n=40;else if(r.includes("smart cropping")||r.includes("cropping"))this.updateStep(2,"Smart cropping applied",!0,!1),o=3,n=70;else if(r.includes("WebP")||r.includes("conversion"))this.updateStep(3,"WebP conversion completed",!0,!1),n=100;else if(r.includes("fallback"))this.updateStep(1,"Using fallback edge detection",!0,!1),o=2,n=30;else if(r.includes("Error")){this.updateStep(o,r,!1,!0),this.showError(r);return}this.updateProgress(n)}),e.success){const r=e.ai_analysis?"Image processed with AI edge detection":"Image processed with fallback edge detection";this.showSuccess(r,e.processing_steps)}}}function G(){if(!document.getElementById("aiProcessingModal"))return;const e=new fe;window.aiProcessingModal=e,window.processImageWithAI=async function(t,o,n={}){return e.processImage(t,o,n)},console.log("[ai-processing-modal] Initialized")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",G,{once:!0}):G();(function(){function e(o){const n=o.target;if(!(n instanceof HTMLImageElement))return;n.removeEventListener("error",e,!0);const r=n.getAttribute("data-fallback-src"),c=n.getAttribute("data-fallback");if(r&&n.src!==r){n.src=r;return}if(c==="placeholder"){n.style.display="none";const l=document.createElement("div");l.className="width_100 height_100 display_flex flex_col align_center justify_center bg_f8f9fa color_6b7280 border_radius_normal",l.innerHTML="<div class='font_size_3rem margin_bottom_10 opacity_07'>ðŸ“·</div><div class='font_size_0_9 font_weight_500'>Image Not Found</div>",n.parentElement&&n.parentElement.appendChild(l);return}if(c==="thumbnail"){n.style.display="none";const l=document.createElement("div");l.className="width_100 height_100 display_flex align_center justify_center bg_f8f9fa color_6b7280 font_size_1_5rem",l.textContent="ðŸ“·",n.parentElement&&(n.parentElement.innerHTML=""),n.parentElement&&n.parentElement.appendChild(l);return}n.style.display="none"}function t(o=document){o.addEventListener("error",e,!0)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>t(),{once:!0}):t()})();console.log("app.js loaded");function N(){if(console.log("[App] Initializing recovered systems..."),window.WF_SYSTEMS_INITIALIZED){console.log("[App] Systems already initialized, skipping");return}const s=new V;window.WF_Cart=s,window.WhimsicalFrog&&WhimsicalFrog.registerModule&&WhimsicalFrog.registerModule("cart-system",s),console.log("[App] Creating RoomModalManager instance...");const e=new Y;window.WF_RoomModal=e,window.roomModalManager=e,window.WhimsicalFrog&&WhimsicalFrog.registerModule&&WhimsicalFrog.registerModule("room-modal-manager",e),console.log("[App] RoomModalManager created and exposed globally:",e);const t=new X;window.WF_Search=t,window.WhimsicalFrog&&WhimsicalFrog.registerModule&&WhimsicalFrog.registerModule("search-system",t);const o=new J;window.WF_Sales=o,window.WhimsicalFrog&&WhimsicalFrog.registerModule&&WhimsicalFrog.registerModule("sales-system",o);const n=new K;window.WF_Utils=n,window.WhimsicalFrog&&WhimsicalFrog.registerModule&&WhimsicalFrog.registerModule("utilities",n),window.WF_SYSTEMS_INITIALIZED=!0,console.log("[App] All core systems initialized successfully")}window.WhimsicalFrog&&(console.log("[App] WhimsicalFrog object exists:",window.WhimsicalFrog),console.log("[App] WhimsicalFrog.ready function:",window.WhimsicalFrog.ready),console.log("[App] WhimsicalFrog.Core:",window.WhimsicalFrog.Core),console.log("[App] WhimsicalFrog.Core.initialized:",window.WhimsicalFrog.Core?.initialized));if(window.WhimsicalFrog&&window.WhimsicalFrog.ready){console.log("[App] WhimsicalFrog available, attempting ready callback");const s=N,e=function(){console.log("[App] ðŸŽ‰ Ready callback is EXECUTING!"),s()};try{WhimsicalFrog.ready(e),console.log("[App] Ready callback registered successfully"),window.WhimsicalFrog.Core?.initialized&&(console.log("[App] Core already initialized, callback should have run immediately"),setTimeout(()=>{window.WF_SYSTEMS_INITIALIZED||(console.log("[App] ðŸš¨ Callback never executed, forcing initialization"),N())},200))}catch(t){console.error("[App] Error with ready callback:",t),N()}}else console.log("[App] WhimsicalFrog not ready, setting up fallback initialization"),N();(function(){function e(){try{const t=document.body,o=t?t.dataset:{},n=o&&o.page||window.WF_PAGE_INFO&&window.WF_PAGE_INFO.page||"";if(typeof n=="string"&&/^room\d+$/.test(n)){E(()=>import("../room-page-BJ-FGt20.js"),[]).then(()=>console.log(`[App] Public module loaded for page: ${n}`)).catch(d=>console.error(`[App] Failed to load public module for page: ${n}`,d));return}const l={cart:()=>E(()=>import("../cart-page-C6VPkmrx.js"),[]),register:()=>E(()=>import("../register-page-rNc9KzKa.js"),[]),account_settings:()=>E(()=>import("../account-settings-page-CwsFN-9O.js"),[]),"account-settings":()=>E(()=>import("../account-settings-page-CwsFN-9O.js"),[])}[n];typeof l=="function"&&l().then(()=>console.log(`[App] Public module loaded for page: ${n}`)).catch(d=>console.error(`[App] Failed to load public module for page: ${n}`,d))}catch(t){console.error("[App] Error setting up public per-page imports",t)}}document.body?e():document.addEventListener("DOMContentLoaded",e,{once:!0})})();(function(){function e(){try{const t=document.body,o=t?t.dataset:{},n=o&&o.page||window.WF_PAGE_INFO&&window.WF_PAGE_INFO.page||"";if(!(o&&o.isAdmin==="true"||typeof n=="string"&&n.startsWith("admin")))return;const d=(o&&o.path||window.location.pathname||"").split("?")[0].split("#")[0].split("/").filter(Boolean);let a=d[0]==="admin"?d[1]||"dashboard":"";a=(a||"").toLowerCase(),a.endsWith(".php")&&(a=a.replace(/\.php$/,""));const i={index:"dashboard",home:"dashboard",order:"orders",product:"inventory",products:"inventory",customer:"customers",user:"customers",users:"customers",report:"reports",setting:"settings",db_status:"db-status",dbstatus:"db-status",db_web_manager:"db-web-manager","db-web-manager":"db-web-manager",room_config_manager:"room-config-manager","room-config-manager":"room-config-manager"};i[a]&&(a=i[a]),({dashboard:()=>E(()=>import("./admin-dashboard.js-VQ1WXx75.js").then(h=>h.a),[]),customers:()=>E(()=>import("../admin-customers-CVcZiYjm.js"),[]),inventory:()=>E(()=>import("./admin-inventory.js-BvaIVksU.js").then(h=>h.a),[]),orders:()=>E(()=>import("../admin-orders-CKuoBxab.js"),[]),pos:()=>E(()=>import("../admin-pos-DuYEvZ-S.js"),[]),reports:()=>E(()=>import("../admin-reports-QEqgp-N2.js"),__vite__mapDeps([0,1])),marketing:()=>E(()=>import("../admin-marketing-DOemP6rh.js"),__vite__mapDeps([2,1])),settings:()=>E(()=>import("../admin-settings-CcnsSfgv.js"),[]),categories:()=>E(()=>import("../admin-categories-DctmXD4Z.js"),[]),"db-status":()=>E(()=>import("../admin-db-status-BDg83GDJ.js"),[]),"db-web-manager":()=>E(()=>import("../admin-db-web-manager-BHQar1Td.js"),[]),"room-config-manager":()=>E(()=>import("../admin-room-config-manager-Wz8M00z8.js"),[])}[a]||(()=>E(()=>import("./admin-dashboard.js-VQ1WXx75.js").then(h=>h.a),[])))().then(()=>console.log(`[App] Admin module loaded for section: ${a}`)).catch(h=>console.error(`[App] Failed to load admin module for section: ${a}`,h))}catch(t){console.error("[App] Error setting up per-page imports",t)}}document.body?e():document.addEventListener("DOMContentLoaded",e,{once:!0})})();
