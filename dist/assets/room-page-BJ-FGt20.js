(function(){try{let u=function(o){const t=o&&o.getAttribute("data-item-json");if(!t)return null;try{return JSON.parse(t)}catch(i){return console.warn("[RoomPage] Failed to parse item JSON",i),null}},f=function(){const o=document.querySelectorAll(".item-icon, .room-product-icon");o.length&&o.forEach(t=>{t.addEventListener("click",i=>{const e=i.currentTarget,n=u(e);if(n){if(window._roomCurrentProduct=n,typeof window.showGlobalPopup=="function")try{window.showGlobalPopup(e,n);return}catch(a){console.warn("[RoomPage] showGlobalPopup failed, falling back",a)}if(typeof window.openQuantityModal=="function")try{window.openQuantityModal(n);return}catch(a){console.warn("[RoomPage] openQuantityModal failed",a)}console.warn("[RoomPage] No popup or modal system available")}})})},p=function(){const o=document.querySelector("#universalRoomPage .room-container");o&&document.body.addEventListener("click",t=>{const i=document.querySelector(".back-to-main-button, .back-button");if(i&&(t.target===i||i.contains(t.target)))return;const e=document.getElementById("productPopup");e&&e.classList.contains("show")||o.contains(t.target)||(window.location.href="/?page=room_main")})};var g=u,h=f,b=p;const r=document.body;if(!r)return;const s=r.dataset&&r.dataset.page||window.WF_PAGE_INFO&&window.WF_PAGE_INFO.page||"",w=/^room(\d+)$/.exec(String(s||"").toLowerCase());if(!w)return;console.log("[RoomPage] Initializing for",s);const m=w[1],d=`room${m}`;if(window.ROOM_NUMBER=m,window.ROOM_TYPE=d,typeof window.loadGlobalCSS=="function")try{window.loadGlobalCSS()}catch(o){console.warn("[RoomPage] loadGlobalCSS failed",o)}else if(typeof window.loadGlobalCSSVariables=="function")try{window.loadGlobalCSSVariables()}catch(o){console.warn("[RoomPage] loadGlobalCSSVariables failed",o)}else console.log("[RoomPage] No global CSS initializer found; proceeding");if(typeof window.simpleCoordinateSystem=="function")try{window.simpleCoordinateSystem(d)}catch(o){console.warn("[RoomPage] simpleCoordinateSystem failed",o)}window.showItemDetails=async function(){const t=window._roomCurrentProduct;if(!t)return;const i=t.sku||t.id;if(i)try{const n=await(await fetch(`/api/get_item_details.php?sku=${encodeURIComponent(i)}`)).json();if(!n.success||!n.item)throw new Error(n.error||"Unknown error");const a=document.getElementById("detailedItemModal");a&&a.remove();const l=document.createElement("div");l.innerHTML=`
          <div id="detailedItemModal" class="modal-overlay hidden">
            <div class="bg-white rounded-lg max-w-6xl w-full max-h-[95vh] overflow-y-auto shadow-2xl">
              <div class="sticky top-0 bg-white border-b px-6 py-4 flex justify-between items-center z-10">
                <h2 class="text-2xl font-bold text-gray-800">${n.item.name}</h2>
                <button class="detailed-modal-close-btn text-gray-500 hover:text-gray-700 text-3xl font-bold">&times;</button>
              </div>
              <div class="p-6">
                <div class="text-3xl font-bold text-green-600 mb-2">$${parseFloat(n.item.retailPrice).toFixed(2)}</div>
                ${n.item.description?`<p class="text-gray-700 text-lg leading-relaxed">${String(n.item.description).replace(/\n/g,"<br>")}</p>`:""}
              </div>
            </div>
          </div>`,document.body.appendChild(l.firstElementChild);const c=document.getElementById("detailedItemModal");if(c.classList.remove("hidden"),window.WFModals&&typeof window.WFModals.lockScroll=="function")try{window.WFModals.lockScroll()}catch{}c.querySelector(".detailed-modal-close-btn")?.addEventListener("click",()=>{if(c.remove(),window.WFModals&&typeof window.WFModals.unlockScroll=="function")try{window.WFModals.unlockScroll()}catch{}})}catch(e){if(console.error("[RoomPage] Failed to load item details",e),typeof window.showError=="function")try{window.showError("Unable to load item details. Please try again.")}catch{}}},window.showProductDetails=async function(t){if(t)try{const e=await(await fetch(`/api/get_item_details.php?sku=${encodeURIComponent(t)}`)).json();if(!e.success||!e.item)throw new Error(e.error||"Unknown error");const n=document.getElementById("detailedItemModal");n&&n.remove();const a=document.createElement("div");a.innerHTML=`
          <div id="detailedItemModal" class="modal-overlay hidden">
            <div class="bg-white rounded-lg max-w-6xl w-full max-h-[95vh] overflow-y-auto shadow-2xl">
              <div class="sticky top-0 bg-white border-b px-6 py-4 flex justify-between items-center z-10">
                <h2 class="text-2xl font-bold text-gray-800">${e.item.name}</h2>
                <button class="detailed-modal-close-btn text-gray-500 hover:text-gray-700 text-3xl font-bold">&times;</button>
              </div>
              <div class="p-6">
                <div class="text-3xl font-bold text-green-600 mb-2">$${parseFloat(e.item.retailPrice).toFixed(2)}</div>
                ${e.item.description?`<p class="text-gray-700 text-lg leading-relaxed">${String(e.item.description).replace(/\\n/g,"<br>")}</p>`:""}
              </div>
            </div>
          </div>`,document.body.appendChild(a.firstElementChild);const l=document.getElementById("detailedItemModal");if(l.classList.remove("hidden"),window.WFModals&&typeof window.WFModals.lockScroll=="function")try{window.WFModals.lockScroll()}catch{}l.querySelector(".detailed-modal-close-btn")?.addEventListener("click",()=>{if(l.remove(),window.WFModals&&typeof window.WFModals.unlockScroll=="function")try{window.WFModals.unlockScroll()}catch{}})}catch(i){if(console.error("[RoomPage] Failed to load product details",i),typeof window.showError=="function")try{window.showError("Unable to load product details. Please try again.")}catch{}}},f(),p(),console.log("[RoomPage] Initialized successfully for",d)}catch(r){console.error("[RoomPage] Initialization error",r)}})();
