<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Final Verification - Viewport Width Fix</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .verification-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .status {
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
            font-weight: bold;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .measurement {
            font-family: monospace;
            background: #f8f9fa;
            padding: 8px;
            border-radius: 4px;
            margin: 5px 0;
        }
        .good { border-left: 4px solid #28a745; }
        .bad { border-left: 4px solid #dc3545; }
        
        iframe {
            width: 100%;
            height: 600px;
            border: 2px solid #ddd;
            border-radius: 4px;
        }
        
        .before-after {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        
        .comparison-panel {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #dee2e6;
        }
        
        .comparison-panel h3 {
            margin-top: 0;
            text-align: center;
        }
    </style>
</head>
<body>
    <h1>üéØ Final Verification: Viewport Width Fix</h1>
    
    <div class="verification-container">
        <h2>Fix Status</h2>
        <div id="fix-status">
            <div class="info">Analyzing shop page viewport width utilization...</div>
        </div>
    </div>
    
    <div class="before-after">
        <div class="comparison-panel">
            <h3>üìã What Was Fixed</h3>
            <ul>
                <li>‚úÖ Removed max-width: 1400px from main grid</li>
                <li>‚úÖ Removed max-width: 900px from tablet breakpoint</li>
                <li>‚úÖ Removed max-width: 1200px from desktop breakpoint</li>
                <li>‚úÖ Removed max-width: 1400px from ultra-wide breakpoint</li>
                <li>‚úÖ Regenerated CSS bundle to apply changes</li>
                <li>‚úÖ Added Tailwind padding overrides</li>
            </ul>
        </div>
        
        <div class="comparison-panel">
            <h3>üéØ Expected Results</h3>
            <ul>
                <li>Products grid uses full viewport width</li>
                <li>5-6 cards per row on large screens (1400px+)</li>
                <li>Grid utilizes 90%+ of available viewport</li>
                <li>No visible padding constraints on main container</li>
                <li>Responsive behavior maintained across breakpoints</li>
            </ul>
        </div>
    </div>

    <div class="verification-container">
        <h2>Live Shop Page Test</h2>
        <iframe id="shopFrame" src="http://localhost:8000/?page=shop"></iframe>
    </div>

    <script>
        function runFinalVerification() {
            const iframe = document.getElementById('shopFrame');
            const statusDiv = document.getElementById('fix-status');
            
            iframe.onload = function() {
                try {
                    const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                    const iframeWindow = iframe.contentWindow;
                    
                    // Get elements
                    const mainElement = iframeDoc.getElementById('mainContent');
                    const shopPage = iframeDoc.getElementById('shopPage');
                    const productsGrid = iframeDoc.getElementById('productsGrid');
                    
                    if (!mainElement || !shopPage || !productsGrid) {
                        statusDiv.innerHTML = '<div class="error">‚ùå Required elements not found</div>';
                        return;
                    }
                    
                    // Get measurements
                    const viewportWidth = iframeWindow.innerWidth;
                    const mainWidth = mainElement.offsetWidth;
                    const shopWidth = shopPage.offsetWidth;
                    const gridWidth = productsGrid.offsetWidth;
                    
                    // Get computed styles
                    const mainStyles = iframeWindow.getComputedStyle(mainElement);
                    const gridStyles = iframeWindow.getComputedStyle(productsGrid);
                    
                    // Calculate utilization
                    const mainUtil = (mainWidth / viewportWidth * 100);
                    const shopUtil = (shopWidth / viewportWidth * 100);
                    const gridUtil = (gridWidth / viewportWidth * 100);
                    
                    // Check constraints
                    const mainPadding = parseFloat(mainStyles.paddingLeft) + parseFloat(mainStyles.paddingRight);
                    const gridMaxWidth = gridStyles.maxWidth;
                    const hasMaxWidthConstraint = gridMaxWidth !== 'none' && !gridMaxWidth.includes('100%');
                    
                    // Count visible cards
                    const cards = productsGrid.querySelectorAll('.product-card');
                    const visibleCards = Array.from(cards).filter(card => 
                        card.style.display !== 'none' && 
                        iframeWindow.getComputedStyle(card).display !== 'none'
                    );
                    
                    // Estimate cards per row
                    const cardWidth = visibleCards.length > 0 ? visibleCards[0].offsetWidth : 250;
                    const gap = parseFloat(gridStyles.gap) || 16;
                    const gridPadding = parseFloat(gridStyles.paddingLeft) + parseFloat(gridStyles.paddingRight);
                    const availableWidth = gridWidth - gridPadding;
                    const estimatedCardsPerRow = Math.floor((availableWidth + gap) / (cardWidth + gap));
                    
                    // Determine success
                    const isMainFullWidth = mainUtil >= 95;
                    const isGridFullWidth = gridUtil >= 85; // Allow some padding
                    const hasGoodCardCount = estimatedCardsPerRow >= 4; // At least 4 cards per row
                    const hasNoPaddingConstraint = mainPadding <= 20; // Allow reasonable padding
                    const hasNoMaxWidthConstraint = !hasMaxWidthConstraint;
                    
                    const overallSuccess = isMainFullWidth && isGridFullWidth && hasGoodCardCount && hasNoPaddingConstraint && hasNoMaxWidthConstraint;
                    
                    let statusHTML = '';
                    if (overallSuccess) {
                        statusHTML = `
                            <div class="success">
                                <strong>üéâ SUCCESS!</strong> Viewport width fix is working perfectly!<br>
                                The shop page is now utilizing the full viewport width as intended.
                            </div>
                        `;
                    } else {
                        statusHTML = `
                            <div class="error">
                                <strong>‚ùå ISSUE PERSISTS:</strong> Some constraints are still preventing full viewport utilization.
                            </div>
                        `;
                    }
                    
                    statusHTML += `
                        <h3>üìä Detailed Results:</h3>
                        <div class="measurement ${isMainFullWidth ? 'good' : 'bad'}">
                            üñ•Ô∏è Viewport Width: ${viewportWidth}px
                        </div>
                        <div class="measurement ${isMainFullWidth ? 'good' : 'bad'}">
                            üì¶ Main Container: ${mainWidth}px (${mainUtil.toFixed(1)}% utilization) ${isMainFullWidth ? '‚úÖ' : '‚ùå'}
                        </div>
                        <div class="measurement ${isGridFullWidth ? 'good' : 'bad'}">
                            üéØ Products Grid: ${gridWidth}px (${gridUtil.toFixed(1)}% utilization) ${isGridFullWidth ? '‚úÖ' : '‚ùå'}
                        </div>
                        <div class="measurement ${hasGoodCardCount ? 'good' : 'bad'}">
                            üÉè Cards Per Row: ${estimatedCardsPerRow} cards ${hasGoodCardCount ? '‚úÖ' : '‚ùå'}
                        </div>
                        <div class="measurement ${hasNoPaddingConstraint ? 'good' : 'bad'}">
                            üìè Main Padding: ${mainPadding}px ${hasNoPaddingConstraint ? '‚úÖ' : '‚ùå'}
                        </div>
                        <div class="measurement ${hasNoMaxWidthConstraint ? 'good' : 'bad'}">
                            üö´ Grid Max-Width: ${gridMaxWidth} ${hasNoMaxWidthConstraint ? '‚úÖ' : '‚ùå'}
                        </div>
                        
                        <h3>üîç Technical Details:</h3>
                        <div class="measurement">Card Width: ${cardWidth}px</div>
                        <div class="measurement">Grid Gap: ${gap}px</div>
                        <div class="measurement">Grid Padding: ${gridPadding}px</div>
                        <div class="measurement">Available Width: ${availableWidth}px</div>
                        <div class="measurement">Visible Cards: ${visibleCards.length}</div>
                        <div class="measurement">Grid Template Columns: ${gridStyles.gridTemplateColumns}</div>
                    `;
                    
                    statusDiv.innerHTML = statusHTML;
                    
                } catch (error) {
                    statusDiv.innerHTML = `
                        <div class="error">
                            <strong>‚ùå ERROR:</strong> Could not analyze shop page: ${error.message}
                        </div>
                    `;
                }
            };
        }
        
        // Run verification when page loads
        window.onload = runFinalVerification;
        
        // Re-run every 5 seconds to catch any changes
        setInterval(runFinalVerification, 5000);
    </script>
</body>
</html>
