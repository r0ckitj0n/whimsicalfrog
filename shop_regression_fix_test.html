<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîß Shop Page Regression Fix Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #87ac3a 0%, #6b8e23 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        h1 {
            color: #2d3748;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            background: #f7fafc;
        }
        
        .test-section h3 {
            color: #2d3748;
            margin-top: 0;
            margin-bottom: 15px;
        }
        
        .status {
            padding: 12px;
            border-radius: 6px;
            margin: 10px 0;
            font-weight: 600;
        }
        
        .status.success {
            background: #c6f6d5;
            color: #22543d;
            border: 1px solid #9ae6b4;
        }
        
        .status.error {
            background: #fed7d7;
            color: #742a2a;
            border: 1px solid #feb2b2;
        }
        
        .status.warning {
            background: #fefcbf;
            color: #744210;
            border: 1px solid #f6e05e;
        }
        
        .status.info {
            background: #bee3f8;
            color: #2a4365;
            border: 1px solid #90cdf4;
        }
        
        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 12px;
            border-radius: 6px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 12px;
            margin: 10px 0;
            overflow-x: auto;
            white-space: pre-wrap;
        }
        
        .test-button {
            background: #87ac3a;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-weight: 600;
            transition: all 0.2s ease;
        }
        
        .test-button:hover {
            background: #6b8e23;
            transform: translateY(-1px);
        }
        
        .iframe-container {
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            overflow: hidden;
            margin: 15px 0;
            height: 500px;
        }
        
        .iframe-container iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .result-item {
            background: white;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
        }
        
        .result-item h4 {
            margin-top: 0;
            color: #2d3748;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Shop Page Regression Fix Test</h1>
        <p style="text-align: center; color: #718096; margin-bottom: 30px;">
            <strong>Testing fixes for background tiling, card spacing, grid centering, and scrollbar issues</strong>
        </p>

        <div class="test-section">
            <h3>üéØ Live Shop Page Test</h3>
            <p>Load the shop page and test all regression fixes in real-time.</p>
            <button class="test-button" onclick="loadShopPageTest()">Load Shop Page Test</button>
            <div id="shop-test-results"></div>
            <div id="shop-iframe-container"></div>
        </div>

        <div class="test-section">
            <h3>üîç Specific Issue Tests</h3>
            <p>Test each specific regression issue individually.</p>
            <button class="test-button" onclick="testBackgroundTiling()">Test Background Tiling</button>
            <button class="test-button" onclick="testCardSpacing()">Test Card Spacing</button>
            <button class="test-button" onclick="testGridCentering()">Test Grid Centering</button>
            <button class="test-button" onclick="testScrollbar()">Test Scrollbar</button>
            <div id="specific-test-results"></div>
        </div>

        <div class="test-section">
            <h3>üìä Summary Report</h3>
            <div id="summary-report">
                <div class="status info">Click any test button above to generate a summary report.</div>
            </div>
        </div>
    </div>

    <script>
        let testResults = {
            backgroundTiling: null,
            cardSpacing: null,
            gridCentering: null,
            scrollbar: null
        };

        async function loadShopPageTest() {
            const resultsDiv = document.getElementById('shop-test-results');
            const iframeContainer = document.getElementById('shop-iframe-container');
            
            resultsDiv.innerHTML = '<div class="status warning">Loading shop page for comprehensive testing...</div>';
            
            try {
                // Create iframe to load shop page
                const iframe = document.createElement('iframe');
                iframe.src = `/?page=shop&test=regression&v=${Date.now()}`;
                
                iframeContainer.innerHTML = '<div class="iframe-container"></div>';
                iframeContainer.querySelector('.iframe-container').appendChild(iframe);
                
                iframe.onload = function() {
                    setTimeout(() => {
                        try {
                            const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                            const iframeWindow = iframe.contentWindow;
                            
                            // Test 1: Background Tiling
                            const body = iframeDoc.body;
                            const bodyStyles = iframeWindow.getComputedStyle(body);
                            const backgroundSize = bodyStyles.backgroundSize;
                            const backgroundRepeat = bodyStyles.backgroundRepeat;
                            
                            // Test 2: Product Grid
                            const productsGrid = iframeDoc.querySelector('#productsGrid');
                            const gridStyles = productsGrid ? iframeWindow.getComputedStyle(productsGrid) : null;
                            const gap = gridStyles ? gridStyles.gap : 'not found';
                            const justifyContent = gridStyles ? gridStyles.justifyContent : 'not found';
                            const maxWidth = gridStyles ? gridStyles.maxWidth : 'not found';
                            
                            // Test 3: Product Cards
                            const productCards = iframeDoc.querySelectorAll('.product-card');
                            const cardCount = productCards.length;
                            
                            // Test 4: Scrollbar
                            const scrollbarWidth = bodyStyles.getPropertyValue('scrollbar-width');
                            const scrollbarColor = bodyStyles.getPropertyValue('scrollbar-color');
                            
                            let status = '<div class="status success">‚úÖ Shop page loaded successfully</div>';
                            
                            const results = `
Background Size: ${backgroundSize}
Background Repeat: ${backgroundRepeat}
Grid Gap: ${gap}
Grid Justify Content: ${justifyContent}
Grid Max Width: ${maxWidth}
Product Cards Found: ${cardCount}
Scrollbar Width: ${scrollbarWidth}
Scrollbar Color: ${scrollbarColor}
                            `;
                            
                            status += `<div class="code-block">${results}</div>`;
                            
                            // Evaluate results
                            let issuesFixed = 0;
                            let totalIssues = 4;
                            
                            // Background tiling test
                            if (backgroundSize === 'cover' && backgroundRepeat === 'no-repeat') {
                                status += '<div class="status success">‚úÖ Background tiling issue FIXED</div>';
                                issuesFixed++;
                                testResults.backgroundTiling = true;
                            } else {
                                status += '<div class="status error">‚ùå Background tiling issue NOT fixed</div>';
                                testResults.backgroundTiling = false;
                            }
                            
                            // Card spacing test
                            const gapValue = parseFloat(gap);
                            if (gapValue > 0 && gapValue <= 20) { // 1rem = 16px, so 20px is reasonable
                                status += '<div class="status success">‚úÖ Card spacing issue FIXED</div>';
                                issuesFixed++;
                                testResults.cardSpacing = true;
                            } else {
                                status += '<div class="status error">‚ùå Card spacing issue NOT fixed</div>';
                                testResults.cardSpacing = false;
                            }
                            
                            // Grid centering test
                            if (justifyContent === 'center' && maxWidth !== 'none') {
                                status += '<div class="status success">‚úÖ Grid centering issue FIXED</div>';
                                issuesFixed++;
                                testResults.gridCentering = true;
                            } else {
                                status += '<div class="status error">‚ùå Grid centering issue NOT fixed</div>';
                                testResults.gridCentering = false;
                            }
                            
                            // Scrollbar test
                            if (scrollbarWidth === 'thin' || scrollbarColor.includes('#87ac3a') || scrollbarColor.includes('135, 172, 58')) {
                                status += '<div class="status success">‚úÖ Scrollbar issue FIXED</div>';
                                issuesFixed++;
                                testResults.scrollbar = true;
                            } else {
                                status += '<div class="status warning">‚ö†Ô∏è Scrollbar styling may need verification</div>';
                                testResults.scrollbar = 'partial';
                            }
                            
                            // Overall status
                            if (issuesFixed === totalIssues) {
                                status += '<div class="status success">üéâ ALL REGRESSION ISSUES FIXED!</div>';
                            } else if (issuesFixed >= totalIssues - 1) {
                                status += '<div class="status warning">‚ö†Ô∏è Most issues fixed, minor issues remain</div>';
                            } else {
                                status += '<div class="status error">‚ùå Multiple issues still need attention</div>';
                            }
                            
                            resultsDiv.innerHTML = status;
                            updateSummary();
                            
                        } catch (error) {
                            resultsDiv.innerHTML = `<div class="status error">‚ùå Error testing shop page: ${error.message}</div>`;
                        }
                    }, 1500);
                };
                
                iframe.onerror = function() {
                    resultsDiv.innerHTML = '<div class="status error">‚ùå Failed to load shop page</div>';
                };
                
            } catch (error) {
                resultsDiv.innerHTML = `<div class="status error">‚ùå Error: ${error.message}</div>`;
            }
        }

        async function testBackgroundTiling() {
            const resultsDiv = document.getElementById('specific-test-results');
            resultsDiv.innerHTML = '<div class="status warning">Testing background tiling fix...</div>';
            
            // Open shop page in new window to test
            const shopWindow = window.open('/?page=shop&test=bg', '_blank', 'width=800,height=600');
            
            setTimeout(() => {
                try {
                    const shopDoc = shopWindow.document;
                    const body = shopDoc.body;
                    const styles = shopWindow.getComputedStyle(body);
                    const backgroundSize = styles.backgroundSize;
                    const backgroundRepeat = styles.backgroundRepeat;
                    
                    let status = '<h4>Background Tiling Test Results:</h4>';
                    status += `<div class="code-block">Background Size: ${backgroundSize}\nBackground Repeat: ${backgroundRepeat}</div>`;
                    
                    if (backgroundSize === 'cover' && backgroundRepeat === 'no-repeat') {
                        status += '<div class="status success">‚úÖ Background tiling issue FIXED</div>';
                    } else {
                        status += '<div class="status error">‚ùå Background tiling issue NOT fixed</div>';
                    }
                    
                    resultsDiv.innerHTML = status;
                    shopWindow.close();
                } catch (error) {
                    resultsDiv.innerHTML = `<div class="status error">‚ùå Error: ${error.message}</div>`;
                    shopWindow.close();
                }
            }, 2000);
        }

        async function testCardSpacing() {
            const resultsDiv = document.getElementById('specific-test-results');
            resultsDiv.innerHTML = '<div class="status info">Card spacing test requires the main shop page test to be run first.</div>';
        }

        async function testGridCentering() {
            const resultsDiv = document.getElementById('specific-test-results');
            resultsDiv.innerHTML = '<div class="status info">Grid centering test requires the main shop page test to be run first.</div>';
        }

        async function testScrollbar() {
            const resultsDiv = document.getElementById('specific-test-results');
            resultsDiv.innerHTML = '<div class="status info">Scrollbar test requires the main shop page test to be run first.</div>';
        }

        function updateSummary() {
            const summaryDiv = document.getElementById('summary-report');
            
            let summary = '<h4>üìä Regression Fix Results</h4>';
            
            const issues = [
                { name: 'Background Tiling', result: testResults.backgroundTiling },
                { name: 'Card Spacing', result: testResults.cardSpacing },
                { name: 'Grid Centering', result: testResults.gridCentering },
                { name: 'Scrollbar', result: testResults.scrollbar }
            ];
            
            let fixedCount = 0;
            issues.forEach(issue => {
                let icon = '‚ùì';
                if (issue.result === true) {
                    icon = '‚úÖ';
                    fixedCount++;
                } else if (issue.result === false) {
                    icon = '‚ùå';
                } else if (issue.result === 'partial') {
                    icon = '‚ö†Ô∏è';
                    fixedCount += 0.5;
                }
                summary += `<div>${icon} ${issue.name}</div>`;
            });
            
            summary += `<div class="status ${fixedCount >= 3.5 ? 'success' : fixedCount >= 2 ? 'warning' : 'error'}">
                ${fixedCount}/${issues.length} issues resolved
            </div>`;
            
            summaryDiv.innerHTML = summary;
        }

        // Auto-run comprehensive test on page load
        window.addEventListener('load', function() {
            setTimeout(loadShopPageTest, 500);
        });
    </script>
</body>
</html>
