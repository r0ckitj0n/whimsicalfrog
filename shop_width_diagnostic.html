<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìè Shop Width Diagnostic</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #17a2b8 0%, #6610f2 100%);
            color: #333;
            min-height: 100vh;
        }
        
        .diagnostic-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #2d3748;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .diagnostic-banner {
            background: linear-gradient(135deg, #17a2b8, #6610f2);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            margin: 20px 0;
            font-size: 1.2rem;
            font-weight: 600;
        }
        
        .test-button {
            display: inline-block;
            background: #17a2b8;
            color: white;
            padding: 15px 30px;
            text-decoration: none;
            border-radius: 6px;
            font-weight: 600;
            margin: 10px 5px;
            transition: background 0.3s ease;
            font-size: 1.1rem;
            cursor: pointer;
            border: none;
        }
        
        .test-button:hover {
            background: #138496;
        }
        
        .results-section {
            margin: 30px 0;
            padding: 25px;
            border-radius: 8px;
            background: #f8f9fa;
            border-left: 4px solid #17a2b8;
        }
        
        .measurement {
            padding: 10px;
            margin: 10px 0;
            border-radius: 6px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 14px;
            background: #e9ecef;
            border: 1px solid #dee2e6;
        }
        
        .measurement.good {
            background: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        
        .measurement.warning {
            background: #fff3cd;
            border-color: #ffeaa7;
            color: #856404;
        }
        
        .measurement.error {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
        
        #diagnosticResults {
            min-height: 200px;
        }
        
        .instructions {
            background: #cce7ff;
            border: 1px solid #99d3ff;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="diagnostic-container">
        <h1>üìè Shop Width Diagnostic</h1>
        
        <div class="diagnostic-banner">
            üîç Real-time Width Measurements & Layout Analysis
        </div>

        <div class="instructions">
            <h3>Instructions:</h3>
            <ol>
                <li>Open the shop page: <a href="http://localhost:8080/?page=shop" target="_blank">Shop Page</a></li>
                <li>Come back to this tab</li>
                <li>Click "Measure Shop Layout" to analyze current dimensions</li>
                <li>Review measurements to verify full-width implementation</li>
            </ol>
        </div>

        <button class="test-button" onclick="measureShopLayout()">üìè Measure Shop Layout</button>
        <button class="test-button" onclick="clearResults()">üóëÔ∏è Clear Results</button>

        <div class="results-section">
            <h3>Layout Measurements:</h3>
            <div id="diagnosticResults">
                <div class="measurement">Click "Measure Shop Layout" to analyze current dimensions...</div>
            </div>
        </div>
    </div>

    <script>
        function clearResults() {
            document.getElementById('diagnosticResults').innerHTML = '<div class="measurement">Results cleared. Click "Measure Shop Layout" to run analysis...</div>';
        }

        async function measureShopLayout() {
            const resultsDiv = document.getElementById('diagnosticResults');
            resultsDiv.innerHTML = '<div class="measurement">Measuring shop page layout...</div>';
            
            try {
                // Open shop page in a hidden iframe to measure its layout
                const iframe = document.createElement('iframe');
                iframe.style.display = 'none';
                iframe.src = 'http://localhost:8080/?page=shop';
                document.body.appendChild(iframe);
                
                iframe.onload = function() {
                    try {
                        const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                        const iframeWindow = iframe.contentWindow;
                        
                        // Get key elements
                        const shopPage = iframeDoc.getElementById('shopPage');
                        const productsGrid = iframeDoc.getElementById('productsGrid');
                        const productCards = iframeDoc.querySelectorAll('.product-card');
                        const body = iframeDoc.body;
                        const main = iframeDoc.querySelector('main');
                        
                        let measurements = [];
                        
                        // Viewport measurements
                        const viewportWidth = iframeWindow.innerWidth;
                        const viewportHeight = iframeWindow.innerHeight;
                        
                        measurements.push({
                            type: 'info',
                            label: 'Viewport Width',
                            value: `${viewportWidth}px`,
                            description: 'Browser window inner width'
                        });
                        
                        // Body measurements
                        if (body) {
                            const bodyWidth = body.offsetWidth;
                            const bodyScrollWidth = body.scrollWidth;
                            
                            measurements.push({
                                type: bodyWidth >= viewportWidth ? 'good' : 'warning',
                                label: 'Body Width',
                                value: `${bodyWidth}px`,
                                description: 'Document body width'
                            });
                            
                            if (bodyScrollWidth > bodyWidth) {
                                measurements.push({
                                    type: 'info',
                                    label: 'Body Scroll Width',
                                    value: `${bodyScrollWidth}px`,
                                    description: 'Total scrollable width'
                                });
                            }
                        }
                        
                        // Main container measurements
                        if (main) {
                            const mainWidth = main.offsetWidth;
                            const mainStyles = iframeWindow.getComputedStyle(main);
                            
                            measurements.push({
                                type: mainWidth >= viewportWidth * 0.95 ? 'good' : 'warning',
                                label: 'Main Container Width',
                                value: `${mainWidth}px`,
                                description: `Padding: ${mainStyles.padding}`
                            });
                        }
                        
                        // Shop page measurements
                        if (shopPage) {
                            const shopWidth = shopPage.offsetWidth;
                            const shopStyles = iframeWindow.getComputedStyle(shopPage);
                            const shopLeft = shopPage.offsetLeft;
                            
                            measurements.push({
                                type: shopWidth >= viewportWidth * 0.95 ? 'good' : 'error',
                                label: 'Shop Page Width',
                                value: `${shopWidth}px`,
                                description: `Left offset: ${shopLeft}px, Padding: ${shopStyles.padding}`
                            });
                            
                            measurements.push({
                                type: 'info',
                                label: 'Shop Page Max-Width',
                                value: shopStyles.maxWidth,
                                description: 'CSS max-width property'
                            });
                        }
                        
                        // Products grid measurements
                        if (productsGrid) {
                            const gridWidth = productsGrid.offsetWidth;
                            const gridStyles = iframeWindow.getComputedStyle(productsGrid);
                            
                            measurements.push({
                                type: gridWidth >= viewportWidth * 0.9 ? 'good' : 'warning',
                                label: 'Products Grid Width',
                                value: `${gridWidth}px`,
                                description: `Display: ${gridStyles.display}, Gap: ${gridStyles.gap}`
                            });
                            
                            measurements.push({
                                type: 'info',
                                label: 'Grid Justify Content',
                                value: gridStyles.justifyContent,
                                description: 'Flexbox alignment'
                            });
                        }
                        
                        // Product cards analysis
                        if (productCards.length > 0) {
                            const firstCard = productCards[0];
                            const cardStyles = iframeWindow.getComputedStyle(firstCard);
                            const cardWidth = parseInt(cardStyles.width);
                            const gap = parseInt(iframeWindow.getComputedStyle(productsGrid).gap) || 16;
                            
                            measurements.push({
                                type: 'info',
                                label: 'Card Count',
                                value: `${productCards.length} cards`,
                                description: 'Total product cards found'
                            });
                            
                            measurements.push({
                                type: 'info',
                                label: 'Card Width',
                                value: `${cardWidth}px`,
                                description: `Flex: ${cardStyles.flex}`
                            });
                            
                            // Calculate cards per row
                            const availableWidth = productsGrid ? productsGrid.offsetWidth : shopWidth;
                            const cardsPerRow = Math.floor((availableWidth + gap) / (cardWidth + gap));
                            
                            measurements.push({
                                type: cardsPerRow >= 5 ? 'good' : 'warning',
                                label: 'Calculated Cards Per Row',
                                value: `${cardsPerRow} cards`,
                                description: `Based on ${availableWidth}px available width`
                            });
                            
                            // Screen size analysis
                            let expectedCards = 'Unknown';
                            if (viewportWidth >= 2560) expectedCards = '8+';
                            else if (viewportWidth >= 1920) expectedCards = '7+';
                            else if (viewportWidth >= 1600) expectedCards = '6+';
                            else if (viewportWidth >= 1200) expectedCards = '5-6';
                            
                            measurements.push({
                                type: 'info',
                                label: 'Expected Cards for Screen',
                                value: expectedCards,
                                description: `For ${viewportWidth}px viewport`
                            });
                        }
                        
                        // Width utilization percentage
                        if (shopPage && viewportWidth > 0) {
                            const utilization = (shopPage.offsetWidth / viewportWidth * 100).toFixed(1);
                            measurements.push({
                                type: utilization >= 95 ? 'good' : utilization >= 85 ? 'warning' : 'error',
                                label: 'Viewport Utilization',
                                value: `${utilization}%`,
                                description: 'Percentage of viewport width used'
                            });
                        }
                        
                        // Display results
                        displayMeasurements(measurements);
                        
                        // Clean up
                        document.body.removeChild(iframe);
                        
                    } catch (error) {
                        resultsDiv.innerHTML = `<div class="measurement error">‚ùå Error measuring layout: ${error.message}</div>`;
                        document.body.removeChild(iframe);
                    }
                };
                
                iframe.onerror = function() {
                    resultsDiv.innerHTML = '<div class="measurement error">‚ùå Failed to load shop page for measurement</div>';
                    document.body.removeChild(iframe);
                };
                
            } catch (error) {
                resultsDiv.innerHTML = `<div class="measurement error">‚ùå Error: ${error.message}</div>`;
            }
        }
        
        function displayMeasurements(measurements) {
            const resultsDiv = document.getElementById('diagnosticResults');
            let html = '';
            
            measurements.forEach(measurement => {
                const className = `measurement ${measurement.type}`;
                html += `
                    <div class="${className}">
                        <strong>${measurement.label}:</strong> ${measurement.value}
                        <br><small>${measurement.description}</small>
                    </div>
                `;
            });
            
            resultsDiv.innerHTML = html;
        }
    </script>
</body>
</html>
