/* Global z-index tokens */
:root {
  /* Room modal base stacking */
  --z-index-room-modal: 1100;
  /* Cart overlay must sit above room modal */
  --z-index-cart-overlay: 1200;
  /* Header and site chrome */
  --z-index-page-header: 300;
  --z-index-site-nav: 290;
  /* Checkout / Receipt overlays */
  --z-index-checkout-overlay: 1300;
  --z-index-checkout-content: 1310;
  --z-index-receipt-overlay: 1320;
  /* UI chrome */
  --z-index-loader: 900;
  --z-index-toast: 1500;
  --z-index-dropdown: 400;
  --z-index-tooltip: 450;
  /* Component-specific low layers */
  --z-index-checkout-badge: 3; /* inline badges inside cards */
  /* Emergency/global overlays */
  --z-index-global-popup: 1250; /* above room/cart overlays, below admin/detailed modals */
  /* Internal modal parts */
  --z-index-modal-content: 420;
  --z-index-modal-front: 430;
}
/*
 * =============================================================================
 * Z-Index Hierarchy - Single Source of Truth
 * =============================================================================
 * This file defines the z-index stacking order for the entire application.
 * Use these variables instead of hardcoded z-index values to ensure
 * predictable and conflict-free layering of components.
 */

:root {
  /* -- Base & Content Layers -- */
  --z-index-behind: -1;
  --z-index-far-behind: -2;
  --z-index-base: 1;
  --z-index-raised: 1;
  --z-index-content-back: 5;
  --z-index-content-mid: 10;
  --z-index-content-front: 15;

  /* -- Floating UI & Page-Level Components -- */
  --z-index-floating-ui: 200;
  --z-index-page-header: 300;
  --z-index-page-footer: 290;

  /* -- Overlays & Dropdowns -- */
  --z-index-dropdown: 400;
  --z-index-tooltip: 450;
  --z-index-overlay-backdrop: 1000;

  /* -- Modals & Popups -- */
  --z-index-modal-back: 1005;
  --z-index-modal-base: 1010;
  --z-index-modal-content: 1020;
  --z-index-modal-front: 1030;

  /* -- Unified Overlay Tiers (sitewide) -- */
  /* Standard overlays (confirmation modals, generic modals) */
  --z-overlay: 1200;
  --z-overlay-content: 1210;
  --z-overlay-topmost: 2147483647; /* topmost should dominate all stacks */

  /* Admin-specific overlays (admin modals/panels) */
  --z-admin-overlay: 10110;              /* above global overlays and cart */
  --z-admin-overlay-content: 10120;

  /* -- Room & Special Modals -- */
  --z-index-room-modal: 1100;
  --z-index-room-modal-header: 1110;
  /* Checkout / Payment overlay (above room modal, below admin) */
  --z-index-checkout-overlay: 1300;

  /* -- Global Notifications & Highest Level -- */
  --z-index-global-notification: 500;
  --z-index-god-mode: 1600; /* emergency */

  /* Detailed Item Modal overlay (sits above hover popups and room overlay) */
  --z-detailed-item-modal: 1500;
  /* Global popup above most content but below god-mode unless explicitly raised */
  --z-global-popup: 1250; /* mirror of --z-index-global-popup */

  /* -- Header/Nav & Inline UI (non-overlay) -- */
  --z-index-header-ink: 310;            /* header text and links */
  --z-index-nav: 320;                   /* navigation links/items */
  /* Shop filters should sit above header (3000) and room modal (~2400), below overlays */
  --z-shop-filters: 600;
  --z-inline-popup: 550;                /* product hover popups, small tips */
  --z-inline-popup-high: 560;           /* slightly above default inline popups */
  --z-index-toast: 1500;                /* global toasts/notifications */
  --z-image-viewer: 1700;               /* image viewer overlay inside detailed modal */
  /* Room main layers */
  --z-room-base: 80;                    /* base layer for main room section (below header) */
  --z-room-door: 10060;                 /* door interactive layer */
  --z-room-buttons: 55;                 /* back button and small controls in room modal header */
  /* Help documentation dropdown */
  --z-help-dropdown: 50;                /* search results dropdown in help docs */
  --z-badge: 10;                        /* decorative badges over images */
  --z-badge-high: 15;                   /* elevated badge on hover/focus */
  --z-badge-mid: 9;                     /* mid-tier badge */
  --z-badge-low: 8;                     /* low-tier badge */
  --z-badge-very-low: 7;               /* very low-tier badge */
  --z-index-flat: 0;                    /* neutral stack */
  --z-content-2: 2;                     /* small content elevation */
  --z-content-3: 3;                     /* small content elevation */
  --z-admin-nav: var(--z-index-page-header, 300); /* admin navigation bar shares header tier */
  --z-header-over-room-modal: 3000;     /* keep header above room modal overlay when needed */
}

/* Legacy variable aliases for backward compatibility */
:root {
  /* Aliases mapping old custom properties to the new z-index scale */
  --z-base: var(--z-index-base);
  --z-base-elevated: var(--z-index-content-front);
  --z-modal: var(--z-index-modal-base);
  --z-notification: var(--z-index-global-notification);
  --z-tooltip: var(--z-index-tooltip);
  --z-navigation: var(--z-index-page-header);
  --z-door-areas: var(--z-index-content-front);
  --z-room-buttons: var(--z-index-floating-ui);
  --z-index-overlay: var(--z-index-overlay-backdrop);

  /* Convenience variables used by newer CSS */
  --wf-overlay-z: var(--z-overlay);
  --wf-overlay-content-z: var(--z-overlay-content);
  --wf-admin-overlay-z: var(--z-admin-overlay);
  --wf-admin-overlay-content-z: var(--z-admin-overlay-content);
  --wf-confirm-overlay-z: var(--z-overlay-topmost);

  /* Legacy alias for popup stacks used in older CSS */
  --z-popups: var(--z-global-popup);

  /* Landing page: ensure it sits above the fixed header */
  --z-index-landing-page: 110; /* header = 100 */
  
  /* Admin Settings specific z-indexes */
  --z-admin-drawer-content: var(--z-index-floating-ui); /* 20 */
  --z-admin-drawer-header: 25;
  --z-admin-drawer-meta: 24;
  --z-admin-drawer-overlay: var(--z-index-base); /* 1 */
}

/* Additional aliases for tokens referenced across legacy and component CSS */
:root {
  /* Headers & sticky elements */
  --z-sticky-header: var(--z-index-page-header);
  --z-site-header: var(--z-index-page-header);
  --z-admin-sticky-header: var(--z-sticky-header);

  /* Dropdowns & content */
  --z-dropdown: var(--z-index-dropdown);
  --z-content: var(--z-index-content-front);
  --z-content-overlay: var(--z-index-overlay-backdrop);

  /* Modals & overlays */
  --z-index-modal: var(--z-index-modal-base);
  --z-modal-overlay: var(--z-index-overlay-backdrop);
  --z-image-zoom-modal: var(--z-detailed-item-modal);
  --z-quantity-modal: calc(var(--z-detailed-item-modal) + 1);

  /* Popups & admin tools */
  --z-popup: var(--z-global-popup);
  --z-index-admin-tools: 10110;

  /* Room & inline UI */
  --z-room-elements: var(--z-index-content-front, 15);

  /* Miscellaneous */
  --z-index-raised: var(--z-index-base);
  --z-index-far-behind: -2;
  --z-image-viewer: 100400;
  --z-debug: var(--z-index-god-mode);
}

/* Admin-only overlay z-index overrides (scoped by route) */
body[data-page^='admin'] {
  --wf-admin-overlay-z: var(--z-admin-overlay);
  --wf-admin-overlay-content-z: var(--z-admin-overlay-content);
}

/*
 * Checkout/Payment overlay must be above the cart overlay and room modal overlays.
 * Cart overlay uses var(--z-overlay) â‰ˆ 10050; room modal sits much lower (~2400).
 * Bump checkout overlay slightly above the cart overlay to ensure visibility.
 */
.confirmation-modal-overlay.checkout-overlay {
  z-index: var(--z-index-checkout-overlay); /* above cart overlay default */
  /* Prevent fullscreen stretch: position modal as a centered flex child */
  display: flex;
  align-items: flex-start; /* honor margin-top offset under header */
  justify-content: center;
}
.confirmation-modal-overlay.checkout-overlay .confirmation-modal {
  z-index: var(--z-index-checkout-content); /* ensure content sits above its own backdrop */
}

/* When combined with under-header, force above header and cart overlay */
.confirmation-modal-overlay.checkout-overlay.under-header {
  z-index: var(--z-index-checkout-overlay) !important;
}
.confirmation-modal-overlay.checkout-overlay.under-header .confirmation-modal {
  z-index: var(--z-index-checkout-content) !important;
}

/* Fallback visibility: if aria-hidden is false, force overlay visible even if `.show` hasn't applied yet */
.confirmation-modal-overlay.checkout-overlay[aria-hidden="false"],
html body .confirmation-modal-overlay.checkout-overlay[aria-hidden="false"],
.confirmation-modal-overlay.checkout-overlay[data-force-visible="1"],
html body .confirmation-modal-overlay.checkout-overlay[data-force-visible="1"] {
  opacity: 1 !important;
  visibility: visible !important;
  display: flex !important;
}
.confirmation-modal-overlay.checkout-overlay[aria-hidden="false"] .confirmation-modal,
html body .confirmation-modal-overlay.checkout-overlay[aria-hidden="false"] .confirmation-modal,
.confirmation-modal-overlay.checkout-overlay[data-force-visible="1"] .confirmation-modal {
  transform: scale(1) translateY(0) !important;
}

/* Receipt overlay: ensure it appears below the fixed header with correct padding and is always on top */
.confirmation-modal-overlay.receipt-overlay {
  z-index: var(--z-index-receipt-overlay) !important;
  /* Position content at the top of the viewport; content handles its own offset */
  align-items: flex-start !important;
}
.confirmation-modal-overlay.receipt-overlay .confirmation-modal {
  /* Offset the modal content below the fixed header without affecting page layout */
  margin-top: calc(var(--wf-header-height, var(--header-height, 80px)) + 8px);
  transform: none !important;
}

/* Payment modal: offset under header too */
.confirmation-modal-overlay.checkout-overlay .confirmation-modal.payment-modal {
  margin-top: calc(var(--wf-header-height, var(--header-height, 80px)) + 8px);
  transform: none !important;
}

/* Toast/notification container should sit above most UI */
#wf-notification-container {
  position: fixed;
  z-index: var(--z-index-toast);
}

/* When the checkout modal is open, fully hide any /payment page content behind it */
body[data-checkout-modal-open='1'] main,
body[data-checkout-modal-open='1'] .page-content,
body[data-checkout-modal-open='1'] #content,
body[data-checkout-modal-open='1'] #app,
body[data-checkout-modal-open='1'] #root,
body[data-checkout-modal-open='1'] #paymentRoot,
body[data-checkout-modal-open='1'] .payment-page,
body[data-checkout-modal-open='1'] .payment-container {
  display: none !important;
}

/* Explicit IDs used by payment.php */
body[data-checkout-modal-open='1'] #paymentPage,
body[data-checkout-modal-open='1'] #checkoutRoot {
  display: none !important;
}
