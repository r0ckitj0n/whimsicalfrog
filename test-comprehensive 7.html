<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comprehensive Popup Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; margin: 0; }
        .test-container { max-width: 800px; margin: 0 auto; }
        .test-popup {
            border: 1px solid #ccc;
            padding: 15px;
            margin: 10px 0;
            background: #f9f9f9;
            cursor: pointer;
            border-radius: 5px;
        }
        .test-popup:hover { background: #e9e9e9; }
        #test-result {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: #f8f9fa;
        }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        button {
            background: #007cba;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #005a87; }
        button:disabled { background: #ccc; cursor: not-allowed; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üéØ Comprehensive Popup Click Test</h1>

        <div id="test-controls">
            <button onclick="loadGlobalItemModal()">Load Global Item Modal</button>
            <button onclick="testFunctionAvailability()">Test Function Availability</button>
            <button onclick="clearResults()">Clear Results</button>
        </div>

        <div class="test-popup" onclick="simulatePopupClick()">
            <div><strong>üñ±Ô∏è Test Popup</strong></div>
            <div>SKU: WF-TU-001</div>
            <div>Name: Test Item</div>
            <div>Price: $19.99</div>
            <small>Click to test popup click functionality</small>
        </div>

        <div id="test-result">
            <h3>üìä Test Results:</h3>
            <div id="results">Ready to test...</div>
        </div>
    </div>

    <script type="module">
        let globalItemModalLoaded = false;

        function addResult(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = type;
            div.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            results.appendChild(div);
            console.log(`[TEST] ${message}`);
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
            addResult('Results cleared', 'info');
        }

        async function loadGlobalItemModal() {
            try {
                addResult('üîÑ Loading global-item-modal.js...', 'info');

                // Load the actual module
                await import('/src/js/global-item-modal.js');

                addResult('‚úÖ Module loaded successfully', 'success');
                globalItemModalLoaded = true;

                // Check if functions are available
                testFunctionAvailability();
            } catch (error) {
                addResult(`‚ùå Failed to load module: ${error.message}`, 'error');
                console.error('[TEST] Module load error:', error);
            }
        }

        function testFunctionAvailability() {
            const results = [];

            // Test window.showGlobalItemModal
            if (typeof window.showGlobalItemModal === 'function') {
                results.push('‚úÖ window.showGlobalItemModal is available');
            } else {
                results.push('‚ùå window.showGlobalItemModal is NOT available');
            }

            // Test window.WhimsicalFrog.GlobalModal.show
            if (window.WhimsicalFrog?.GlobalModal?.show) {
                results.push('‚úÖ window.WhimsicalFrog.GlobalModal.show is available');
            } else {
                results.push('‚ùå window.WhimsicalFrog.GlobalModal.show is NOT available');
            }

            // Test getCurrentModalItem
            if (typeof window.WhimsicalFrog?.GlobalModal?.getCurrentItem === 'function') {
                results.push('‚úÖ window.WhimsicalFrog.GlobalModal.getCurrentItem is available');
            } else {
                results.push('‚ùå window.WhimsicalFrog.GlobalModal.getCurrentItem is NOT available');
            }

            results.forEach(result => addResult(result, result.includes('‚úÖ') ? 'success' : 'error'));
        }

        function simulatePopupClick() {
            const testItem = {
                sku: 'WF-TU-001',
                name: 'Test Item',
                price: 19.99,
                stockLevel: 10
            };

            addResult('üñ±Ô∏è Simulating popup click...', 'info');
            addResult(`üì¶ Item data: ${JSON.stringify(testItem)}`, 'info');

            if (typeof window.showGlobalItemModal === 'function') {
                try {
                    addResult('üöÄ Calling window.showGlobalItemModal...', 'info');
                    window.showGlobalItemModal(testItem.sku, testItem);
                    addResult('‚úÖ showGlobalItemModal called successfully', 'success');
                } catch (error) {
                    addResult(`‚ùå Error calling showGlobalItemModal: ${error.message}`, 'error');
                    console.error('[TEST] Error:', error);
                }
            } else {
                addResult('‚ùå window.showGlobalItemModal is not available for calling', 'error');
            }
        }

        // Auto-load the module on page load
        window.addEventListener('load', () => {
            addResult('üîÑ Page loaded, auto-loading global-item-modal.js...', 'info');
            loadGlobalItemModal();
        });
    </script>
</body>
</html>
